import{r as A,a as bp,g as vp,R as xo}from"./vendor-F9Y4d3HK.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function a(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(i){if(i.ep)return;i.ep=!0;const l=a(i);fetch(i.href,l)}})();var pu={exports:{}},$i={};/** // gitleaks:allow
 * @license React // gitleaks:allow
 * react-jsx-runtime.production.min.js // gitleaks:allow
 * // gitleaks:allow
 * Copyright (c) Facebook, Inc. and its affiliates. // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the MIT license found in the // gitleaks:allow
 * LICENSE file in the root directory of this source tree. // gitleaks:allow
 */var yp=A,jp=Symbol.for("react.element"),_p=Symbol.for("react.fragment"),Np=Object.prototype.hasOwnProperty,wp=yp.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Sp={key:!0,ref:!0,__self:!0,__source:!0};function fu(e,s,a){var n,i={},l=null,o=null;a!==void 0&&(l=""+a),s.key!==void 0&&(l=""+s.key),s.ref!==void 0&&(o=s.ref);for(n in s)Np.call(s,n)&&!Sp.hasOwnProperty(n)&&(i[n]=s[n]);if(e&&e.defaultProps)for(n in s=e.defaultProps,s)i[n]===void 0&&(i[n]=s[n]);return{$$typeof:jp,type:e,key:l,ref:o,props:i,_owner:wp.current}}$i.Fragment=_p;$i.jsx=fu;$i.jsxs=fu;pu.exports=$i;var t=pu.exports,Rl={},_c=bp;Rl.createRoot=_c.createRoot,Rl.hydrateRoot=_c.hydrateRoot;const Cp={},Nc=e=>{let s;const a=new Set,n=(r,c)=>{const d=typeof r=="function"?r(s):r;if(!Object.is(d,s)){const g=s;s=c??(typeof d!="object"||d===null)?d:Object.assign({},s,d),a.forEach(v=>v(s,g))}},i=()=>s,m={setState:n,getState:i,getInitialState:()=>h,subscribe:r=>(a.add(r),()=>a.delete(r)),destroy:()=>{(Cp?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),a.clear()}},h=s=e(n,i,m);return m},xu=e=>e?Nc(e):Nc;var gu={exports:{}},bu={},vu={exports:{}},yu={};/** // gitleaks:allow
 * @license React // gitleaks:allow
 * use-sync-external-store-shim.production.js // gitleaks:allow
 * // gitleaks:allow
 * Copyright (c) Meta Platforms, Inc. and affiliates. // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the MIT license found in the // gitleaks:allow
 * LICENSE file in the root directory of this source tree. // gitleaks:allow
 */var $n=A;function kp(e,s){return e===s&&(e!==0||1/e===1/s)||e!==e&&s!==s}var Mp=typeof Object.is=="function"?Object.is:kp,Rp=$n.useState,Tp=$n.useEffect,Ep=$n.useLayoutEffect,Ap=$n.useDebugValue;function Pp(e,s){var a=s(),n=Rp({inst:{value:a,getSnapshot:s}}),i=n[0].inst,l=n[1];return Ep(function(){i.value=a,i.getSnapshot=s,el(i)&&l({inst:i})},[e,a,s]),Tp(function(){return el(i)&&l({inst:i}),e(function(){el(i)&&l({inst:i})})},[e]),Ap(a),a}function el(e){var s=e.getSnapshot;e=e.value;try{var a=s();return!Mp(e,a)}catch{return!0}}function Ip(e,s){return s()}var Op=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Ip:Pp;yu.useSyncExternalStore=$n.useSyncExternalStore!==void 0?$n.useSyncExternalStore:Op;vu.exports=yu;var Lp=vu.exports;/** // gitleaks:allow
 * @license React // gitleaks:allow
 * use-sync-external-store-shim/with-selector.production.js // gitleaks:allow
 * // gitleaks:allow
 * Copyright (c) Meta Platforms, Inc. and affiliates. // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the MIT license found in the // gitleaks:allow
 * LICENSE file in the root directory of this source tree. // gitleaks:allow
 */var Vi=A,$p=Lp;function Vp(e,s){return e===s&&(e!==0||1/e===1/s)||e!==e&&s!==s}var Dp=typeof Object.is=="function"?Object.is:Vp,Fp=$p.useSyncExternalStore,zp=Vi.useRef,Hp=Vi.useEffect,Bp=Vi.useMemo,Wp=Vi.useDebugValue;bu.useSyncExternalStoreWithSelector=function(e,s,a,n,i){var l=zp(null);if(l.current===null){var o={hasValue:!1,value:null};l.current=o}else o=l.current;l=Bp(function(){function m(g){if(!h){if(h=!0,r=g,g=n(g),i!==void 0&&o.hasValue){var v=o.value;if(i(v,g))return c=v}return c=g}if(v=c,Dp(r,g))return v;var S=n(g);return i!==void 0&&i(v,S)?(r=g,v):(r=g,c=S)}var h=!1,r,c,d=a===void 0?null:a;return[function(){return m(s())},d===null?void 0:function(){return m(d())}]},[s,a,n,i]);var u=Fp(e,l[0],l[1]);return Hp(function(){o.hasValue=!0,o.value=u},[u]),Wp(u),u};gu.exports=bu;var Up=gu.exports;const ju=vp(Up),_u={},{useDebugValue:qp}=xo,{useSyncExternalStoreWithSelector:Gp}=ju;let wc=!1;const Yp=e=>e;function Kp(e,s=Yp,a){(_u?"production":void 0)!=="production"&&a&&!wc&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),wc=!0);const n=Gp(e.subscribe,e.getState,e.getServerState||e.getInitialState,s,a);return qp(n),n}const Sc=e=>{(_u?"production":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const s=typeof e=="function"?xu(e):e,a=(n,i)=>Kp(s,n,i);return Object.assign(a,s),a},Yn=e=>e?Sc(e):Sc;let Yr=null;async function Nu(){if(Yr)return Yr;try{return Yr=(await(await fetch("/api/version")).json()).dao_ai,Yr||void 0}catch(e){console.error("Failed to fetch DAO AI version:",e);return}}const Cc={variables:{},schemas:{},resources:{llms:{},vector_stores:{},genie_rooms:{},tables:{},volumes:{},functions:{},warehouses:{},databases:{},connections:{},apps:{}},retrievers:{},tools:{},guardrails:{},prompts:{},agents:{},app:void 0},nt=Yn((e,s)=>({config:Cc,skippedSteps:new Set,daoAiVersion:null,hasUnsavedAppChanges:!1,setConfig:a=>e({config:a,skippedSteps:new Set,hasUnsavedAppChanges:!1}),setDaoAiVersion:a=>e({daoAiVersion:a}),setHasUnsavedAppChanges:a=>e({hasUnsavedAppChanges:a}),updateConfig:a=>e(n=>({config:{...n.config,...a}})),skipStep:a=>e(n=>({skippedSteps:new Set(n.skippedSteps).add(a)})),unskipStep:a=>e(n=>{const i=new Set(n.skippedSteps);return i.delete(a),{skippedSteps:i}}),addVariable:(a,n)=>e(i=>({config:{...i.config,variables:{...i.config.variables,[a]:n}}})),updateVariable:(a,n)=>e(i=>({config:{...i.config,variables:{...i.config.variables,[a]:n}}})),removeVariable:a=>e(n=>{const i={...n.config.variables};return i==null||delete i[a],{config:{...n.config,variables:i}}}),updateMemory:a=>e(n=>({config:{...n.config,memory:a}})),addDatabase:(a,n)=>e(i=>{var l;return{config:{...i.config,resources:{...i.config.resources,databases:{...(l=i.config.resources)==null?void 0:l.databases,[a]:n}}}}}),updateDatabase:(a,n)=>e(i=>{var o;const l={...(o=i.config.resources)==null?void 0:o.databases};return l!=null&&l[a]&&(l[a]={...l[a],...n}),{config:{...i.config,resources:{...i.config.resources,databases:l||{}}}}}),removeDatabase:a=>e(n=>{var l;const i={...(l=n.config.resources)==null?void 0:l.databases};return i==null||delete i[a],{config:{...n.config,resources:{...n.config.resources,databases:i||{}}}}}),addSchema:(a,n)=>e(i=>({config:{...i.config,schemas:{...i.config.schemas,[a]:n}}})),updateSchema:(a,n)=>e(i=>{const l={...i.config.schemas};return l!=null&&l[a]&&(l[a]={...l[a],...n}),{config:{...i.config,schemas:l}}}),removeSchema:a=>e(n=>{const i={...n.config.schemas};return i==null||delete i[a],{config:{...n.config,schemas:i}}}),addLLM:(a,n)=>e(i=>{var l;return{config:{...i.config,resources:{...i.config.resources,llms:{...(l=i.config.resources)==null?void 0:l.llms,[a]:n}}}}}),updateLLM:(a,n)=>e(i=>{var o;const l={...(o=i.config.resources)==null?void 0:o.llms};return l!=null&&l[a]&&(l[a]={...l[a],...n}),{config:{...i.config,resources:{...i.config.resources,llms:l||{}}}}}),removeLLM:a=>e(n=>{var l;const i={...(l=n.config.resources)==null?void 0:l.llms};return i==null||delete i[a],{config:{...n.config,resources:{...n.config.resources,llms:i||{}}}}}),addGenieRoom:(a,n)=>e(i=>{var l;return{config:{...i.config,resources:{...i.config.resources,genie_rooms:{...(l=i.config.resources)==null?void 0:l.genie_rooms,[a]:n}}}}}),updateGenieRoom:(a,n)=>e(i=>{var o;const l={...(o=i.config.resources)==null?void 0:o.genie_rooms};return l!=null&&l[a]&&(l[a]={...l[a],...n}),{config:{...i.config,resources:{...i.config.resources,genie_rooms:l||{}}}}}),removeGenieRoom:a=>e(n=>{var l;const i={...(l=n.config.resources)==null?void 0:l.genie_rooms};return i==null||delete i[a],{config:{...n.config,resources:{...n.config.resources,genie_rooms:i||{}}}}}),addTable:(a,n)=>e(i=>{var l;return{config:{...i.config,resources:{...i.config.resources,tables:{...(l=i.config.resources)==null?void 0:l.tables,[a]:n}}}}}),updateTable:(a,n)=>e(i=>{var o;const l={...(o=i.config.resources)==null?void 0:o.tables};return l!=null&&l[a]&&(l[a]={...l[a],...n}),{config:{...i.config,resources:{...i.config.resources,tables:l||{}}}}}),removeTable:a=>e(n=>{var l;const i={...(l=n.config.resources)==null?void 0:l.tables};return i==null||delete i[a],{config:{...n.config,resources:{...n.config.resources,tables:i||{}}}}}),addVolume:(a,n)=>e(i=>{var l;return{config:{...i.config,resources:{...i.config.resources,volumes:{...(l=i.config.resources)==null?void 0:l.volumes,[a]:n}}}}}),updateVolume:(a,n)=>e(i=>{var o;const l={...(o=i.config.resources)==null?void 0:o.volumes};return l!=null&&l[a]&&(l[a]={...l[a],...n}),{config:{...i.config,resources:{...i.config.resources,volumes:l||{}}}}}),removeVolume:a=>e(n=>{var l;const i={...(l=n.config.resources)==null?void 0:l.volumes};return i==null||delete i[a],{config:{...n.config,resources:{...n.config.resources,volumes:i||{}}}}}),addFunction:(a,n)=>e(i=>{var l;return{config:{...i.config,resources:{...i.config.resources,functions:{...(l=i.config.resources)==null?void 0:l.functions,[a]:n}}}}}),updateFunction:(a,n)=>e(i=>{var o;const l={...(o=i.config.resources)==null?void 0:o.functions};return l!=null&&l[a]&&(l[a]={...l[a],...n}),{config:{...i.config,resources:{...i.config.resources,functions:l||{}}}}}),removeFunction:a=>e(n=>{var l;const i={...(l=n.config.resources)==null?void 0:l.functions};return i==null||delete i[a],{config:{...n.config,resources:{...n.config.resources,functions:i||{}}}}}),addWarehouse:(a,n)=>e(i=>{var l;return{config:{...i.config,resources:{...i.config.resources,warehouses:{...(l=i.config.resources)==null?void 0:l.warehouses,[a]:n}}}}}),updateWarehouse:(a,n)=>e(i=>{var o;const l={...(o=i.config.resources)==null?void 0:o.warehouses};return l!=null&&l[a]&&(l[a]={...l[a],...n}),{config:{...i.config,resources:{...i.config.resources,warehouses:l||{}}}}}),removeWarehouse:a=>e(n=>{var l;const i={...(l=n.config.resources)==null?void 0:l.warehouses};return i==null||delete i[a],{config:{...n.config,resources:{...n.config.resources,warehouses:i||{}}}}}),addConnection:(a,n)=>e(i=>{var l;return{config:{...i.config,resources:{...i.config.resources,connections:{...(l=i.config.resources)==null?void 0:l.connections,[a]:n}}}}}),updateConnection:(a,n)=>e(i=>{var o;const l={...(o=i.config.resources)==null?void 0:o.connections};return l!=null&&l[a]&&(l[a]={...l[a],...n}),{config:{...i.config,resources:{...i.config.resources,connections:l||{}}}}}),removeConnection:a=>e(n=>{var l;const i={...(l=n.config.resources)==null?void 0:l.connections};return i==null||delete i[a],{config:{...n.config,resources:{...n.config.resources,connections:i||{}}}}}),addDatabricksApp:(a,n)=>e(i=>{var l;return{config:{...i.config,resources:{...i.config.resources,apps:{...(l=i.config.resources)==null?void 0:l.apps,[a]:n}}}}}),updateDatabricksApp:(a,n)=>e(i=>{var o;const l={...(o=i.config.resources)==null?void 0:o.apps};return l!=null&&l[a]&&(l[a]={...l[a],...n}),{config:{...i.config,resources:{...i.config.resources,apps:l||{}}}}}),removeDatabricksApp:a=>e(n=>{var l;const i={...(l=n.config.resources)==null?void 0:l.apps};return i==null||delete i[a],{config:{...n.config,resources:{...n.config.resources,apps:i||{}}}}}),addServicePrincipal:(a,n)=>e(i=>({config:{...i.config,service_principals:{...i.config.service_principals,[a]:n}}})),updateServicePrincipal:(a,n)=>e(i=>{const l={...i.config.service_principals};return l!=null&&l[a]&&(l[a]={...l[a],...n}),{config:{...i.config,service_principals:l}}}),removeServicePrincipal:a=>e(n=>{const i={...n.config.service_principals};return i==null||delete i[a],{config:{...n.config,service_principals:i}}}),addVectorStore:(a,n)=>e(i=>{var l;return{config:{...i.config,resources:{...i.config.resources,vector_stores:{...(l=i.config.resources)==null?void 0:l.vector_stores,[a]:n}}}}}),updateVectorStore:(a,n)=>e(i=>{var o;const l={...(o=i.config.resources)==null?void 0:o.vector_stores};return l!=null&&l[a]&&(l[a]={...l[a],...n}),{config:{...i.config,resources:{...i.config.resources,vector_stores:l||{}}}}}),removeVectorStore:a=>e(n=>{var l;const i={...(l=n.config.resources)==null?void 0:l.vector_stores};return i==null||delete i[a],{config:{...n.config,resources:{...n.config.resources,vector_stores:i||{}}}}}),addRetriever:(a,n)=>e(i=>({config:{...i.config,retrievers:{...i.config.retrievers,[a]:n}}})),updateRetriever:(a,n)=>e(i=>{const l={...i.config.retrievers};return l!=null&&l[a]&&(l[a]={...l[a],...n}),{config:{...i.config,retrievers:l}}}),removeRetriever:a=>e(n=>{const i={...n.config.retrievers};return i==null||delete i[a],{config:{...n.config,retrievers:i}}}),addTool:(a,n)=>e(i=>({config:{...i.config,tools:{...i.config.tools,[a]:n}}})),updateTool:(a,n)=>e(i=>{const l={...i.config.tools};return l!=null&&l[a]&&(l[a]={...l[a],...n}),{config:{...i.config,tools:l}}}),removeTool:a=>e(n=>{const i={...n.config.tools};return i==null||delete i[a],{config:{...n.config,tools:i}}}),addGuardrail:(a,n)=>e(i=>({config:{...i.config,guardrails:{...i.config.guardrails,[a]:n}}})),updateGuardrail:(a,n)=>e(i=>{const l={...i.config.guardrails};return l!=null&&l[a]&&(l[a]={...l[a],...n}),{config:{...i.config,guardrails:l}}}),removeGuardrail:a=>e(n=>{const i={...n.config.guardrails};return i==null||delete i[a],{config:{...n.config,guardrails:i}}}),addMiddleware:(a,n)=>e(i=>({config:{...i.config,middleware:{...i.config.middleware,[a]:n}}})),updateMiddleware:(a,n)=>e(i=>{const l={...i.config.middleware};return l!=null&&l[a]&&(l[a]={...l[a],...n}),{config:{...i.config,middleware:l}}}),removeMiddleware:a=>e(n=>{const i={...n.config.middleware};return i==null||delete i[a],{config:{...n.config,middleware:i}}}),addPrompt:(a,n)=>e(i=>({config:{...i.config,prompts:{...i.config.prompts,[a]:n}}})),updatePrompt:(a,n)=>e(i=>{const l={...i.config.prompts};return l!=null&&l[a]&&(l[a]={...l[a],...n}),{config:{...i.config,prompts:l}}}),removePrompt:a=>e(n=>{const i={...n.config.prompts};return i==null||delete i[a],{config:{...n.config,prompts:i}}}),addAgent:(a,n)=>e(i=>{var u;const l={...i.config.agents,[a]:n},o=[...((u=i.config.app)==null?void 0:u.agents)||[],n];return{config:{...i.config,agents:l,app:i.config.app?{...i.config.app,agents:o}:void 0}}}),updateAgent:(a,n)=>e(i=>{var o,u;const l={...i.config.agents};if(l!=null&&l[a]){l[a]={...l[a],...n};const m=((u=(o=i.config.app)==null?void 0:o.agents)==null?void 0:u.map(h=>h.name===a?{...h,...n}:h))||[];return{config:{...i.config,agents:l,app:i.config.app?{...i.config.app,agents:m}:void 0}}}return{config:i.config}}),removeAgent:a=>e(n=>{var o,u;const i={...n.config.agents};i==null||delete i[a];const l=((u=(o=n.config.app)==null?void 0:o.agents)==null?void 0:u.filter(m=>m.name!==a))||[];return{config:{...n.config,agents:i,app:n.config.app?{...n.config.app,agents:l}:void 0}}}),updateApp:a=>e(n=>{var i,l,o;return{config:{...n.config,app:{name:((i=n.config.app)==null?void 0:i.name)||"",registered_model:((l=n.config.app)==null?void 0:l.registered_model)||{name:""},agents:((o=n.config.app)==null?void 0:o.agents)||[],...n.config.app,...a}}}}),reset:()=>{const a=s().daoAiVersion||void 0,n={...Cc,version:a};e({config:n,skippedSteps:new Set})}}));Nu().then(e=>{e&&nt.getState().setDaoAiVersion(e)});Nu().then(e=>{e&&(nt.getState().config.version||nt.getState().updateConfig({version:e}))});/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */var Xp={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Jp=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),ye=(e,s)=>{const a=A.forwardRef(({color:n="currentColor",size:i=24,strokeWidth:l=2,absoluteStrokeWidth:o,className:u="",children:m,...h},r)=>A.createElement("svg",{ref:r,...Xp,width:i,height:i,stroke:n,strokeWidth:o?Number(l)*24/Number(i):l,className:["lucide",`lucide-${Jp(e)}`,u].join(" "),...h},[...s.map(([c,d])=>A.createElement(c,d)),...Array.isArray(m)?m:[m]]));return a.displayName=`${e}`,a};/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Vn=ye("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const fr=ye("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Tl=ye("AppWindow",[["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}],["path",{d:"M10 4v4",key:"pp8u80"}],["path",{d:"M2 8h20",key:"d11cs7"}],["path",{d:"M6 4v4",key:"1svtjw"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const kc=ye("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const El=ye("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Qp=ye("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Zp=ye("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const ts=ye("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const ef=ye("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const tf=ye("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Xs=ye("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const go=ye("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const bi=ye("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Wt=ye("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Fa=ye("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const ya=ye("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const sf=ye("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Rn=ye("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const af=ye("CloudCog",[["circle",{cx:"12",cy:"17",r:"3",key:"1spfwm"}],["path",{d:"M4.2 15.1A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.2",key:"zaobp"}],["path",{d:"m15.7 18.4-.9-.3",key:"4qxpbn"}],["path",{d:"m9.2 15.9-.9-.3",key:"17q7o2"}],["path",{d:"m10.6 20.7.3-.9",key:"1pf4s2"}],["path",{d:"m13.1 14.2.3-.9",key:"1mnuqm"}],["path",{d:"m13.6 20.7-.4-1",key:"1jpd1m"}],["path",{d:"m10.8 14.3-.4-1",key:"17ugyy"}],["path",{d:"m8.3 18.6 1-.4",key:"s42vdx"}],["path",{d:"m14.7 15.8 1-.4",key:"2wizun"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Al=ye("Code2",[["path",{d:"m18 16 4-4-4-4",key:"1inbqp"}],["path",{d:"m6 8-4 4 4 4",key:"15zrgr"}],["path",{d:"m14.5 4-5 16",key:"e7oirm"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const nf=ye("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const rf=ye("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const xr=ye("Cpu",[["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"9",y:"9",width:"6",height:"6",key:"o3kz5p"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const $t=ye("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const wu=ye("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const lf=ye("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const of=ye("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const cf=ye("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const bo=ye("FileCode",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"m10 13-2 2 2 2",key:"17smn8"}],["path",{d:"m14 17 2-2-2-2",key:"14mezr"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Ya=ye("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const df=ye("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Pl=ye("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const uf=ye("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Or=ye("GitBranch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Mc=ye("Github",[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4",key:"tonef"}],["path",{d:"M9 18c-4.51 2-5-2-7-2",key:"9comsn"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const mf=ye("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Il=ye("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Ol=ye("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Ka=ye("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Mt=ye("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const xs=ye("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const hf=ye("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const pf=ye("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Ll=ye("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Nt=ye("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const vo=ye("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const $l=ye("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const ff=ye("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Xa=ye("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Su=ye("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const ds=ye("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Lr=ye("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Ie=ye("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Ut=ye("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Cu=ye("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const xf=ye("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const gf=ye("Route",[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const bf=ye("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Ba=ye("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const vf=ye("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const gr=ye("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const ca=ye("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Ja=ye("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Rt=ye("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const vi=ye("Table2",[["path",{d:"M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18",key:"gugj83"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Vl=ye("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const tl=ye("Terminal",[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Rc=ye("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Ze=ye("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const yf=ye("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const ku=ye("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Dn=ye("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Os=ye("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const Dl=ye("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const jf=ye("Variable",[["path",{d:"M8 21s-4-3-4-9 4-9 4-9",key:"uto9ud"}],["path",{d:"M16 3s4 3 4 9-4 9-4 9",key:"4w2vsq"}],["line",{x1:"15",x2:"9",y1:"9",y2:"15",key:"f7djnv"}],["line",{x1:"9",x2:"15",y1:"9",y2:"15",key:"1shsy8"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const ma=ye("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const As=ye("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const _a=ye("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/** // gitleaks:allow
 * @license lucide-react v0.294.0 - ISC // gitleaks:allow
 * // gitleaks:allow
 * This source code is licensed under the ISC license. // gitleaks:allow
 * See the LICENSE file in the root directory of this source tree. // gitleaks:allow
 */const br=ye("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]);function Mu(e){var s,a,n="";if(typeof e=="string"||typeof e=="number")n+=e;else if(typeof e=="object")if(Array.isArray(e)){var i=e.length;for(s=0;s<i;s++)e[s]&&(a=Mu(e[s]))&&(n&&(n+=" "),n+=a)}else for(a in e)e[a]&&(n&&(n+=" "),n+=a);return n}function pt(){for(var e,s,a=0,n="",i=arguments.length;a<i;a++)(e=arguments[a])&&(s=Mu(e))&&(n&&(n+=" "),n+=s);return n}const zs=Yn(e=>({targetSection:null,targetAsset:null,scrollTimestamp:0,scrollToSection:s=>e({targetSection:s,targetAsset:null,scrollTimestamp:Date.now()}),scrollToAsset:s=>e({targetSection:null,targetAsset:s,scrollTimestamp:Date.now()}),clearTarget:()=>e({targetSection:null,targetAsset:null})})),sl=[{id:"overview",label:"Overview",icon:hf,description:"Getting started"},{id:"variables",label:"Variables",icon:Mt,description:"Config variables"},{id:"service_principals",label:"Service Principals",icon:Dn,description:"OAuth credentials"},{id:"schemas",label:"Schemas",icon:$t,description:"Unity Catalog schemas",required:!0},{id:"resources",label:"Resources",icon:Su,description:"Databricks resources",required:!0},{id:"retrievers",label:"Retrievers",icon:Ba,description:"Vector search retrievers"},{id:"tools",label:"Tools",icon:ma,description:"Agent tools"},{id:"guardrails",label:"Guardrails",icon:Ja,description:"Safety checks"},{id:"middleware",label:"Middleware",icon:xs,description:"Agent middleware"},{id:"memory",label:"Memory",icon:Il,description:"Persistence & storage"},{id:"prompts",label:"Prompts",icon:Ya,description:"MLflow prompts"},{id:"agents",label:"Agents",icon:ts,description:"AI agents",required:!0},{id:"app",label:"Application",icon:ca,description:"App settings & orchestration",required:!0}];function _f({activeSection:e,onSectionChange:s,config:a}){const{scrollToSection:n}=zs(),i=u=>{s(u),u!=="overview"&&n(u)},l=u=>{var m,h,r,c,d,g,v,S,y,b;switch(u){case"overview":return 0;case"variables":return Object.keys(a.variables||{}).length;case"service_principals":return Object.keys(a.service_principals||{}).length;case"schemas":return Object.keys(a.schemas||{}).length;case"resources":return Object.keys(((m=a.resources)==null?void 0:m.llms)||{}).length+Object.keys(((h=a.resources)==null?void 0:h.genie_rooms)||{}).length+Object.keys(((r=a.resources)==null?void 0:r.tables)||{}).length+Object.keys(((c=a.resources)==null?void 0:c.volumes)||{}).length+Object.keys(((d=a.resources)==null?void 0:d.functions)||{}).length+Object.keys(((g=a.resources)==null?void 0:g.warehouses)||{}).length+Object.keys(((v=a.resources)==null?void 0:v.connections)||{}).length;case"retrievers":return Object.keys(a.retrievers||{}).length;case"tools":return Object.keys(a.tools||{}).length;case"guardrails":return Object.keys(a.guardrails||{}).length;case"middleware":return Object.keys(a.middleware||{}).length;case"memory":return((S=a.memory)!=null&&S.checkpointer?1:0)+((y=a.memory)!=null&&y.store?1:0);case"prompts":return Object.keys(a.prompts||{}).length;case"agents":return Object.keys(a.agents||{}).length;case"app":return(b=a.app)!=null&&b.name?1:0;default:return 0}},o=u=>{const m=l(u),h=sl.find(r=>r.id===u);return h!=null&&h.required?m>0:!0};return t.jsxs("aside",{className:"w-64 bg-slate-900 border-r border-slate-800 flex flex-col min-h-0",children:[t.jsxs("div",{className:"flex-1 overflow-y-auto min-h-0 p-4",children:[t.jsx("h2",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wider mb-3",children:"Configuration"}),t.jsx("nav",{className:"space-y-1",children:sl.map(u=>{const m=u.icon,h=l(u.id),r=o(u.id),c=e===u.id;return t.jsxs("button",{onClick:()=>i(u.id),className:pt("w-full flex items-center justify-between px-3 py-2.5 rounded-lg text-left transition-all duration-200",c?"bg-blue-500/20 text-blue-400 border border-blue-500/30":"text-slate-400 hover:bg-slate-800 hover:text-slate-200 border border-transparent"),children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(m,{className:pt("w-5 h-5",c?"text-blue-400":"text-slate-500")}),t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium",children:u.label}),t.jsx("p",{className:"text-xs text-slate-500",children:u.description})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[h>0&&t.jsx("span",{className:pt("px-1.5 py-0.5 text-xs rounded",c?"bg-blue-500/30 text-blue-300":"bg-slate-700 text-slate-400"),children:h}),u.required&&(r?t.jsx(Xs,{className:"w-4 h-4 text-emerald-500"}):t.jsx(sf,{className:"w-4 h-4 text-amber-500"}))]})]},u.id)})})]}),t.jsx("div",{className:"flex-shrink-0 p-4 border-t border-slate-800",children:t.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-3",children:[t.jsx("h3",{className:"text-xs font-semibold text-slate-400 mb-2",children:"Configuration Status"}),t.jsx("div",{className:"space-y-1.5",children:sl.filter(u=>u.required).map(u=>{const m=o(u.id);return t.jsxs("div",{className:"flex items-center justify-between text-xs",children:[t.jsx("span",{className:"text-slate-500",children:u.label}),t.jsx("span",{className:m?"text-emerald-400":"text-amber-400",children:m?" Ready":" Required"})]},u.id)})})]})})]})}const $e=A.forwardRef(({className:e,variant:s="default",children:a,...n},i)=>{const l={default:"bg-slate-800/50 border-slate-700/50",interactive:"bg-slate-800/50 border-slate-700/50 hover:border-slate-600 hover:bg-slate-800/70 cursor-pointer transition-all duration-200",highlight:"bg-gradient-to-br from-blue-500/10 to-purple-500/10 border-blue-500/30"};return t.jsx("div",{ref:i,className:pt("rounded-xl border p-4",l[s],e),...n,children:a})});$e.displayName="Card";const ee=A.forwardRef(({className:e,variant:s="primary",size:a="md",loading:n,children:i,disabled:l,...o},u)=>{const m="inline-flex items-center justify-center font-medium transition-all duration-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900 disabled:opacity-50 disabled:cursor-not-allowed",h={primary:"bg-blue-600 text-white hover:bg-blue-500 focus:ring-blue-500 shadow-lg shadow-blue-500/25",secondary:"bg-slate-700 text-slate-200 hover:bg-slate-600 focus:ring-slate-500 border border-slate-600",ghost:"bg-transparent text-slate-300 hover:bg-slate-800 hover:text-white focus:ring-slate-500",danger:"bg-red-600/20 text-red-400 hover:bg-red-600/30 focus:ring-red-500 border border-red-500/30"},r={sm:"px-3 py-1.5 text-sm gap-1.5",md:"px-4 py-2 text-sm gap-2",lg:"px-6 py-3 text-base gap-2"};return t.jsxs("button",{ref:u,className:pt(m,h[s],r[a],e),disabled:l||n,...o,children:[n&&t.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),i]})});ee.displayName="Button";const Se=A.forwardRef(({className:e,variant:s="default",children:a,...n},i)=>{const l={default:"bg-slate-700 text-slate-300",success:"bg-emerald-500/20 text-emerald-400 border-emerald-500/30",warning:"bg-amber-500/20 text-amber-400 border-amber-500/30",danger:"bg-red-500/20 text-red-400 border-red-500/30",info:"bg-blue-500/20 text-blue-400 border-blue-500/30"};return t.jsx("span",{ref:i,className:pt("inline-flex items-center px-2 py-0.5 rounded-md text-xs font-medium border",l[s],e),...n,children:a})});Se.displayName="Badge";const Kr=[{id:"schemas",title:"1. Define Schemas",description:"Set up Unity Catalog schemas for your resources",icon:$t,color:"text-blue-400",isComplete:e=>Object.keys(e.schemas||{}).length>0},{id:"resources",title:"2. Configure Resources",description:"Add LLMs, Genie rooms, tables, and other Databricks resources",icon:Su,color:"text-emerald-400",isComplete:e=>{const s=e.resources||{};return Object.keys(s.llms||{}).length>0}},{id:"tools",title:"3. Create Tools",description:"Define tools that agents can use to perform tasks",icon:ma,color:"text-amber-400",optional:!0,isComplete:e=>Object.keys(e.tools||{}).length>0},{id:"prompts",title:"4. Configure Prompts",description:"Set up prompts from MLflow Prompt Registry",icon:Ya,color:"text-purple-400",optional:!0,isComplete:e=>Object.keys(e.prompts||{}).length>0},{id:"agents",title:"5. Build Agents",description:"Create AI agents with models, tools, and prompts",icon:ts,color:"text-violet-400",isComplete:e=>Object.keys(e.agents||{}).length>0},{id:"app",title:"6. Configure Application",description:"Set up your application and deployment settings",icon:ca,color:"text-rose-400",isComplete:e=>{var s,a,n;return((s=e.app)==null?void 0:s.name)&&((n=(a=e.app)==null?void 0:a.registered_model)==null?void 0:n.name)}}];function Nf({onNavigate:e}){var r;const{config:s,skippedSteps:a,skipStep:n,unskipStep:i}=nt(),l={schemas:Object.keys(s.schemas||{}).length,llms:Object.keys(((r=s.resources)==null?void 0:r.llms)||{}).length,tools:Object.keys(s.tools||{}).length,agents:Object.keys(s.agents||{}).length,prompts:Object.keys(s.prompts||{}).length},o=Kr.filter(c=>c.isComplete(s)||a.has(c.id)).length,u=Kr.length,m=Math.round(o/u*100),h=o===0;return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-white",children:"DAO AI Configuration Builder"}),t.jsx("p",{className:"text-slate-400 mt-1",children:"Build and configure multi-agent AI systems for Databricks"})]}),t.jsxs($e,{className:"bg-gradient-to-br from-slate-800/80 to-slate-900/80 border-slate-700/50",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center",children:t.jsx(Rt,{className:"w-5 h-5 text-blue-400"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-white",children:h?"Get Started":"Configuration Progress"}),t.jsx("p",{className:"text-sm text-slate-400",children:h?"Follow the steps below to build your agent configuration":`${o} of ${u} steps completed`})]})]}),!h&&t.jsxs("div",{className:"text-right",children:[t.jsxs("span",{className:"text-2xl font-bold text-white",children:[m,"%"]}),t.jsx("p",{className:"text-xs text-slate-500",children:"complete"})]})]}),t.jsx("div",{className:"w-full bg-slate-700/50 rounded-full h-2 mb-4",children:t.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-violet-500 h-2 rounded-full transition-all duration-500",style:{width:`${m}%`}})}),!h&&t.jsxs("div",{className:"grid grid-cols-5 gap-4 pt-2",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-lg font-semibold text-white",children:l.schemas}),t.jsx("p",{className:"text-xs text-slate-500",children:"Schemas"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-lg font-semibold text-white",children:l.llms}),t.jsx("p",{className:"text-xs text-slate-500",children:"LLMs"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-lg font-semibold text-white",children:l.tools}),t.jsx("p",{className:"text-xs text-slate-500",children:"Tools"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-lg font-semibold text-white",children:l.prompts}),t.jsx("p",{className:"text-xs text-slate-500",children:"Prompts"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-lg font-semibold text-white",children:l.agents}),t.jsx("p",{className:"text-xs text-slate-500",children:"Agents"})]})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"text-lg font-semibold text-white",children:h?"Getting Started":"Configuration Steps"}),Kr.map((c,d)=>{const g=c.icon,v=c.isComplete(s),S=a.has(c.id),y=!v&&!S&&Kr.slice(0,d).every(b=>b.isComplete(s)||a.has(b.id));return t.jsx($e,{variant:y?"highlight":"default",className:`transition-all duration-200 ${y?"ring-1 ring-blue-500/50":""}`,children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${v||S?"bg-emerald-500/20":y?"bg-blue-500/20":"bg-slate-700/50"}`,children:v||S?t.jsx(Xs,{className:"w-5 h-5 text-emerald-400"}):t.jsx(g,{className:`w-5 h-5 ${y?c.color:"text-slate-500"}`})}),t.jsxs("div",{children:[t.jsxs("h4",{className:`font-medium ${v||S?"text-slate-400":"text-white"}`,children:[c.title,c.optional&&!v&&!S&&t.jsx("span",{className:"text-xs text-slate-500 ml-2",children:"(Optional)"})]}),t.jsx("p",{className:"text-sm text-slate-500",children:c.description})]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[v&&t.jsx(Se,{variant:"success",children:"Complete"}),S&&t.jsx(Se,{variant:"success",children:"Skipped"}),y&&t.jsx(Se,{variant:"info",children:"Next Step"}),c.optional&&!v&&!S&&t.jsx(ee,{variant:"secondary",size:"sm",onClick:()=>n(c.id),children:"Skip"}),t.jsxs(ee,{variant:y?"primary":"secondary",size:"sm",onClick:()=>{S&&i(c.id),e(c.id)},children:[v||S?"Edit":y?"Start":"Configure",t.jsx(Qp,{className:"w-4 h-4 ml-1"})]})]})]})},c.id)})]}),t.jsxs($e,{children:[t.jsx("h3",{className:"font-semibold text-white mb-4",children:"Quick Actions"}),t.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.jsxs("button",{onClick:()=>e("prompts"),className:"flex items-center space-x-3 p-3 bg-slate-800/50 hover:bg-slate-700/50 rounded-lg transition-colors text-left",children:[t.jsx(Ya,{className:"w-5 h-5 text-violet-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-white",children:"Manage Prompts"}),t.jsx("p",{className:"text-xs text-slate-500",children:"MLflow registry"})]})]}),t.jsxs("button",{onClick:()=>e("memory"),className:"flex items-center space-x-3 p-3 bg-slate-800/50 hover:bg-slate-700/50 rounded-lg transition-colors text-left",children:[t.jsx($t,{className:"w-5 h-5 text-cyan-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-white",children:"Configure Memory"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Persistence options"})]})]}),t.jsxs("button",{onClick:()=>e("app"),className:"flex items-center space-x-3 p-3 bg-slate-800/50 hover:bg-slate-700/50 rounded-lg transition-colors text-left",children:[t.jsx(ts,{className:"w-5 h-5 text-amber-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-white",children:"Configure Application"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Orchestration & deployment"})]})]})]})]}),t.jsx("div",{className:"text-center text-sm text-slate-500 py-4",children:t.jsx("p",{children:" Tip: Use the YAML preview on the right to see your configuration in real-time"})})]})}const U=A.forwardRef(({className:e,label:s,error:a,hint:n,id:i,...l},o)=>{const u=i||(s==null?void 0:s.toLowerCase().replace(/\s+/g,"-"));return t.jsxs("div",{className:"space-y-1.5",children:[s&&t.jsxs("label",{htmlFor:u,className:"block text-sm font-medium text-slate-300",children:[s,l.required&&t.jsx("span",{className:"text-red-400 ml-1",children:"*"})]}),t.jsx("input",{ref:o,id:u,className:pt("w-full px-3 py-2 bg-slate-800/50 border rounded-lg text-slate-200 placeholder-slate-500","focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500","transition-all duration-200",a?"border-red-500/50":"border-slate-700",e),...l}),n&&!a&&t.jsx("p",{className:"text-xs text-slate-500",children:n}),a&&t.jsx("p",{className:"text-xs text-red-400",children:a})]})});U.displayName="Input";const ae=A.forwardRef(({className:e,label:s,error:a,hint:n,options:i,placeholder:l,id:o,...u},m)=>{const h=o||(s==null?void 0:s.toLowerCase().replace(/\s+/g,"-")),r=i.length===0;return t.jsxs("div",{className:"space-y-1.5",children:[s&&t.jsxs("label",{htmlFor:h,className:"block text-sm font-medium text-slate-300",children:[s,u.required&&t.jsx("span",{className:"text-red-400 ml-1",children:"*"})]}),t.jsx("div",{className:"relative",children:r?t.jsxs("div",{className:pt("w-full px-3 py-2 bg-slate-800/50 border rounded-lg appearance-none","transition-all duration-200","border-slate-700 text-sm text-slate-500",e),children:["No options available",t.jsx(Wt,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500 pointer-events-none"})]}):t.jsxs(t.Fragment,{children:[t.jsxs("select",{ref:m,id:h,className:pt("w-full px-3 py-2 bg-slate-800/50 border rounded-lg text-slate-200 appearance-none","focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500","transition-all duration-200",a?"border-red-500/50":"border-slate-700",u.disabled?"opacity-50 cursor-not-allowed text-slate-500":"cursor-pointer",e),...u,children:[l&&t.jsx("option",{value:"",className:"text-slate-500",children:l}),i.map(c=>t.jsx("option",{value:c.value,className:"bg-slate-800",children:c.label},c.value))]}),t.jsx(Wt,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500 pointer-events-none"})]})}),n&&!a&&t.jsx("p",{className:"text-xs text-slate-500",children:n}),a&&t.jsx("p",{className:"text-xs text-red-400",children:a})]})});ae.displayName="Select";/*! js-yaml 4.1.1 https://github.com/nodeca/js-yaml @license MIT */function Ru(e){return typeof e>"u"||e===null}function wf(e){return typeof e=="object"&&e!==null}function Sf(e){return Array.isArray(e)?e:Ru(e)?[]:[e]}function Cf(e,s){var a,n,i,l;if(s)for(l=Object.keys(s),a=0,n=l.length;a<n;a+=1)i=l[a],e[i]=s[i];return e}function kf(e,s){var a="",n;for(n=0;n<s;n+=1)a+=e;return a}function Mf(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}var Rf=Ru,Tf=wf,Ef=Sf,Af=kf,Pf=Mf,If=Cf,qt={isNothing:Rf,isObject:Tf,toArray:Ef,repeat:Af,isNegativeZero:Pf,extend:If};function Tu(e,s){var a="",n=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(a+='in "'+e.mark.name+'" '),a+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!s&&e.mark.snippet&&(a+=`

`+e.mark.snippet),n+" "+a):n}function vr(e,s){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=s,this.message=Tu(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}vr.prototype=Object.create(Error.prototype);vr.prototype.constructor=vr;vr.prototype.toString=function(s){return this.name+": "+Tu(this,s)};var fs=vr;function al(e,s,a,n,i){var l="",o="",u=Math.floor(i/2)-1;return n-s>u&&(l=" ... ",s=n-u+l.length),a-n>u&&(o=" ...",a=n+u-o.length),{str:l+e.slice(s,a).replace(/\t/g,"")+o,pos:n-s+l.length}}function nl(e,s){return qt.repeat(" ",s-e.length)+e}function Of(e,s){if(s=Object.create(s||null),!e.buffer)return null;s.maxLength||(s.maxLength=79),typeof s.indent!="number"&&(s.indent=1),typeof s.linesBefore!="number"&&(s.linesBefore=3),typeof s.linesAfter!="number"&&(s.linesAfter=2);for(var a=/\r?\n|\r|\0/g,n=[0],i=[],l,o=-1;l=a.exec(e.buffer);)i.push(l.index),n.push(l.index+l[0].length),e.position<=l.index&&o<0&&(o=n.length-2);o<0&&(o=n.length-1);var u="",m,h,r=Math.min(e.line+s.linesAfter,i.length).toString().length,c=s.maxLength-(s.indent+r+3);for(m=1;m<=s.linesBefore&&!(o-m<0);m++)h=al(e.buffer,n[o-m],i[o-m],e.position-(n[o]-n[o-m]),c),u=qt.repeat(" ",s.indent)+nl((e.line-m+1).toString(),r)+" | "+h.str+`
`+u;for(h=al(e.buffer,n[o],i[o],e.position,c),u+=qt.repeat(" ",s.indent)+nl((e.line+1).toString(),r)+" | "+h.str+`
`,u+=qt.repeat("-",s.indent+r+3+h.pos)+`^
`,m=1;m<=s.linesAfter&&!(o+m>=i.length);m++)h=al(e.buffer,n[o+m],i[o+m],e.position-(n[o]-n[o+m]),c),u+=qt.repeat(" ",s.indent)+nl((e.line+m+1).toString(),r)+" | "+h.str+`
`;return u.replace(/\n$/,"")}var Lf=Of,$f=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],Vf=["scalar","sequence","mapping"];function Df(e){var s={};return e!==null&&Object.keys(e).forEach(function(a){e[a].forEach(function(n){s[String(n)]=a})}),s}function Ff(e,s){if(s=s||{},Object.keys(s).forEach(function(a){if($f.indexOf(a)===-1)throw new fs('Unknown option "'+a+'" is met in definition of "'+e+'" YAML type.')}),this.options=s,this.tag=e,this.kind=s.kind||null,this.resolve=s.resolve||function(){return!0},this.construct=s.construct||function(a){return a},this.instanceOf=s.instanceOf||null,this.predicate=s.predicate||null,this.represent=s.represent||null,this.representName=s.representName||null,this.defaultStyle=s.defaultStyle||null,this.multi=s.multi||!1,this.styleAliases=Df(s.styleAliases||null),Vf.indexOf(this.kind)===-1)throw new fs('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var ss=Ff;function Tc(e,s){var a=[];return e[s].forEach(function(n){var i=a.length;a.forEach(function(l,o){l.tag===n.tag&&l.kind===n.kind&&l.multi===n.multi&&(i=o)}),a[i]=n}),a}function zf(){var e={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},s,a;function n(i){i.multi?(e.multi[i.kind].push(i),e.multi.fallback.push(i)):e[i.kind][i.tag]=e.fallback[i.tag]=i}for(s=0,a=arguments.length;s<a;s+=1)arguments[s].forEach(n);return e}function Fl(e){return this.extend(e)}Fl.prototype.extend=function(s){var a=[],n=[];if(s instanceof ss)n.push(s);else if(Array.isArray(s))n=n.concat(s);else if(s&&(Array.isArray(s.implicit)||Array.isArray(s.explicit)))s.implicit&&(a=a.concat(s.implicit)),s.explicit&&(n=n.concat(s.explicit));else throw new fs("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");a.forEach(function(l){if(!(l instanceof ss))throw new fs("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(l.loadKind&&l.loadKind!=="scalar")throw new fs("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(l.multi)throw new fs("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),n.forEach(function(l){if(!(l instanceof ss))throw new fs("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var i=Object.create(Fl.prototype);return i.implicit=(this.implicit||[]).concat(a),i.explicit=(this.explicit||[]).concat(n),i.compiledImplicit=Tc(i,"implicit"),i.compiledExplicit=Tc(i,"explicit"),i.compiledTypeMap=zf(i.compiledImplicit,i.compiledExplicit),i};var Eu=Fl,Au=new ss("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return e!==null?e:""}}),Pu=new ss("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return e!==null?e:[]}}),Iu=new ss("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return e!==null?e:{}}}),Ou=new Eu({explicit:[Au,Pu,Iu]});function Hf(e){if(e===null)return!0;var s=e.length;return s===1&&e==="~"||s===4&&(e==="null"||e==="Null"||e==="NULL")}function Bf(){return null}function Wf(e){return e===null}var Lu=new ss("tag:yaml.org,2002:null",{kind:"scalar",resolve:Hf,construct:Bf,predicate:Wf,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function Uf(e){if(e===null)return!1;var s=e.length;return s===4&&(e==="true"||e==="True"||e==="TRUE")||s===5&&(e==="false"||e==="False"||e==="FALSE")}function qf(e){return e==="true"||e==="True"||e==="TRUE"}function Gf(e){return Object.prototype.toString.call(e)==="[object Boolean]"}var $u=new ss("tag:yaml.org,2002:bool",{kind:"scalar",resolve:Uf,construct:qf,predicate:Gf,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function Yf(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function Kf(e){return 48<=e&&e<=55}function Xf(e){return 48<=e&&e<=57}function Jf(e){if(e===null)return!1;var s=e.length,a=0,n=!1,i;if(!s)return!1;if(i=e[a],(i==="-"||i==="+")&&(i=e[++a]),i==="0"){if(a+1===s)return!0;if(i=e[++a],i==="b"){for(a++;a<s;a++)if(i=e[a],i!=="_"){if(i!=="0"&&i!=="1")return!1;n=!0}return n&&i!=="_"}if(i==="x"){for(a++;a<s;a++)if(i=e[a],i!=="_"){if(!Yf(e.charCodeAt(a)))return!1;n=!0}return n&&i!=="_"}if(i==="o"){for(a++;a<s;a++)if(i=e[a],i!=="_"){if(!Kf(e.charCodeAt(a)))return!1;n=!0}return n&&i!=="_"}}if(i==="_")return!1;for(;a<s;a++)if(i=e[a],i!=="_"){if(!Xf(e.charCodeAt(a)))return!1;n=!0}return!(!n||i==="_")}function Qf(e){var s=e,a=1,n;if(s.indexOf("_")!==-1&&(s=s.replace(/_/g,"")),n=s[0],(n==="-"||n==="+")&&(n==="-"&&(a=-1),s=s.slice(1),n=s[0]),s==="0")return 0;if(n==="0"){if(s[1]==="b")return a*parseInt(s.slice(2),2);if(s[1]==="x")return a*parseInt(s.slice(2),16);if(s[1]==="o")return a*parseInt(s.slice(2),8)}return a*parseInt(s,10)}function Zf(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1===0&&!qt.isNegativeZero(e)}var Vu=new ss("tag:yaml.org,2002:int",{kind:"scalar",resolve:Jf,construct:Qf,predicate:Zf,represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),ex=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function tx(e){return!(e===null||!ex.test(e)||e[e.length-1]==="_")}function sx(e){var s,a;return s=e.replace(/_/g,"").toLowerCase(),a=s[0]==="-"?-1:1,"+-".indexOf(s[0])>=0&&(s=s.slice(1)),s===".inf"?a===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:s===".nan"?NaN:a*parseFloat(s,10)}var ax=/^[-+]?[0-9]+e/;function nx(e,s){var a;if(isNaN(e))switch(s){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(s){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(s){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(qt.isNegativeZero(e))return"-0.0";return a=e.toString(10),ax.test(a)?a.replace("e",".e"):a}function rx(e){return Object.prototype.toString.call(e)==="[object Number]"&&(e%1!==0||qt.isNegativeZero(e))}var Du=new ss("tag:yaml.org,2002:float",{kind:"scalar",resolve:tx,construct:sx,predicate:rx,represent:nx,defaultStyle:"lowercase"}),Fu=Ou.extend({implicit:[Lu,$u,Vu,Du]}),zu=Fu,Hu=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),Bu=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function ix(e){return e===null?!1:Hu.exec(e)!==null||Bu.exec(e)!==null}function lx(e){var s,a,n,i,l,o,u,m=0,h=null,r,c,d;if(s=Hu.exec(e),s===null&&(s=Bu.exec(e)),s===null)throw new Error("Date resolve error");if(a=+s[1],n=+s[2]-1,i=+s[3],!s[4])return new Date(Date.UTC(a,n,i));if(l=+s[4],o=+s[5],u=+s[6],s[7]){for(m=s[7].slice(0,3);m.length<3;)m+="0";m=+m}return s[9]&&(r=+s[10],c=+(s[11]||0),h=(r*60+c)*6e4,s[9]==="-"&&(h=-h)),d=new Date(Date.UTC(a,n,i,l,o,u,m)),h&&d.setTime(d.getTime()-h),d}function ox(e){return e.toISOString()}var Wu=new ss("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:ix,construct:lx,instanceOf:Date,represent:ox});function cx(e){return e==="<<"||e===null}var Uu=new ss("tag:yaml.org,2002:merge",{kind:"scalar",resolve:cx}),yo=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function dx(e){if(e===null)return!1;var s,a,n=0,i=e.length,l=yo;for(a=0;a<i;a++)if(s=l.indexOf(e.charAt(a)),!(s>64)){if(s<0)return!1;n+=6}return n%8===0}function ux(e){var s,a,n=e.replace(/[\r\n=]/g,""),i=n.length,l=yo,o=0,u=[];for(s=0;s<i;s++)s%4===0&&s&&(u.push(o>>16&255),u.push(o>>8&255),u.push(o&255)),o=o<<6|l.indexOf(n.charAt(s));return a=i%4*6,a===0?(u.push(o>>16&255),u.push(o>>8&255),u.push(o&255)):a===18?(u.push(o>>10&255),u.push(o>>2&255)):a===12&&u.push(o>>4&255),new Uint8Array(u)}function mx(e){var s="",a=0,n,i,l=e.length,o=yo;for(n=0;n<l;n++)n%3===0&&n&&(s+=o[a>>18&63],s+=o[a>>12&63],s+=o[a>>6&63],s+=o[a&63]),a=(a<<8)+e[n];return i=l%3,i===0?(s+=o[a>>18&63],s+=o[a>>12&63],s+=o[a>>6&63],s+=o[a&63]):i===2?(s+=o[a>>10&63],s+=o[a>>4&63],s+=o[a<<2&63],s+=o[64]):i===1&&(s+=o[a>>2&63],s+=o[a<<4&63],s+=o[64],s+=o[64]),s}function hx(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}var qu=new ss("tag:yaml.org,2002:binary",{kind:"scalar",resolve:dx,construct:ux,predicate:hx,represent:mx}),px=Object.prototype.hasOwnProperty,fx=Object.prototype.toString;function xx(e){if(e===null)return!0;var s=[],a,n,i,l,o,u=e;for(a=0,n=u.length;a<n;a+=1){if(i=u[a],o=!1,fx.call(i)!=="[object Object]")return!1;for(l in i)if(px.call(i,l))if(!o)o=!0;else return!1;if(!o)return!1;if(s.indexOf(l)===-1)s.push(l);else return!1}return!0}function gx(e){return e!==null?e:[]}var Gu=new ss("tag:yaml.org,2002:omap",{kind:"sequence",resolve:xx,construct:gx}),bx=Object.prototype.toString;function vx(e){if(e===null)return!0;var s,a,n,i,l,o=e;for(l=new Array(o.length),s=0,a=o.length;s<a;s+=1){if(n=o[s],bx.call(n)!=="[object Object]"||(i=Object.keys(n),i.length!==1))return!1;l[s]=[i[0],n[i[0]]]}return!0}function yx(e){if(e===null)return[];var s,a,n,i,l,o=e;for(l=new Array(o.length),s=0,a=o.length;s<a;s+=1)n=o[s],i=Object.keys(n),l[s]=[i[0],n[i[0]]];return l}var Yu=new ss("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:vx,construct:yx}),jx=Object.prototype.hasOwnProperty;function _x(e){if(e===null)return!0;var s,a=e;for(s in a)if(jx.call(a,s)&&a[s]!==null)return!1;return!0}function Nx(e){return e!==null?e:{}}var Ku=new ss("tag:yaml.org,2002:set",{kind:"mapping",resolve:_x,construct:Nx}),jo=zu.extend({implicit:[Wu,Uu],explicit:[qu,Gu,Yu,Ku]}),Qa=Object.prototype.hasOwnProperty,yi=1,Xu=2,Ju=3,ji=4,rl=1,wx=2,Ec=3,Sx=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,Cx=/[\x85\u2028\u2029]/,kx=/[,\[\]\{\}]/,Qu=/^(?:!|!!|![a-z\-]+!)$/i,Zu=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function Ac(e){return Object.prototype.toString.call(e)}function da(e){return e===10||e===13}function cn(e){return e===9||e===32}function _s(e){return e===9||e===32||e===10||e===13}function Tn(e){return e===44||e===91||e===93||e===123||e===125}function Mx(e){var s;return 48<=e&&e<=57?e-48:(s=e|32,97<=s&&s<=102?s-97+10:-1)}function Rx(e){return e===120?2:e===117?4:e===85?8:0}function Tx(e){return 48<=e&&e<=57?e-48:-1}function Pc(e){return e===48?"\0":e===97?"\x07":e===98?"\b":e===116||e===9?"	":e===110?`
`:e===118?"\v":e===102?"\f":e===114?"\r":e===101?"\x1B":e===32?" ":e===34?'"':e===47?"/":e===92?"\\":e===78?"":e===95?"":e===76?"\u2028":e===80?"\u2029":""}function Ex(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}function em(e,s,a){s==="__proto__"?Object.defineProperty(e,s,{configurable:!0,enumerable:!0,writable:!0,value:a}):e[s]=a}var tm=new Array(256),sm=new Array(256);for(var jn=0;jn<256;jn++)tm[jn]=Pc(jn)?1:0,sm[jn]=Pc(jn);function Ax(e,s){this.input=e,this.filename=s.filename||null,this.schema=s.schema||jo,this.onWarning=s.onWarning||null,this.legacy=s.legacy||!1,this.json=s.json||!1,this.listener=s.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function am(e,s){var a={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return a.snippet=Lf(a),new fs(s,a)}function Ae(e,s){throw am(e,s)}function _i(e,s){e.onWarning&&e.onWarning.call(null,am(e,s))}var Ic={YAML:function(s,a,n){var i,l,o;s.version!==null&&Ae(s,"duplication of %YAML directive"),n.length!==1&&Ae(s,"YAML directive accepts exactly one argument"),i=/^([0-9]+)\.([0-9]+)$/.exec(n[0]),i===null&&Ae(s,"ill-formed argument of the YAML directive"),l=parseInt(i[1],10),o=parseInt(i[2],10),l!==1&&Ae(s,"unacceptable YAML version of the document"),s.version=n[0],s.checkLineBreaks=o<2,o!==1&&o!==2&&_i(s,"unsupported YAML version of the document")},TAG:function(s,a,n){var i,l;n.length!==2&&Ae(s,"TAG directive accepts exactly two arguments"),i=n[0],l=n[1],Qu.test(i)||Ae(s,"ill-formed tag handle (first argument) of the TAG directive"),Qa.call(s.tagMap,i)&&Ae(s,'there is a previously declared suffix for "'+i+'" tag handle'),Zu.test(l)||Ae(s,"ill-formed tag prefix (second argument) of the TAG directive");try{l=decodeURIComponent(l)}catch{Ae(s,"tag prefix is malformed: "+l)}s.tagMap[i]=l}};function Wa(e,s,a,n){var i,l,o,u;if(s<a){if(u=e.input.slice(s,a),n)for(i=0,l=u.length;i<l;i+=1)o=u.charCodeAt(i),o===9||32<=o&&o<=1114111||Ae(e,"expected valid JSON character");else Sx.test(u)&&Ae(e,"the stream contains non-printable characters");e.result+=u}}function Oc(e,s,a,n){var i,l,o,u;for(qt.isObject(a)||Ae(e,"cannot merge mappings; the provided source object is unacceptable"),i=Object.keys(a),o=0,u=i.length;o<u;o+=1)l=i[o],Qa.call(s,l)||(em(s,l,a[l]),n[l]=!0)}function En(e,s,a,n,i,l,o,u,m){var h,r;if(Array.isArray(i))for(i=Array.prototype.slice.call(i),h=0,r=i.length;h<r;h+=1)Array.isArray(i[h])&&Ae(e,"nested arrays are not supported inside keys"),typeof i=="object"&&Ac(i[h])==="[object Object]"&&(i[h]="[object Object]");if(typeof i=="object"&&Ac(i)==="[object Object]"&&(i="[object Object]"),i=String(i),s===null&&(s={}),n==="tag:yaml.org,2002:merge")if(Array.isArray(l))for(h=0,r=l.length;h<r;h+=1)Oc(e,s,l[h],a);else Oc(e,s,l,a);else!e.json&&!Qa.call(a,i)&&Qa.call(s,i)&&(e.line=o||e.line,e.lineStart=u||e.lineStart,e.position=m||e.position,Ae(e,"duplicated mapping key")),em(s,i,l),delete a[i];return s}function _o(e){var s;s=e.input.charCodeAt(e.position),s===10?e.position++:s===13?(e.position++,e.input.charCodeAt(e.position)===10&&e.position++):Ae(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function Vt(e,s,a){for(var n=0,i=e.input.charCodeAt(e.position);i!==0;){for(;cn(i);)i===9&&e.firstTabInLine===-1&&(e.firstTabInLine=e.position),i=e.input.charCodeAt(++e.position);if(s&&i===35)do i=e.input.charCodeAt(++e.position);while(i!==10&&i!==13&&i!==0);if(da(i))for(_o(e),i=e.input.charCodeAt(e.position),n++,e.lineIndent=0;i===32;)e.lineIndent++,i=e.input.charCodeAt(++e.position);else break}return a!==-1&&n!==0&&e.lineIndent<a&&_i(e,"deficient indentation"),n}function Di(e){var s=e.position,a;return a=e.input.charCodeAt(s),!!((a===45||a===46)&&a===e.input.charCodeAt(s+1)&&a===e.input.charCodeAt(s+2)&&(s+=3,a=e.input.charCodeAt(s),a===0||_s(a)))}function No(e,s){s===1?e.result+=" ":s>1&&(e.result+=qt.repeat(`
`,s-1))}function Px(e,s,a){var n,i,l,o,u,m,h,r,c=e.kind,d=e.result,g;if(g=e.input.charCodeAt(e.position),_s(g)||Tn(g)||g===35||g===38||g===42||g===33||g===124||g===62||g===39||g===34||g===37||g===64||g===96||(g===63||g===45)&&(i=e.input.charCodeAt(e.position+1),_s(i)||a&&Tn(i)))return!1;for(e.kind="scalar",e.result="",l=o=e.position,u=!1;g!==0;){if(g===58){if(i=e.input.charCodeAt(e.position+1),_s(i)||a&&Tn(i))break}else if(g===35){if(n=e.input.charCodeAt(e.position-1),_s(n))break}else{if(e.position===e.lineStart&&Di(e)||a&&Tn(g))break;if(da(g))if(m=e.line,h=e.lineStart,r=e.lineIndent,Vt(e,!1,-1),e.lineIndent>=s){u=!0,g=e.input.charCodeAt(e.position);continue}else{e.position=o,e.line=m,e.lineStart=h,e.lineIndent=r;break}}u&&(Wa(e,l,o,!1),No(e,e.line-m),l=o=e.position,u=!1),cn(g)||(o=e.position+1),g=e.input.charCodeAt(++e.position)}return Wa(e,l,o,!1),e.result?!0:(e.kind=c,e.result=d,!1)}function Ix(e,s){var a,n,i;if(a=e.input.charCodeAt(e.position),a!==39)return!1;for(e.kind="scalar",e.result="",e.position++,n=i=e.position;(a=e.input.charCodeAt(e.position))!==0;)if(a===39)if(Wa(e,n,e.position,!0),a=e.input.charCodeAt(++e.position),a===39)n=e.position,e.position++,i=e.position;else return!0;else da(a)?(Wa(e,n,i,!0),No(e,Vt(e,!1,s)),n=i=e.position):e.position===e.lineStart&&Di(e)?Ae(e,"unexpected end of the document within a single quoted scalar"):(e.position++,i=e.position);Ae(e,"unexpected end of the stream within a single quoted scalar")}function Ox(e,s){var a,n,i,l,o,u;if(u=e.input.charCodeAt(e.position),u!==34)return!1;for(e.kind="scalar",e.result="",e.position++,a=n=e.position;(u=e.input.charCodeAt(e.position))!==0;){if(u===34)return Wa(e,a,e.position,!0),e.position++,!0;if(u===92){if(Wa(e,a,e.position,!0),u=e.input.charCodeAt(++e.position),da(u))Vt(e,!1,s);else if(u<256&&tm[u])e.result+=sm[u],e.position++;else if((o=Rx(u))>0){for(i=o,l=0;i>0;i--)u=e.input.charCodeAt(++e.position),(o=Mx(u))>=0?l=(l<<4)+o:Ae(e,"expected hexadecimal character");e.result+=Ex(l),e.position++}else Ae(e,"unknown escape sequence");a=n=e.position}else da(u)?(Wa(e,a,n,!0),No(e,Vt(e,!1,s)),a=n=e.position):e.position===e.lineStart&&Di(e)?Ae(e,"unexpected end of the document within a double quoted scalar"):(e.position++,n=e.position)}Ae(e,"unexpected end of the stream within a double quoted scalar")}function Lx(e,s){var a=!0,n,i,l,o=e.tag,u,m=e.anchor,h,r,c,d,g,v=Object.create(null),S,y,b,_;if(_=e.input.charCodeAt(e.position),_===91)r=93,g=!1,u=[];else if(_===123)r=125,g=!0,u={};else return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=u),_=e.input.charCodeAt(++e.position);_!==0;){if(Vt(e,!0,s),_=e.input.charCodeAt(e.position),_===r)return e.position++,e.tag=o,e.anchor=m,e.kind=g?"mapping":"sequence",e.result=u,!0;a?_===44&&Ae(e,"expected the node content, but found ','"):Ae(e,"missed comma between flow collection entries"),y=S=b=null,c=d=!1,_===63&&(h=e.input.charCodeAt(e.position+1),_s(h)&&(c=d=!0,e.position++,Vt(e,!0,s))),n=e.line,i=e.lineStart,l=e.position,Fn(e,s,yi,!1,!0),y=e.tag,S=e.result,Vt(e,!0,s),_=e.input.charCodeAt(e.position),(d||e.line===n)&&_===58&&(c=!0,_=e.input.charCodeAt(++e.position),Vt(e,!0,s),Fn(e,s,yi,!1,!0),b=e.result),g?En(e,u,v,y,S,b,n,i,l):c?u.push(En(e,null,v,y,S,b,n,i,l)):u.push(S),Vt(e,!0,s),_=e.input.charCodeAt(e.position),_===44?(a=!0,_=e.input.charCodeAt(++e.position)):a=!1}Ae(e,"unexpected end of the stream within a flow collection")}function $x(e,s){var a,n,i=rl,l=!1,o=!1,u=s,m=0,h=!1,r,c;if(c=e.input.charCodeAt(e.position),c===124)n=!1;else if(c===62)n=!0;else return!1;for(e.kind="scalar",e.result="";c!==0;)if(c=e.input.charCodeAt(++e.position),c===43||c===45)rl===i?i=c===43?Ec:wx:Ae(e,"repeat of a chomping mode identifier");else if((r=Tx(c))>=0)r===0?Ae(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):o?Ae(e,"repeat of an indentation width identifier"):(u=s+r-1,o=!0);else break;if(cn(c)){do c=e.input.charCodeAt(++e.position);while(cn(c));if(c===35)do c=e.input.charCodeAt(++e.position);while(!da(c)&&c!==0)}for(;c!==0;){for(_o(e),e.lineIndent=0,c=e.input.charCodeAt(e.position);(!o||e.lineIndent<u)&&c===32;)e.lineIndent++,c=e.input.charCodeAt(++e.position);if(!o&&e.lineIndent>u&&(u=e.lineIndent),da(c)){m++;continue}if(e.lineIndent<u){i===Ec?e.result+=qt.repeat(`
`,l?1+m:m):i===rl&&l&&(e.result+=`
`);break}for(n?cn(c)?(h=!0,e.result+=qt.repeat(`
`,l?1+m:m)):h?(h=!1,e.result+=qt.repeat(`
`,m+1)):m===0?l&&(e.result+=" "):e.result+=qt.repeat(`
`,m):e.result+=qt.repeat(`
`,l?1+m:m),l=!0,o=!0,m=0,a=e.position;!da(c)&&c!==0;)c=e.input.charCodeAt(++e.position);Wa(e,a,e.position,!1)}return!0}function Lc(e,s){var a,n=e.tag,i=e.anchor,l=[],o,u=!1,m;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=l),m=e.input.charCodeAt(e.position);m!==0&&(e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,Ae(e,"tab characters must not be used in indentation")),!(m!==45||(o=e.input.charCodeAt(e.position+1),!_s(o))));){if(u=!0,e.position++,Vt(e,!0,-1)&&e.lineIndent<=s){l.push(null),m=e.input.charCodeAt(e.position);continue}if(a=e.line,Fn(e,s,Ju,!1,!0),l.push(e.result),Vt(e,!0,-1),m=e.input.charCodeAt(e.position),(e.line===a||e.lineIndent>s)&&m!==0)Ae(e,"bad indentation of a sequence entry");else if(e.lineIndent<s)break}return u?(e.tag=n,e.anchor=i,e.kind="sequence",e.result=l,!0):!1}function Vx(e,s,a){var n,i,l,o,u,m,h=e.tag,r=e.anchor,c={},d=Object.create(null),g=null,v=null,S=null,y=!1,b=!1,_;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=c),_=e.input.charCodeAt(e.position);_!==0;){if(!y&&e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,Ae(e,"tab characters must not be used in indentation")),n=e.input.charCodeAt(e.position+1),l=e.line,(_===63||_===58)&&_s(n))_===63?(y&&(En(e,c,d,g,v,null,o,u,m),g=v=S=null),b=!0,y=!0,i=!0):y?(y=!1,i=!0):Ae(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,_=n;else{if(o=e.line,u=e.lineStart,m=e.position,!Fn(e,a,Xu,!1,!0))break;if(e.line===l){for(_=e.input.charCodeAt(e.position);cn(_);)_=e.input.charCodeAt(++e.position);if(_===58)_=e.input.charCodeAt(++e.position),_s(_)||Ae(e,"a whitespace character is expected after the key-value separator within a block mapping"),y&&(En(e,c,d,g,v,null,o,u,m),g=v=S=null),b=!0,y=!1,i=!1,g=e.tag,v=e.result;else if(b)Ae(e,"can not read an implicit mapping pair; a colon is missed");else return e.tag=h,e.anchor=r,!0}else if(b)Ae(e,"can not read a block mapping entry; a multiline key may not be an implicit key");else return e.tag=h,e.anchor=r,!0}if((e.line===l||e.lineIndent>s)&&(y&&(o=e.line,u=e.lineStart,m=e.position),Fn(e,s,ji,!0,i)&&(y?v=e.result:S=e.result),y||(En(e,c,d,g,v,S,o,u,m),g=v=S=null),Vt(e,!0,-1),_=e.input.charCodeAt(e.position)),(e.line===l||e.lineIndent>s)&&_!==0)Ae(e,"bad indentation of a mapping entry");else if(e.lineIndent<s)break}return y&&En(e,c,d,g,v,null,o,u,m),b&&(e.tag=h,e.anchor=r,e.kind="mapping",e.result=c),b}function Dx(e){var s,a=!1,n=!1,i,l,o;if(o=e.input.charCodeAt(e.position),o!==33)return!1;if(e.tag!==null&&Ae(e,"duplication of a tag property"),o=e.input.charCodeAt(++e.position),o===60?(a=!0,o=e.input.charCodeAt(++e.position)):o===33?(n=!0,i="!!",o=e.input.charCodeAt(++e.position)):i="!",s=e.position,a){do o=e.input.charCodeAt(++e.position);while(o!==0&&o!==62);e.position<e.length?(l=e.input.slice(s,e.position),o=e.input.charCodeAt(++e.position)):Ae(e,"unexpected end of the stream within a verbatim tag")}else{for(;o!==0&&!_s(o);)o===33&&(n?Ae(e,"tag suffix cannot contain exclamation marks"):(i=e.input.slice(s-1,e.position+1),Qu.test(i)||Ae(e,"named tag handle cannot contain such characters"),n=!0,s=e.position+1)),o=e.input.charCodeAt(++e.position);l=e.input.slice(s,e.position),kx.test(l)&&Ae(e,"tag suffix cannot contain flow indicator characters")}l&&!Zu.test(l)&&Ae(e,"tag name cannot contain such characters: "+l);try{l=decodeURIComponent(l)}catch{Ae(e,"tag name is malformed: "+l)}return a?e.tag=l:Qa.call(e.tagMap,i)?e.tag=e.tagMap[i]+l:i==="!"?e.tag="!"+l:i==="!!"?e.tag="tag:yaml.org,2002:"+l:Ae(e,'undeclared tag handle "'+i+'"'),!0}function Fx(e){var s,a;if(a=e.input.charCodeAt(e.position),a!==38)return!1;for(e.anchor!==null&&Ae(e,"duplication of an anchor property"),a=e.input.charCodeAt(++e.position),s=e.position;a!==0&&!_s(a)&&!Tn(a);)a=e.input.charCodeAt(++e.position);return e.position===s&&Ae(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(s,e.position),!0}function zx(e){var s,a,n;if(n=e.input.charCodeAt(e.position),n!==42)return!1;for(n=e.input.charCodeAt(++e.position),s=e.position;n!==0&&!_s(n)&&!Tn(n);)n=e.input.charCodeAt(++e.position);return e.position===s&&Ae(e,"name of an alias node must contain at least one character"),a=e.input.slice(s,e.position),Qa.call(e.anchorMap,a)||Ae(e,'unidentified alias "'+a+'"'),e.result=e.anchorMap[a],Vt(e,!0,-1),!0}function Fn(e,s,a,n,i){var l,o,u,m=1,h=!1,r=!1,c,d,g,v,S,y;if(e.listener!==null&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,l=o=u=ji===a||Ju===a,n&&Vt(e,!0,-1)&&(h=!0,e.lineIndent>s?m=1:e.lineIndent===s?m=0:e.lineIndent<s&&(m=-1)),m===1)for(;Dx(e)||Fx(e);)Vt(e,!0,-1)?(h=!0,u=l,e.lineIndent>s?m=1:e.lineIndent===s?m=0:e.lineIndent<s&&(m=-1)):u=!1;if(u&&(u=h||i),(m===1||ji===a)&&(yi===a||Xu===a?S=s:S=s+1,y=e.position-e.lineStart,m===1?u&&(Lc(e,y)||Vx(e,y,S))||Lx(e,S)?r=!0:(o&&$x(e,S)||Ix(e,S)||Ox(e,S)?r=!0:zx(e)?(r=!0,(e.tag!==null||e.anchor!==null)&&Ae(e,"alias node should not have any properties")):Px(e,S,yi===a)&&(r=!0,e.tag===null&&(e.tag="?")),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):m===0&&(r=u&&Lc(e,y))),e.tag===null)e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);else if(e.tag==="?"){for(e.result!==null&&e.kind!=="scalar"&&Ae(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),c=0,d=e.implicitTypes.length;c<d;c+=1)if(v=e.implicitTypes[c],v.resolve(e.result)){e.result=v.construct(e.result),e.tag=v.tag,e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);break}}else if(e.tag!=="!"){if(Qa.call(e.typeMap[e.kind||"fallback"],e.tag))v=e.typeMap[e.kind||"fallback"][e.tag];else for(v=null,g=e.typeMap.multi[e.kind||"fallback"],c=0,d=g.length;c<d;c+=1)if(e.tag.slice(0,g[c].tag.length)===g[c].tag){v=g[c];break}v||Ae(e,"unknown tag !<"+e.tag+">"),e.result!==null&&v.kind!==e.kind&&Ae(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+v.kind+'", not "'+e.kind+'"'),v.resolve(e.result,e.tag)?(e.result=v.construct(e.result,e.tag),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):Ae(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return e.listener!==null&&e.listener("close",e),e.tag!==null||e.anchor!==null||r}function Hx(e){var s=e.position,a,n,i,l=!1,o;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);(o=e.input.charCodeAt(e.position))!==0&&(Vt(e,!0,-1),o=e.input.charCodeAt(e.position),!(e.lineIndent>0||o!==37));){for(l=!0,o=e.input.charCodeAt(++e.position),a=e.position;o!==0&&!_s(o);)o=e.input.charCodeAt(++e.position);for(n=e.input.slice(a,e.position),i=[],n.length<1&&Ae(e,"directive name must not be less than one character in length");o!==0;){for(;cn(o);)o=e.input.charCodeAt(++e.position);if(o===35){do o=e.input.charCodeAt(++e.position);while(o!==0&&!da(o));break}if(da(o))break;for(a=e.position;o!==0&&!_s(o);)o=e.input.charCodeAt(++e.position);i.push(e.input.slice(a,e.position))}o!==0&&_o(e),Qa.call(Ic,n)?Ic[n](e,n,i):_i(e,'unknown document directive "'+n+'"')}if(Vt(e,!0,-1),e.lineIndent===0&&e.input.charCodeAt(e.position)===45&&e.input.charCodeAt(e.position+1)===45&&e.input.charCodeAt(e.position+2)===45?(e.position+=3,Vt(e,!0,-1)):l&&Ae(e,"directives end mark is expected"),Fn(e,e.lineIndent-1,ji,!1,!0),Vt(e,!0,-1),e.checkLineBreaks&&Cx.test(e.input.slice(s,e.position))&&_i(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&Di(e)){e.input.charCodeAt(e.position)===46&&(e.position+=3,Vt(e,!0,-1));return}if(e.position<e.length-1)Ae(e,"end of the stream or a document separator is expected");else return}function nm(e,s){e=String(e),s=s||{},e.length!==0&&(e.charCodeAt(e.length-1)!==10&&e.charCodeAt(e.length-1)!==13&&(e+=`
`),e.charCodeAt(0)===65279&&(e=e.slice(1)));var a=new Ax(e,s),n=e.indexOf("\0");for(n!==-1&&(a.position=n,Ae(a,"null byte is not allowed in input")),a.input+="\0";a.input.charCodeAt(a.position)===32;)a.lineIndent+=1,a.position+=1;for(;a.position<a.length-1;)Hx(a);return a.documents}function Bx(e,s,a){s!==null&&typeof s=="object"&&typeof a>"u"&&(a=s,s=null);var n=nm(e,a);if(typeof s!="function")return n;for(var i=0,l=n.length;i<l;i+=1)s(n[i])}function Wx(e,s){var a=nm(e,s);if(a.length!==0){if(a.length===1)return a[0];throw new fs("expected a single document in the stream, but found more")}}var Ux=Bx,qx=Wx,rm={loadAll:Ux,load:qx},im=Object.prototype.toString,lm=Object.prototype.hasOwnProperty,wo=65279,Gx=9,yr=10,Yx=13,Kx=32,Xx=33,Jx=34,zl=35,Qx=37,Zx=38,e0=39,t0=42,om=44,s0=45,Ni=58,a0=61,n0=62,r0=63,i0=64,cm=91,dm=93,l0=96,um=123,o0=124,mm=125,us={};us[0]="\\0";us[7]="\\a";us[8]="\\b";us[9]="\\t";us[10]="\\n";us[11]="\\v";us[12]="\\f";us[13]="\\r";us[27]="\\e";us[34]='\\"';us[92]="\\\\";us[133]="\\N";us[160]="\\_";us[8232]="\\L";us[8233]="\\P";var c0=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],d0=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function u0(e,s){var a,n,i,l,o,u,m;if(s===null)return{};for(a={},n=Object.keys(s),i=0,l=n.length;i<l;i+=1)o=n[i],u=String(s[o]),o.slice(0,2)==="!!"&&(o="tag:yaml.org,2002:"+o.slice(2)),m=e.compiledTypeMap.fallback[o],m&&lm.call(m.styleAliases,u)&&(u=m.styleAliases[u]),a[o]=u;return a}function m0(e){var s,a,n;if(s=e.toString(16).toUpperCase(),e<=255)a="x",n=2;else if(e<=65535)a="u",n=4;else if(e<=4294967295)a="U",n=8;else throw new fs("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+a+qt.repeat("0",n-s.length)+s}var h0=1,jr=2;function p0(e){this.schema=e.schema||jo,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=qt.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=u0(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType=e.quotingType==='"'?jr:h0,this.forceQuotes=e.forceQuotes||!1,this.replacer=typeof e.replacer=="function"?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function $c(e,s){for(var a=qt.repeat(" ",s),n=0,i=-1,l="",o,u=e.length;n<u;)i=e.indexOf(`
`,n),i===-1?(o=e.slice(n),n=u):(o=e.slice(n,i+1),n=i+1),o.length&&o!==`
`&&(l+=a),l+=o;return l}function Hl(e,s){return`
`+qt.repeat(" ",e.indent*s)}function f0(e,s){var a,n,i;for(a=0,n=e.implicitTypes.length;a<n;a+=1)if(i=e.implicitTypes[a],i.resolve(s))return!0;return!1}function wi(e){return e===Kx||e===Gx}function _r(e){return 32<=e&&e<=126||161<=e&&e<=55295&&e!==8232&&e!==8233||57344<=e&&e<=65533&&e!==wo||65536<=e&&e<=1114111}function Vc(e){return _r(e)&&e!==wo&&e!==Yx&&e!==yr}function Dc(e,s,a){var n=Vc(e),i=n&&!wi(e);return(a?n:n&&e!==om&&e!==cm&&e!==dm&&e!==um&&e!==mm)&&e!==zl&&!(s===Ni&&!i)||Vc(s)&&!wi(s)&&e===zl||s===Ni&&i}function x0(e){return _r(e)&&e!==wo&&!wi(e)&&e!==s0&&e!==r0&&e!==Ni&&e!==om&&e!==cm&&e!==dm&&e!==um&&e!==mm&&e!==zl&&e!==Zx&&e!==t0&&e!==Xx&&e!==o0&&e!==a0&&e!==n0&&e!==e0&&e!==Jx&&e!==Qx&&e!==i0&&e!==l0}function g0(e){return!wi(e)&&e!==Ni}function lr(e,s){var a=e.charCodeAt(s),n;return a>=55296&&a<=56319&&s+1<e.length&&(n=e.charCodeAt(s+1),n>=56320&&n<=57343)?(a-55296)*1024+n-56320+65536:a}function hm(e){var s=/^\n* /;return s.test(e)}var pm=1,Bl=2,fm=3,xm=4,Mn=5;function b0(e,s,a,n,i,l,o,u){var m,h=0,r=null,c=!1,d=!1,g=n!==-1,v=-1,S=x0(lr(e,0))&&g0(lr(e,e.length-1));if(s||o)for(m=0;m<e.length;h>=65536?m+=2:m++){if(h=lr(e,m),!_r(h))return Mn;S=S&&Dc(h,r,u),r=h}else{for(m=0;m<e.length;h>=65536?m+=2:m++){if(h=lr(e,m),h===yr)c=!0,g&&(d=d||m-v-1>n&&e[v+1]!==" ",v=m);else if(!_r(h))return Mn;S=S&&Dc(h,r,u),r=h}d=d||g&&m-v-1>n&&e[v+1]!==" "}return!c&&!d?S&&!o&&!i(e)?pm:l===jr?Mn:Bl:a>9&&hm(e)?Mn:o?l===jr?Mn:Bl:d?xm:fm}function v0(e,s,a,n,i){e.dump=function(){if(s.length===0)return e.quotingType===jr?'""':"''";if(!e.noCompatMode&&(c0.indexOf(s)!==-1||d0.test(s)))return e.quotingType===jr?'"'+s+'"':"'"+s+"'";var l=e.indent*Math.max(1,a),o=e.lineWidth===-1?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-l),u=n||e.flowLevel>-1&&a>=e.flowLevel;function m(h){return f0(e,h)}switch(b0(s,u,e.indent,o,m,e.quotingType,e.forceQuotes&&!n,i)){case pm:return s;case Bl:return"'"+s.replace(/'/g,"''")+"'";case fm:return"|"+Fc(s,e.indent)+zc($c(s,l));case xm:return">"+Fc(s,e.indent)+zc($c(y0(s,o),l));case Mn:return'"'+j0(s)+'"';default:throw new fs("impossible error: invalid scalar style")}}()}function Fc(e,s){var a=hm(e)?String(s):"",n=e[e.length-1]===`
`,i=n&&(e[e.length-2]===`
`||e===`
`),l=i?"+":n?"":"-";return a+l+`
`}function zc(e){return e[e.length-1]===`
`?e.slice(0,-1):e}function y0(e,s){for(var a=/(\n+)([^\n]*)/g,n=function(){var h=e.indexOf(`
`);return h=h!==-1?h:e.length,a.lastIndex=h,Hc(e.slice(0,h),s)}(),i=e[0]===`
`||e[0]===" ",l,o;o=a.exec(e);){var u=o[1],m=o[2];l=m[0]===" ",n+=u+(!i&&!l&&m!==""?`
`:"")+Hc(m,s),i=l}return n}function Hc(e,s){if(e===""||e[0]===" ")return e;for(var a=/ [^ ]/g,n,i=0,l,o=0,u=0,m="";n=a.exec(e);)u=n.index,u-i>s&&(l=o>i?o:u,m+=`
`+e.slice(i,l),i=l+1),o=u;return m+=`
`,e.length-i>s&&o>i?m+=e.slice(i,o)+`
`+e.slice(o+1):m+=e.slice(i),m.slice(1)}function j0(e){for(var s="",a=0,n,i=0;i<e.length;a>=65536?i+=2:i++)a=lr(e,i),n=us[a],!n&&_r(a)?(s+=e[i],a>=65536&&(s+=e[i+1])):s+=n||m0(a);return s}function _0(e,s,a){var n="",i=e.tag,l,o,u;for(l=0,o=a.length;l<o;l+=1)u=a[l],e.replacer&&(u=e.replacer.call(a,String(l),u)),(wa(e,s,u,!1,!1)||typeof u>"u"&&wa(e,s,null,!1,!1))&&(n!==""&&(n+=","+(e.condenseFlow?"":" ")),n+=e.dump);e.tag=i,e.dump="["+n+"]"}function Bc(e,s,a,n){var i="",l=e.tag,o,u,m;for(o=0,u=a.length;o<u;o+=1)m=a[o],e.replacer&&(m=e.replacer.call(a,String(o),m)),(wa(e,s+1,m,!0,!0,!1,!0)||typeof m>"u"&&wa(e,s+1,null,!0,!0,!1,!0))&&((!n||i!=="")&&(i+=Hl(e,s)),e.dump&&yr===e.dump.charCodeAt(0)?i+="-":i+="- ",i+=e.dump);e.tag=l,e.dump=i||"[]"}function N0(e,s,a){var n="",i=e.tag,l=Object.keys(a),o,u,m,h,r;for(o=0,u=l.length;o<u;o+=1)r="",n!==""&&(r+=", "),e.condenseFlow&&(r+='"'),m=l[o],h=a[m],e.replacer&&(h=e.replacer.call(a,m,h)),wa(e,s,m,!1,!1)&&(e.dump.length>1024&&(r+="? "),r+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),wa(e,s,h,!1,!1)&&(r+=e.dump,n+=r));e.tag=i,e.dump="{"+n+"}"}function w0(e,s,a,n){var i="",l=e.tag,o=Object.keys(a),u,m,h,r,c,d;if(e.sortKeys===!0)o.sort();else if(typeof e.sortKeys=="function")o.sort(e.sortKeys);else if(e.sortKeys)throw new fs("sortKeys must be a boolean or a function");for(u=0,m=o.length;u<m;u+=1)d="",(!n||i!=="")&&(d+=Hl(e,s)),h=o[u],r=a[h],e.replacer&&(r=e.replacer.call(a,h,r)),wa(e,s+1,h,!0,!0,!0)&&(c=e.tag!==null&&e.tag!=="?"||e.dump&&e.dump.length>1024,c&&(e.dump&&yr===e.dump.charCodeAt(0)?d+="?":d+="? "),d+=e.dump,c&&(d+=Hl(e,s)),wa(e,s+1,r,!0,c)&&(e.dump&&yr===e.dump.charCodeAt(0)?d+=":":d+=": ",d+=e.dump,i+=d));e.tag=l,e.dump=i||"{}"}function Wc(e,s,a){var n,i,l,o,u,m;for(i=a?e.explicitTypes:e.implicitTypes,l=0,o=i.length;l<o;l+=1)if(u=i[l],(u.instanceOf||u.predicate)&&(!u.instanceOf||typeof s=="object"&&s instanceof u.instanceOf)&&(!u.predicate||u.predicate(s))){if(a?u.multi&&u.representName?e.tag=u.representName(s):e.tag=u.tag:e.tag="?",u.represent){if(m=e.styleMap[u.tag]||u.defaultStyle,im.call(u.represent)==="[object Function]")n=u.represent(s,m);else if(lm.call(u.represent,m))n=u.represent[m](s,m);else throw new fs("!<"+u.tag+'> tag resolver accepts not "'+m+'" style');e.dump=n}return!0}return!1}function wa(e,s,a,n,i,l,o){e.tag=null,e.dump=a,Wc(e,a,!1)||Wc(e,a,!0);var u=im.call(e.dump),m=n,h;n&&(n=e.flowLevel<0||e.flowLevel>s);var r=u==="[object Object]"||u==="[object Array]",c,d;if(r&&(c=e.duplicates.indexOf(a),d=c!==-1),(e.tag!==null&&e.tag!=="?"||d||e.indent!==2&&s>0)&&(i=!1),d&&e.usedDuplicates[c])e.dump="*ref_"+c;else{if(r&&d&&!e.usedDuplicates[c]&&(e.usedDuplicates[c]=!0),u==="[object Object]")n&&Object.keys(e.dump).length!==0?(w0(e,s,e.dump,i),d&&(e.dump="&ref_"+c+e.dump)):(N0(e,s,e.dump),d&&(e.dump="&ref_"+c+" "+e.dump));else if(u==="[object Array]")n&&e.dump.length!==0?(e.noArrayIndent&&!o&&s>0?Bc(e,s-1,e.dump,i):Bc(e,s,e.dump,i),d&&(e.dump="&ref_"+c+e.dump)):(_0(e,s,e.dump),d&&(e.dump="&ref_"+c+" "+e.dump));else if(u==="[object String]")e.tag!=="?"&&v0(e,e.dump,s,l,m);else{if(u==="[object Undefined]")return!1;if(e.skipInvalid)return!1;throw new fs("unacceptable kind of an object to dump "+u)}e.tag!==null&&e.tag!=="?"&&(h=encodeURI(e.tag[0]==="!"?e.tag.slice(1):e.tag).replace(/!/g,"%21"),e.tag[0]==="!"?h="!"+h:h.slice(0,18)==="tag:yaml.org,2002:"?h="!!"+h.slice(18):h="!<"+h+">",e.dump=h+" "+e.dump)}return!0}function S0(e,s){var a=[],n=[],i,l;for(Wl(e,a,n),i=0,l=n.length;i<l;i+=1)s.duplicates.push(a[n[i]]);s.usedDuplicates=new Array(l)}function Wl(e,s,a){var n,i,l;if(e!==null&&typeof e=="object")if(i=s.indexOf(e),i!==-1)a.indexOf(i)===-1&&a.push(i);else if(s.push(e),Array.isArray(e))for(i=0,l=e.length;i<l;i+=1)Wl(e[i],s,a);else for(n=Object.keys(e),i=0,l=n.length;i<l;i+=1)Wl(e[n[i]],s,a)}function C0(e,s){s=s||{};var a=new p0(s);a.noRefs||S0(e,a);var n=e;return a.replacer&&(n=a.replacer.call({"":n},"",n)),wa(a,0,n,!0,!0)?a.dump+`
`:""}var k0=C0,M0={dump:k0};function So(e,s){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+s+" instead, which is now safe by default.")}}var R0=ss,T0=Eu,E0=Ou,A0=Fu,P0=zu,I0=jo,O0=rm.load,L0=rm.loadAll,$0=M0.dump,V0=fs,D0={binary:qu,float:Du,map:Iu,null:Lu,pairs:Yu,set:Ku,timestamp:Wu,bool:$u,int:Vu,merge:Uu,omap:Gu,seq:Pu,str:Au},F0=So("safeLoad","load"),z0=So("safeLoadAll","loadAll"),H0=So("safeDump","dump"),Na={Type:R0,Schema:T0,FAILSAFE_SCHEMA:E0,JSON_SCHEMA:A0,CORE_SCHEMA:P0,DEFAULT_SCHEMA:I0,load:O0,loadAll:L0,dump:$0,YAMLException:V0,types:D0,safeLoad:F0,safeLoadAll:z0,safeDump:H0};function gm(e){const s=[],a=[],n={},i={},l={},o={},u={},m=e.split(`
`),h=[],r=new Map;for(let c=0;c<m.length;c++){const d=m[c],g=c+1;if(!d.trim()||d.trim().startsWith("#"))continue;const v=d.search(/\S/);if(v===-1)continue;for(;h.length>0&&h[h.length-1].indent>=v;)h.pop();const S=/^\s*-/.test(d),y=d.match(/<<:\s*\*(\w+)/),b=d.match(/^\s*-?\s*([^:\s]+)\s*:/);if(b&&b[1]!=="<<"){const C=b[1];h.push({indent:v,key:C});const w=h.map(I=>I.key).join(".");r.delete(w)}const _=h.map(C=>C.key).join(".");let x=_;if(S&&!b){const C=r.get(_)||0;x=`${_}.${C}`,r.set(_,C+1)}const f=d.match(/&(\w+)/);if(f){const C=f[1];s.push({name:C,path:_,lineNumber:g}),i[C]=_,b&&b[1]!==C&&(o[_]=C)}if(y){const C=y[1],w=_;u[w]=C;const I=w.split(".");if(I.length>=2){const R=I.slice(-2).join(".");if(u[R]=C,I.length>=3){const k=I.slice(-3).join(".");u[k]=C}}console.log(`[extractYamlReferences] Found merge key at path '${w}': <<: *${C}`)}if(!y){const C=d.matchAll(new RegExp(`(?<!["\\w])\\*(\\w+)(?!["'])`,"g"));for(const w of C){const I=w[1];if(d.includes(`&${I}`))continue;a.push({name:I,path:x,lineNumber:g}),n[I]||(n[I]=[]),n[I].push(x);const R=x.split(".");if(R.length>=2){const k=R.slice(-3).join(".");l[`${k}=${I}`]=I;const D=R.slice(-2).join(".");l[`${D}=${I}`]=I}}}}return{anchors:s,aliases:a,aliasUsage:n,anchorPaths:i,pathSuffixToAnchor:l,keyToAnchorName:o,mergeKeys:u}}let Fs=null;function bm(e){Fs=e}function vm(){return Fs}function B0(){Fs=null}function W0(){return!Fs||!Fs.mergeKeys?[]:[...new Set(Object.values(Fs.mergeKeys))]}function U0(){return!Fs||!Fs.aliasUsage?[]:Object.keys(Fs.aliasUsage)}function za(e){return!Fs||!Fs.keyToAnchorName?null:Fs.keyToAnchorName[e]||null}let Co={};function q0(e,s){Co[e]=s}function G0(e){return Co[e]||null}function Ul(){Co={}}function Uc(e,s){return typeof e=="string"&&e.startsWith(s)}let ym={},jm={};function ql(e,s){if(e===s)return!0;if(typeof e!=typeof s)return!1;if(e===null||s===null)return e===s;if(typeof e!="object")return!1;const a=e,n=s,i=Object.keys(a),l=Object.keys(n);return i.length!==l.length?!1:i.every(o=>ql(a[o],n[o]))}function Y0(e){if(!e||typeof e!="object")return null;for(const[s,a]of Object.entries(ym))if(ql(e,a)||ql(e,ko(a)))return s;return null}function Xr(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean")return e.toString();const s=e;return s.env?String(s.env):s.secret?String(s.secret):s.value!==void 0?String(s.value):JSON.stringify(e)}function K0(e){const s=e.split(`
`),a=[];let n=!1;for(let i=0;i<s.length;i++){const l=s[i];if(/^\s+(?:include|exclude)_tools:\s*$/.test(l)){n=!0,a.push(l);continue}if(n&&l.trim()&&!l.match(/^\s+-\s+/)&&(n=!1),n&&/^\s+-\s+/.test(l)){const o=l.match(/^(\s+-\s+)(['"]?)([^'"\n#]+)\2(\s*(?:#.*)?)$/);if(o){const[,u,m,h,r]=o,c=h.trim();if(/[*?[\]!]/.test(c)&&m!=='"'){a.push(`${u}"${c}"${r}`);continue}}}a.push(l)}return a.join(`
`)}function X0(e){if(!e||typeof e!="object")return null;const s=e;for(const[a,n]of Object.entries(jm)){const i=n,l=Xr(s.catalog_name)===Xr(i.catalog_name),o=Xr(s.schema_name)===Xr(i.schema_name);if(l&&o)return a}return null}function J0(e){return typeof e=="string"?e:""}function Q0(e){const s=["variables","schemas","service_principals","retrievers","tools","guardrails","middleware","prompts","agents"],a=["memory"],n=["llms","vector_stores","genie_rooms","tables","volumes","functions","warehouses","connections","databases","apps"],i=["app"],l=e.split(`
`),o=[];for(let u=0;u<l.length;u++){const h=l[u].match(/^(\s*)(\w[\w_-]*):\s*$/);if(h){const r=h[2],c=h[1].length;if(c===0&&s.includes(r))o.push({name:r,startLine:u,indent:c,childIndent:c+2,endLine:-1});else if(c===0&&r==="resources")for(let d=u+1;d<l.length;d++){const v=l[d].match(/^(\s*)(\w[\w_-]*):\s*$/);if(v){const S=v[2],y=v[1].length;if(y===0)break;y===2&&n.includes(S)&&o.push({name:S,startLine:d,indent:y,childIndent:y+2,endLine:-1})}}}}for(let u=0;u<o.length;u++){const m=o[u];for(let h=m.startLine+1;h<l.length;h++){const r=l[h];if(!r.trim())continue;const c=r.search(/\S/);if(c!==-1&&c<=m.indent){m.endLine=h;break}}m.endLine===-1&&(m.endLine=l.length)}for(let u=0;u<l.length;u++){const m=l[u],h=m.match(/^(\w[\w_-]*):\s*$/);if(h){const r=h[1];if(a.includes(r)&&!m.includes("&")){const c=G0(r),d=za(r),g=c||d||r;l[u]=`${r}: &${g}`}}}for(const u of o){if(i.includes(u.name))continue;const m=u.indent===0?u.name:`resources.${u.name}`;for(let h=u.startLine+1;h<u.endLine;h++){const r=l[h];if(!r.trim()||r.search(/\S/)!==u.childIndent)continue;const d=r.match(new RegExp(`^( {${u.childIndent}})(\\w[\\w_-]*):\\s*$`));if(d){const g=d[1],v=d[2];if(!r.includes("&")){const S=`${m}.${v}`,y=za(S),b=W0(),_=U0(),x=b.includes(v)||y&&b.includes(y),f=_.includes(v)||y&&_.includes(y);y?l[h]=`${g}${v}: &${y}`:x||f?l[h]=`${g}${v}: &${v}`:["tables","volumes"].includes(u.name)||(l[h]=`${g}${v}: &${v}`)}}}}return l.join(`
`)}function Z0(e){let s=e.replace(/__MERGE__: "(\w+)"/g,"<<: *$1");return s=s.replace(/__MERGE__: (\w+)/g,"<<: *$1"),s=s.replace(/"__REF__(\w+)"/g,"*$1"),s=s.replace(/- __REF__(\w+)/g,"- *$1"),s=s.replace(/__REF__(\w+)/g,"*$1"),s=s.replace(/"__PROMPT_REF__(\w+)"/g,"*$1"),s=s.replace(/__PROMPT_REF__(\w+)/g,"*$1"),s}function ge(e){return`__REF__${e}`}function eg(e,s){const a={};for(const[n,i]of Object.entries(e))if(typeof i=="string"&&i.startsWith("*"))a[n]=ge(i.slice(1));else if(typeof i=="object"&&i!==null){const l=Object.entries(s).find(([,o])=>JSON.stringify(o)===JSON.stringify(i));l?a[n]=ge(l[0]):a[n]=String(i)}else a[n]=String(i);return a}function ft(e,s){const a=vm();if(!a)return null;const n=e.toLowerCase().replace(/-/g,"_"),i=e.split(".");for(const[u,m]of Object.entries(a.aliasUsage))for(const h of m){const r=h.toLowerCase().replace(/-/g,"_");if(n===r&&a.anchorPaths[u])return u}const l=i[i.length-1];if(/^\d+$/.test(l))for(const[u,m]of Object.entries(a.aliasUsage))for(const h of m){const r=h.toLowerCase().replace(/-/g,"_");if(n===r||r.endsWith(n))return u}if(s&&typeof s=="object"&&"name"in s&&"function"in s){for(const[u,m]of Object.entries(a.anchorPaths))if(m.startsWith("tools.")){const h=a.aliasUsage[u]||[];for(const r of h){const c=r.split("."),d=e.split(".");if(c.includes("tools")&&d.includes("tools")){const g=c.indexOf("agents"),v=d.indexOf("agents");if(g!==-1&&v!==-1){const S=c[g+1],y=d[v+1];if(S===y)return u}}}}}const o=i.slice(-2).join(".");if(a.pathSuffixToAnchor){const u=o.toLowerCase().replace(/-/g,"_");for(const[m,h]of Object.entries(a.pathSuffixToAnchor)){const r=m.toLowerCase().replace(/-/g,"_");if((u===r||u.endsWith("."+r))&&a.anchorPaths[h])return h}}if(s&&typeof s=="object"&&s.catalog_name&&s.schema_name){for(const[u,m]of Object.entries(a.anchorPaths))if(m.includes("schema"))return u}return null}function Gl(e,s,a){if(e==null||typeof e!="object")return e;const n=ft(s,e);if(n)return ge(n);if(Array.isArray(e))return e.map((l,o)=>Gl(l,`${s}.${o}`));const i={};for(const[l,o]of Object.entries(e)){const u=s?`${s}.${l}`:l,m=ft(u,o);m?i[l]=ge(m):typeof o=="object"&&o!==null?i[l]=Gl(o,u):i[l]=o}return i}function mi(e,s,a){if(typeof e=="string")return s[e]?ge(e):e;if(e&&typeof e=="object"&&e.name){if(a){const n=ft(a,e);if(n)return ge(n)}for(const[n,i]of Object.entries(s))if(JSON.stringify(i)===JSON.stringify(e))return ge(n);return{name:e.name,...e.description&&{description:e.description},...e.temperature!==void 0&&{temperature:e.temperature},...e.max_tokens!==void 0&&{max_tokens:e.max_tokens},...e.on_behalf_of_user!==void 0&&{on_behalf_of_user:e.on_behalf_of_user},...e.use_responses_api!==void 0&&{use_responses_api:e.use_responses_api},...e.fallbacks&&e.fallbacks.length>0&&{fallbacks:e.fallbacks}}}return e}function Nr(e,s){if(e!=null){if(s){const a=ft(s,e);if(a)return ge(a)}if(typeof e=="string")return e.startsWith("*")?ge(e.slice(1)):e;if(typeof e=="object"){const a=e;if("env"in a&&typeof a.env=="string")return{env:a.env,...a.default_value!==void 0&&{default_value:a.default_value}};if("scope"in a&&"secret"in a)return{scope:a.scope,secret:a.secret,...a.default_value!==void 0&&{default_value:a.default_value}};if("value"in a)return{value:a.value};if("options"in a&&Array.isArray(a.options))return{options:a.options.map(n=>Nr(n)),...a.default_value!==void 0&&{default_value:a.default_value}}}return e}}function Jr(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean")return String(e);if(typeof e=="object"){const s=e;if("value"in s)return String(s.value);if("env"in s&&s.default_value!==void 0)return String(s.default_value);if("env"in s)return`$${s.env}`;if("scope"in s&&"secret"in s)return`{{secrets/${s.scope}/${s.secret}}}`}return""}function an(e,s,a){if(!e)return;if(a){const o=ft(a,e);if(o)return ge(o)}const n=Jr(e.catalog_name),i=Jr(e.schema_name);for(const[o,u]of Object.entries(s)){const m=Jr(u.catalog_name),h=Jr(u.schema_name);if(m===n&&h===i)return ge(o)}const l=a||"";return{catalog_name:Nr(e.catalog_name,l?`${l}.catalog_name`:void 0),schema_name:Nr(e.schema_name,l?`${l}.schema_name`:void 0)}}function qc(e,s){var n,i,l,o;if(!e)return;const a={};if(e.volume)if(typeof e.volume=="string")e.volume.startsWith("*")?a.volume=ge(e.volume.substring(1)):a.volume=ge(e.volume);else{let u;for(const[m,h]of Object.entries(s))if(h.name===e.volume.name&&((n=h.schema)==null?void 0:n.catalog_name)===((i=e.volume.schema)==null?void 0:i.catalog_name)&&((l=h.schema)==null?void 0:l.schema_name)===((o=e.volume.schema)==null?void 0:o.schema_name)){u=m;break}u?a.volume=ge(u):e.volume._schemaRef?a.volume={schema:ge(e.volume._schemaRef),name:e.volume.name}:a.volume={...e.volume.schema&&{schema:{catalog_name:e.volume.schema.catalog_name,schema_name:e.volume.schema.schema_name}},name:e.volume.name}}return e.path&&(a.path=e.path),Object.keys(a).length>0?a:void 0}function tg(e,s,a,n,i){const l={};if(e.supervisor){let o;e.supervisor.tools&&e.supervisor.tools.length>0&&(o=e.supervisor.tools.map(m=>{const h=typeof m=="string"?m:m.name;if(a[h])return ge(h);const r=Object.entries(a).find(([,d])=>d.name===h);if(r)return ge(r[0]);const c=typeof m=="object"?m:null;if(c){const d=Object.entries(a).find(([,g])=>JSON.stringify(g)===JSON.stringify(c));if(d)return ge(d[0])}return ge(h)}));let u;e.supervisor.middleware&&e.supervisor.middleware.length>0&&(u=e.supervisor.middleware.map(m=>{if(typeof m=="string")return m.startsWith("*")?ge(m.slice(1)):ge(m);const h=typeof m=="string"?m:m==null?void 0:m.name;if(h){const c=Object.entries(n).find(([,d])=>d.name===h);if(c)return ge(c[0])}const r=typeof m=="object"?m:null;if(r){const c=Object.entries(n).find(([,d])=>JSON.stringify(d)===JSON.stringify(r));if(c)return ge(c[0])}return ge(h||"middleware")})),l.supervisor={model:mi(e.supervisor.model,s,"orchestration.supervisor.model"),...o&&o.length>0&&{tools:o},...e.supervisor.prompt&&{prompt:e.supervisor.prompt},...u&&u.length>0&&{middleware:u}}}if(e.swarm){l.swarm={};const o=u=>{const m=typeof u=="string"?u:u==null?void 0:u.name;if(!m)return null;if(i[m])return ge(m);const h=Object.entries(i).find(([,r])=>r.name===m);return h?ge(h[0]):m};if(e.swarm.default_agent&&(l.swarm.default_agent=o(e.swarm.default_agent)),e.swarm.handoffs&&Object.keys(e.swarm.handoffs).length>0&&(l.swarm.handoffs={},Object.entries(e.swarm.handoffs).forEach(([u,m])=>{m==null?l.swarm.handoffs[u]=null:Array.isArray(m)&&(m.length===0?l.swarm.handoffs[u]=[]:l.swarm.handoffs[u]=m.map(h=>{if(typeof h=="object"&&h!==null&&"agent"in h&&"is_deterministic"in h){const r=h,c=o(r.agent);return r.is_deterministic?{agent:c,is_deterministic:!0}:c}return o(h)}))})),e.swarm.middleware&&e.swarm.middleware.length>0){const u=e.swarm.middleware.map(m=>{if(typeof m=="string")return m.startsWith("*")?ge(m.slice(1)):ge(m);const h=typeof m=="string"?m:m==null?void 0:m.name;if(h){const c=Object.entries(n).find(([,d])=>d.name===h);if(c)return ge(c[0])}const r=typeof m=="object"?m:null;if(r){const c=Object.entries(n).find(([,d])=>JSON.stringify(d)===JSON.stringify(r));if(c)return ge(c[0])}return ge(h||"middleware")});u.length>0&&(l.swarm.middleware=u)}}if(e.memory){const o=e.memory;if(typeof o=="string")o.startsWith("*")?l.memory=ge(o.slice(1)):l.memory=ge(o);else{const u=ft("orchestration.memory",o);u?l.memory=ge(u):l.memory=ge("memory")}}return l}function sg(e){return{...e.review_prompt&&{review_prompt:e.review_prompt},...e.allowed_decisions&&e.allowed_decisions.length>0&&{allowed_decisions:e.allowed_decisions}}}function ag(e,s,a,n){var l,o;if(typeof e=="string")return e;const i={type:e.type};if(!("__MERGE__"in e)&&e.type!=="unity_catalog"&&e.type!=="mcp"&&"name"in e&&(i.name=e.name),e.type==="factory"&&"args"in e&&e.args&&Object.keys(e.args).length>0){const u=s?`tools.${s}.function.args`:"function.args";i.args=Gl(e.args,u)}if(e.type==="inline"&&(delete i.name,"code"in e&&e.code&&(i.code=e.code)),e.type==="unity_catalog"){if(delete i.name,"resource"in e&&e.resource){const u=e.resource;if(typeof u=="string")u.startsWith("*")?i.resource=ge(u.slice(1)):i.resource=ge(u);else{const m=s?`tools.${s}.function.resource`:"function.resource",h=ft(m,u);if(h)i.resource=ge(h);else{const r={};u.schema&&(r.schema=u.schema),u.name&&(r.name=u.name),u.on_behalf_of_user&&(r.on_behalf_of_user=u.on_behalf_of_user),i.resource=r}}}if("partial_args"in e&&e.partial_args&&Object.keys(e.partial_args).length>0){const u={};for(const[m,h]of Object.entries(e.partial_args)){const r=s?ft(`tools.${s}.function.partial_args.${m}`,h):null;r?u[m]=ge(r):u[m]=h}i.partial_args=u}}if(e.type==="mcp"){if("transport"in e&&e.transport&&(i.transport=e.transport),"command"in e&&e.command&&(i.command=e.command),"url"in e&&e.url&&(i.url=e.url),"headers"in e&&e.headers&&(i.headers=e.headers),"args"in e&&e.args&&(i.args=e.args),"pat"in e&&e.pat&&(i.pat=Qs(e.pat)),"service_principal"in e&&e.service_principal){const u=e.service_principal;typeof u=="string"?u.startsWith("*")?i.service_principal=ge(u.slice(1)):i.service_principal=ge(u):i.service_principal={client_id:Qs(u.client_id),client_secret:Qs(u.client_secret)}}else"client_id"in e&&e.client_id&&(i.client_id=Qs(e.client_id)),"client_secret"in e&&e.client_secret&&(i.client_secret=Qs(e.client_secret)),"workspace_host"in e&&e.workspace_host&&(i.workspace_host=Qs(e.workspace_host));if("connection"in e&&e.connection){const u=e.connection;if(typeof u=="string"&&u.startsWith("*"))i.connection=ge(u.slice(1));else{const m=s?ft(`tools.${s}.function.connection`,u):null;if(m)i.connection=ge(m);else{const h=typeof u=="object"&&u.name?u.name:null;if(h&&a){const r=(l=Object.entries(a).find(([,c])=>c.name===h))==null?void 0:l[0];r?i.connection=ge(r):i.connection=u}else i.connection=u}}}if("functions"in e&&e.functions){const u=e.functions;if(typeof u=="string"&&u.startsWith("*"))i.functions=ge(u.slice(1));else{const m=X0(e.functions);m?i.functions=ge(m):i.functions=e.functions}}if("genie_room"in e&&e.genie_room){const u=e.genie_room;if(typeof u=="string"&&u.startsWith("*"))i.genie_room=ge(u.slice(1));else{const m=s?ft(`tools.${s}.function.genie_room`,e.genie_room):null;i.genie_room=m?ge(m):e.genie_room}}if("sql"in e&&e.sql&&(i.sql=e.sql),"app"in e&&e.app){const u=e.app;if(typeof u=="string"&&u.startsWith("*"))i.app=ge(u.slice(1));else{const m=s?ft(`tools.${s}.function.app`,u):null;if(m)i.app=ge(m);else{const h=typeof u=="object"&&u.name?u.name:null;if(h&&n){const r=(o=Object.entries(n).find(([,c])=>c.name===h))==null?void 0:o[0];r?i.app=ge(r):i.app=u}else i.app=u}}}if("vector_search"in e&&e.vector_search){const u=e.vector_search;if(typeof u=="string"&&u.startsWith("*"))i.vector_search=ge(u.slice(1));else{const m=s?ft(`tools.${s}.function.vector_search`,e.vector_search):null;if(m)i.vector_search=ge(m);else if("retriever"in u){const h=s?ft(`tools.${s}.function.vector_search.retriever`,u.retriever):null;i.vector_search={...u,retriever:h?ge(h):u.retriever}}else i.vector_search=e.vector_search}}"include_tools"in e&&e.include_tools&&e.include_tools.length>0&&(i.include_tools=e.include_tools),"exclude_tools"in e&&e.exclude_tools&&e.exclude_tools.length>0&&(i.exclude_tools=e.exclude_tools)}return"human_in_the_loop"in e&&e.human_in_the_loop&&(i.human_in_the_loop=sg(e.human_in_the_loop)),i}function il(e,s){const a={name:e.name};if(e.instance_name&&(a.instance_name=e.instance_name),e.host&&(a.host=js(e.host,s?`${s}.host`:void 0)),e.description&&(a.description=e.description),e.capacity&&(a.capacity=e.capacity),e.max_pool_size&&(a.max_pool_size=e.max_pool_size),e.timeout_seconds&&(a.timeout_seconds=e.timeout_seconds),e.service_principal)if(typeof e.service_principal=="string")e.service_principal.startsWith("*")?a.service_principal=ge(e.service_principal.slice(1)):a.service_principal=ge(e.service_principal);else{const n=s?`${s}.service_principal`:"service_principal",i=ft(n,e.service_principal);i?a.service_principal=ge(i):a.service_principal={client_id:js(e.service_principal.client_id,s?`${s}.service_principal.client_id`:void 0),client_secret:js(e.service_principal.client_secret,s?`${s}.service_principal.client_secret`:void 0)}}else e.client_id&&(a.client_id=js(e.client_id,s?`${s}.client_id`:void 0)),e.client_secret&&(a.client_secret=js(e.client_secret,s?`${s}.client_secret`:void 0)),e.workspace_host&&(a.workspace_host=js(e.workspace_host,s?`${s}.workspace_host`:void 0));return e.user&&(a.user=js(e.user,s?`${s}.user`:void 0)),e.password&&(a.password=js(e.password,s?`${s}.password`:void 0)),e.on_behalf_of_user&&e.instance_name&&(a.on_behalf_of_user=e.on_behalf_of_user),a}function js(e,s){if(s){const a=ft(s,e);if(a)return ge(a)}return Qs(e)}function nn(e,s){const a={};if(e.service_principal)if(typeof e.service_principal=="string")e.service_principal.startsWith("*")?a.service_principal=ge(e.service_principal.slice(1)):a.service_principal=ge(e.service_principal);else{const n=s?`${s}.service_principal`:"service_principal",i=ft(n,e.service_principal);i?a.service_principal=ge(i):a.service_principal={client_id:js(e.service_principal.client_id,s?`${s}.service_principal.client_id`:void 0),client_secret:js(e.service_principal.client_secret,s?`${s}.service_principal.client_secret`:void 0)}}else e.client_id&&(a.client_id=js(e.client_id,s?`${s}.client_id`:void 0)),e.client_secret&&(a.client_secret=js(e.client_secret,s?`${s}.client_secret`:void 0)),e.workspace_host&&(a.workspace_host=js(e.workspace_host,s?`${s}.workspace_host`:void 0)),e.pat&&(a.pat=js(e.pat,s?`${s}.pat`:void 0));return a}function Qs(e){if(typeof e!="string"){const s=Y0(e);return s?ge(s):e}if(e.startsWith("*"))return ge(e.slice(1));if(e.startsWith("env:"))return{env:e.slice(4)};if(e.startsWith("secret:")){const s=e.slice(7).split("/");if(s.length===2)return{scope:s[0],secret:s[1]}}return e}function ng(e){return e.type?e.type:"options"in e&&Array.isArray(e.options)?"composite":"scope"in e&&"secret"in e?"secret":"env"in e?"env":("value"in e,"primitive")}function ko(e){const s=ng(e),a=e;switch(s){case"primitive":return{value:a.value};case"env":return{env:a.env,...a.default_value!==void 0&&{default_value:a.default_value}};case"secret":return{scope:a.scope,secret:a.secret,...a.default_value!==void 0&&{default_value:a.default_value}};case"composite":return{options:(a.options||[]).map(i=>ko(i)),...a.default_value!==void 0&&{default_value:a.default_value}};default:return e}}function mn(e){var l,o,u,m,h,r,c,d,g,v,S,y,b,_;const s={};e.version&&(s.version=e.version),Ul(),(l=e.memory)!=null&&l.refName&&q0("memory",e.memory.refName),ym=e.variables||{},jm=e.schemas||{};const a=e.schemas||{};if(e.variables&&Object.keys(e.variables).length>0&&(s.variables={},Object.entries(e.variables).forEach(([x,f])=>{s.variables[x]=ko(f)})),e.service_principals&&Object.keys(e.service_principals).length>0&&(s.service_principals={},Object.entries(e.service_principals).forEach(([x,f])=>{s.service_principals[x]={client_id:Qs(f.client_id),client_secret:Qs(f.client_secret)}})),e.schemas&&Object.keys(e.schemas).length>0&&(s.schemas={},Object.entries(e.schemas).forEach(([x,f])=>{s.schemas[x]={catalog_name:Nr(f.catalog_name,`schemas.${x}.catalog_name`),schema_name:Nr(f.schema_name,`schemas.${x}.schema_name`),...f.permissions&&{permissions:f.permissions}}})),e.resources&&(e.resources.llms&&Object.keys(e.resources.llms).length>0||e.resources.vector_stores&&Object.keys(e.resources.vector_stores).length>0||e.resources.genie_rooms&&Object.keys(e.resources.genie_rooms).length>0||e.resources.tables&&Object.keys(e.resources.tables).length>0||e.resources.volumes&&Object.keys(e.resources.volumes).length>0||e.resources.functions&&Object.keys(e.resources.functions).length>0||e.resources.warehouses&&Object.keys(e.resources.warehouses).length>0||e.resources.connections&&Object.keys(e.resources.connections).length>0||e.resources.databases&&Object.keys(e.resources.databases).length>0||e.resources.apps&&Object.keys(e.resources.apps).length>0)){if(s.resources={},e.resources.llms&&Object.keys(e.resources.llms).length>0&&(s.resources.llms={},Object.entries(e.resources.llms).forEach(([x,f])=>{let C;f.fallbacks&&f.fallbacks.length>0&&(C=f.fallbacks.map(w=>typeof w=="string"&&w.startsWith("ref:")?ge(w.slice(4)):typeof w=="string"?w:w.name)),s.resources.llms[x]={name:f.name,...f.description&&{description:f.description},...f.temperature!==void 0&&{temperature:f.temperature},...f.max_tokens!==void 0&&{max_tokens:f.max_tokens},...f.on_behalf_of_user!==void 0&&{on_behalf_of_user:f.on_behalf_of_user},...f.use_responses_api!==void 0&&{use_responses_api:f.use_responses_api},...C&&C.length>0&&{fallbacks:C},...nn(f,`resources.llms.${x}`)}})),e.resources.vector_stores&&Object.keys(e.resources.vector_stores).length>0){const x=e.resources.volumes||{};s.resources.vector_stores={},Object.entries(e.resources.vector_stores).forEach(([f,C])=>{let w;if(C.source_table){const k=an(C.source_table.schema,a,`resources.vector_stores.${f}.source_table.schema`);w={...k&&{schema:k},...C.source_table.name&&{name:C.source_table.name}}}let I;if(C.index&&C.index.name){const k=an(C.index.schema,a,`resources.vector_stores.${f}.index.schema`);I={...k&&{schema:k},name:C.index.name}}let R;if(C.embedding_model){const k=ft(`resources.vector_stores.${f}.embedding_model`,C.embedding_model);k?R=ge(k):R=C.embedding_model}s.resources.vector_stores[f]={...I&&{index:I},...w&&{source_table:w},...C.embedding_source_column&&{embedding_source_column:C.embedding_source_column},...R&&{embedding_model:R},...C.endpoint&&C.endpoint.name&&{endpoint:C.endpoint},...C.primary_key&&{primary_key:C.primary_key},...C.columns&&C.columns.length>0&&{columns:C.columns},...C.doc_uri&&{doc_uri:C.doc_uri},...C.source_path&&{source_path:qc(C.source_path,x)},...C.checkpoint_path&&{checkpoint_path:qc(C.checkpoint_path,x)},...C.on_behalf_of_user!==void 0&&{on_behalf_of_user:C.on_behalf_of_user},...nn(C,`resources.vector_stores.${f}`)}})}e.resources.genie_rooms&&Object.keys(e.resources.genie_rooms).length>0&&(s.resources.genie_rooms={},Object.entries(e.resources.genie_rooms).forEach(([x,f])=>{let C=f.space_id;typeof f.space_id=="string"?Uc(f.space_id,"*")&&(C=ge(f.space_id.substring(1))):typeof f.space_id=="object"&&f.space_id!==null&&(C=f.space_id),s.resources.genie_rooms[x]={name:f.name,space_id:C,...f.description&&{description:f.description},...f.on_behalf_of_user!==void 0&&{on_behalf_of_user:f.on_behalf_of_user},...nn(f,`resources.genie_rooms.${x}`)}})),e.resources.tables&&Object.keys(e.resources.tables).length>0&&(s.resources.tables={},Object.entries(e.resources.tables).forEach(([x,f])=>{const C=an(f.schema,a,`resources.tables.${x}.schema`);s.resources.tables[x]={...C&&{schema:C},...f.name&&{name:f.name},...f.on_behalf_of_user!==void 0&&{on_behalf_of_user:f.on_behalf_of_user},...nn(f,`resources.tables.${x}`)}})),e.resources.volumes&&Object.keys(e.resources.volumes).length>0&&(s.resources.volumes={},Object.entries(e.resources.volumes).forEach(([x,f])=>{const C=an(f.schema,a,`resources.volumes.${x}.schema`);s.resources.volumes[x]={name:f.name,...C&&{schema:C},...f.on_behalf_of_user!==void 0&&{on_behalf_of_user:f.on_behalf_of_user}}})),e.resources.functions&&Object.keys(e.resources.functions).length>0&&(s.resources.functions={},Object.entries(e.resources.functions).forEach(([x,f])=>{const C=an(f.schema,a,`resources.functions.${x}.schema`);s.resources.functions[x]={...C&&{schema:C},...f.name&&{name:f.name},...f.on_behalf_of_user!==void 0&&{on_behalf_of_user:f.on_behalf_of_user}}})),e.resources.warehouses&&Object.keys(e.resources.warehouses).length>0&&(s.resources.warehouses={},Object.entries(e.resources.warehouses).forEach(([x,f])=>{const C=J0(f.warehouse_id);let w=C;Uc(C,"*")&&(w=ge(C.substring(1))),s.resources.warehouses[x]={name:f.name,warehouse_id:w,...f.description&&{description:f.description},...f.on_behalf_of_user!==void 0&&{on_behalf_of_user:f.on_behalf_of_user},...nn(f,`resources.warehouses.${x}`)}})),e.resources.connections&&Object.keys(e.resources.connections).length>0&&(s.resources.connections={},Object.entries(e.resources.connections).forEach(([x,f])=>{s.resources.connections[x]={name:f.name,...f.on_behalf_of_user!==void 0&&{on_behalf_of_user:f.on_behalf_of_user},...nn(f,`resources.connections.${x}`)}})),e.resources.databases&&Object.keys(e.resources.databases).length>0&&(s.resources.databases={},Object.entries(e.resources.databases).forEach(([x,f])=>{s.resources.databases[x]=il(f,`resources.databases.${x}`)})),e.resources.apps&&Object.keys(e.resources.apps).length>0&&(s.resources.apps={},Object.entries(e.resources.apps).forEach(([x,f])=>{s.resources.apps[x]={name:f.name,...f.on_behalf_of_user!==void 0&&{on_behalf_of_user:f.on_behalf_of_user},...nn(f,`resources.apps.${x}`)}}))}if(e.retrievers&&Object.keys(e.retrievers).length>0&&(s.retrievers={},Object.entries(e.retrievers).forEach(([x,f])=>{var R,k,D,L,V,B;let C;const w=ft(`retrievers.${x}.vector_store`,f.vector_store);if(w)C=ge(w);else{const T=((R=e.resources)==null?void 0:R.vector_stores)||{},F=(k=Object.entries(T).find(([,E])=>{var $,p,N,P;return E.embedding_source_column===(($=f.vector_store)==null?void 0:$.embedding_source_column)&&((p=E.source_table)==null?void 0:p.name)===((P=(N=f.vector_store)==null?void 0:N.source_table)==null?void 0:P.name)}))==null?void 0:k[0];F&&(C=ge(F))}const I={vector_store:C||f.vector_store};if(f.columns&&f.columns.length>0&&(I.columns=f.columns),f.search_parameters){const T={num_results:f.search_parameters.num_results||10,query_type:f.search_parameters.query_type||"ANN"};f.search_parameters.filters&&Object.keys(f.search_parameters.filters).length>0&&(T.filters=f.search_parameters.filters),I.search_parameters=T}if(f.rerank)if(typeof f.rerank=="boolean")I.rerank=f.rerank;else{const T={...f.rerank.model&&{model:f.rerank.model},...f.rerank.top_n!==void 0&&{top_n:f.rerank.top_n},...f.rerank.cache_dir&&{cache_dir:f.rerank.cache_dir},...f.rerank.columns&&f.rerank.columns.length>0&&{columns:f.rerank.columns}};I.rerank=T}if(f.instructed){const T={};if(T.columns=f.instructed.columns.map(F=>({name:F.name,...F.type&&{type:F.type},...F.operators&&F.operators.length>0&&{operators:F.operators},...F.description&&{description:F.description}})),f.instructed.constraints&&f.instructed.constraints.length>0&&(T.constraints=f.instructed.constraints),f.instructed.decomposition){const F={};if(f.instructed.decomposition.model){const E=typeof f.instructed.decomposition.model=="string"?f.instructed.decomposition.model:(D=f.instructed.decomposition.model)==null?void 0:D.name;if(E){const $=ft(`retrievers.${x}.instructed.decomposition.model`,f.instructed.decomposition.model);F.model=ge($||E)}}f.instructed.decomposition.normalize_filter_case&&(F.normalize_filter_case=f.instructed.decomposition.normalize_filter_case),f.instructed.decomposition.max_subqueries!==void 0&&f.instructed.decomposition.max_subqueries!==3&&(F.max_subqueries=f.instructed.decomposition.max_subqueries),f.instructed.decomposition.rrf_k!==void 0&&f.instructed.decomposition.rrf_k!==60&&(F.rrf_k=f.instructed.decomposition.rrf_k),f.instructed.decomposition.examples&&f.instructed.decomposition.examples.length>0&&(F.examples=f.instructed.decomposition.examples),Object.keys(F).length>0&&(T.decomposition=F)}if(f.instructed.rerank){const F={};if(f.instructed.rerank.model){const E=typeof f.instructed.rerank.model=="string"?f.instructed.rerank.model:(L=f.instructed.rerank.model)==null?void 0:L.name;if(E){const $=ft(`retrievers.${x}.instructed.rerank.model`,f.instructed.rerank.model);F.model=ge($||E)}}f.instructed.rerank.instructions&&(F.instructions=f.instructed.rerank.instructions),f.instructed.rerank.top_n!==void 0&&(F.top_n=f.instructed.rerank.top_n),Object.keys(F).length>0&&(T.rerank=F)}if(f.instructed.router){const F={};if(f.instructed.router.model){const E=typeof f.instructed.router.model=="string"?f.instructed.router.model:(V=f.instructed.router.model)==null?void 0:V.name;if(E){const $=ft(`retrievers.${x}.instructed.router.model`,f.instructed.router.model);F.model=ge($||E)}}f.instructed.router.default_mode&&(F.default_mode=f.instructed.router.default_mode),f.instructed.router.auto_bypass!==void 0&&(F.auto_bypass=f.instructed.router.auto_bypass),Object.keys(F).length>0&&(T.router=F)}if(f.instructed.verifier){const F={};if(f.instructed.verifier.model){const E=typeof f.instructed.verifier.model=="string"?f.instructed.verifier.model:(B=f.instructed.verifier.model)==null?void 0:B.name;if(E){const $=ft(`retrievers.${x}.instructed.verifier.model`,f.instructed.verifier.model);F.model=ge($||E)}}f.instructed.verifier.on_failure&&(F.on_failure=f.instructed.verifier.on_failure),f.instructed.verifier.max_retries!==void 0&&(F.max_retries=f.instructed.verifier.max_retries),Object.keys(F).length>0&&(T.verifier=F)}I.instructed=T}s.retrievers[x]=I})),e.tools&&Object.keys(e.tools).length>0){const x=((o=e.resources)==null?void 0:o.connections)||{},f=((u=e.resources)==null?void 0:u.apps)||{};s.tools={},Object.entries(e.tools).forEach(([C,w])=>{s.tools[C]={name:w.name,function:ag(w.function,C,x,f)}})}if(e.guardrails&&Object.keys(e.guardrails).length>0){const x=((m=e.resources)==null?void 0:m.llms)||{};s.guardrails={},Object.entries(e.guardrails).forEach(([f,C])=>{s.guardrails[f]={name:C.name,model:mi(C.model,x,`guardrails.${f}.model`),prompt:C.prompt,...C.num_retries!==void 0&&{num_retries:C.num_retries},...C.fail_open!==void 0&&{fail_open:C.fail_open},...C.max_context_length!==void 0&&{max_context_length:C.max_context_length}}})}if(e.memory){if(s.memory={},e.memory.checkpointer){let x;if(e.memory.checkpointer.database){const f=ft("memory.checkpointer.database",e.memory.checkpointer.database);if(f)x=ge(f);else{const C=((h=e.resources)==null?void 0:h.databases)||{},w=(r=Object.entries(C).find(([,I])=>{var R,k,D;return I.instance_name===((D=(k=(R=e.memory)==null?void 0:R.checkpointer)==null?void 0:k.database)==null?void 0:D.instance_name)}))==null?void 0:r[0];w?x=ge(w):x=il(e.memory.checkpointer.database,"memory.checkpointer.database")}}s.memory.checkpointer={name:e.memory.checkpointer.name,...x&&{database:x}}}if(e.memory.store){let x;if(e.memory.store.database){const C=ft("memory.store.database",e.memory.store.database);if(C)x=ge(C);else{const w=((c=e.resources)==null?void 0:c.databases)||{},I=(d=Object.entries(w).find(([,R])=>{var k,D,L;return R.instance_name===((L=(D=(k=e.memory)==null?void 0:k.store)==null?void 0:D.database)==null?void 0:L.instance_name)}))==null?void 0:d[0];I?x=ge(I):x=il(e.memory.store.database,"memory.store.database")}}let f;if(e.memory.store.embedding_model){const C=ft("memory.store.embedding_model",e.memory.store.embedding_model);if(C)f=ge(C);else{const w=((g=e.resources)==null?void 0:g.llms)||{},I=(v=Object.entries(w).find(([,R])=>{var k,D,L;return R.name===((L=(D=(k=e.memory)==null?void 0:k.store)==null?void 0:D.embedding_model)==null?void 0:L.name)}))==null?void 0:v[0];I?f=ge(I):f=e.memory.store.embedding_model}}s.memory.store={name:e.memory.store.name,...f&&{embedding_model:f},...e.memory.store.dims&&{dims:e.memory.store.dims},...x&&{database:x},...e.memory.store.namespace&&{namespace:e.memory.store.namespace}}}}if(e.prompts&&Object.keys(e.prompts).length>0&&(s.prompts={},Object.entries(e.prompts).forEach(([x,f])=>{const C=f.alias&&f.alias.trim()!=="";s.prompts[x]={name:f.name,...f.schema&&{schema:an(f.schema,a,`prompts.${x}.schema`)},...f.description&&{description:f.description},...f.default_template&&{default_template:f.default_template},...C&&{alias:f.alias},...!C&&f.version!==void 0&&{version:f.version},...f.tags&&Object.keys(f.tags).length>0&&{tags:f.tags},...f.auto_register!==void 0&&{auto_register:f.auto_register}}})),e.middleware&&Object.keys(e.middleware).length>0&&(s.middleware={},Object.entries(e.middleware).forEach(([x,f])=>{let C;f.args&&Object.keys(f.args).length>0&&(C={},Object.entries(f.args).forEach(([w,I])=>{if(typeof I=="object"&&I!==null)C[w]=I;else if(typeof I=="string")if(I.startsWith("[")&&I.endsWith("]")||I.startsWith("{")&&I.endsWith("}"))try{C[w]=JSON.parse(I)}catch{C[w]=I}else C[w]=I;else C[w]=I})),s.middleware[x]={name:f.name,...C&&Object.keys(C).length>0&&{args:C}}})),e.agents&&Object.keys(e.agents).length>0){const x=((S=e.resources)==null?void 0:S.llms)||{},f=e.prompts||{},C=e.tools||{},w=e.guardrails||{},I=e.middleware||{};s.agents={},Object.entries(e.agents).forEach(([R,k])=>{var F;let D=k.prompt;if(k.prompt&&typeof k.prompt=="object"&&"name"in k.prompt){const E=k.prompt,$=(F=Object.entries(f).find(([,p])=>p.name===E.name))==null?void 0:F[0];$&&(D=ge($))}let L;k.tools&&k.tools.length>0&&(L=k.tools.map((E,$)=>{const p=ft(`agents.${R}.tools.${$}`,E),N=typeof E=="object"?E:null,P=typeof E=="string"?E:E.name,M=W=>za(`tools.${W}`)||W;if(p){for(const[W]of Object.entries(C))if(za(`tools.${W}`)===p||W===p)return ge(p)}if(C[P])return ge(M(P));if(N){const W=Object.entries(C).find(([,q])=>JSON.stringify(q)===JSON.stringify(N));if(W)return ge(M(W[0]))}const O=Object.entries(C).find(([,W])=>W.name===P);if(O)return ge(M(O[0]));if(N&&N.function){const W=Object.entries(C).find(([,q])=>q.function&&JSON.stringify(q.function)===JSON.stringify(N.function));if(W)return ge(M(W[0]))}return console.warn(`Could not find tool key for tool with name "${P}". Tool may have been deleted.`),null}).filter(E=>E!==null));let V;k.guardrails&&k.guardrails.length>0&&(V=k.guardrails.map((E,$)=>{const p=ft(`agents.${R}.guardrails.${$}`,E),N=typeof E=="object"?E:null,P=typeof E=="string"?E:E.name,M=W=>za(`guardrails.${W}`)||W;if(p){for(const[W]of Object.entries(w))if(za(`guardrails.${W}`)===p||W===p)return ge(p)}if(w[P])return ge(M(P));if(N){const W=Object.entries(w).find(([,q])=>JSON.stringify(q)===JSON.stringify(N));if(W)return ge(M(W[0]))}const O=Object.entries(w).find(([,W])=>W.name===P);return O?ge(M(O[0])):(console.warn(`Could not find guardrail key for guardrail with name "${P}". Guardrail may have been deleted.`),null)}).filter(E=>E!==null));let B;k.middleware&&k.middleware.length>0&&(B=k.middleware.map((E,$)=>{const p=ft(`agents.${R}.middleware.${$}`,E),N=typeof E=="object"?E:null,P=typeof E=="string"?E:E.name,M=W=>za(`middleware.${W}`)||W;if(p){for(const[W]of Object.entries(I))if(za(`middleware.${W}`)===p||W===p)return ge(p)}if(I[P])return ge(M(P));if(N){const W=Object.entries(I).find(([,q])=>JSON.stringify(q)===JSON.stringify(N));if(W)return ge(M(W[0]))}const O=Object.entries(I).find(([,W])=>W.name===P);return O?ge(M(O[0])):(console.warn(`Could not find middleware key for middleware with name "${P}". Middleware may have been deleted.`),null)}).filter(E=>E!==null));let T;k.response_format&&(typeof k.response_format=="string"?T=k.response_format:typeof k.response_format=="object"&&(T={...k.response_format.response_schema&&{response_schema:k.response_format.response_schema},...k.response_format.use_tool!==null&&k.response_format.use_tool!==void 0&&{use_tool:k.response_format.use_tool}})),s.agents[R]={name:k.name,model:mi(k.model,x,`agents.${R}.model`),...k.description&&{description:k.description},...L&&L.length>0&&{tools:L},...V&&V.length>0&&{guardrails:V},...B&&B.length>0&&{middleware:B},...D&&{prompt:D},...k.handoff_prompt&&{handoff_prompt:k.handoff_prompt},...T&&{response_format:T}}})}if(e.app&&e.app.name&&((y=e.app.registered_model)!=null&&y.name)){const x=e.agents||{};let f;e.app.agents&&e.app.agents.length>0&&(f=e.app.agents.map((I,R)=>{const k=ft(`app.agents.${R}`,I);if(k&&x[k])return ge(k);const D=typeof I=="object"?I:null,L=typeof I=="string"?I:I.name;if(x[L])return ge(L);if(D){const B=Object.entries(x).find(([,T])=>JSON.stringify(T)===JSON.stringify(D));if(B)return ge(B[0])}const V=Object.entries(x).find(([,B])=>B.name===L);if(V)return ge(V[0]);if(D&&D.model){const B=Object.entries(x).find(([,T])=>T.model&&T.name===L&&JSON.stringify(T.model)===JSON.stringify(D.model));if(B)return ge(B[0])}return console.warn(`Could not find agent key for agent with name "${L}". Agent may have been deleted.`),null}).filter(I=>I!==null));let C={name:e.app.registered_model.name};if(e.app.registered_model.schema){const I=an(e.app.registered_model.schema,a,"app.registered_model.schema");I&&(C.schema=I)}let w;if(e.app.service_principal)if(typeof e.app.service_principal=="string"){const I=e.app.service_principal.startsWith("*")?e.app.service_principal.slice(1):e.app.service_principal;w=ge(I)}else w={client_id:Qs(e.app.service_principal.client_id),client_secret:Qs(e.app.service_principal.client_secret)};if(s.app={name:e.app.name,...e.app.alias&&{alias:e.app.alias},registered_model:C,...e.app.description&&{description:e.app.description},...e.app.log_level&&{log_level:e.app.log_level},...w&&{service_principal:w},...e.app.deployment_target&&{deployment_target:e.app.deployment_target},...(e.app.deployment_target==="model_serving"||!e.app.deployment_target)&&e.app.endpoint_name&&{endpoint_name:e.app.endpoint_name},...(e.app.deployment_target==="model_serving"||!e.app.deployment_target)&&e.app.workload_size&&{workload_size:e.app.workload_size},...(e.app.deployment_target==="model_serving"||!e.app.deployment_target)&&e.app.scale_to_zero!==void 0&&{scale_to_zero:e.app.scale_to_zero},...e.app.python_version&&{python_version:e.app.python_version},...e.app.budget_policy_id&&{budget_policy_id:e.app.budget_policy_id},...e.app.environment_vars&&Object.keys(e.app.environment_vars).length>0&&{environment_vars:eg(e.app.environment_vars,e.variables||{})},...e.app.tags&&Object.keys(e.app.tags).length>0&&{tags:e.app.tags},...e.app.permissions&&e.app.permissions.length>0&&{permissions:e.app.permissions},...e.app.initialization_hooks&&e.app.initialization_hooks.length>0&&{initialization_hooks:e.app.initialization_hooks},...e.app.shutdown_hooks&&e.app.shutdown_hooks.length>0&&{shutdown_hooks:e.app.shutdown_hooks},...e.app.input_example&&{input_example:e.app.input_example},...e.app.code_paths&&e.app.code_paths.length>0&&{code_paths:e.app.code_paths},...e.app.pip_requirements&&e.app.pip_requirements.length>0&&{pip_requirements:e.app.pip_requirements},...f&&f.length>0&&{agents:f}},e.app.orchestration){const I=((b=e.resources)==null?void 0:b.llms)||{},R=e.tools||{},k=e.middleware||{},D=e.agents||{};s.app.orchestration=tg(e.app.orchestration,I,R,k,D)}if(e.app.chat_history){const I=((_=e.resources)==null?void 0:_.llms)||{};s.app.chat_history={model:mi(e.app.chat_history.model,I,"app.chat_history.model"),max_tokens:e.app.chat_history.max_tokens,...e.app.chat_history.max_tokens_before_summary&&{max_tokens_before_summary:e.app.chat_history.max_tokens_before_summary},...e.app.chat_history.max_messages_before_summary&&{max_messages_before_summary:e.app.chat_history.max_messages_before_summary}}}}let i=Na.dump(s,{indent:2,lineWidth:-1,noRefs:!0,sortKeys:!1,quotingType:'"'});return i=Q0(i),i=Z0(i),i=K0(i),i}function rg(e,s="model_config.yaml"){const a=mn(e),n=new Blob([a],{type:"text/yaml"}),i=URL.createObjectURL(n),l=document.createElement("a");l.href=i,l.download=s,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(i)}const _m=Yn(e=>({notifications:[],addNotification:(s,a,n)=>{const i=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,l={id:i,type:s,message:a,details:n,timestamp:Date.now()};e(o=>({notifications:[...o.notifications,l]})),s!=="error"&&setTimeout(()=>{e(o=>({notifications:o.notifications.filter(u=>u.id!==i)}))},1e4)},removeNotification:s=>e(a=>({notifications:a.notifications.filter(n=>n.id!==s)})),clearAll:()=>e({notifications:[]})}));function ig(e){try{const s=mn(e);return Na.load(s),null}catch(s){if(s instanceof Error){const a=s.message,n=a.match(/undefined alias "([^"]+)"/i);return n?`This component is referenced by "${n[1]}". Remove that reference first.`:`Validation failed: ${a}`}return"Unknown validation error"}}function lg(e,s,a){var i,l,o,u,m,h,r;const n=JSON.parse(JSON.stringify(e));switch(s.toLowerCase()){case"tool":n.tools&&delete n.tools[a];break;case"guardrail":n.guardrails&&delete n.guardrails[a];break;case"schema":n.schemas&&delete n.schemas[a];break;case"variable":n.variables&&delete n.variables[a];break;case"agent":n.agents&&delete n.agents[a];break;case"service principal":n.service_principals&&delete n.service_principals[a];break;case"prompt":n.prompts&&delete n.prompts[a];break;case"retriever":n.retrievers&&delete n.retrievers[a];break;case"llm":(i=n.resources)!=null&&i.llms&&delete n.resources.llms[a];break;case"genie room":(l=n.resources)!=null&&l.genie_rooms&&delete n.resources.genie_rooms[a];break;case"warehouse":(o=n.resources)!=null&&o.warehouses&&delete n.resources.warehouses[a];break;case"function":(u=n.resources)!=null&&u.functions&&delete n.resources.functions[a];break;case"connection":(m=n.resources)!=null&&m.connections&&delete n.resources.connections[a];break;case"database":(h=n.resources)!=null&&h.databases&&delete n.resources.databases[a];break;case"vector store":(r=n.resources)!=null&&r.vector_stores&&delete n.resources.vector_stores[a];break;case"middleware":n.middleware&&delete n.middleware[a];break;default:return null}return ig(n)}function Gt(e,s,a){const{addNotification:n}=_m.getState(),i=nt.getState().config,l=lg(i,e,s);if(l)return n("error",`Cannot delete ${e} "${s}"`,l),!1;try{return a(),n("success",`${e} "${s}" deleted`),!0}catch(o){return n("error",`Failed to delete ${e} "${s}"`,o instanceof Error?o.message:"Unknown error"),!1}}function hn(e){return e.trim().replace(/[\s-]+/g,"_").replace(/_+/g,"_").replace(/[^a-zA-Z0-9_]/g,"").replace(/^_+|_+$/g,"")}function Ot(e){const s=e.endsWith(" ");let a=e.replace(/[\s-]+/g,"_").replace(/[^a-zA-Z0-9_]/g,"").replace(/_+/g,"_").replace(/^_+/,"");return s&&!a.endsWith("_")&&a.length>0&&(a+="_"),a}const ll={name:"",type:"primitive",primitiveValue:"",envName:"",envDefault:"",secretScope:"",secretKey:"",secretDefault:"",compositeOptions:[],compositeDefault:""},og=[{value:"primitive",label:"Primitive Value"},{value:"env",label:"Environment Variable"},{value:"secret",label:"Databricks Secret"},{value:"composite",label:"Composite (Fallback Chain)"}],cg=e=>{switch(e){case"primitive":return bo;case"env":return Mt;case"secret":return vo;case"composite":return xs;default:return Mt}},Yl=e=>{const s=e;return s.type&&typeof s.type=="string"?s.type:"options"in s&&Array.isArray(s.options)?"composite":"scope"in s&&"secret"in s?"secret":"env"in s?"env":("value"in s,"primitive")},dg=e=>{const s=Yl(e),a=e;switch(s){case"primitive":return`Value: ${a.value??""}`;case"env":return`Env: ${a.env??""}`;case"secret":return`Secret: ${a.scope??""}/${a.secret??""}`;case"composite":return`${(a.options||[]).length} fallback option(s)`;default:return""}};function ug(){const{config:e,addVariable:s,updateVariable:a,removeVariable:n}=nt(),[i,l]=A.useState(!1),[o,u]=A.useState(null),[m,h]=A.useState(ll),r=e.variables||{},{scrollToAsset:c}=zs(),d=(x,f)=>{c(x),u(x);const C=Yl(f),w={...ll,name:x,type:C};switch(C){case"primitive":w.primitiveValue=String(f.value||"");break;case"env":const I=f;w.envName=I.env||"",w.envDefault=I.default_value!==void 0?String(I.default_value):"";break;case"secret":const R=f;w.secretScope=R.scope||"",w.secretKey=R.secret||"",w.secretDefault=R.default_value!==void 0?String(R.default_value):"";break;case"composite":const k=f;w.compositeOptions=(k.options||[]).map(D=>{const L=D;return"env"in L?{type:"env",envName:String(L.env||"")}:"scope"in L&&"secret"in L?{type:"secret",scope:String(L.scope||""),secret:String(L.secret||"")}:"value"in L?{type:"primitive",value:String(L.value||"")}:{type:"primitive",value:""}}),w.compositeDefault=k.default_value!==void 0?String(k.default_value):"";break}h(w),l(!0)},g=()=>{h(ll),u(null),l(!1)},v=()=>{switch(m.type){case"primitive":return{type:"primitive",value:m.primitiveValue};case"env":return{type:"env",env:m.envName,...m.envDefault&&{default_value:m.envDefault}};case"secret":return{type:"secret",scope:m.secretScope,secret:m.secretKey,...m.secretDefault&&{default_value:m.secretDefault}};case"composite":return{type:"composite",options:m.compositeOptions.map(x=>x.type==="env"?{type:"env",env:x.envName||""}:x.type==="secret"?{type:"secret",scope:x.scope||"",secret:x.secret||""}:{type:"primitive",value:x.value||""}),...m.compositeDefault&&{default_value:m.compositeDefault}};default:return{type:"primitive",value:""}}},S=()=>{if(!m.name.trim())return;const x=v();o?o!==m.name?(n(o),s(m.name,x)):a(o,x):s(m.name,x),g()},y=x=>{h({...m,compositeOptions:[...m.compositeOptions,{type:x,envName:"",scope:"",secret:"",value:""}]})},b=(x,f)=>{const C=[...m.compositeOptions];C[x]={...C[x],...f},h({...m,compositeOptions:C})},_=x=>{h({...m,compositeOptions:m.compositeOptions.filter((f,C)=>C!==x)})};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-semibold text-white",children:"Variables"}),t.jsx("p",{className:"text-sm text-slate-400",children:"Define reusable configuration variables (env vars, secrets, or values)"})]}),t.jsxs(ee,{onClick:()=>l(!0),disabled:i,children:[t.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Add Variable"]})]}),i&&t.jsxs($e,{className:"p-4 space-y-4 border-blue-500/50",children:[t.jsx("h3",{className:"text-lg font-medium text-white",children:o?"Edit Variable":"Add Variable"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(U,{label:"Variable Name",placeholder:"e.g., client_id, workspace_host",value:m.name,onChange:x=>{h({...m,name:Ot(x.target.value)})},hint:"Type naturally - spaces become underscores"}),t.jsx(ae,{label:"Variable Type",value:m.type,onChange:x=>h({...m,type:x.target.value}),options:og})]}),m.type==="primitive"&&t.jsx(U,{label:"Value",placeholder:"Enter the value",value:m.primitiveValue,onChange:x=>h({...m,primitiveValue:x.target.value})}),m.type==="env"&&t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(U,{label:"Environment Variable Name",placeholder:"e.g., DATABRICKS_HOST",value:m.envName,onChange:x=>h({...m,envName:x.target.value})}),t.jsx(U,{label:"Default Value (optional)",placeholder:"Fallback if env var not set",value:m.envDefault,onChange:x=>h({...m,envDefault:x.target.value})})]}),m.type==="secret"&&t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsx(U,{label:"Secret Scope",placeholder:"e.g., retail_ai",value:m.secretScope,onChange:x=>h({...m,secretScope:x.target.value})}),t.jsx(U,{label:"Secret Key",placeholder:"e.g., DATABRICKS_TOKEN",value:m.secretKey,onChange:x=>h({...m,secretKey:x.target.value})}),t.jsx(U,{label:"Default Value (optional)",placeholder:"Fallback if secret not found",value:m.secretDefault,onChange:x=>h({...m,secretDefault:x.target.value})})]}),m.type==="composite"&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Fallback Options (tried in order)"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(ee,{size:"sm",variant:"secondary",onClick:()=>y("env"),children:[t.jsx(Mt,{className:"w-3 h-3 mr-1"})," Add Env"]}),t.jsxs(ee,{size:"sm",variant:"secondary",onClick:()=>y("secret"),children:[t.jsx(vo,{className:"w-3 h-3 mr-1"})," Add Secret"]}),t.jsxs(ee,{size:"sm",variant:"secondary",onClick:()=>y("primitive"),children:[t.jsx(bo,{className:"w-3 h-3 mr-1"})," Add Value"]})]})]}),m.compositeOptions.length===0&&t.jsx("p",{className:"text-sm text-slate-500 italic",children:"Add fallback options. They will be tried in order until one succeeds."}),m.compositeOptions.map((x,f)=>t.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-800/50 rounded-lg",children:[t.jsxs("span",{className:"text-xs text-slate-500 w-6",children:[f+1,"."]}),x.type==="env"&&t.jsx(U,{className:"flex-1",placeholder:"Environment variable name",value:x.envName||"",onChange:C=>b(f,{envName:C.target.value})}),x.type==="secret"&&t.jsxs(t.Fragment,{children:[t.jsx(U,{className:"flex-1",placeholder:"Scope",value:x.scope||"",onChange:C=>b(f,{scope:C.target.value})}),t.jsx(U,{className:"flex-1",placeholder:"Secret key",value:x.secret||"",onChange:C=>b(f,{secret:C.target.value})})]}),x.type==="primitive"&&t.jsx(U,{className:"flex-1",placeholder:"Value",value:x.value||"",onChange:C=>b(f,{value:C.target.value})}),t.jsx("span",{className:"text-xs text-slate-500 capitalize",children:x.type}),t.jsx("button",{onClick:()=>_(f),className:"text-slate-400 hover:text-red-400",children:t.jsx(Ze,{className:"w-4 h-4"})})]},f)),t.jsx(U,{label:"Default Value (optional)",placeholder:"Final fallback if all options fail",value:m.compositeDefault,onChange:x=>h({...m,compositeDefault:x.target.value})})]}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(ee,{variant:"secondary",onClick:g,children:"Cancel"}),t.jsx(ee,{onClick:S,disabled:!m.name.trim(),children:o?"Save Changes":"Add Variable"})]})]}),Object.keys(r).length===0&&!i?t.jsxs($e,{className:"p-8 text-center",children:[t.jsx("div",{className:"text-slate-400 mb-4",children:t.jsx(Mt,{className:"w-12 h-12 mx-auto opacity-50"})}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No Variables Defined"}),t.jsx("p",{className:"text-slate-400 text-sm mb-4",children:"Variables let you configure values from environment variables, Databricks secrets, or fallback chains. Use them to keep sensitive data out of your config."}),t.jsxs(ee,{onClick:()=>l(!0),children:[t.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Add Your First Variable"]})]}):t.jsx("div",{className:"grid gap-4",children:Object.entries(r).map(([x,f])=>{const C=Yl(f),w=cg(C);return t.jsx($e,{className:"p-4 cursor-pointer hover:border-blue-500/50 transition-colors",onClick:()=>d(x,f),children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-slate-700/50 rounded-lg",children:t.jsx(w,{className:"w-5 h-5 text-blue-400"})}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-white",children:x}),t.jsx("p",{className:"text-sm text-slate-400",children:dg(f)})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-xs px-2 py-1 bg-slate-700/50 rounded text-slate-300 capitalize",children:C}),t.jsx("button",{onClick:I=>{I.stopPropagation(),d(x,f)},className:"text-slate-400 hover:text-blue-400 p-1",title:"Edit variable",children:t.jsx(Lr,{className:"w-4 h-4"})}),t.jsx("button",{onClick:I=>{I.stopPropagation(),Gt("Variable",x,()=>n(x))},className:"text-slate-400 hover:text-red-400 p-1",title:"Delete variable",children:t.jsx(Ze,{className:"w-4 h-4"})})]})]})},x)})}),Object.keys(r).length>0&&t.jsxs($e,{className:"p-4 bg-slate-800/30 border-slate-700/50",children:[t.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-2",children:"Usage in YAML"}),t.jsx("p",{className:"text-xs text-slate-400 mb-2",children:"Reference variables using YAML anchors:"}),t.jsx("pre",{className:"text-xs bg-slate-900/50 p-2 rounded overflow-x-auto",children:t.jsx("code",{className:"text-green-400",children:`variables:
  ${Object.keys(r)[0]||"my_var"}: &${Object.keys(r)[0]||"my_var"}
    ...

# Use in config:
tools:
  my_tool:
    function:
      client_id: *${Object.keys(r)[0]||"my_var"}`})})]})]})}function Gc(e,s){return typeof e=="string"&&e.startsWith(s)}function Qr(e){return typeof e=="string"?e:""}function Yc(e,s,a){if(!e)return!1;const n=s.resources||{},i=["llms","genie_rooms","tables","volumes","functions","warehouses","connections","databases","vector_stores"];for(const r of i){const c=n[r]||{};if(e in c&&e!==a)return!0}const l=s.service_principals||{};if(e in l&&e!==a)return!0;const o=s.agents||{};if(e in o&&e!==a)return!0;const u=s.tools||{};if(e in u&&e!==a)return!0;const m=s.schemas||{};if(e in m&&e!==a)return!0;const h=s.variables||{};return e in h&&e!==a}const Zr={refName:"",clientIdSource:"variable",clientSecretSource:"variable",client_id:"",client_secret:"",clientIdVariable:"",clientSecretVariable:""};function mg(){const{config:e,addServicePrincipal:s,updateServicePrincipal:a,removeServicePrincipal:n}=nt(),i=e.service_principals||{},l=e.variables||{},o=Object.keys(l),[u,m]=A.useState(!1),[h,r]=A.useState(null),[c,d]=A.useState(Zr),{scrollToAsset:g}=zs(),v=f=>{g(f);const C=i[f];if(C){const w=R=>Gc(R,"*"),I=R=>{const k=Qr(R);return k.startsWith("*")?k.slice(1):""};d({refName:f,clientIdSource:w(C.client_id)?"variable":"manual",clientSecretSource:w(C.client_secret)?"variable":"manual",client_id:w(C.client_id)?"":Qr(C.client_id),client_secret:w(C.client_secret)?"":Qr(C.client_secret),clientIdVariable:w(C.client_id)?I(C.client_id):"",clientSecretVariable:w(C.client_secret)?I(C.client_secret):""}),r(f),m(!0)}},S=()=>{const f={client_id:c.clientIdSource==="variable"&&c.clientIdVariable?`*${c.clientIdVariable}`:c.client_id,client_secret:c.clientSecretSource==="variable"&&c.clientSecretVariable?`*${c.clientSecretVariable}`:c.client_secret};h?h!==c.refName?(n(h),s(c.refName,f)):a(c.refName,f):s(c.refName,f),d(Zr),m(!1),r(null)},y=()=>{d(Zr),m(!1),r(null)},b=f=>{Gt("Service Principal",f,()=>n(f))},_=c.clientIdSource==="variable"?!!c.clientIdVariable:!!c.client_id,x=c.clientSecretSource==="variable"?!!c.clientSecretVariable:!!c.client_secret;return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-slate-100",children:"Service Principals"}),t.jsx("p",{className:"text-slate-400 mt-1",children:"Configure OAuth credentials for database connections, MCP tools, and other services that require authentication."})]}),t.jsx($e,{className:"p-4 bg-blue-500/10 border-blue-500/30",children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(Mt,{className:"w-5 h-5 text-blue-400 mt-0.5"}),t.jsxs("div",{className:"text-sm text-blue-200",children:[t.jsx("p",{className:"font-medium",children:"About Service Principals"}),t.jsxs("p",{className:"text-blue-300 mt-1",children:["Service principals provide OAuth client credentials (client_id and client_secret) that can be referenced throughout your configuration using ",t.jsx("code",{className:"bg-blue-900/50 px-1 rounded",children:"*reference_name"})," syntax. They're commonly used for database connections, external API authentication, and MCP tool configuration."]})]})]})}),t.jsxs($e,{className:"p-5",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Mt,{className:"w-5 h-5 text-amber-400"}),t.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Configured Service Principals"})]}),t.jsxs(ee,{variant:"secondary",size:"sm",onClick:()=>{d(Zr),r(null),m(!0)},children:[t.jsx(Ie,{className:"w-4 h-4 mr-1"}),"Add Service Principal"]})]}),Object.keys(i).length>0&&t.jsx("div",{className:"space-y-2 mb-4",children:Object.entries(i).map(([f,C])=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800/50 rounded-lg border border-slate-700",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Mt,{className:"w-4 h-4 text-amber-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-slate-200",children:f}),t.jsxs("p",{className:"text-xs text-slate-500",children:["Client ID: ",Gc(C.client_id,"*")?`Variable (${Qr(C.client_id).slice(1)})`:""]})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ee,{variant:"ghost",size:"sm",onClick:()=>v(f),children:t.jsx(ds,{className:"w-4 h-4"})}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:()=>b(f),children:t.jsx(Ze,{className:"w-4 h-4 text-red-400"})})]})]},f))}),Object.keys(i).length===0&&!u&&t.jsx("p",{className:"text-slate-500 text-sm",children:'No service principals configured. Click "Add Service Principal" to create one.'}),u&&t.jsxs("div",{className:"mt-4 p-4 bg-slate-800/50 rounded-lg border border-slate-700 space-y-4",children:[t.jsxs("h4",{className:"font-medium text-slate-200",children:[h?"Edit":"New"," Service Principal"]}),t.jsx(U,{label:"Reference Name",value:c.refName,onChange:f=>d({...c,refName:Ot(f.target.value)}),placeholder:"My Service Principal",hint:"Type naturally - spaces become underscores",required:!0}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Client ID *"}),t.jsx("div",{className:"flex space-x-2",children:t.jsxs("div",{className:"inline-flex rounded-lg bg-slate-900/50 p-0.5",children:[t.jsx("button",{type:"button",onClick:()=>d({...c,clientIdSource:"variable",client_id:""}),className:`px-3 py-1 text-xs rounded-md font-medium transition-all duration-150 ${c.clientIdSource==="variable"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Variable"}),t.jsx("button",{type:"button",onClick:()=>d({...c,clientIdSource:"manual",clientIdVariable:""}),className:`px-3 py-1 text-xs rounded-md font-medium transition-all duration-150 ${c.clientIdSource==="manual"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Manual"})]})})]}),c.clientIdSource==="variable"?t.jsx(ae,{value:c.clientIdVariable,onChange:f=>d({...c,clientIdVariable:f.target.value}),options:[{value:"",label:"Select a variable..."},...o.map(f=>({value:f,label:f}))],hint:"Reference a configured variable for the client ID"}):t.jsx(U,{type:"password",value:c.client_id,onChange:f=>d({...c,client_id:f.target.value}),placeholder:"Enter client ID...",hint:"OAuth client ID for the service principal"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Client Secret *"}),t.jsx("div",{className:"flex space-x-2",children:t.jsxs("div",{className:"inline-flex rounded-lg bg-slate-900/50 p-0.5",children:[t.jsx("button",{type:"button",onClick:()=>d({...c,clientSecretSource:"variable",client_secret:""}),className:`px-3 py-1 text-xs rounded-md font-medium transition-all duration-150 ${c.clientSecretSource==="variable"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Variable"}),t.jsx("button",{type:"button",onClick:()=>d({...c,clientSecretSource:"manual",clientSecretVariable:""}),className:`px-3 py-1 text-xs rounded-md font-medium transition-all duration-150 ${c.clientSecretSource==="manual"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Manual"})]})})]}),c.clientSecretSource==="variable"?t.jsx(ae,{value:c.clientSecretVariable,onChange:f=>d({...c,clientSecretVariable:f.target.value}),options:[{value:"",label:"Select a variable..."},...o.map(f=>({value:f,label:f}))],hint:"Reference a configured variable for the client secret"}):t.jsx(U,{type:"password",value:c.client_secret,onChange:f=>d({...c,client_secret:f.target.value}),placeholder:"Enter client secret...",hint:"OAuth client secret for the service principal"})]}),c.refName&&Yc(c.refName,e,h)&&t.jsxs("div",{className:"p-3 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm",children:['A resource with reference name "',c.refName,'" already exists. Please choose a unique name.']}),t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx(ee,{variant:"secondary",onClick:y,children:"Cancel"}),t.jsx(ee,{onClick:S,disabled:!c.refName||!_||!x||Yc(c.refName,e,h),children:h?"Update":"Add"})]})]})]}),t.jsxs($e,{className:"p-4",children:[t.jsx("h4",{className:"font-medium text-slate-200 mb-3",children:"Usage Examples"}),t.jsxs("div",{className:"text-sm text-slate-400 space-y-2",children:[t.jsx("p",{children:"Once configured, reference service principals in your YAML using the asterisk notation:"}),t.jsx("pre",{className:"bg-slate-800 p-3 rounded text-xs overflow-x-auto",children:`databases:
  my_database:
    service_principal: *my_service_principal
    host: ...

tools:
  mcp_tool:
    function:
      type: mcp
      service_principal: *my_service_principal
      ...`})]})]})]})}function ws({isOpen:e,onClose:s,title:a,description:n,children:i,size:l="md"}){if(A.useEffect(()=>{const u=m=>{m.key==="Escape"&&s()};return e&&(document.addEventListener("keydown",u),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",u),document.body.style.overflow="unset"}},[e,s]),!e)return null;const o={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl",full:"max-w-[90vw]"};return t.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[t.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:s}),t.jsxs("div",{className:pt("relative w-full bg-slate-900 border border-slate-700 rounded-2xl shadow-2xl animate-fade-in",o[l]),children:[t.jsxs("div",{className:"flex items-start justify-between p-6 border-b border-slate-800",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold text-white",children:a}),n&&t.jsx("p",{className:"mt-1 text-sm text-slate-400",children:n})]}),t.jsx("button",{onClick:s,className:"p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors",children:t.jsx(_a,{className:"w-5 h-5"})})]}),t.jsx("div",{className:pt("p-6 overflow-y-auto",l==="full"?"max-h-[80vh]":"max-h-[70vh]"),children:i})]})]})}let An=null;const Mo="databricks_config";function hg(){const e=window.location.hostname;return e.includes(".databricks")||e.includes(".azuredatabricks.")||e.endsWith(".databricks.com")||e.endsWith(".gcp.databricks.com")||e.endsWith(".cloud.databricks.com")}function pg(){return window.location.origin}let wr=null;function fg(e){wr=e}function or(e){console.log("[Config] Setting config:",{host:e.host,source:e.source,isAutoDetected:e.isAutoDetected}),An=e;try{localStorage.setItem(Mo,JSON.stringify(e)),console.log("[Config] Saved to localStorage")}catch(s){console.error("[Config] Failed to save to localStorage:",s)}wr?(console.log("[Config] Notifying listeners of config change"),wr()):console.warn("[Config] No config change callback registered")}function ln(){if(An)return An;try{const e=localStorage.getItem(Mo);if(e)return An=JSON.parse(e),An}catch{}return null}function Nm(){An=null;try{localStorage.removeItem(Mo)}catch{}wr&&wr()}function Ca(){return ln()!==null}async function xg(e){const s=e?`/api/auth/login?host=${encodeURIComponent(e)}`:"/api/auth/login";return(await fetch(s,{credentials:"include"})).json()}async function gg(){await fetch("/api/auth/logout",{credentials:"include"}),Nm()}async function bg(){var a;const e=hg(),s=ln();if(s)return console.log("[AutoDetect] Already configured, returning existing config"),{success:!0,host:s.host,hasToken:!0,inDatabricksApp:e,source:s.source};try{console.log("[AutoDetect] Fetching /api/auth/context...");const n=await fetch("/api/auth/context",{credentials:"include"});if(console.log("[AutoDetect] Response status:",n.status,n.ok),n.ok){const i=await n.json();if(console.log("[AutoDetect] Auth context data:",i),i.host&&i.has_token){const l=i.auth_method;return or({host:i.host,token:`__${l.toUpperCase()}_TOKEN__`,isAutoDetected:!0,source:l}),{success:!0,host:i.host,hasToken:!0,inDatabricksApp:i.is_databricks_app,user:i.user,source:l,oauth:i.oauth}}return i.host&&!i.has_token?{success:!1,host:i.host,hasToken:!1,inDatabricksApp:i.is_databricks_app,user:i.user,source:null,oauth:i.oauth,error:(a=i.oauth)!=null&&a.configured?'Not authenticated. Click "Login with Databricks" to authenticate.':i.is_databricks_app?"On-behalf-of-user authentication is not enabled. Please configure manual credentials or enable OBO auth for this app.":"Token not found. Configure credentials manually or set DATABRICKS_TOKEN environment variable."}:{success:!1,host:null,hasToken:!1,inDatabricksApp:i.is_databricks_app,oauth:i.oauth,error:"No Databricks host configured."}}}catch{}return e?{success:!1,host:pg(),hasToken:!1,inDatabricksApp:!0,error:"Could not connect to backend. Please ensure the app is running correctly."}:{success:!1,host:null,hasToken:!1,inDatabricksApp:!1,error:"Configure Databricks credentials manually."}}class la extends Error{constructor(s,a,n){super(s),this.status=a,this.errorCode=n,this.name="DatabricksApiError"}}const Yt={async getConnectionStatus(){const e=ln();if(console.log("[getConnectionStatus] Current config:",e),!e)return console.log("[getConnectionStatus] No config found, returning not connected"),{connected:!1,error:"Not configured"};try{console.log("[getConnectionStatus] Fetching /api/auth/verify...");const s={"Content-Type":"application/json","X-Databricks-Host":e.host};e.token&&!e.token.startsWith("__")&&e.source==="manual"?(console.log("[getConnectionStatus] Using manual token for verification"),s.Authorization=`Bearer ${e.token}`):console.log("[getConnectionStatus] Using auto-detected auth (no Authorization header)");const i=await(await fetch("/api/auth/verify",{credentials:"include",headers:s})).json();return console.log("[getConnectionStatus] Verify response:",i),i.authenticated&&i.user?{connected:!0,user:i.user.userName,display_name:i.user.displayName,host:i.host||e.host,isAutoDetected:e.isAutoDetected,source:i.token_source||e.source}:{connected:!1,error:i.error||i.message||"Authentication failed"}}catch(s){return console.error("[getConnectionStatus] Error:",s),{connected:!1,error:s instanceof Error?s.message:"Unknown error"}}},async listCatalogs(){const e=await fetch("/api/uc/catalogs",{credentials:"include"});if(!e.ok){const a=await e.json().catch(()=>({error:e.statusText}));throw new la(a.error||"Failed to list catalogs")}return(await e.json()).catalogs||[]},async listSchemas(e){const s=await fetch(`/api/uc/schemas?catalog=${encodeURIComponent(e)}`,{credentials:"include"});if(!s.ok){const n=await s.json().catch(()=>({error:s.statusText}));throw new la(n.error||"Failed to list schemas")}return(await s.json()).schemas||[]},async listTables(e,s){const a=await fetch(`/api/uc/tables?catalog=${encodeURIComponent(e)}&schema=${encodeURIComponent(s)}`,{credentials:"include"});if(!a.ok){const i=await a.json().catch(()=>({error:a.statusText}));throw new la(i.error||"Failed to list tables")}return(await a.json()).tables||[]},async getTableColumns(e,s,a){const n=await fetch(`/api/uc/table-columns?catalog=${encodeURIComponent(e)}&schema=${encodeURIComponent(s)}&table=${encodeURIComponent(a)}`,{credentials:"include"});if(!n.ok){const l=await n.json().catch(()=>({error:n.statusText}));throw new la(l.error||"Failed to get table columns")}return(await n.json()).columns||[]},async listFunctions(e,s){const a=await fetch(`/api/uc/functions?catalog=${encodeURIComponent(e)}&schema=${encodeURIComponent(s)}`,{credentials:"include"});if(!a.ok){const i=await a.json().catch(()=>({error:a.statusText}));throw new la(i.error||"Failed to list functions")}return(await a.json()).functions||[]},async listVolumes(e,s){const a=await fetch(`/api/uc/volumes?catalog=${encodeURIComponent(e)}&schema=${encodeURIComponent(s)}`,{credentials:"include"});if(!a.ok){const i=await a.json().catch(()=>({error:a.statusText}));throw new la(i.error||"Failed to list volumes")}return(await a.json()).volumes||[]},async listDatabases(){try{const e=await fetch("/api/uc/databases",{credentials:"include"});if(!e.ok){const a=await e.json().catch(()=>({error:e.statusText}));return console.error("[listDatabases] Error:",a),[]}return(await e.json()).databases||[]}catch(e){return console.error("[listDatabases] Error:",e),[]}},async listServingEndpoints(){try{const e=await fetch("/api/uc/serving-endpoints",{credentials:"include"});if(!e.ok){const a=await e.json().catch(()=>({error:e.statusText}));throw new la(a.error||"Failed to list serving endpoints")}return(await e.json()).endpoints||[]}catch(e){return console.error("[listServingEndpoints] Error:",e),[]}},async listSQLWarehouses(){try{const e=await fetch("/api/uc/sql-warehouses",{credentials:"include"});if(!e.ok){const a=await e.json().catch(()=>({error:e.statusText}));throw new la(a.error||"Failed to list SQL warehouses")}return(await e.json()).warehouses||[]}catch(e){return console.error("[listSQLWarehouses] Error:",e),[]}},async listGenieSpaces(){try{const e=await fetch("/api/uc/genie-spaces",{credentials:"include"});return e.ok?((await e.json()).spaces||[]).map(a=>({space_id:a.id||a.space_id||"",title:a.name||a.title||"",description:a.description,owner:a.owner})):[]}catch{return[]}},async listApps(){try{const e=await fetch("/api/uc/apps",{credentials:"include"});if(!e.ok){const a=await e.json().catch(()=>({error:e.statusText}));throw new la(a.error||"Failed to list apps")}return(await e.json()).apps||[]}catch(e){return console.error("[listApps] Error:",e),[]}},async listVectorSearchEndpoints(){try{const e=await fetch("/api/uc/vector-search-endpoints",{credentials:"include"});return e.ok?(await e.json()).endpoints||[]:[]}catch{return[]}},async listVectorSearchIndexes(e){try{const s=e?`/api/uc/vector-search-indexes?endpoint=${encodeURIComponent(e)}`:"/api/uc/vector-search-indexes",a=await fetch(s,{credentials:"include"});return a.ok?(await a.json()).vector_indexes||[]:[]}catch{return[]}},async listUCConnections(){try{const e=await fetch("/api/uc/connections",{credentials:"include"});return e.ok?(await e.json()).connections||[]:[]}catch{return[]}},async listRegisteredModels(){try{const e=await fetch("/api/uc/registered-models",{credentials:"include"});if(!e.ok){const a=await e.json().catch(()=>({error:e.statusText}));throw new la(a.error||"Failed to list registered models")}return(await e.json()).models||[]}catch(e){return console.error("[listRegisteredModels] Error:",e),[]}},async listPrompts(e,s,a){try{let n;if(a?n=await fetch("/api/uc/prompts",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({catalog:e,schema:s,service_principal:a})}):n=await fetch(`/api/uc/prompts?catalog=${encodeURIComponent(e)}&schema=${encodeURIComponent(s)}`,{credentials:"include"}),!n.ok){const l=await n.json().catch(()=>({error:n.statusText}));return console.error("[listPrompts] Error:",l),[]}return(await n.json()).prompts||[]}catch(n){return console.error("[listPrompts] Error:",n),[]}},async getPromptDetails(e,s){try{let a;if(s?a=await fetch("/api/uc/prompt-details",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:e,service_principal:s})}):a=await fetch(`/api/uc/prompt-details?name=${encodeURIComponent(e)}`,{credentials:"include"}),!a.ok){const n=await a.json().catch(()=>({error:a.statusText}));return console.error("[getPromptDetails] Error:",n),null}return await a.json()}catch(a){return console.error("[getPromptDetails] Error:",a),null}},async getPromptTemplate(e,s,a,n){try{let i;if(n)i=await fetch("/api/uc/prompt-template",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:e,version:s||void 0,alias:a||void 0,service_principal:n})});else{let o=`/api/uc/prompt-template?name=${encodeURIComponent(e)}`;s?o+=`&version=${encodeURIComponent(s)}`:a&&(o+=`&alias=${encodeURIComponent(a)}`),i=await fetch(o,{credentials:"include"})}const l=await i.json().catch(()=>({error:i.statusText}));return i.ok?l:(console.error("[getPromptTemplate] Error:",l),{template:"",version:"",error:l.error||"Failed to load template",alias_not_found:l.alias_not_found,version_not_found:l.version_not_found})}catch(i){return console.error("[getPromptTemplate] Error:",i),{template:"",version:"",error:i instanceof Error?i.message:"Unknown error"}}},async registerPrompt(e,s,a,n,i,l,o,u){try{const m=await fetch("/api/uc/register-prompt",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:e,catalog_name:s,schema_name:a,template:n,description:i||void 0,alias:l||void 0,tags:o||void 0,service_principal:u||void 0})}),h=await m.json().catch(()=>({error:m.statusText}));return m.ok?h:(console.error("[registerPrompt] Error:",h),{success:!1,error:h.error||"Failed to register prompt"})}catch(m){return console.error("[registerPrompt] Error:",m),{success:!1,error:m instanceof Error?m.message:"Unknown error"}}}};let Kl=0;const Si=new Set;function vg(){Kl++,console.log("[Hooks] Config change notified, new version:",Kl,"listeners:",Si.size),Si.forEach(e=>e())}console.log("[Hooks] Registering config change callback");fg(vg);function yg(e){return Si.add(e),()=>Si.delete(e)}function jg(){return Kl}function wm(){return A.useSyncExternalStore(yg,jg)}function as(e,s=[],a=!1){const n=wm(),[i,l]=A.useState(null),[o,u]=A.useState(!1),[m,h]=A.useState(null),r=JSON.stringify(s),c=A.useRef(!1),d=A.useCallback(async()=>{if(c.current)return;const g=Ca();if(a||!g){u(!1),l(null);return}c.current=!0,u(!0),h(null);try{const v=await e();l(v)}catch(v){console.error("[useAsync] Fetch error:",v),h(v instanceof Error?v:new Error(String(v)))}finally{u(!1),c.current=!1}},[a,n,r]);return A.useEffect(()=>{d()},[d]),{data:i,loading:o,error:m,refetch:d}}function _g(){const[e,s]=A.useState(!0),[a,n]=A.useState(!1),[i,l]=A.useState(null),[o,u]=A.useState(!1),[m,h]=A.useState(!1),[r,c]=A.useState(null),[d,g]=A.useState(void 0),[v,S]=A.useState(0),y=A.useCallback(()=>{S(b=>b+1)},[]);return A.useEffect(()=>{(async()=>{console.log("[useAutoDetectConfig] Starting detection..."),s(!0);const _=await bg();console.log("[useAutoDetectConfig] Detection result:",_),n(_.success),l(_.host),u(_.hasToken),h(_.inDatabricksApp),c(_.error||null),g(_.oauth),s(!1)})()},[v]),{detecting:e,detected:a,autoDetectedHost:i,hasToken:o,inDatabricksApp:m,error:r,oauthInfo:d,redetect:y}}function Sm(){const e=wm(),s=Ca();console.log("[useConnectionStatus] configured:",s,"configVer:",e);const a=as(async()=>{console.log("[useConnectionStatus] Calling getConnectionStatus...");const n=await Yt.getConnectionStatus();return console.log("[useConnectionStatus] Got status:",n),n},[s,e],!1);return console.log("[useConnectionStatus] Returning:",{...a,configured:s}),{...a,configured:s}}function en(){return as(()=>Yt.listCatalogs(),[])}function ea(e){return as(async()=>e?Yt.listSchemas(e):[],[e],!e)}function Xl(e,s){return as(async()=>!e||!s?[]:Yt.listTables(e,s),[e,s],!e||!s)}function Ng(e,s,a){return as(async()=>!e||!s||!a?[]:Yt.getTableColumns(e,s,a),[e,s,a],!e||!s||!a)}function Cm(e,s){return as(async()=>!e||!s?[]:Yt.listFunctions(e,s),[e,s],!e||!s)}function Jl(e,s){return as(async()=>!e||!s?[]:Yt.listVolumes(e,s),[e,s],!e||!s)}function wg(){return as(()=>Yt.listServingEndpoints(),[])}function Sg(){return as(()=>Yt.listDatabases(),[])}function Cg(){return as(()=>Yt.listSQLWarehouses(),[])}function Ro(){return as(()=>Yt.listGenieSpaces(),[])}function km(){return as(()=>Yt.listUCConnections(),[])}function kg(){return as(()=>Yt.listApps(),[])}function Mm(){return as(()=>Yt.listVectorSearchEndpoints(),[])}function Ql(e){return as(async()=>Yt.listVectorSearchIndexes(e),[e])}function Mg(e,s,a){return as(async()=>!e||!s?[]:Yt.listPrompts(e,s,a),[e,s,a],!e||!s)}function Rg(e,s){return as(async()=>e?Yt.getPromptDetails(e,s):null,[e,s],!e)}function cr({label:e="Catalog",value:s,onChange:a,hint:n,required:i,disabled:l,placeholder:o="Select a catalog"}){const{data:u,loading:m,error:h}=en(),r=Ca(),c=[{value:"",label:o},...(u||[]).map(d=>({value:d.name,label:d.name}))];return t.jsx(ae,{label:e,value:s,onChange:d=>a(d.target.value),options:c,hint:r?m?"Loading catalogs...":h?"Failed to load catalogs":n:"Connect to Databricks first",required:i,disabled:l||m||!r})}function dr({label:e="Schema",value:s,onChange:a,catalog:n,hint:i,required:l,disabled:o,placeholder:u="Select a schema"}){const{data:m,loading:h,error:r}=ea(n),c=Ca();A.useEffect(()=>{s&&m&&!m.find(g=>g.name===s)&&a("")},[n,m,s,a]);const d=[{value:"",label:u},...(m||[]).map(g=>({value:g.name,label:g.name}))];return t.jsx(ae,{label:e,value:s,onChange:g=>a(g.target.value),options:d,hint:c?n?h?"Loading schemas...":r?"Failed to load schemas":i:"Select a catalog first":"Connect to Databricks first",required:l,disabled:o||h||!n||!c})}function Kc({label:e="Genie Space",value:s,onChange:a,hint:n,required:i,disabled:l,placeholder:o="Select a Genie space"}){const{data:u,loading:m,error:h}=Ro(),r=Ca(),c=g=>{let v=g.title;if(g.description){const S=g.description.length>50?g.description.substring(0,50)+"...":g.description;v+=` - ${S}`}return v},d=[{value:"",label:o},...(u||[]).map(g=>({value:g.space_id,label:c(g)}))];return t.jsx(ae,{label:e,value:s,onChange:g=>a(g.target.value),options:d,hint:r?m?"Loading Genie spaces...":h?"Failed to load Genie spaces":n:"Connect to Databricks first",required:i,disabled:l||m||!r})}function Rm({label:e="Databricks App",value:s,onChange:a,hint:n,required:i,disabled:l,placeholder:o="Select an app"}){const{data:u,loading:m,error:h}=kg(),r=Ca(),c=[{value:"",label:o},...(u||[]).map(d=>{var g;return{value:d.name,label:`${d.name}${(g=d.app_status)!=null&&g.state?` (${d.app_status.state})`:""}`}})];return t.jsx(ae,{label:e,value:s,onChange:d=>a(d.target.value),options:c,hint:r?m?"Loading apps...":h?"Failed to load apps":n:"Connect to Databricks first",required:i,disabled:l||m||!r})}function ol({label:e="Vector Search Endpoint",value:s,onChange:a,hint:n,required:i,disabled:l,placeholder:o="Select an endpoint"}){const{data:u,loading:m,error:h}=Mm(),r=Ca(),c=[{value:"",label:o},...(u||[]).map(d=>{var g;return{value:d.name,label:`${d.name}${(g=d.endpoint_status)!=null&&g.state?` (${d.endpoint_status.state})`:""}`}})];return t.jsx(ae,{label:e,value:s,onChange:d=>a(d.target.value),options:c,hint:r?m?"Loading endpoints...":h?"Failed to load endpoints":n:"Connect to Databricks first",required:i,disabled:l||m||!r})}function Tg({label:e="UC Connection",value:s,onChange:a,hint:n,required:i,disabled:l,placeholder:o="Select a connection"}){const{data:u,loading:m,error:h}=km(),r=Ca(),c=[{value:"",label:o},...(u||[]).map(d=>({value:d.name,label:`${d.name}${d.connection_type?` (${d.connection_type})`:""}`}))];return t.jsx(ae,{label:e,value:s,onChange:d=>a(d.target.value),options:c,hint:r?m?"Loading connections...":h?"Failed to load connections":(u==null?void 0:u.length)===0?"No UC connections found":n:"Connect to Databricks first",required:i,disabled:l||m||!r})}function er(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean")return String(e);if(typeof e=="object"){const s=e;if("_variableRef"in s&&typeof s._variableRef=="string")return`*${s._variableRef}`;if("value"in s)return String(s.value);if("env"in s&&s.default_value!==void 0)return String(s.default_value);if("env"in s)return`$${s.env}`;if("scope"in s&&"secret"in s)return`{{secrets/${s.scope}/${s.secret}}}`}return""}function ei(e){return!!(typeof e=="string"&&e.startsWith("*"))}function Xc(e){return typeof e=="string"&&e.startsWith("*")?e.slice(1):""}function cl(e,s){const a=`${e}_${s}`;return hn(a)}function Eg(){const{config:e,addSchema:s,removeSchema:a,updateSchema:n}=nt(),[i,l]=A.useState(!1),[o,u]=A.useState(null),[m,h]=A.useState("select"),[r,c]=A.useState("manual"),[d,g]=A.useState("manual"),[v,S]=A.useState({name:"",catalogName:"",schemaName:"",catalogVariable:"",schemaVariable:""}),y=e.schemas||{},b=e.variables||{},_=Object.keys(b),x=Ca(),{data:f,loading:C,refetch:w}=en(),{data:I}=ea(r==="manual"&&v.catalogName||null),R=()=>{S({name:"",catalogName:"",schemaName:"",catalogVariable:"",schemaVariable:""}),h("select"),c("manual"),g("manual"),u(null)},{scrollToAsset:k}=zs(),D=(T,F)=>{k(T),u(T);const E=ei(F.catalog_name),$=ei(F.schema_name);if(S({name:T,catalogName:E?"":er(F.catalog_name),schemaName:$?"":er(F.schema_name),catalogVariable:E?Xc(F.catalog_name):"",schemaVariable:$?Xc(F.schema_name):""}),c(E?"variable":"manual"),g($?"variable":"manual"),E)h("create");else{const p=f==null?void 0:f.some(N=>N.name===er(F.catalog_name));h(p?"select":"create")}l(!0)},L=T=>{T.preventDefault();const F=r==="variable"&&v.catalogVariable?`*${v.catalogVariable.trim()}`:v.catalogName.trim(),E=d==="variable"&&v.schemaVariable?`*${v.schemaVariable.trim()}`:v.schemaName.trim(),$=r==="variable"?!!v.catalogVariable:!!v.catalogName,p=d==="variable"?!!v.schemaVariable:!!v.schemaName;if(v.name&&$&&p){const N={catalog_name:F,schema_name:E};o?n(o,N):s(v.name,N),R(),l(!1)}},V=T=>{S({...v,catalogName:T,schemaName:""})},B=m==="create"&&v.catalogName&&v.schemaName&&(I==null?void 0:I.some(T=>T.name===v.schemaName));return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-white",children:"Schemas"}),t.jsx("p",{className:"text-slate-400 mt-1",children:"Define Unity Catalog schemas for your data and resources"})]}),t.jsxs(ee,{onClick:()=>{R(),l(!0)},children:[t.jsx(Ie,{className:"w-4 h-4"}),"Add Schema"]})]}),Object.keys(y).length===0?t.jsxs($e,{className:"text-center py-12",children:[t.jsx($t,{className:"w-12 h-12 mx-auto text-slate-600 mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-slate-300 mb-2",children:"No schemas configured"}),t.jsx("p",{className:"text-slate-500 mb-4",children:"Schemas define where your data and resources are stored in Unity Catalog."}),t.jsxs(ee,{onClick:()=>{R(),l(!0)},children:[t.jsx(Ie,{className:"w-4 h-4"}),"Add Your First Schema"]})]}):t.jsx("div",{className:"grid gap-4",children:Object.entries(y).map(([T,F])=>{const E=er(F.catalog_name),$=er(F.schema_name),p=ei(F.catalog_name),N=ei(F.schema_name),P=p||N,M=!p&&(f==null?void 0:f.some(O=>O.name===E));return t.jsx($e,{variant:"interactive",className:"group cursor-pointer",onClick:()=>D(T,F),children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${P?"bg-purple-500/20":"bg-blue-500/20"}`,children:P?t.jsx(Mt,{className:"w-5 h-5 text-purple-400"}):t.jsx($t,{className:"w-5 h-5 text-blue-400"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-white",children:T}),t.jsxs("p",{className:"text-sm text-slate-400",children:[E,".",$]})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[P?t.jsx(Se,{variant:"info",children:"Variable"}):M?t.jsx(Se,{variant:"success",children:"Exists"}):t.jsx(Se,{variant:"warning",children:"New"}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:O=>{O.stopPropagation(),D(T,F)},children:t.jsx(ds,{className:"w-4 h-4"})}),t.jsx(ee,{variant:"danger",size:"sm",onClick:O=>{O.stopPropagation(),Gt("Schema",T,()=>a(T))},children:t.jsx(Ze,{className:"w-4 h-4"})})]})]})},T)})}),t.jsx(ws,{isOpen:i,onClose:()=>{l(!1),R()},title:o?"Edit Schema":"Add Schema",description:"Configure a Unity Catalog schema reference",children:t.jsxs("form",{onSubmit:L,className:"space-y-4",children:[t.jsx(U,{label:"Reference Name",placeholder:"e.g., Retail Schema",value:v.name,onChange:T=>S({...v,name:Ot(T.target.value)}),hint:"Type naturally - spaces become underscores",required:!0,disabled:!!o}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Schema Source"}),t.jsxs("div",{className:"inline-flex rounded-lg bg-slate-900/50 p-0.5 w-full",children:[t.jsxs("button",{type:"button",onClick:()=>h("select"),className:`flex-1 px-3 py-1.5 text-xs rounded-md font-medium transition-all duration-150 flex items-center justify-center gap-1.5 ${m==="select"?"bg-emerald-500/20 text-emerald-400 border border-emerald-500/40":"bg-slate-800/50 text-slate-400 border border-slate-700/50 hover:text-slate-300 hover:border-slate-600"}`,children:[t.jsx($t,{className:"w-3.5 h-3.5"}),"Use Existing"]}),t.jsxs("button",{type:"button",onClick:()=>h("create"),className:`flex-1 px-3 py-1.5 text-xs rounded-md font-medium transition-all duration-150 flex items-center justify-center gap-1.5 ${m==="create"?"bg-emerald-500/20 text-emerald-400 border border-emerald-500/40":"bg-slate-800/50 text-slate-400 border border-slate-700/50 hover:text-slate-300 hover:border-slate-600"}`,children:[t.jsx(Ie,{className:"w-3.5 h-3.5"}),"Create New"]})]})]}),m==="select"?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm text-slate-400",children:"Select from existing Unity Catalog"}),t.jsxs("button",{type:"button",onClick:()=>w(),className:"text-xs text-slate-400 hover:text-white flex items-center space-x-1",disabled:C,children:[t.jsx(Ut,{className:`w-3 h-3 ${C?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]})]}),!x&&t.jsx("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-lg p-4 text-amber-400 text-sm",children:"Connect to Databricks first to browse existing catalogs and schemas."}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("label",{className:"text-sm font-medium text-slate-300",children:["Catalog Name ",t.jsx("span",{className:"text-red-400",children:"*"})]}),t.jsxs("div",{className:"inline-flex rounded-md bg-slate-900/50 p-0.5",children:[t.jsxs("button",{type:"button",onClick:()=>c("manual"),className:`px-2 py-0.5 text-xs rounded font-medium transition-all ${r==="manual"?"bg-blue-500/20 text-blue-400 border border-blue-500/40":"text-slate-400 hover:text-slate-300"}`,children:[t.jsx($t,{className:"w-3 h-3 inline mr-1"}),"Select"]}),t.jsxs("button",{type:"button",onClick:()=>c("variable"),className:`px-2 py-0.5 text-xs rounded font-medium transition-all ${r==="variable"?"bg-purple-500/20 text-purple-400 border border-purple-500/40":"text-slate-400 hover:text-slate-300"}`,disabled:_.length===0,title:_.length===0?"No variables configured":"Use a configured variable",children:[t.jsx(Mt,{className:"w-3 h-3 inline mr-1"}),"Variable"]})]})]}),r==="manual"?t.jsx(cr,{value:v.catalogName,onChange:V,hint:"Select a Unity Catalog catalog",required:!0}):t.jsx(ae,{value:v.catalogVariable,onChange:T=>S({...v,catalogVariable:T.target.value}),options:[{value:"",label:"Select a variable..."},..._.map(T=>({value:T,label:T}))],hint:"Use a preconfigured variable for the catalog name"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("label",{className:"text-sm font-medium text-slate-300",children:["Schema Name ",t.jsx("span",{className:"text-red-400",children:"*"})]}),t.jsxs("div",{className:"inline-flex rounded-md bg-slate-900/50 p-0.5",children:[t.jsxs("button",{type:"button",onClick:()=>g("manual"),className:`px-2 py-0.5 text-xs rounded font-medium transition-all ${d==="manual"?"bg-blue-500/20 text-blue-400 border border-blue-500/40":"text-slate-400 hover:text-slate-300"}`,children:[t.jsx($t,{className:"w-3 h-3 inline mr-1"}),"Select"]}),t.jsxs("button",{type:"button",onClick:()=>g("variable"),className:`px-2 py-0.5 text-xs rounded font-medium transition-all ${d==="variable"?"bg-purple-500/20 text-purple-400 border border-purple-500/40":"text-slate-400 hover:text-slate-300"}`,disabled:_.length===0,title:_.length===0?"No variables configured":"Use a configured variable",children:[t.jsx(Mt,{className:"w-3 h-3 inline mr-1"}),"Variable"]})]})]}),d==="manual"?t.jsx(dr,{value:v.schemaName,onChange:T=>S({...v,schemaName:T,name:v.name||cl(v.catalogName,T)}),catalog:r==="manual"&&v.catalogName||null,hint:r==="variable"?"Enter catalog first or use variable":"Select a schema within the catalog",required:!0,disabled:r==="variable"}):t.jsx(ae,{value:v.schemaVariable,onChange:T=>S({...v,schemaVariable:T.target.value}),options:[{value:"",label:"Select a variable..."},..._.map(T=>({value:T,label:T}))],hint:"Use a preconfigured variable for the schema name"})]})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"p-3 rounded-lg bg-green-500/10 border border-green-500/20",children:t.jsxs("p",{className:"text-sm text-green-400",children:[t.jsx("strong",{children:"Note:"})," When you deploy your dao-ai agent, it will create these Unity Catalog resources if they don't exist. Make sure you have the appropriate permissions."]})}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("label",{className:"text-sm font-medium text-slate-300",children:["Catalog Name ",t.jsx("span",{className:"text-red-400",children:"*"})]}),t.jsxs("div",{className:"inline-flex rounded-md bg-slate-900/50 p-0.5",children:[t.jsxs("button",{type:"button",onClick:()=>c("manual"),className:`px-2 py-0.5 text-xs rounded font-medium transition-all ${r==="manual"?"bg-blue-500/20 text-blue-400 border border-blue-500/40":"text-slate-400 hover:text-slate-300"}`,children:[t.jsx($t,{className:"w-3 h-3 inline mr-1"}),"Manual"]}),t.jsxs("button",{type:"button",onClick:()=>c("variable"),className:`px-2 py-0.5 text-xs rounded font-medium transition-all ${r==="variable"?"bg-purple-500/20 text-purple-400 border border-purple-500/40":"text-slate-400 hover:text-slate-300"}`,disabled:_.length===0,title:_.length===0?"No variables configured":"Use a configured variable",children:[t.jsx(Mt,{className:"w-3 h-3 inline mr-1"}),"Variable"]})]})]}),r==="manual"?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("input",{type:"text",value:v.catalogName,onChange:T=>S({...v,catalogName:T.target.value}),placeholder:"e.g., retail_catalog",className:"flex-1 px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0}),f&&f.length>0&&t.jsxs("select",{value:"",onChange:T=>{T.target.value&&S({...v,catalogName:T.target.value})},className:"px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-slate-400 cursor-pointer hover:border-slate-600",children:[t.jsx("option",{value:"",children:"Pick existing..."}),f.map(T=>t.jsx("option",{value:T.name,children:T.name},T.name))]})]}),t.jsx("p",{className:"text-xs text-slate-500",children:"Enter a new catalog name or pick an existing one"})]}):t.jsx(ae,{value:v.catalogVariable,onChange:T=>S({...v,catalogVariable:T.target.value}),options:[{value:"",label:"Select a variable..."},..._.map(T=>({value:T,label:T}))],hint:"Use a preconfigured variable for the catalog name"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("label",{className:"text-sm font-medium text-slate-300",children:["Schema Name ",t.jsx("span",{className:"text-red-400",children:"*"})]}),t.jsxs("div",{className:"inline-flex rounded-md bg-slate-900/50 p-0.5",children:[t.jsxs("button",{type:"button",onClick:()=>g("manual"),className:`px-2 py-0.5 text-xs rounded font-medium transition-all ${d==="manual"?"bg-blue-500/20 text-blue-400 border border-blue-500/40":"text-slate-400 hover:text-slate-300"}`,children:[t.jsx($t,{className:"w-3 h-3 inline mr-1"}),"Manual"]}),t.jsxs("button",{type:"button",onClick:()=>g("variable"),className:`px-2 py-0.5 text-xs rounded font-medium transition-all ${d==="variable"?"bg-purple-500/20 text-purple-400 border border-purple-500/40":"text-slate-400 hover:text-slate-300"}`,disabled:_.length===0,title:_.length===0?"No variables configured":"Use a configured variable",children:[t.jsx(Mt,{className:"w-3 h-3 inline mr-1"}),"Variable"]})]})]}),d==="manual"?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("input",{type:"text",value:v.schemaName,onChange:T=>{const F=T.target.value;S({...v,schemaName:F,name:v.name||cl(v.catalogName,F)})},placeholder:"e.g., hardware_store",className:"flex-1 px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0}),r==="manual"&&v.catalogName&&I&&I.length>0&&t.jsxs("select",{value:"",onChange:T=>{T.target.value&&S({...v,schemaName:T.target.value,name:v.name||cl(v.catalogName,T.target.value)})},className:"px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-slate-400 cursor-pointer hover:border-slate-600",children:[t.jsx("option",{value:"",children:"Pick existing..."}),I.map(T=>t.jsx("option",{value:T.name,children:T.name},T.name))]})]}),t.jsx("p",{className:"text-xs text-slate-500",children:"Enter a new schema name or pick an existing one"})]}):t.jsx(ae,{value:v.schemaVariable,onChange:T=>S({...v,schemaVariable:T.target.value}),options:[{value:"",label:"Select a variable..."},..._.map(T=>({value:T,label:T}))],hint:"Use a preconfigured variable for the schema name"})]}),B&&t.jsx("div",{className:"p-3 rounded-lg bg-blue-500/10 border border-blue-500/20",children:t.jsx("p",{className:"text-sm text-blue-400",children:" This schema already exists in Unity Catalog"})})]})]}),(r==="manual"&&v.catalogName||r==="variable"&&v.catalogVariable)&&(d==="manual"&&v.schemaName||d==="variable"&&v.schemaVariable)&&t.jsxs("div",{className:"p-3 rounded-lg bg-slate-800/50 border border-slate-700",children:[t.jsx("p",{className:"text-xs text-slate-400 mb-1",children:"Full schema path:"}),t.jsxs("code",{className:"text-sm text-white font-mono",children:[r==="variable"?t.jsxs("span",{className:"text-purple-400",children:["*",v.catalogVariable]}):v.catalogName,".",d==="variable"?t.jsxs("span",{className:"text-purple-400",children:["*",v.schemaVariable]}):v.schemaName]}),(r==="variable"||d==="variable")&&t.jsxs("p",{className:"text-xs text-purple-400 mt-2",children:[t.jsx(Mt,{className:"w-3 h-3 inline mr-1"}),"Using variable reference(s) - resolved at runtime"]})]}),t.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[t.jsx(ee,{variant:"secondary",type:"button",onClick:()=>{l(!1),R()},children:"Cancel"}),t.jsx(ee,{type:"submit",children:o?"Save Changes":"Add Schema"})]})]})})]})}const Jc={ready:"bg-green-500",transitioning:"bg-yellow-500",stopped:"bg-red-500",unknown:"bg-slate-500"};function $r({value:e,onChange:s,options:a,placeholder:n="Select...",disabled:i=!1,className:l=""}){const[o,u]=A.useState(!1),m=A.useRef(null),h=a.find(g=>g.value===e);A.useEffect(()=>{const g=v=>{m.current&&!m.current.contains(v.target)&&u(!1)};return document.addEventListener("mousedown",g),()=>document.removeEventListener("mousedown",g)},[]),A.useEffect(()=>{const g=v=>{v.key==="Escape"&&u(!1)};return document.addEventListener("keydown",g),()=>document.removeEventListener("keydown",g)},[]);const r=g=>{g&&!g.startsWith("__header")&&(s(g),u(!1))},c=[];let d="";return a.forEach(g=>{g.value.startsWith("__header")?(d=g.label,c.push({group:d,items:[]})):c.length>0?c[c.length-1].items.push(g):(c.length===0&&c.push({group:"",items:[]}),c[0].items.push(g))}),t.jsxs("div",{ref:m,className:`relative ${l}`,children:[t.jsxs("button",{type:"button",onClick:()=>!i&&u(!o),disabled:i,className:`
          w-full flex items-center justify-between px-3 py-2
          bg-slate-800 border border-slate-700 rounded-lg
          text-left text-sm
          ${i?"opacity-50 cursor-not-allowed":"hover:border-slate-600 cursor-pointer"}
          focus:outline-none focus:ring-2 focus:ring-blue-500
          transition-colors
        `,children:[t.jsxs("span",{className:"flex items-center gap-2 truncate",children:[(h==null?void 0:h.status)&&t.jsx("span",{className:`w-2 h-2 rounded-full flex-shrink-0 ${Jc[h.status]}`}),t.jsx("span",{className:h?"text-white":"text-slate-400",children:(h==null?void 0:h.label)||n})]}),t.jsx(Wt,{className:`w-4 h-4 text-slate-400 transition-transform ${o?"rotate-180":""}`})]}),o&&t.jsx("div",{className:"absolute z-50 w-full mt-1 bg-slate-800 border border-slate-700 rounded-lg shadow-xl max-h-60 overflow-auto",children:c.map((g,v)=>t.jsxs("div",{children:[g.group&&t.jsx("div",{className:"px-3 py-1.5 text-xs font-semibold text-slate-500 bg-slate-900/50 sticky top-0",children:g.group.replace(/^\s*/,"").replace(/\s*$/,"")}),g.items.map(S=>t.jsxs("button",{type:"button",onClick:()=>r(S.value),disabled:S.disabled,className:`
                    w-full flex items-center gap-2 px-3 py-2 text-sm text-left
                    ${S.disabled?"opacity-50 cursor-not-allowed":"hover:bg-slate-700/50 cursor-pointer"}
                    ${S.value===e?"bg-blue-500/20 text-blue-400":"text-slate-200"}
                    transition-colors
                  `,children:[S.status&&t.jsx("span",{className:`w-2 h-2 rounded-full flex-shrink-0 ${Jc[S.status]}`}),t.jsx("span",{className:"truncate flex-1",children:S.label}),S.value===e&&t.jsx(bi,{className:"w-4 h-4 text-blue-400 flex-shrink-0"})]},S.value))]},v))})]})}const Ag=e=>`*${e}`,Pg=e=>e?typeof e=="string"||typeof e=="number"||typeof e=="boolean"?`value: ${String(e)}`:"env"in e?`env: ${e.env}`:"scope"in e&&"secret"in e?`secret: ${e.scope}/${e.secret}`:"value"in e?`value: ${String(e.value)}`:"options"in e?`composite (${e.options.length} options)`:"unknown":"unknown";function tr({label:e,source:s,onSourceChange:a,manualValue:n,onManualChange:i,variableValue:l,onVariableChange:o,placeholder:u,isPassword:m=!1,hint:h,variableNames:r,variables:c,disabled:d=!1}){return t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:e}),t.jsxs("div",{className:"inline-flex rounded-lg bg-slate-900/50 p-0.5",children:[t.jsx("button",{type:"button",onClick:()=>!d&&a("variable"),disabled:d,className:`px-3 py-1 text-xs rounded-md font-medium transition-all duration-150 flex items-center gap-1 ${s==="variable"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"} ${d?"opacity-50 cursor-not-allowed":""}`,children:"Variable"}),t.jsx("button",{type:"button",onClick:()=>!d&&a("manual"),disabled:d,className:`px-3 py-1 text-xs rounded-md font-medium transition-all duration-150 ${s==="manual"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"} ${d?"opacity-50 cursor-not-allowed":""}`,children:"Manual"})]})]}),s==="variable"?t.jsx(ae,{value:l,onChange:g=>o(g.target.value),options:[{value:"",label:"Select a variable..."},...r.map(g=>({value:g,label:`${g} (${Pg(c[g])})`}))],hint:r.length===0?"Define variables in the Variables section first":h,disabled:d}):t.jsx(U,{value:n,onChange:g=>i(g.target.value),placeholder:u,type:m?"password":"text",hint:h,disabled:d})]})}const Ig=[{value:"default",label:"Use Ambient/Default Credentials"},{value:"service_principal",label:"Configured Service Principal"},{value:"oauth",label:"OAuth2 / M2M Credentials"},{value:"pat",label:"Personal Access Token"}];function bn({formData:e,setFormData:s,servicePrincipals:a,variables:n,variableNames:i}){const l=(e==null?void 0:e.on_behalf_of_user)||!1;return t.jsxs("div",{className:"space-y-4 p-4 bg-slate-900/30 rounded-lg border border-slate-600",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h4",{className:"text-sm font-semibold text-slate-200",children:"Authentication"}),t.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:e.on_behalf_of_user,onChange:o=>s({...e,on_behalf_of_user:o.target.checked}),className:"rounded border-slate-600 bg-slate-800 text-blue-500 focus:ring-blue-500"}),t.jsx(Os,{className:"w-4 h-4 text-blue-400"}),t.jsx("span",{className:"text-sm text-slate-300",children:"On Behalf of User"})]})]}),l&&t.jsx("div",{className:"p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg text-blue-300 text-xs",children:"When enabled, the resource will use the calling user's credentials for authentication. Other authentication options are disabled."}),t.jsx(ae,{label:"Authentication Method",value:(e==null?void 0:e.authMethod)||"default",onChange:o=>s({...e,authMethod:o.target.value}),options:Ig,disabled:l,hint:l?'Disabled when "On Behalf of User" is enabled':void 0}),!l&&((e==null?void 0:e.authMethod)==="default"||!(e!=null&&e.authMethod))&&t.jsx("div",{className:"p-3 bg-slate-800/50 rounded border border-slate-600 text-slate-300 text-xs",children:"Will use ambient credentials from the environment (DATABRICKS_HOST, DATABRICKS_TOKEN, etc.) or the default Databricks SDK configuration."}),!l&&(e==null?void 0:e.authMethod)==="service_principal"&&t.jsxs("div",{className:"space-y-4 p-3 bg-slate-900/50 rounded border border-slate-600",children:[t.jsx("p",{className:"text-xs text-slate-400 font-medium",children:"Select Configured Service Principal"}),t.jsx(ae,{label:"Service Principal",value:(e==null?void 0:e.servicePrincipalRef)||"",onChange:o=>s({...e,servicePrincipalRef:o.target.value}),options:[{value:"",label:"Select a service principal..."},...Object.keys(a).map(o=>({value:o,label:o}))],hint:"Reference a pre-configured service principal"}),Object.keys(a).length===0&&t.jsx("div",{className:"p-2 bg-amber-500/10 border border-amber-500/30 rounded text-amber-400 text-xs",children:"No service principals configured. Add one in the Service Principals section first."})]}),!l&&(e==null?void 0:e.authMethod)==="oauth"&&t.jsxs("div",{className:"space-y-4 p-3 bg-slate-900/50 rounded border border-slate-600",children:[t.jsx("p",{className:"text-xs text-slate-400 font-medium",children:"OAuth2 / M2M Credentials"}),t.jsx(tr,{label:"Client ID",source:(e==null?void 0:e.clientIdSource)||"variable",onSourceChange:o=>s({...e,clientIdSource:o}),manualValue:(e==null?void 0:e.client_id)||"",onManualChange:o=>s({...e,client_id:o}),variableValue:(e==null?void 0:e.clientIdVariable)||"",onVariableChange:o=>s({...e,clientIdVariable:o}),placeholder:"your-service-principal-client-id",variableNames:i,variables:n}),t.jsx(tr,{label:"Client Secret",source:(e==null?void 0:e.clientSecretSource)||"variable",onSourceChange:o=>s({...e,clientSecretSource:o}),manualValue:(e==null?void 0:e.client_secret)||"",onManualChange:o=>s({...e,client_secret:o}),variableValue:(e==null?void 0:e.clientSecretVariable)||"",onVariableChange:o=>s({...e,clientSecretVariable:o}),placeholder:"your-client-secret",isPassword:!0,variableNames:i,variables:n}),t.jsx(tr,{label:"Workspace Host (Optional)",source:e.workspaceHostSource,onSourceChange:o=>s({...e,workspaceHostSource:o}),manualValue:e.workspace_host,onManualChange:o=>s({...e,workspace_host:o}),variableValue:e.workspaceHostVariable,onVariableChange:o=>s({...e,workspaceHostVariable:o}),placeholder:"https://your-workspace.cloud.databricks.com",hint:"Only required if connecting from outside the workspace",variableNames:i,variables:n})]}),!l&&(e==null?void 0:e.authMethod)==="pat"&&t.jsxs("div",{className:"space-y-4 p-3 bg-slate-900/50 rounded border border-slate-600",children:[t.jsx("p",{className:"text-xs text-slate-400 font-medium",children:"Personal Access Token"}),t.jsx(tr,{label:"PAT Token",source:(e==null?void 0:e.patSource)||"variable",onSourceChange:o=>s({...e,patSource:o}),manualValue:(e==null?void 0:e.pat)||"",onManualChange:o=>s({...e,pat:o}),variableValue:(e==null?void 0:e.patVariable)||"",onVariableChange:o=>s({...e,patVariable:o}),placeholder:"dapi...",isPassword:!0,hint:"Databricks Personal Access Token",variableNames:i,variables:n}),t.jsx(tr,{label:"Workspace Host (Optional)",source:(e==null?void 0:e.workspaceHostSource)||"variable",onSourceChange:o=>s({...e,workspaceHostSource:o}),manualValue:(e==null?void 0:e.workspace_host)||"",onManualChange:o=>s({...e,workspace_host:o}),variableValue:(e==null?void 0:e.workspaceHostVariable)||"",onVariableChange:o=>s({...e,workspaceHostVariable:o}),placeholder:"https://your-workspace.cloud.databricks.com",hint:"Only required if connecting from outside the workspace",variableNames:i,variables:n})]})]})}const sr=(e,s,a)=>{if(!(!s&&!a))return e==="variable"&&a?Ag(a):s||void 0},vn=(e,s,a,n)=>{var m;const i=h=>s(h,"*"),l=h=>{const r=a(h);return r.startsWith("*")?r.slice(1):""};let o="default";e.service_principal?o="service_principal":e.client_id&&e.client_secret?o="oauth":e.pat&&(o="pat");let u="";if(e.service_principal){if(s(e.service_principal,"*"))u=a(e.service_principal).slice(1);else if(typeof e.service_principal=="object"&&n){const h=e.service_principal,r=(m=Object.entries(n).find(([,c])=>{const d=a(c.client_id),g=a(h.client_id);return d&&g&&d===g}))==null?void 0:m[0];r&&(u=r)}}return{authMethod:o,servicePrincipalRef:u,clientIdSource:i(e.client_id)?"variable":"manual",clientSecretSource:i(e.client_secret)?"variable":"manual",workspaceHostSource:i(e.workspace_host)?"variable":"manual",patSource:i(e.pat)?"variable":"manual",client_id:i(e.client_id)?"":a(e.client_id),client_secret:i(e.client_secret)?"":a(e.client_secret),workspace_host:i(e.workspace_host)?"":a(e.workspace_host),pat:i(e.pat)?"":a(e.pat),clientIdVariable:l(e.client_id),clientSecretVariable:l(e.client_secret),workspaceHostVariable:l(e.workspace_host),patVariable:l(e.pat),on_behalf_of_user:e.on_behalf_of_user||!1}},yn=(e,s)=>{if(s.on_behalf_of_user){e.on_behalf_of_user=!0;return}if(s.authMethod==="service_principal"&&s.servicePrincipalRef)e.service_principal=`*${s.servicePrincipalRef}`;else if(s.authMethod==="oauth"){const a=sr(s.clientIdSource,s.client_id,s.clientIdVariable),n=sr(s.clientSecretSource,s.client_secret,s.clientSecretVariable),i=sr(s.workspaceHostSource,s.workspace_host,s.workspaceHostVariable);a&&(e.client_id=a),n&&(e.client_secret=n),i&&(e.workspace_host=i)}else if(s.authMethod==="pat"){const a=sr(s.patSource,s.pat,s.patVariable),n=sr(s.workspaceHostSource,s.workspace_host,s.workspaceHostVariable);a&&(e.pat=a),n&&(e.workspace_host=n)}},pa=e=>{zs.getState().scrollToAsset(e)};function gs(e,s){return typeof e=="string"&&e.startsWith(s)}function Lt(e){return typeof e=="string"?e:""}function ke(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean")return String(e);if(typeof e=="object"){const s=e;if("env"in s&&typeof s.env=="string"){const a=s.default_value;return a!=null?String(a):`$${s.env}`}if("scope"in s&&"secret"in s)return`{{secrets/${s.scope}/${s.secret}}}`;if("type"in s&&s.type==="primitive"&&"value"in s)return String(s.value);if("default_value"in s&&s.default_value!==void 0)return String(s.default_value)}return""}const Og=[{id:"llms",label:"LLMs",icon:xr,description:"Language models"},{id:"genie_rooms",label:"Genie Rooms",icon:Xa,description:"AI-powered data assistants"},{id:"warehouses",label:"SQL Warehouses",icon:$t,description:"SQL compute resources"},{id:"tables",label:"Tables",icon:vi,description:"Unity Catalog tables"},{id:"volumes",label:"Volumes",icon:Pl,description:"Unity Catalog volumes"},{id:"functions",label:"Functions",icon:Al,description:"Unity Catalog functions"},{id:"connections",label:"Connections",icon:Ll,description:"External connections"},{id:"databases",label:"Databases",icon:gr,description:"Lakebase/PostgreSQL backends"},{id:"vector_stores",label:"Vector Stores",icon:xs,description:"Vector search indexes"},{id:"apps",label:"Apps",icon:Tl,description:"Databricks Apps"}],Qc=[{value:"databricks-claude-3-7-sonnet",label:"Claude 3.7 Sonnet"},{value:"databricks-claude-sonnet-4",label:"Claude Sonnet 4"},{value:"databricks-meta-llama-3-3-70b-instruct",label:"Llama 3.3 70B Instruct"},{value:"databricks-meta-llama-3-1-405b-instruct",label:"Llama 3.1 405B Instruct"},{value:"databricks-meta-llama-3-1-8b-instruct",label:"Llama 3.1 8B Instruct"},{value:"databricks-dbrx-instruct",label:"DBRX Instruct"},{value:"databricks-gte-large-en",label:"GTE Large (Embeddings)"}];function vt(e){return e.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,"")}function Dt(e,s,a){if(!e)return!1;const n=s.resources||{},i=["llms","genie_rooms","tables","volumes","functions","warehouses","connections","databases","vector_stores","apps"];for(const g of i){const v=n[g]||{};if(e in v&&e!==a)return!0}const l=s.service_principals||{};if(e in l&&e!==a)return!0;const o=s.agents||{};if(e in o&&e!==a)return!0;const u=s.tools||{};if(e in u&&e!==a)return!0;const m=s.guardrails||{};if(e in m&&e!==a)return!0;const h=s.retrievers||{};if(e in h&&e!==a)return!0;const r=s.schemas||{};if(e in r&&e!==a)return!0;const c=s.prompts||{};if(e in c&&e!==a)return!0;const d=s.variables||{};return e in d&&e!==a}function Lg(){const{config:e}=nt(),s=e.resources,[a,n]=A.useState("llms"),[i,l]=A.useState(!1),[o,u]=A.useState(null),m=()=>{l(!1),u(null)},h=()=>{switch(a){case"llms":return t.jsx(Vg,{});case"genie_rooms":return t.jsx(Dg,{showForm:i,setShowForm:l,editingKey:o,setEditingKey:u,onClose:m});case"warehouses":return t.jsx(Fg,{showForm:i,setShowForm:l,editingKey:o,setEditingKey:u,onClose:m});case"tables":return t.jsx(zg,{showForm:i,setShowForm:l,editingKey:o,setEditingKey:u,onClose:m});case"volumes":return t.jsx(Hg,{showForm:i,setShowForm:l,editingKey:o,setEditingKey:u,onClose:m});case"functions":return t.jsx(Bg,{showForm:i,setShowForm:l,editingKey:o,setEditingKey:u,onClose:m});case"connections":return t.jsx(Wg,{showForm:i,setShowForm:l,editingKey:o,setEditingKey:u,onClose:m});case"databases":return t.jsx(Yg,{showForm:i,setShowForm:l,editingKey:o,setEditingKey:u,onClose:m});case"vector_stores":return t.jsx(Xg,{showForm:i,setShowForm:l,editingKey:o,setEditingKey:u,onClose:m});case"apps":return t.jsx(Jg,{showForm:i,setShowForm:l,editingKey:o,setEditingKey:u,onClose:m});default:return null}},r=c=>{switch(c){case"llms":return Object.keys((s==null?void 0:s.llms)||{}).length;case"genie_rooms":return Object.keys((s==null?void 0:s.genie_rooms)||{}).length;case"tables":return Object.keys((s==null?void 0:s.tables)||{}).length;case"volumes":return Object.keys((s==null?void 0:s.volumes)||{}).length;case"functions":return Object.keys((s==null?void 0:s.functions)||{}).length;case"warehouses":return Object.keys((s==null?void 0:s.warehouses)||{}).length;case"connections":return Object.keys((s==null?void 0:s.connections)||{}).length;case"databases":return Object.keys((s==null?void 0:s.databases)||{}).length;case"vector_stores":return Object.keys((s==null?void 0:s.vector_stores)||{}).length;case"apps":return Object.keys((s==null?void 0:s.apps)||{}).length;default:return 0}};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-slate-100",children:"Resources"}),t.jsx("p",{className:"text-slate-400 mt-1",children:"Configure Databricks resources that can be referenced in tools, agents, and other parts of your configuration."})]}),t.jsx($e,{className:"p-4 bg-blue-900/20 border-blue-500/30",children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(Ka,{className:"w-5 h-5 text-blue-400 mt-0.5 flex-shrink-0"}),t.jsxs("div",{className:"text-sm text-blue-300",children:[t.jsx("p",{className:"font-medium",children:"Resource References"}),t.jsxs("p",{className:"mt-1 text-blue-400/80",children:["Resources defined here can be referenced by their ",t.jsx("strong",{children:"reference name"}),' (the key) in tools and other configuration sections. For example, a Genie room named "retail_genie" can be used in tools to create Genie-powered assistants.']})]})]})}),t.jsx("div",{className:"flex flex-wrap gap-2 border-b border-slate-700 pb-4",children:Og.map(c=>{const d=c.icon,g=r(c.id);return t.jsxs("button",{onClick:()=>{n(c.id),l(!1),u(null)},className:`flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors ${a===c.id?"bg-blue-500/20 text-blue-300 border border-blue-500/30":"bg-slate-800/50 text-slate-400 hover:bg-slate-800 hover:text-slate-300"}`,children:[t.jsx(d,{className:"w-4 h-4"}),t.jsx("span",{children:c.label}),g>0&&t.jsx(Se,{variant:"default",className:"ml-1",children:g})]},c.id)})}),t.jsx("div",{children:h()})]})}function $g({index:e,fallback:s,isReference:a,refKey:n,hasConfiguredLLMs:i,llms:l,endpoints:o,editingKey:u,formDataName:m,onUpdate:h,onRemove:r,getEndpointStatus:c}){const[d,g]=A.useState(a?"reference":"endpoint"),v=Object.entries(l).filter(([b])=>b!==u&&b!==m).map(([b,_])=>({value:`ref:${b}`,label:`*${b}  ${_.name}`})),S=o.map(b=>({value:b.name,label:b.name,status:c(b.state)})),y=b=>{g(b),h("")};return t.jsxs("div",{className:"p-3 bg-slate-900/50 rounded-lg border border-slate-700 space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("span",{className:"text-xs text-slate-400 font-medium",children:["Fallback #",e+1]}),t.jsx(ee,{variant:"ghost",size:"sm",type:"button",onClick:r,children:t.jsx(Ze,{className:"w-3 h-3 text-red-400"})})]}),i&&t.jsxs("div",{className:"inline-flex rounded-lg bg-slate-900/50 p-0.5 w-full",children:[t.jsx("button",{type:"button",onClick:()=>y("reference"),className:`flex-1 px-3 py-1.5 text-xs rounded-md font-medium transition-all duration-150 ${d==="reference"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Configured"}),t.jsx("button",{type:"button",onClick:()=>y("endpoint"),className:`flex-1 px-3 py-1.5 text-xs rounded-md font-medium transition-all duration-150 ${d==="endpoint"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Endpoint"})]}),d==="reference"&&i?t.jsxs("div",{className:"space-y-2",children:[t.jsx(ae,{value:s,onChange:b=>h(b.target.value),options:[{value:"",label:"Select a configured LLM..."},...v]}),a&&n&&l[n]&&t.jsxs("div",{className:"p-2 bg-slate-800/50 rounded text-xs",children:[t.jsx("span",{className:"text-blue-400",children:"YAML output:"})," ",t.jsxs("code",{className:"text-slate-300",children:["*",n]}),t.jsxs("span",{className:"text-slate-500 ml-2",children:[" ",l[n].name]})]})]}):t.jsxs("div",{className:"space-y-2",children:[t.jsx($r,{value:gs(s,"ref:")?"":Lt(s),onChange:h,options:[{value:"",label:"Select an endpoint..."},...S],placeholder:"Select an endpoint..."}),s&&!gs(s,"ref:")&&t.jsxs("div",{className:"p-2 bg-slate-800/50 rounded text-xs",children:[t.jsx("span",{className:"text-green-400",children:"YAML output:"})," ",t.jsx("code",{className:"text-slate-300",children:s})]})]})]})}function Vg(){var D;const{config:e,addLLM:s,removeLLM:a,updateLLM:n}=nt(),[i,l]=A.useState(!1),[o,u]=A.useState(null),[m,h]=A.useState("preset"),[r,c]=A.useState(!1),[d,g]=A.useState({name:"",modelName:"",customModelName:"",temperature:"0.1",maxTokens:"8192",onBehalfOfUser:!1,useResponseApi:!1,fallbacks:[],authMethod:"default",servicePrincipalRef:"",clientIdSource:"variable",clientSecretSource:"variable",workspaceHostSource:"variable",patSource:"variable",client_id:"",client_secret:"",workspace_host:"",pat:"",clientIdVariable:"",clientSecretVariable:"",workspaceHostVariable:"",patVariable:""}),{data:v,loading:S,refetch:y}=wg(),b=((D=e.resources)==null?void 0:D.llms)||{},_=()=>{g({name:"",modelName:"",customModelName:"",temperature:"0.1",maxTokens:"8192",onBehalfOfUser:!1,useResponseApi:!1,fallbacks:[],authMethod:"default",servicePrincipalRef:"",clientIdSource:"variable",clientSecretSource:"variable",workspaceHostSource:"variable",patSource:"variable",client_id:"",client_secret:"",workspace_host:"",pat:"",clientIdVariable:"",clientSecretVariable:"",workspaceHostVariable:"",patVariable:""}),h("preset"),c(!1),u(null)},x=(L,V)=>{pa(L),u(L);const B=(V.fallbacks||[]).map(E=>{const $=typeof E=="string"?E:E.name;return Object.keys(b).includes($)&&$!==L?`ref:${$}`:$}),T=vn(V,gs,Lt,e.service_principals||{});g({name:L,modelName:V.name,customModelName:V.name,temperature:String(V.temperature??.1),maxTokens:String(V.max_tokens??8192),onBehalfOfUser:V.on_behalf_of_user??!1,useResponseApi:V.use_responses_api??!1,fallbacks:B,...T}),Qc.some(E=>E.value===V.name)?h("preset"):v!=null&&v.some(E=>E.name===V.name)?h("endpoint"):h("custom");const F=T.authMethod!=="default";c(!!(V.on_behalf_of_user||V.use_responses_api||V.fallbacks&&V.fallbacks.length>0||F)),l(!0)},f=L=>{L.preventDefault();let V="";switch(m){case"preset":V=d.modelName;break;case"endpoint":V=d.modelName;break;case"custom":V=d.customModelName;break}if(d.name&&V){const B={name:V,temperature:parseFloat(d.temperature),max_tokens:parseInt(d.maxTokens)};d.onBehalfOfUser&&(B.on_behalf_of_user=!0),d.useResponseApi&&(B.use_responses_api=!0),d.fallbacks.length>0&&(B.fallbacks=d.fallbacks),yn(B,d),o?o!==d.name?(a(o),s(d.name,B)):n(o,B):s(d.name,B),_(),l(!1)}},C=()=>{g({...d,fallbacks:[...d.fallbacks,""]})},w=(L,V)=>{const B=[...d.fallbacks];B[L]=V,g({...d,fallbacks:B})},I=L=>{g({...d,fallbacks:d.fallbacks.filter((V,B)=>B!==L)})},R=L=>{var B;switch((B=L==null?void 0:L.ready)==null?void 0:B.toUpperCase()){case"READY":return"ready";case"NOT_READY":return"transitioning";default:return"unknown"}},k=[{value:"",label:S?"Loading endpoints...":"Select an endpoint..."},...(v||[]).map(L=>({value:L.name,label:L.name,status:R(L.state)}))];return t.jsxs($e,{className:"p-5",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(xr,{className:"w-5 h-5 text-purple-400"}),t.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Language Models"})]}),t.jsxs(ee,{variant:"secondary",size:"sm",onClick:()=>l(!0),children:[t.jsx(Ie,{className:"w-4 h-4 mr-1"}),"Add LLM"]})]}),Object.keys(b).length>0?t.jsx("div",{className:"space-y-2",children:Object.entries(b).map(([L,V])=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800/50 rounded-lg border border-slate-700 cursor-pointer hover:bg-slate-800/70 transition-colors",onClick:()=>x(L,V),children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(xr,{className:"w-4 h-4 text-purple-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-slate-200",children:L}),t.jsx("p",{className:"text-xs text-slate-500",children:V.name})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[V.on_behalf_of_user&&t.jsxs(Se,{variant:"success",title:"On Behalf of User",children:[t.jsx(Os,{className:"w-3 h-3 mr-1"}),"OBO"]}),V.fallbacks&&V.fallbacks.length>0&&t.jsxs(Se,{variant:"warning",title:`${V.fallbacks.length} fallback(s)`,children:[t.jsx(xs,{className:"w-3 h-3 mr-1"}),V.fallbacks.length]}),t.jsxs(Se,{variant:"info",children:["temp: ",V.temperature??.1]}),t.jsxs(Se,{variant:"default",children:["tokens: ",V.max_tokens??8192]}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:B=>{B.stopPropagation(),Gt("LLM",L,()=>a(L))},children:t.jsx(Ze,{className:"w-4 h-4 text-red-400"})})]})]},L))}):t.jsx("p",{className:"text-slate-500 text-sm",children:"No LLMs configured. Add language models that will power your AI agents."}),t.jsx(ws,{isOpen:i,onClose:()=>{l(!1),_()},title:o?"Edit Language Model":"Add Language Model",description:"Configure an LLM for your agents to use",children:t.jsxs("form",{onSubmit:f,className:"space-y-4",children:[t.jsx(U,{label:"Reference Name",placeholder:"e.g., Default LLM",value:d.name,onChange:L=>g({...d,name:Ot(L.target.value)}),hint:"Type naturally - spaces become underscores",required:!0}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Model Source"}),t.jsxs("div",{className:"inline-flex rounded-lg bg-slate-900/50 p-0.5 w-full",children:[t.jsx("button",{type:"button",onClick:()=>h("preset"),className:`flex-1 px-3 py-1.5 text-xs rounded-md font-medium transition-all duration-150 ${m==="preset"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Preset"}),t.jsx("button",{type:"button",onClick:()=>h("endpoint"),className:`flex-1 px-3 py-1.5 text-xs rounded-md font-medium transition-all duration-150 ${m==="endpoint"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Endpoint"}),t.jsx("button",{type:"button",onClick:()=>h("custom"),className:`flex-1 px-3 py-1.5 text-xs rounded-md font-medium transition-all duration-150 ${m==="custom"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Custom"})]})]}),m==="preset"&&t.jsx(ae,{label:"Model",options:[{value:"",label:"Select a model..."},...Qc],value:d.modelName,onChange:L=>g({...d,modelName:L.target.value,name:d.name||vt(L.target.value)}),required:!0}),m==="endpoint"&&t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Serving Endpoint"}),t.jsxs("button",{type:"button",onClick:()=>y(),className:"text-xs text-slate-400 hover:text-white flex items-center space-x-1",disabled:S,children:[t.jsx(Ut,{className:`w-3 h-3 ${S?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]})]}),t.jsx($r,{options:k,value:d.modelName,onChange:L=>g({...d,modelName:L,name:d.name||vt(L)}),disabled:S,placeholder:"Select an endpoint..."}),S&&t.jsx("p",{className:"text-xs text-slate-500",children:"Loading endpoints from Databricks..."})]}),m==="custom"&&t.jsx(U,{label:"Custom Model Name",placeholder:"e.g., my-custom-endpoint",value:d.customModelName,onChange:L=>g({...d,customModelName:L.target.value}),hint:"Enter the name of your custom model endpoint",required:!0}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(U,{label:"Temperature",type:"number",step:"0.1",min:"0",max:"2",value:d.temperature,onChange:L=>g({...d,temperature:L.target.value}),hint:"0.0 = deterministic, 2.0 = creative"}),t.jsx(U,{label:"Max Tokens",type:"number",min:"1",max:"128000",value:d.maxTokens,onChange:L=>g({...d,maxTokens:L.target.value}),hint:"Maximum response length"})]}),t.jsxs("button",{type:"button",onClick:()=>c(!r),className:"flex items-center space-x-2 text-sm text-slate-400 hover:text-white transition-colors",children:[r?t.jsx(ya,{className:"w-4 h-4"}):t.jsx(Wt,{className:"w-4 h-4"}),t.jsx("span",{children:"Advanced Options"}),(d.onBehalfOfUser||d.useResponseApi||d.fallbacks.length>0||d.authMethod!=="default")&&t.jsxs(Se,{variant:"info",className:"ml-2",children:[(d.onBehalfOfUser?1:0)+(d.useResponseApi?1:0)+(d.fallbacks.length>0?1:0)+(d.authMethod!=="default"?1:0)," configured"]})]}),r&&t.jsxs("div",{className:"space-y-4 p-4 bg-slate-800/50 rounded-lg border border-slate-700",children:[t.jsx(bn,{formData:d,setFormData:L=>g({...d,...L}),servicePrincipals:e.service_principals||{},variables:e.variables||{},variableNames:Object.keys(e.variables||{})}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:d.useResponseApi,onChange:L=>g({...d,useResponseApi:L.target.checked}),className:"rounded border-slate-600 bg-slate-800 text-blue-500 focus:ring-blue-500"}),t.jsx("span",{className:"text-sm text-slate-300",children:"Use Response API"})]}),t.jsx("p",{className:"text-xs text-slate-500 ml-6",children:"Enable when using the Databricks response API for streaming and enhanced features"})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Fallback Models"}),t.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Alternative models to try if the primary model fails."})]}),t.jsxs(ee,{variant:"secondary",size:"sm",type:"button",onClick:C,children:[t.jsx(Ie,{className:"w-4 h-4 mr-1"}),"Add Fallback"]})]}),d.fallbacks.length>0?t.jsx("div",{className:"space-y-3",children:d.fallbacks.map((L,V)=>{const B=Lt(L),T=gs(B,"ref:"),F=T?B.slice(4):null,E=Object.keys(b).filter($=>$!==o&&$!==d.name).length>0;return t.jsx($g,{index:V,fallback:L,isReference:T,refKey:F,hasConfiguredLLMs:E,llms:b,endpoints:v||[],editingKey:o,formDataName:d.name,onUpdate:$=>w(V,$),onRemove:()=>I(V),getEndpointStatus:R},V)})}):t.jsx("p",{className:"text-xs text-slate-500 italic",children:"No fallbacks configured."})]})]}),d.name&&Dt(d.name,e,o)&&t.jsxs("div",{className:"p-3 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm",children:['A resource with reference name "',d.name,'" already exists. Please choose a unique name.']}),t.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[t.jsx(ee,{variant:"secondary",type:"button",onClick:()=>{l(!1),_()},children:"Cancel"}),t.jsx(ee,{type:"submit",disabled:Dt(d.name,e,o),children:o?"Save Changes":"Add LLM"})]})]})})]})}function Dg({showForm:e,setShowForm:s,editingKey:a,setEditingKey:n,onClose:i}){var I;const{config:l,addGenieRoom:o,updateGenieRoom:u,removeGenieRoom:m}=nt(),h=((I=l.resources)==null?void 0:I.genie_rooms)||{},r=l.variables||{},c=l.service_principals||{},{data:d,loading:g,refetch:v}=Ro(),[S,y]=A.useState("select"),[b,_]=A.useState({refName:"",name:"",description:"",space_id:"",space_id_variable:"",on_behalf_of_user:!1,authMethod:"default",servicePrincipalRef:"",clientIdSource:"variable",clientSecretSource:"variable",workspaceHostSource:"variable",patSource:"variable",client_id:"",client_secret:"",workspace_host:"",pat:"",clientIdVariable:"",clientSecretVariable:"",workspaceHostVariable:"",patVariable:""}),x=R=>{pa(R);const k=h[R],D=ke(k.space_id);let L="manual",V="",B="";if(typeof k.space_id=="string")gs(k.space_id,"*")?(L="variable",B=k.space_id.substring(1)):(L=(d==null?void 0:d.some(p=>p.space_id===k.space_id))?"select":"manual",V=k.space_id);else if(typeof k.space_id=="object"&&k.space_id!==null){const $=k.space_id;"env"in $?(L="manual",V=$.default_value!==void 0?String($.default_value):D):("secret"in $,L="manual",V=D)}const T=vn(k,gs,Lt,c);let F=k.name||"",E=k.description||"";if(V&&(!k.name||!k.description)){const $=d==null?void 0:d.find(p=>p.space_id===V);$&&(!k.name&&$.title&&(F=$.title),!k.description&&$.description&&(E=$.description))}y(L),_({refName:R,name:F,description:E,space_id:V,space_id_variable:B,...T}),n(R),s(!0)},f=()=>{let R=b.space_id;S==="variable"&&b.space_id_variable&&(R=`*${b.space_id_variable}`);const k={name:b.name,description:b.description||void 0,space_id:R,on_behalf_of_user:b.on_behalf_of_user};yn(k,b),a?a!==b.refName?(m(a),o(b.refName,k)):u(b.refName,k):o(b.refName,k),y("select"),_({refName:"",name:"",description:"",space_id:"",space_id_variable:"",on_behalf_of_user:!1,authMethod:"default",servicePrincipalRef:"",clientIdSource:"variable",clientSecretSource:"variable",workspaceHostSource:"variable",patSource:"variable",client_id:"",client_secret:"",workspace_host:"",pat:"",clientIdVariable:"",clientSecretVariable:"",workspaceHostVariable:"",patVariable:""}),i()},C=R=>{Gt("Genie Room",R,()=>m(R))},w=[{value:"",label:g?"Loading Genie spaces...":"Select a Genie space..."},...(d||[]).map(R=>({value:R.space_id,label:`${R.title}${R.description?` - ${R.description.substring(0,50)}${R.description.length>50?"...":""}`:""}`}))];return t.jsxs($e,{className:"p-5",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Xa,{className:"w-5 h-5 text-purple-400"}),t.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Genie Rooms"})]}),t.jsxs(ee,{variant:"secondary",size:"sm",onClick:()=>{y("select"),_({refName:"",name:"",description:"",space_id:"",space_id_variable:"",on_behalf_of_user:!1,authMethod:"default",servicePrincipalRef:"",clientIdSource:"variable",clientSecretSource:"variable",workspaceHostSource:"variable",patSource:"variable",client_id:"",client_secret:"",workspace_host:"",pat:"",clientIdVariable:"",clientSecretVariable:"",workspaceHostVariable:"",patVariable:""}),n(null),s(!0)},children:[t.jsx(Ie,{className:"w-4 h-4 mr-1"}),"Add Genie Room"]})]}),Object.keys(h).length>0&&t.jsx("div",{className:"space-y-2 mb-4",children:Object.entries(h).map(([R,k])=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800/50 rounded-lg border border-slate-700 cursor-pointer hover:bg-slate-800/70 transition-colors",onClick:()=>x(R),children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Xa,{className:"w-4 h-4 text-purple-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-slate-200",children:R}),t.jsxs("p",{className:"text-xs text-slate-500",children:[k.name,"  Space ID: ",ke(k.space_id).substring(0,12),"..."]})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[k.on_behalf_of_user&&t.jsxs(Se,{variant:"success",title:"On Behalf of User",children:[t.jsx(Os,{className:"w-3 h-3 mr-1"}),"OBO"]}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:D=>{D.stopPropagation(),x(R)},children:t.jsx(ds,{className:"w-4 h-4"})}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:D=>{D.stopPropagation(),C(R)},children:t.jsx(Ze,{className:"w-4 h-4 text-red-400"})})]})]},R))}),Object.keys(h).length===0&&!e&&t.jsx("p",{className:"text-slate-500 text-sm",children:"No Genie rooms configured."}),e&&t.jsxs("div",{className:"mt-4 p-4 bg-slate-800/50 rounded-lg border border-slate-700 space-y-4",children:[t.jsxs("h4",{className:"font-medium text-slate-200",children:[a?"Edit":"New"," Genie Room"]}),t.jsx(U,{label:"Reference Name",value:b.refName,onChange:R=>_({...b,refName:Ot(R.target.value)}),placeholder:"Retail Genie",hint:"Type naturally - spaces become underscores",required:!0}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Genie Space"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{type:"button",onClick:()=>{y("select"),_({...b,space_id:"",space_id_variable:"",name:"",description:""})},className:`px-2 py-1 text-xs rounded ${S==="select"?"bg-blue-500/30 text-blue-300":"bg-slate-700 text-slate-400"}`,children:"Select"}),t.jsx("button",{type:"button",onClick:()=>{y("manual"),_({...b,space_id:"",space_id_variable:"",name:"",description:""})},className:`px-2 py-1 text-xs rounded ${S==="manual"?"bg-blue-500/30 text-blue-300":"bg-slate-700 text-slate-400"}`,children:"Manual"}),t.jsxs("button",{type:"button",onClick:()=>{y("variable"),_({...b,space_id:"",space_id_variable:"",name:"",description:""})},className:`px-2 py-1 text-xs rounded flex items-center space-x-1 ${S==="variable"?"bg-purple-500/30 text-purple-300":"bg-slate-700 text-slate-400"}`,children:[t.jsx(Mt,{className:"w-3 h-3"}),t.jsx("span",{children:"Variable"})]})]})]}),S==="select"&&t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"flex-1",children:t.jsx(ae,{value:b.space_id,onChange:R=>{const k=R.target.value,D=d==null?void 0:d.find(B=>B.space_id===k),L=(D==null?void 0:D.title)||"",V=(D==null?void 0:D.description)||"";_({...b,space_id:k,space_id_variable:"",refName:a?b.refName:vt(L),name:L,description:V})},options:w})}),t.jsx("button",{type:"button",onClick:()=>v(),className:"p-2 text-slate-400 hover:text-white",disabled:g,children:t.jsx(Ut,{className:`w-4 h-4 ${g?"animate-spin":""}`})})]}),t.jsxs("p",{className:"text-xs text-slate-500",children:["Select from ",(d==null?void 0:d.length)||0," available Genie spaces. Display Name and Description will auto-fill."]})]}),S==="manual"&&t.jsxs("div",{className:"space-y-2",children:[t.jsx(U,{value:b.space_id,onChange:R=>{const k=R.target.value;_({...b,space_id:k,space_id_variable:"",refName:a?b.refName:vt(k)})},placeholder:"01f0d05d42ed11eeae85802c1d5bcccd"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Enter the Genie space ID directly. You can find this in the Genie room URL."})]}),S==="variable"&&t.jsxs("div",{className:"space-y-2",children:[Object.keys(r).length>0?t.jsx(ae,{value:b.space_id_variable,onChange:R=>{const k=R.target.value;_({...b,space_id_variable:k,space_id:"",refName:a?b.refName:vt(k||"genie")})},options:[{value:"",label:"Select a variable..."},...Object.keys(r).map(R=>({value:R,label:R}))]}):t.jsx(U,{value:b.space_id_variable,onChange:R=>{const k=R.target.value;_({...b,space_id_variable:k,space_id:"",refName:a?b.refName:vt(k||"genie")})},placeholder:"genie_space_id"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Reference a variable containing the Genie space ID. The value will be resolved at runtime."})]})]}),t.jsx(U,{label:"Display Name",value:b.name,onChange:R=>_({...b,name:R.target.value}),placeholder:"Retail Analytics Genie",required:!0}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Description"}),t.jsx("textarea",{value:b.description,onChange:R=>_({...b,description:R.target.value}),placeholder:"Query retail data using natural language",rows:3,className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-slate-100 placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"})]}),t.jsx(bn,{formData:b,setFormData:R=>_({...b,...R}),servicePrincipals:l.service_principals||{},variables:l.variables||{},variableNames:Object.keys(l.variables||{})}),b.refName&&Dt(b.refName,l,a)&&t.jsxs("div",{className:"p-3 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm",children:['A resource with reference name "',b.refName,'" already exists. Please choose a unique name.']}),t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx(ee,{variant:"secondary",onClick:i,children:"Cancel"}),t.jsx(ee,{onClick:f,disabled:!b.refName||!b.name||S==="select"&&!b.space_id||S==="manual"&&!b.space_id||S==="variable"&&!b.space_id_variable||Dt(b.refName,l,a),children:a?"Update":"Add"})]})]})]})}function Fg({showForm:e,setShowForm:s,editingKey:a,setEditingKey:n,onClose:i}){var R;const{config:l,addWarehouse:o,updateWarehouse:u,removeWarehouse:m}=nt(),h=((R=l.resources)==null?void 0:R.warehouses)||{},r=l.variables||{},c=l.service_principals||{},{data:d,loading:g,refetch:v}=Cg(),[S,y]=A.useState("select"),[b,_]=A.useState({refName:"",name:"",description:"",warehouse_id:"",warehouse_id_variable:"",on_behalf_of_user:!1,authMethod:"default",servicePrincipalRef:"",clientIdSource:"variable",clientSecretSource:"variable",workspaceHostSource:"variable",patSource:"variable",client_id:"",client_secret:"",workspace_host:"",pat:"",clientIdVariable:"",clientSecretVariable:"",workspaceHostVariable:"",patVariable:""}),x=k=>{pa(k);const D=h[k],L=Lt(D.warehouse_id),V=gs(L,"__REF__"),B=V?L.substring(7):"",T=V?"":L;let F="manual";V?F="variable":d!=null&&d.some(p=>p.id===L)&&(F="select");const E=vn(D,gs,Lt,c);let $=D.name||"";if(T&&!D.name){const p=d==null?void 0:d.find(N=>N.id===T);p!=null&&p.name&&($=p.name)}y(F),_({refName:k,name:$,description:D.description||"",warehouse_id:T,warehouse_id_variable:B,...E}),n(k),s(!0)},f=()=>{let k=b.warehouse_id;S==="variable"&&b.warehouse_id_variable&&(k=`__REF__${b.warehouse_id_variable}`);const D={name:b.name,description:b.description||void 0,warehouse_id:k,on_behalf_of_user:b.on_behalf_of_user};yn(D,b),a?a!==b.refName?(m(a),o(b.refName,D)):u(b.refName,D):o(b.refName,D),_({refName:"",name:"",description:"",warehouse_id:"",warehouse_id_variable:"",on_behalf_of_user:!1,authMethod:"default",servicePrincipalRef:"",clientIdSource:"variable",clientSecretSource:"variable",workspaceHostSource:"variable",patSource:"variable",client_id:"",client_secret:"",workspace_host:"",pat:"",clientIdVariable:"",clientSecretVariable:"",workspaceHostVariable:"",patVariable:""}),y("select"),i()},C=k=>{Gt("Warehouse",k,()=>m(k))},w=k=>{switch(k==null?void 0:k.toUpperCase()){case"RUNNING":return"ready";case"STARTING":case"STOPPING":case"RESTARTING":return"transitioning";case"STOPPED":case"DELETED":case"DELETING":return"stopped";default:return"unknown"}},I=[{value:"",label:g?"Loading...":"Select a SQL warehouse..."},...(d||[]).map(k=>({value:k.id,label:k.name,status:w(k.state)}))];return t.jsxs($e,{className:"p-5",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx($t,{className:"w-5 h-5 text-emerald-400"}),t.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"SQL Warehouses"})]}),t.jsxs(ee,{variant:"secondary",size:"sm",onClick:()=>{_({refName:"",name:"",description:"",warehouse_id:"",warehouse_id_variable:"",on_behalf_of_user:!1,authMethod:"default",servicePrincipalRef:"",clientIdSource:"variable",clientSecretSource:"variable",workspaceHostSource:"variable",patSource:"variable",client_id:"",client_secret:"",workspace_host:"",pat:"",clientIdVariable:"",clientSecretVariable:"",workspaceHostVariable:"",patVariable:""}),y("select"),n(null),s(!0)},children:[t.jsx(Ie,{className:"w-4 h-4 mr-1"}),"Add Warehouse"]})]}),Object.keys(h).length>0&&t.jsx("div",{className:"space-y-2 mb-4",children:Object.entries(h).map(([k,D])=>{const L=Lt(D.warehouse_id),V=gs(L,"__REF__"),B=V?`$${L.substring(7)}`:`${L==null?void 0:L.substring(0,12)}...`;return t.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800/50 rounded-lg border border-slate-700 cursor-pointer hover:bg-slate-800/70 transition-colors",onClick:()=>x(k),children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx($t,{className:"w-4 h-4 text-emerald-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-slate-200",children:k}),t.jsxs("p",{className:"text-xs text-slate-500",children:[D.name,"  ",V?"Var: ":"ID: ",B]})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[D.on_behalf_of_user&&t.jsxs(Se,{variant:"success",title:"On Behalf of User",children:[t.jsx(Os,{className:"w-3 h-3 mr-1"}),"OBO"]}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:T=>{T.stopPropagation(),x(k)},children:t.jsx(ds,{className:"w-4 h-4"})}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:T=>{T.stopPropagation(),C(k)},children:t.jsx(Ze,{className:"w-4 h-4 text-red-400"})})]})]},k)})}),Object.keys(h).length===0&&!e&&t.jsx("p",{className:"text-slate-500 text-sm",children:"No SQL warehouses configured."}),e&&t.jsxs("div",{className:"mt-4 p-4 bg-slate-800/50 rounded-lg border border-slate-700 space-y-4",children:[t.jsxs("h4",{className:"font-medium text-slate-200",children:[a?"Edit":"New"," SQL Warehouse"]}),t.jsx(U,{label:"Reference Name",value:b.refName,onChange:k=>_({...b,refName:Ot(k.target.value)}),placeholder:"Main Warehouse",hint:"Type naturally - spaces become underscores",required:!0}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"SQL Warehouse"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{type:"button",onClick:()=>{y("select"),_({...b,warehouse_id_variable:""})},className:`px-2 py-1 text-xs rounded ${S==="select"?"bg-blue-500/30 text-blue-300":"bg-slate-700 text-slate-400"}`,children:"Select"}),t.jsx("button",{type:"button",onClick:()=>{y("manual"),_({...b,warehouse_id_variable:""})},className:`px-2 py-1 text-xs rounded ${S==="manual"?"bg-blue-500/30 text-blue-300":"bg-slate-700 text-slate-400"}`,children:"Manual"}),t.jsxs("button",{type:"button",onClick:()=>{y("variable"),_({...b,warehouse_id:""})},className:`px-2 py-1 text-xs rounded flex items-center space-x-1 ${S==="variable"?"bg-purple-500/30 text-purple-300":"bg-slate-700 text-slate-400"}`,children:[t.jsx(Mt,{className:"w-3 h-3"}),t.jsx("span",{children:"Variable"})]})]})]}),S==="select"&&t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"flex-1",children:t.jsx($r,{value:b.warehouse_id,onChange:k=>{const D=d==null?void 0:d.find(V=>V.id===k),L=(D==null?void 0:D.name)||"";_({...b,warehouse_id:k,warehouse_id_variable:"",refName:a?b.refName:vt(L),name:L||b.name||""})},options:I,placeholder:"Select a SQL warehouse..."})}),t.jsx("button",{type:"button",onClick:()=>v(),className:"p-2 text-slate-400 hover:text-white",disabled:g,children:t.jsx(Ut,{className:`w-4 h-4 ${g?"animate-spin":""}`})})]}),t.jsxs("p",{className:"text-xs text-slate-500",children:["Select from ",(d==null?void 0:d.length)||0," available SQL warehouses. Display Name will auto-fill."]})]}),S==="manual"&&t.jsxs("div",{className:"space-y-2",children:[t.jsx(U,{value:b.warehouse_id,onChange:k=>{const D=k.target.value;_({...b,warehouse_id:D,warehouse_id_variable:"",refName:a?b.refName:vt(D)})},placeholder:"abc123def456"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Enter the warehouse ID directly. You can find this in the SQL warehouse settings."})]}),S==="variable"&&t.jsxs("div",{className:"space-y-2",children:[Object.keys(r).length>0?t.jsx(ae,{value:b.warehouse_id_variable,onChange:k=>{const D=k.target.value;_({...b,warehouse_id_variable:D,warehouse_id:"",refName:a?b.refName:vt(D||"warehouse")})},options:[{value:"",label:"Select a variable..."},...Object.keys(r).map(k=>({value:k,label:k}))]}):t.jsx(U,{value:b.warehouse_id_variable,onChange:k=>{const D=k.target.value;_({...b,warehouse_id_variable:D,warehouse_id:"",refName:a?b.refName:vt(D||"warehouse")})},placeholder:"warehouse_id"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Reference a variable containing the warehouse ID. The value will be resolved at runtime."})]})]}),t.jsx(U,{label:"Display Name",value:b.name,onChange:k=>_({...b,name:k.target.value}),placeholder:"Main Analytics Warehouse",required:!0}),t.jsx(U,{label:"Description",value:b.description,onChange:k=>_({...b,description:k.target.value}),placeholder:"Primary warehouse for analytics queries"}),t.jsx(bn,{formData:b,setFormData:k=>_({...b,...k}),servicePrincipals:l.service_principals||{},variables:l.variables||{},variableNames:Object.keys(l.variables||{})}),b.refName&&Dt(b.refName,l,a)&&t.jsxs("div",{className:"p-3 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm",children:['A resource with reference name "',b.refName,'" already exists. Please choose a unique name.']}),t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx(ee,{variant:"secondary",onClick:i,children:"Cancel"}),t.jsx(ee,{onClick:f,disabled:!b.refName||!b.name||S==="select"&&!b.warehouse_id||S==="manual"&&!b.warehouse_id||S==="variable"&&!b.warehouse_id_variable||Dt(b.refName,l,a),children:a?"Update":"Add"})]})]})]})}function zg({showForm:e,setShowForm:s,editingKey:a,setEditingKey:n,onClose:i}){var B,T,F;const{config:l,addTable:o,updateTable:u,removeTable:m}=nt(),h=((B=l.resources)==null?void 0:B.tables)||{},r=l.schemas||{},c=l.variables||{},d=l.service_principals||{},{data:g}=en(),[v,S]=A.useState("reference"),[y,b]=A.useState({schemaRef:"",catalog_name:"",schema_name:"",source:"reference"}),[_,x]=A.useState({refName:"",schemaRef:"",catalog_name:"",schema_name:"",name:"",on_behalf_of_user:!1,authMethod:"default",servicePrincipalRef:"",clientIdSource:"variable",clientSecretSource:"variable",workspaceHostSource:"variable",patSource:"variable",client_id:"",client_secret:"",workspace_host:"",pat:"",clientIdVariable:"",clientSecretVariable:"",workspaceHostVariable:"",patVariable:""}),{data:f,loading:C}=ea(_.catalog_name||null),{data:w,loading:I}=Xl(v==="reference"&&_.schemaRef?ke((T=r[_.schemaRef])==null?void 0:T.catalog_name)||null:_.catalog_name||null,v==="reference"&&_.schemaRef?ke((F=r[_.schemaRef])==null?void 0:F.schema_name)||null:_.schema_name||null),R=E=>{var O,W,q;pa(E);const $=h[E],p=ke((O=$.schema)==null?void 0:O.catalog_name),N=ke((W=$.schema)==null?void 0:W.schema_name),M=$.schema&&Object.entries(r).some(([,ce])=>ke(ce.catalog_name)===p&&ke(ce.schema_name)===N)?(q=Object.entries(r).find(([,ce])=>ke(ce.catalog_name)===p&&ke(ce.schema_name)===N))==null?void 0:q[0]:"";S(M?"reference":"direct"),x({refName:E,schemaRef:M||"",catalog_name:p,schema_name:N,name:$.name||"",...vn($,gs,Lt,d)}),n(E),s(!0)},k=()=>{const E={name:_.name||void 0,on_behalf_of_user:_.on_behalf_of_user};if(yn(E,_),v==="reference"&&_.schemaRef){const $=r[_.schemaRef];$&&(E.schema={catalog_name:$.catalog_name,schema_name:$.schema_name})}else _.catalog_name&&_.schema_name&&(E.schema={catalog_name:_.catalog_name,schema_name:_.schema_name});a?a!==_.refName?(m(a),o(_.refName,E)):u(_.refName,E):o(_.refName,E),b({schemaRef:_.schemaRef,catalog_name:_.catalog_name,schema_name:_.schema_name,source:v}),x({refName:"",schemaRef:_.schemaRef,catalog_name:_.catalog_name,schema_name:_.schema_name,name:"",on_behalf_of_user:!1,authMethod:"default",servicePrincipalRef:"",clientIdSource:"variable",clientSecretSource:"variable",workspaceHostSource:"variable",patSource:"variable",client_id:"",client_secret:"",workspace_host:"",pat:"",clientIdVariable:"",clientSecretVariable:"",workspaceHostVariable:"",patVariable:""}),i()},D=E=>{m(E)},L=Object.keys(r).length>0,V=v==="reference"?!!_.schemaRef:!!_.catalog_name&&!!_.schema_name;return t.jsxs($e,{className:"p-5",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(vi,{className:"w-5 h-5 text-cyan-400"}),t.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Tables"})]}),t.jsxs(ee,{variant:"secondary",size:"sm",onClick:()=>{x({refName:"",schemaRef:y.schemaRef,catalog_name:y.catalog_name,schema_name:y.schema_name,name:"",on_behalf_of_user:!1,authMethod:"default",servicePrincipalRef:"",clientIdSource:"variable",clientSecretSource:"variable",workspaceHostSource:"variable",patSource:"variable",client_id:"",client_secret:"",workspace_host:"",pat:"",clientIdVariable:"",clientSecretVariable:"",workspaceHostVariable:"",patVariable:""}),S(y.source),n(null),s(!0)},children:[t.jsx(Ie,{className:"w-4 h-4 mr-1"}),"Add Table"]})]}),Object.keys(h).length>0&&t.jsx("div",{className:"space-y-2 mb-4",children:Object.entries(h).map(([E,$])=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800/50 rounded-lg border border-slate-700 cursor-pointer hover:bg-slate-800/70 transition-colors",onClick:()=>R(E),children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(vi,{className:"w-4 h-4 text-cyan-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-slate-200",children:E}),t.jsx("p",{className:"text-xs text-slate-500",children:$.schema?`${ke($.schema.catalog_name)}.${ke($.schema.schema_name)}${$.name?`.${$.name}`:".*"}`:$.name})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[$.on_behalf_of_user&&t.jsxs(Se,{variant:"success",title:"On Behalf of User",children:[t.jsx(Os,{className:"w-3 h-3 mr-1"}),"OBO"]}),!$.on_behalf_of_user&&$.service_principal&&t.jsxs(Se,{variant:"info",title:"Service Principal",children:[t.jsx(Mt,{className:"w-3 h-3 mr-1"}),"SP"]}),!$.on_behalf_of_user&&($.client_id||$.client_secret)&&t.jsxs(Se,{variant:"warning",title:"OAuth2 / M2M",children:[t.jsx(Mt,{className:"w-3 h-3 mr-1"}),"OAuth"]}),!$.on_behalf_of_user&&$.pat&&t.jsxs(Se,{variant:"default",title:"Personal Access Token",children:[t.jsx(Mt,{className:"w-3 h-3 mr-1"}),"PAT"]}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:p=>{p.stopPropagation(),R(E)},children:t.jsx(ds,{className:"w-4 h-4"})}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:p=>{p.stopPropagation(),D(E)},children:t.jsx(Ze,{className:"w-4 h-4 text-red-400"})})]})]},E))}),Object.keys(h).length===0&&!e&&t.jsx("p",{className:"text-slate-500 text-sm",children:"No tables configured."}),e&&t.jsxs("div",{className:"mt-4 p-4 bg-slate-800/50 rounded-lg border border-slate-700 space-y-4",children:[t.jsxs("h4",{className:"font-medium text-slate-200",children:[a?"Edit":"New"," Table"]}),t.jsx(U,{label:"Reference Name",value:_.refName,onChange:E=>x({..._,refName:Ot(E.target.value)}),placeholder:"Sales Data",hint:"Type naturally - spaces become underscores",required:!0}),L&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Schema Source"}),t.jsxs("div",{className:"inline-flex rounded-lg bg-slate-900/50 p-0.5 w-full",children:[t.jsx("button",{type:"button",onClick:()=>{S("reference"),x({..._,catalog_name:"",schema_name:""})},className:`flex-1 px-3 py-1.5 text-xs rounded-md font-medium transition-all duration-150 ${v==="reference"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Configured"}),t.jsx("button",{type:"button",onClick:()=>{S("direct"),x({..._,schemaRef:""})},className:`flex-1 px-3 py-1.5 text-xs rounded-md font-medium transition-all duration-150 ${v==="direct"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Select"})]})]}),v==="reference"&&L?t.jsx(ae,{label:"Schema Reference",value:_.schemaRef,onChange:E=>{const $=E.target.value,p=r[$],N=p?vt(`${ke(p.catalog_name)}_${ke(p.schema_name)}_tables`):"";x({..._,schemaRef:$,name:"",refName:_.refName||N})},options:[{value:"",label:"Select a configured schema..."},...Object.entries(r).map(([E,$])=>({value:E,label:`${E} (${ke($.catalog_name)}.${ke($.schema_name)})`}))],hint:"Reference a schema defined in the Schemas section"}):t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(ae,{label:"Catalog",value:_.catalog_name,onChange:E=>x({..._,catalog_name:E.target.value,schema_name:"",name:""}),options:[{value:"",label:"Select catalog..."},...(g||[]).map(E=>({value:E.name,label:E.name}))]}),t.jsx(ae,{label:"Schema",value:_.schema_name,onChange:E=>{const $=E.target.value,p=$?vt(`${_.catalog_name}_${$}_tables`):"";x({..._,schema_name:$,name:"",refName:_.refName||p})},options:[{value:"",label:C?"Loading schemas...":"Select schema..."},...(f||[]).map(E=>({value:E.name,label:E.name}))],disabled:!_.catalog_name||C})]}),v==="reference"&&_.schemaRef&&r[_.schemaRef]&&t.jsxs("div",{className:"p-2 bg-slate-900/50 rounded text-xs text-slate-400",children:["Using schema: ",t.jsxs("span",{className:"text-slate-300",children:[ke(r[_.schemaRef].catalog_name),".",ke(r[_.schemaRef].schema_name)]})]}),t.jsx(ae,{label:"Table",value:_.name,onChange:E=>{const $=E.target.value;x(p=>{let N="";if($)N=vt($);else if(v==="reference"&&p.schemaRef){const M=r[p.schemaRef];M&&(N=vt(`${M.catalog_name}_${M.schema_name}_tables`))}else p.catalog_name&&p.schema_name&&(N=vt(`${p.catalog_name}_${p.schema_name}_tables`));const P=a&&p.refName;return{...p,name:$,refName:P?p.refName:N}})},options:[{value:"",label:I?"Loading tables...":"All tables (*)"},...(w||[]).map(E=>({value:E.name,label:E.name}))],disabled:!V||I,hint:"Leave empty for all tables in schema"}),t.jsx(bn,{formData:_,setFormData:x,variables:c,servicePrincipals:d,variableNames:Object.keys(c)}),_.refName&&Dt(_.refName,l,a)&&t.jsxs("div",{className:"p-3 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm",children:['A resource with reference name "',_.refName,'" already exists. Please choose a unique name.']}),t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx(ee,{variant:"secondary",onClick:i,children:"Cancel"}),t.jsx(ee,{onClick:k,disabled:!_.refName||!V||Dt(_.refName,l,a),children:a?"Update":"Add"})]})]})]})}function Hg({showForm:e,setShowForm:s,editingKey:a,setEditingKey:n,onClose:i}){var L,V,B;const{config:l,addVolume:o,updateVolume:u,removeVolume:m}=nt(),h=((L=l.resources)==null?void 0:L.volumes)||{},r=l.schemas||{},{data:c}=en(),[d,g]=A.useState("reference"),[v,S]=A.useState({schemaRef:"",catalog_name:"",schema_name:"",source:"reference"}),[y,b]=A.useState({refName:"",schemaRef:"",catalog_name:"",schema_name:"",name:"",on_behalf_of_user:!1}),{data:_,loading:x}=ea(y.catalog_name||null),{data:f,loading:C}=Jl(d==="reference"&&y.schemaRef?ke((V=r[y.schemaRef])==null?void 0:V.catalog_name)||null:y.catalog_name||null,d==="reference"&&y.schemaRef?ke((B=r[y.schemaRef])==null?void 0:B.schema_name)||null:y.schema_name||null),w=T=>{var P,M,O;pa(T);const F=h[T],E=ke((P=F.schema)==null?void 0:P.catalog_name),$=ke((M=F.schema)==null?void 0:M.schema_name),N=F.schema&&Object.entries(r).some(([,W])=>ke(W.catalog_name)===E&&ke(W.schema_name)===$)?(O=Object.entries(r).find(([,W])=>ke(W.catalog_name)===E&&ke(W.schema_name)===$))==null?void 0:O[0]:"";g(N?"reference":"direct"),b({refName:T,schemaRef:N||"",catalog_name:E,schema_name:$,name:F.name||"",on_behalf_of_user:F.on_behalf_of_user||!1}),n(T),s(!0)},I=()=>{const T={name:y.name,on_behalf_of_user:y.on_behalf_of_user};if(d==="reference"&&y.schemaRef){const F=r[y.schemaRef];F&&(T.schema={catalog_name:F.catalog_name,schema_name:F.schema_name})}else y.catalog_name&&y.schema_name&&(T.schema={catalog_name:y.catalog_name,schema_name:y.schema_name});a?a!==y.refName?(m(a),o(y.refName,T)):u(y.refName,T):o(y.refName,T),S({schemaRef:y.schemaRef,catalog_name:y.catalog_name,schema_name:y.schema_name,source:d}),b({refName:"",schemaRef:y.schemaRef,catalog_name:y.catalog_name,schema_name:y.schema_name,name:"",on_behalf_of_user:!1}),i()},R=T=>{m(T)},k=Object.keys(r).length>0,D=d==="reference"?!!y.schemaRef:!!y.catalog_name&&!!y.schema_name;return t.jsxs($e,{className:"p-5",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Pl,{className:"w-5 h-5 text-amber-400"}),t.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Volumes"})]}),t.jsxs(ee,{variant:"secondary",size:"sm",onClick:()=>{b({refName:"",schemaRef:v.schemaRef,catalog_name:v.catalog_name,schema_name:v.schema_name,name:"",on_behalf_of_user:!1}),g(v.source),n(null),s(!0)},children:[t.jsx(Ie,{className:"w-4 h-4 mr-1"}),"Add Volume"]})]}),Object.keys(h).length>0&&t.jsx("div",{className:"space-y-2 mb-4",children:Object.entries(h).map(([T,F])=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800/50 rounded-lg border border-slate-700 cursor-pointer hover:bg-slate-800/70 transition-colors",onClick:()=>w(T),children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Pl,{className:"w-4 h-4 text-amber-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-slate-200",children:T}),t.jsx("p",{className:"text-xs text-slate-500",children:F.schema?`${ke(F.schema.catalog_name)}.${ke(F.schema.schema_name)}.${F.name}`:F.name})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[F.on_behalf_of_user&&t.jsxs(Se,{variant:"success",title:"On Behalf of User",children:[t.jsx(Os,{className:"w-3 h-3 mr-1"}),"OBO"]}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:E=>{E.stopPropagation(),w(T)},children:t.jsx(ds,{className:"w-4 h-4"})}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:E=>{E.stopPropagation(),R(T)},children:t.jsx(Ze,{className:"w-4 h-4 text-red-400"})})]})]},T))}),Object.keys(h).length===0&&!e&&t.jsx("p",{className:"text-slate-500 text-sm",children:"No volumes configured."}),e&&t.jsxs("div",{className:"mt-4 p-4 bg-slate-800/50 rounded-lg border border-slate-700 space-y-4",children:[t.jsxs("h4",{className:"font-medium text-slate-200",children:[a?"Edit":"New"," Volume"]}),t.jsx(U,{label:"Reference Name",value:y.refName,onChange:T=>b({...y,refName:Ot(T.target.value)}),placeholder:"Data Volume",hint:"Type naturally - spaces become underscores",required:!0}),k&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Schema Source"}),t.jsxs("div",{className:"inline-flex rounded-lg bg-slate-900/50 p-0.5 w-full",children:[t.jsx("button",{type:"button",onClick:()=>{g("reference"),b({...y,catalog_name:"",schema_name:""})},className:`flex-1 px-3 py-1.5 text-xs rounded-md font-medium transition-all duration-150 ${d==="reference"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Configured"}),t.jsx("button",{type:"button",onClick:()=>{g("direct"),b({...y,schemaRef:""})},className:`flex-1 px-3 py-1.5 text-xs rounded-md font-medium transition-all duration-150 ${d==="direct"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Select"})]})]}),d==="reference"&&k?t.jsx(ae,{label:"Schema Reference",value:y.schemaRef,onChange:T=>{const F=T.target.value;b({...y,schemaRef:F,name:""})},options:[{value:"",label:"Select a configured schema..."},...Object.entries(r).map(([T,F])=>({value:T,label:`${T} (${ke(F.catalog_name)}.${ke(F.schema_name)})`}))],hint:"Reference a schema defined in the Schemas section"}):t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(ae,{label:"Catalog",value:y.catalog_name,onChange:T=>b({...y,catalog_name:T.target.value,schema_name:"",name:""}),options:[{value:"",label:"Select catalog..."},...(c||[]).map(T=>({value:T.name,label:T.name}))]}),t.jsx(ae,{label:"Schema",value:y.schema_name,onChange:T=>b({...y,schema_name:T.target.value,name:""}),options:[{value:"",label:x?"Loading schemas...":"Select schema..."},...(_||[]).map(T=>({value:T.name,label:T.name}))],disabled:!y.catalog_name||x})]}),d==="reference"&&y.schemaRef&&r[y.schemaRef]&&t.jsxs("div",{className:"p-2 bg-slate-900/50 rounded text-xs text-slate-400",children:["Using schema: ",t.jsxs("span",{className:"text-slate-300",children:[ke(r[y.schemaRef].catalog_name),".",ke(r[y.schemaRef].schema_name)]})]}),t.jsx(ae,{label:"Volume",value:y.name,onChange:T=>{const F=T.target.value;b({...y,name:F,refName:y.refName||vt(F)})},options:[{value:"",label:C?"Loading volumes...":"Select volume..."},...(f||[]).map(T=>({value:T.name,label:T.name}))],disabled:!D||C}),t.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:y.on_behalf_of_user,onChange:T=>b({...y,on_behalf_of_user:T.target.checked}),className:"rounded border-slate-600 bg-slate-800 text-blue-500 focus:ring-blue-500"}),t.jsx(Dn,{className:"w-4 h-4 text-blue-400"}),t.jsx("span",{className:"text-sm text-slate-300",children:"On Behalf of User"})]}),y.refName&&Dt(y.refName,l,a)&&t.jsxs("div",{className:"p-3 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm",children:['A resource with reference name "',y.refName,'" already exists. Please choose a unique name.']}),t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx(ee,{variant:"secondary",onClick:i,children:"Cancel"}),t.jsx(ee,{onClick:I,disabled:!y.refName||!y.name||!D||Dt(y.refName,l,a),children:a?"Update":"Add"})]})]})]})}function Bg({showForm:e,setShowForm:s,editingKey:a,setEditingKey:n,onClose:i}){var p;const{config:l,addFunction:o,updateFunction:u,removeFunction:m}=nt(),h=((p=l.resources)==null?void 0:p.functions)||{},r=l.schemas||{},{data:c}=en(),[d,g]=A.useState("reference"),[v,S]=A.useState({schemaRef:"",catalog_name:"",schema_name:"",source:"reference"}),[y,b]=A.useState({refName:"",schemaRef:"",catalog_name:"",schema_name:"",name:"",on_behalf_of_user:!1}),_=()=>d==="reference"&&y.schemaRef&&r[y.schemaRef]?ke(r[y.schemaRef].catalog_name):y.catalog_name,x=()=>d==="reference"&&y.schemaRef&&r[y.schemaRef]?ke(r[y.schemaRef].schema_name):y.schema_name,f=_(),C=x(),{data:w,loading:I}=ea(f||null),{data:R,loading:k,refetch:D}=Cm(f||null,C||null);A.useEffect(()=>{a&&e&&(console.log("[FunctionsPanel] Editing function:",a),console.log("[FunctionsPanel] schemaSource:",d),console.log("[FunctionsPanel] formData:",y),console.log("[FunctionsPanel] currentCatalog:",f),console.log("[FunctionsPanel] currentSchema:",C),console.log("[FunctionsPanel] functionsList:",R),f&&C&&!R&&!k&&(console.log("[FunctionsPanel] Triggering refetch..."),D()))},[a,e,d,y,f,C,R,k,D]);const L=Object.values(h).filter(N=>{var P,M;return((P=N.schema)==null?void 0:P.catalog_name)===f&&((M=N.schema)==null?void 0:M.schema_name)===C}).map(N=>N.name).filter(Boolean),V=(R||[]).filter(N=>{var P;return a?!L.includes(N.name)||N.name===((P=h[a])==null?void 0:P.name):!L.includes(N.name)}),B=N=>{var se,H,z;pa(N);const P=h[N],M=ke((se=P.schema)==null?void 0:se.catalog_name),O=ke((H=P.schema)==null?void 0:H.schema_name),q=P.schema&&Object.entries(r).some(([,te])=>ke(te.catalog_name)===M&&ke(te.schema_name)===O)?(z=Object.entries(r).find(([,te])=>ke(te.catalog_name)===M&&ke(te.schema_name)===O))==null?void 0:z[0]:"";g(q?"reference":"direct"),b({refName:N,schemaRef:q||"",catalog_name:M,schema_name:O,name:P.name||"",on_behalf_of_user:P.on_behalf_of_user||!1}),n(N),s(!0)},T=()=>{const N={name:y.name||void 0,on_behalf_of_user:y.on_behalf_of_user};if(d==="reference"&&y.schemaRef){const P=r[y.schemaRef];P&&(N.schema={catalog_name:P.catalog_name,schema_name:P.schema_name})}else y.catalog_name&&y.schema_name&&(N.schema={catalog_name:y.catalog_name,schema_name:y.schema_name});a?a!==y.refName?(m(a),o(y.refName,N)):u(y.refName,N):o(y.refName,N),S({schemaRef:y.schemaRef,catalog_name:y.catalog_name,schema_name:y.schema_name,source:d}),b({refName:"",schemaRef:y.schemaRef,catalog_name:y.catalog_name,schema_name:y.schema_name,name:"",on_behalf_of_user:!1}),i()},F=N=>{Gt("Function",N,()=>m(N))},E=Object.keys(r).length>0,$=d==="reference"?!!y.schemaRef:!!y.catalog_name&&!!y.schema_name;return t.jsxs($e,{className:"p-5",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Al,{className:"w-5 h-5 text-pink-400"}),t.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Functions"})]}),t.jsxs(ee,{variant:"secondary",size:"sm",onClick:()=>{b({refName:"",schemaRef:v.schemaRef,catalog_name:v.catalog_name,schema_name:v.schema_name,name:"",on_behalf_of_user:!1}),g(v.source),n(null),s(!0)},children:[t.jsx(Ie,{className:"w-4 h-4 mr-1"}),"Add Function"]})]}),Object.keys(h).length>0&&t.jsx("div",{className:"space-y-2 mb-4",children:Object.entries(h).map(([N,P])=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800/50 rounded-lg border border-slate-700 cursor-pointer hover:bg-slate-800/70 transition-colors",onClick:()=>B(N),children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Al,{className:"w-4 h-4 text-pink-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-slate-200",children:N}),t.jsx("p",{className:"text-xs text-slate-500",children:P.schema?`${ke(P.schema.catalog_name)}.${ke(P.schema.schema_name)}${P.name?`.${P.name}`:".*"}`:P.name})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[P.on_behalf_of_user&&t.jsxs(Se,{variant:"success",title:"On Behalf of User",children:[t.jsx(Os,{className:"w-3 h-3 mr-1"}),"OBO"]}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:M=>{M.stopPropagation(),B(N)},children:t.jsx(ds,{className:"w-4 h-4"})}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:M=>{M.stopPropagation(),F(N)},children:t.jsx(Ze,{className:"w-4 h-4 text-red-400"})})]})]},N))}),Object.keys(h).length===0&&!e&&t.jsx("p",{className:"text-slate-500 text-sm",children:"No functions configured."}),e&&t.jsxs("div",{className:"mt-4 p-4 bg-slate-800/50 rounded-lg border border-slate-700 space-y-4",children:[t.jsxs("h4",{className:"font-medium text-slate-200",children:[a?"Edit":"New"," Function"]}),t.jsx(U,{label:"Reference Name",value:y.refName,onChange:N=>b({...y,refName:Ot(N.target.value)}),placeholder:"UC Functions",hint:"Type naturally - spaces become underscores",required:!0}),E&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Schema Source"}),t.jsxs("div",{className:"inline-flex rounded-lg bg-slate-900/50 p-0.5 w-full",children:[t.jsx("button",{type:"button",onClick:()=>{g("reference"),b({...y,catalog_name:"",schema_name:""})},className:`flex-1 px-3 py-1.5 text-xs rounded-md font-medium transition-all duration-150 ${d==="reference"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Configured"}),t.jsx("button",{type:"button",onClick:()=>{g("direct"),b({...y,schemaRef:""})},className:`flex-1 px-3 py-1.5 text-xs rounded-md font-medium transition-all duration-150 ${d==="direct"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Select"})]})]}),d==="reference"&&E?t.jsx(ae,{label:"Schema Reference",value:y.schemaRef,onChange:N=>{const P=N.target.value,M=P?r[P]:null,O=M?vt(`${M.catalog_name}_${M.schema_name}_functions`):"";b({...y,schemaRef:P,name:"",refName:y.refName||O})},options:[{value:"",label:"Select a configured schema..."},...Object.entries(r).map(([N,P])=>({value:N,label:`${N} (${ke(P.catalog_name)}.${ke(P.schema_name)})`}))],hint:"Reference a schema defined in the Schemas section"}):t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(ae,{label:"Catalog",value:y.catalog_name,onChange:N=>b({...y,catalog_name:N.target.value,schema_name:"",name:""}),options:[{value:"",label:"Select catalog..."},...(c||[]).map(N=>({value:N.name,label:N.name}))]}),t.jsx(ae,{label:"Schema",value:y.schema_name,onChange:N=>{const P=N.target.value,M=P?vt(`${y.catalog_name}_${P}_functions`):"";b({...y,schema_name:P,name:"",refName:y.refName||M})},options:[{value:"",label:I?"Loading schemas...":"Select schema..."},...(w||[]).map(N=>({value:N.name,label:N.name}))],disabled:!y.catalog_name||I})]}),d==="reference"&&y.schemaRef&&r[y.schemaRef]&&t.jsxs("div",{className:"p-2 bg-slate-900/50 rounded text-xs text-slate-400",children:["Using schema: ",t.jsxs("span",{className:"text-slate-300",children:[ke(r[y.schemaRef].catalog_name),".",ke(r[y.schemaRef].schema_name)]})]}),t.jsx(ae,{label:"Function",value:y.name,onChange:N=>{const P=N.target.value;b(M=>{let O="";if(P)O=vt(P);else if(d==="reference"&&M.schemaRef){const q=r[M.schemaRef];q&&(O=vt(`${q.catalog_name}_${q.schema_name}_functions`))}else M.catalog_name&&M.schema_name&&(O=vt(`${M.catalog_name}_${M.schema_name}_functions`));const W=a&&M.refName;return{...M,name:P,refName:W?M.refName:O}})},options:[{value:"",label:k?"Loading functions...":"All functions (*)"},...V.map(N=>({value:N.name,label:N.name}))],disabled:!$||k,hint:"Leave empty for all functions in schema"}),t.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:y.on_behalf_of_user,onChange:N=>b({...y,on_behalf_of_user:N.target.checked}),className:"rounded border-slate-600 bg-slate-800 text-blue-500 focus:ring-blue-500"}),t.jsx(Dn,{className:"w-4 h-4 text-blue-400"}),t.jsx("span",{className:"text-sm text-slate-300",children:"On Behalf of User"})]}),y.refName&&Dt(y.refName,l,a)&&t.jsxs("div",{className:"p-3 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm",children:['A resource with reference name "',y.refName,'" already exists. Please choose a unique name.']}),t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx(ee,{variant:"secondary",onClick:i,children:"Cancel"}),t.jsx(ee,{onClick:T,disabled:!y.refName||!$||Dt(y.refName,l,a),children:a?"Update":"Add"})]})]})]})}function Wg({showForm:e,setShowForm:s,editingKey:a,setEditingKey:n,onClose:i}){var _;const{config:l,addConnection:o,updateConnection:u,removeConnection:m}=nt(),h=((_=l.resources)==null?void 0:_.connections)||{},r=l.service_principals||{},{data:c,loading:d}=km(),[g,v]=A.useState({refName:"",name:"",on_behalf_of_user:!1,authMethod:"default",servicePrincipalRef:"",clientIdSource:"variable",clientSecretSource:"variable",workspaceHostSource:"variable",patSource:"variable",client_id:"",client_secret:"",workspace_host:"",pat:"",clientIdVariable:"",clientSecretVariable:"",workspaceHostVariable:"",patVariable:""}),S=x=>{pa(x);const f=h[x],C=vn(f,gs,Lt,r);v({refName:x,name:f.name,...C}),n(x),s(!0)},y=()=>{const x={name:g.name,on_behalf_of_user:g.on_behalf_of_user};yn(x,g),a?a!==g.refName?(m(a),o(g.refName,x)):u(g.refName,x):o(g.refName,x),v({refName:"",name:"",on_behalf_of_user:!1,authMethod:"default",servicePrincipalRef:"",clientIdSource:"variable",clientSecretSource:"variable",workspaceHostSource:"variable",patSource:"variable",client_id:"",client_secret:"",workspace_host:"",pat:"",clientIdVariable:"",clientSecretVariable:"",workspaceHostVariable:"",patVariable:""}),i()},b=x=>{Gt("Connection",x,()=>m(x))};return t.jsxs($e,{className:"p-5",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Ll,{className:"w-5 h-5 text-indigo-400"}),t.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Connections"})]}),t.jsxs(ee,{variant:"secondary",size:"sm",onClick:()=>{v({refName:"",name:"",on_behalf_of_user:!1,authMethod:"default",servicePrincipalRef:"",clientIdSource:"variable",clientSecretSource:"variable",workspaceHostSource:"variable",patSource:"variable",client_id:"",client_secret:"",workspace_host:"",pat:"",clientIdVariable:"",clientSecretVariable:"",workspaceHostVariable:"",patVariable:""}),n(null),s(!0)},children:[t.jsx(Ie,{className:"w-4 h-4 mr-1"}),"Add Connection"]})]}),Object.keys(h).length>0&&t.jsx("div",{className:"space-y-2 mb-4",children:Object.entries(h).map(([x,f])=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800/50 rounded-lg border border-slate-700 cursor-pointer hover:bg-slate-800/70 transition-colors",onClick:()=>S(x),children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Ll,{className:"w-4 h-4 text-indigo-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-slate-200",children:x}),t.jsxs("p",{className:"text-xs text-slate-500",children:["UC Connection: ",f.name]})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[f.on_behalf_of_user&&t.jsxs(Se,{variant:"success",title:"On Behalf of User",children:[t.jsx(Os,{className:"w-3 h-3 mr-1"}),"OBO"]}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:C=>{C.stopPropagation(),S(x)},children:t.jsx(ds,{className:"w-4 h-4"})}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:C=>{C.stopPropagation(),b(x)},children:t.jsx(Ze,{className:"w-4 h-4 text-red-400"})})]})]},x))}),Object.keys(h).length===0&&!e&&t.jsx("p",{className:"text-slate-500 text-sm",children:"No connections configured."}),e&&t.jsxs("div",{className:"mt-4 p-4 bg-slate-800/50 rounded-lg border border-slate-700 space-y-4",children:[t.jsxs("h4",{className:"font-medium text-slate-200",children:[a?"Edit":"New"," Connection"]}),t.jsx(U,{label:"Reference Name",value:g.refName,onChange:x=>v({...g,refName:Ot(x.target.value)}),placeholder:"External API",hint:"Type naturally - spaces become underscores",required:!0}),t.jsx(ae,{label:"Unity Catalog Connection",value:g.name,onChange:x=>{v({...g,name:x.target.value,refName:g.refName||vt(x.target.value)})},options:[{value:"",label:d?"Loading connections...":"Select a connection..."},...(c||[]).map(x=>({value:x.name,label:`${x.name}${x.connection_type?` (${x.connection_type})`:""}`}))],hint:"Select from available Unity Catalog connections",required:!0}),t.jsx(bn,{formData:g,setFormData:x=>v({...g,...x}),servicePrincipals:l.service_principals||{},variables:l.variables||{},variableNames:Object.keys(l.variables||{})}),g.refName&&Dt(g.refName,l,a)&&t.jsxs("div",{className:"p-3 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm",children:['A resource with reference name "',g.refName,'" already exists. Please choose a unique name.']}),t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx(ee,{variant:"secondary",onClick:i,children:"Cancel"}),t.jsx(ee,{onClick:y,disabled:!g.refName||!g.name||Dt(g.refName,l,a),children:a?"Update":"Add"})]})]})]})}const dl={refName:"",name:"",type:"lakebase",instanceSource:"existing",instance_name:"",hostSource:"manual",host:"",hostVariable:"",description:"",capacity:"CU_2",max_pool_size:10,timeout_seconds:10,authMethod:"service_principal",servicePrincipalRef:"",clientIdSource:"variable",clientSecretSource:"variable",workspaceHostSource:"variable",client_id:"",client_secret:"",workspace_host:"",clientIdVariable:"",clientSecretVariable:"",workspaceHostVariable:"",userSource:"manual",passwordSource:"variable",user:"",password:"",userVariable:"",passwordVariable:"",on_behalf_of_user:!1},Ug=[{value:"lakebase",label:"Lakebase (Databricks-managed PostgreSQL)"},{value:"postgres",label:"PostgreSQL (External)"}],Zc=[{value:"service_principal",label:"Configured Service Principal"},{value:"oauth",label:"Manual OAuth2 Credentials"},{value:"user",label:"User/Password"}],qg=e=>`*${e}`,Gg=e=>"env"in e?`env: ${e.env}`:"scope"in e&&"secret"in e?`secret: ${e.scope}/${e.secret}`:"value"in e?`value: ${String(e.value)}`:"options"in e?`composite (${e.options.length} options)`:"unknown";function _n({label:e,source:s,onSourceChange:a,manualValue:n,onManualChange:i,variableValue:l,onVariableChange:o,placeholder:u,isPassword:m=!1,hint:h,variableNames:r,variables:c}){return t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:e}),t.jsxs("div",{className:"inline-flex rounded-lg bg-slate-900/50 p-0.5",children:[t.jsx("button",{type:"button",onClick:()=>a("variable"),className:`px-3 py-1 text-xs rounded-md font-medium transition-all duration-150 flex items-center gap-1 ${s==="variable"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Variable"}),t.jsx("button",{type:"button",onClick:()=>a("manual"),className:`px-3 py-1 text-xs rounded-md font-medium transition-all duration-150 ${s==="manual"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Manual"})]})]}),s==="variable"?t.jsx(ae,{value:l,onChange:d=>o(d.target.value),options:[{value:"",label:"Select a variable..."},...r.map(d=>({value:d,label:`${d} (${Gg(c[d])})`}))],hint:r.length===0?"Define variables in the Variables section first":h}):t.jsx(U,{value:n,onChange:d=>i(d.target.value),placeholder:u,type:m?"password":"text",hint:h})]})}function Yg({showForm:e,setShowForm:s,editingKey:a,setEditingKey:n,onClose:i}){var I;const{config:l,addDatabase:o,updateDatabase:u,removeDatabase:m}=nt(),h=((I=l.resources)==null?void 0:I.databases)||{},r=l.variables||{},c=Object.keys(r),{data:d,loading:g,refetch:v}=Sg(),S=R=>{switch(R==null?void 0:R.toUpperCase()){case"AVAILABLE":case"RUNNING":return"ready";case"CREATING":case"STARTING":case"STOPPING":case"PROVISIONING":case"UPDATING":return"transitioning";case"STOPPED":case"FAILED":case"DELETED":case"DELETING":return"stopped";default:return"unknown"}},y=[{value:"",label:g?"Loading...":"Select an instance..."},...(d||[]).map(R=>({value:R.name,label:R.name,status:S(R.state)}))],[b,_]=A.useState(dl),x=R=>{pa(R);const k=h[R];if(k){const D=V=>gs(V,"*"),L=V=>{const B=Lt(V);return B.startsWith("*")?B.slice(1):""};_({refName:R,name:k.name||k.instance_name||"",type:k._uiType||(k.instance_name?"lakebase":"postgres"),instanceSource:"existing",instance_name:k.instance_name||"",hostSource:D(k.host)?"variable":"manual",host:D(k.host)?"":Lt(k.host),hostVariable:L(k.host),description:k.description||"",capacity:k.capacity||"CU_2",max_pool_size:k.max_pool_size||10,timeout_seconds:k.timeout_seconds||10,authMethod:k.service_principal?"service_principal":k.client_id?"oauth":"user",servicePrincipalRef:gs(k.service_principal,"*")?Lt(k.service_principal).slice(1):"",clientIdSource:D(k.client_id)?"variable":"manual",clientSecretSource:D(k.client_secret)?"variable":"manual",workspaceHostSource:D(k.workspace_host)?"variable":"manual",client_id:D(k.client_id)?"":Lt(k.client_id),client_secret:D(k.client_secret)?"":Lt(k.client_secret),workspace_host:D(k.workspace_host)?"":Lt(k.workspace_host),clientIdVariable:L(k.client_id),clientSecretVariable:L(k.client_secret),workspaceHostVariable:L(k.workspace_host),userSource:D(k.user)?"variable":"manual",passwordSource:D(k.password)?"variable":"manual",user:D(k.user)?"":Lt(k.user),password:D(k.password)?"":Lt(k.password),userVariable:L(k.user),passwordVariable:L(k.password),on_behalf_of_user:k.on_behalf_of_user||!1}),n(R),s(!0)}},f=R=>{Gt("Database",R,()=>m(R))},C=(R,k,D)=>R==="variable"&&D?qg(D):k,w=()=>{const R={name:b.name,_uiType:b.type,instance_name:b.type==="lakebase"&&b.instance_name||void 0,host:b.type==="postgres"&&C(b.hostSource,b.host,b.hostVariable)||void 0,description:b.description||void 0,capacity:b.capacity,max_pool_size:b.max_pool_size,timeout_seconds:b.timeout_seconds,on_behalf_of_user:b.type==="lakebase"&&b.on_behalf_of_user||void 0};if(b.authMethod==="service_principal")b.servicePrincipalRef&&(R.service_principal=`*${b.servicePrincipalRef}`);else if(b.authMethod==="oauth"){const k=C(b.clientIdSource,b.client_id,b.clientIdVariable),D=C(b.clientSecretSource,b.client_secret,b.clientSecretVariable),L=C(b.workspaceHostSource,b.workspace_host,b.workspaceHostVariable);k&&(R.client_id=k),D&&(R.client_secret=D),L&&(R.workspace_host=L)}else{const k=C(b.userSource,b.user,b.userVariable),D=C(b.passwordSource,b.password,b.passwordVariable);k&&(R.user=k),D&&(R.password=D)}a?a!==b.refName?(m(a),o(b.refName,R)):u(a,R):o(b.refName,R),s(!1),n(null),_(dl),i()};return t.jsxs($e,{className:"p-5",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(gr,{className:"w-5 h-5 text-emerald-400"}),t.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Databases (Lakebase/PostgreSQL)"})]}),t.jsxs(ee,{variant:"secondary",size:"sm",onClick:()=>{_(dl),n(null),s(!0)},children:[t.jsx(Ie,{className:"w-4 h-4 mr-1"}),"Add Database"]})]}),Object.keys(h).length>0&&t.jsx("div",{className:"space-y-2 mb-4",children:Object.entries(h).map(([R,k])=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800/50 rounded-lg border border-slate-700 cursor-pointer hover:bg-slate-800/70 transition-colors",onClick:()=>x(R),children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(gr,{className:"w-4 h-4 text-emerald-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-slate-200",children:R}),t.jsxs("p",{className:"text-xs text-slate-500",children:[k.instance_name||k.name||"Default instance","  ",k.capacity||"CU_2",k.client_id?"  OAuth":k.user?"  User auth":""]})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[k.on_behalf_of_user&&t.jsxs(Se,{variant:"success",title:"On Behalf of User",children:[t.jsx(Os,{className:"w-3 h-3 mr-1"}),"OBO"]}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:D=>{D.stopPropagation(),x(R)},children:t.jsx(ds,{className:"w-4 h-4"})}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:D=>{D.stopPropagation(),f(R)},children:t.jsx(Ze,{className:"w-4 h-4 text-red-400"})})]})]},R))}),Object.keys(h).length===0&&!e&&t.jsx("p",{className:"text-slate-500 text-sm",children:"No databases configured. Add a database for PostgreSQL/Lakebase memory storage."}),e&&t.jsxs("div",{className:"mt-4 p-4 bg-slate-800/50 rounded-lg border border-slate-700 space-y-4",children:[t.jsxs("h4",{className:"font-medium text-slate-200",children:[a?"Edit":"New"," Database"]}),t.jsx(U,{label:"Reference Name",value:b.refName,onChange:R=>_({...b,refName:Ot(R.target.value)}),placeholder:"Retail Database",hint:"Type naturally - spaces become underscores",required:!0}),t.jsx(ae,{label:"Database Type",value:b.type,onChange:R=>{const k=R.target.value;_({...b,type:k,on_behalf_of_user:k==="postgres"?!1:b.on_behalf_of_user})},options:Ug,hint:b.type==="lakebase"?"Databricks-managed Lakebase supports ambient/OBO authentication":"External PostgreSQL requires explicit credentials"}),b.type==="lakebase"&&t.jsxs("div",{className:"space-y-3 p-3 bg-slate-900/50 rounded border border-slate-600",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("p",{className:"text-sm text-slate-300 font-medium flex items-center",children:[t.jsx(af,{className:"w-4 h-4 mr-2 text-emerald-400"}),"Lakebase Instance"]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{type:"button",onClick:()=>_({...b,instanceSource:"existing"}),className:`px-2 py-1 text-xs rounded ${b.instanceSource==="existing"?"bg-emerald-500/30 text-emerald-300":"bg-slate-700 text-slate-400"}`,children:"Use Existing"}),t.jsx("button",{type:"button",onClick:()=>_({...b,instanceSource:"manual"}),className:`px-2 py-1 text-xs rounded ${b.instanceSource==="manual"?"bg-emerald-500/30 text-emerald-300":"bg-slate-700 text-slate-400"}`,children:"Manual"})]})]}),b.instanceSource==="existing"?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:"Select Lakebase Instance"}),t.jsx($r,{value:b.instance_name,onChange:R=>{_({...b,instance_name:R,name:R||b.name,refName:a?b.refName:vt(R)})},options:y,placeholder:"Select an instance..."})]}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:()=>v(),disabled:g,className:"mt-6",children:g?t.jsx(Nt,{className:"w-4 h-4 animate-spin"}):t.jsx(Ut,{className:"w-4 h-4"})})]}):t.jsx(U,{label:"Instance Name",value:b.instance_name,onChange:R=>{const k=R.target.value;_({...b,instance_name:k,name:k||b.name,refName:a?b.refName:vt(k)})},placeholder:"my-lakebase-instance",hint:"Enter the Lakebase instance name directly"})]}),b.type==="postgres"&&t.jsx(_n,{label:"PostgreSQL Host",source:b.hostSource,onSourceChange:R=>_({...b,hostSource:R}),manualValue:b.host,onManualChange:R=>_({...b,host:R}),variableValue:b.hostVariable,onVariableChange:R=>_({...b,hostVariable:R}),placeholder:"postgres.example.com:5432",hint:"Hostname and port for your PostgreSQL server",variableNames:c,variables:r}),t.jsx(U,{label:"Display Name",value:b.name,onChange:R=>_({...b,name:R.target.value}),placeholder:"Retail Database"}),t.jsx(U,{label:"Description",value:b.description,onChange:R=>_({...b,description:R.target.value}),placeholder:"Database for agent memory and checkpoints"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(U,{label:"Max Pool Size",type:"number",value:b.max_pool_size,onChange:R=>_({...b,max_pool_size:parseInt(R.target.value)||10})}),t.jsx(U,{label:"Timeout (seconds)",type:"number",value:b.timeout_seconds,onChange:R=>_({...b,timeout_seconds:parseInt(R.target.value)||10})})]}),b.type==="lakebase"?t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Authentication Method"}),t.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:b.on_behalf_of_user,onChange:R=>_({...b,on_behalf_of_user:R.target.checked}),className:"rounded border-slate-600 bg-slate-800 text-blue-500 focus:ring-blue-500"}),t.jsx(Dn,{className:"w-4 h-4 text-blue-400"}),t.jsx("span",{className:"text-sm text-slate-300",children:"On Behalf of User"})]})]}),t.jsx(ae,{value:b.authMethod,onChange:R=>_({...b,authMethod:R.target.value}),options:Zc,hint:"Lakebase supports ambient/OBO authentication",disabled:b.on_behalf_of_user}),b.on_behalf_of_user&&t.jsx("div",{className:"p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg text-blue-300 text-xs",children:"When enabled, the resource will use the calling user's credentials for authentication. Other authentication options are disabled."})]}):t.jsx(ae,{label:"Authentication Method",value:b.authMethod,onChange:R=>_({...b,authMethod:R.target.value}),options:Zc,hint:"PostgreSQL requires explicit authentication"}),b.type==="postgres"&&t.jsx("div",{className:"p-3 bg-amber-500/10 border border-amber-500/30 rounded-lg",children:t.jsxs("p",{className:"text-xs text-amber-400",children:[t.jsx("strong",{children:"Note:"})," PostgreSQL databases require explicit authentication (user/password or OAuth2 credentials)."]})}),!b.on_behalf_of_user&&b.authMethod==="service_principal"?t.jsxs("div",{className:"space-y-4 p-3 bg-slate-900/50 rounded border border-slate-600",children:[t.jsx("p",{className:"text-xs text-slate-400 font-medium",children:"Select Configured Service Principal"}),t.jsx(ae,{label:"Service Principal",value:b.servicePrincipalRef,onChange:R=>_({...b,servicePrincipalRef:R.target.value}),options:[{value:"",label:"Select a service principal..."},...Object.keys(l.service_principals||{}).map(R=>({value:R,label:R}))],hint:"Reference a pre-configured service principal"}),Object.keys(l.service_principals||{}).length===0&&t.jsx("div",{className:"p-2 bg-amber-500/10 border border-amber-500/30 rounded text-amber-400 text-xs",children:"No service principals configured. Add one in the Service Principals tab first."})]}):!b.on_behalf_of_user&&b.authMethod==="oauth"?t.jsxs("div",{className:"space-y-4 p-3 bg-slate-900/50 rounded border border-slate-600",children:[t.jsx("p",{className:"text-xs text-slate-400 font-medium",children:"OAuth2 / Service Principal Credentials"}),t.jsx(_n,{label:"Client ID",source:b.clientIdSource,onSourceChange:R=>_({...b,clientIdSource:R}),manualValue:b.client_id,onManualChange:R=>_({...b,client_id:R}),variableValue:b.clientIdVariable,onVariableChange:R=>_({...b,clientIdVariable:R}),placeholder:"your-service-principal-client-id",variableNames:c,variables:r}),t.jsx(_n,{label:"Client Secret",source:b.clientSecretSource,onSourceChange:R=>_({...b,clientSecretSource:R}),manualValue:b.client_secret,onManualChange:R=>_({...b,client_secret:R}),variableValue:b.clientSecretVariable,onVariableChange:R=>_({...b,clientSecretVariable:R}),placeholder:"your-client-secret",isPassword:!0,variableNames:c,variables:r}),t.jsx(_n,{label:"Workspace Host (Optional)",source:b.workspaceHostSource,onSourceChange:R=>_({...b,workspaceHostSource:R}),manualValue:b.workspace_host,onManualChange:R=>_({...b,workspace_host:R}),variableValue:b.workspaceHostVariable,onVariableChange:R=>_({...b,workspaceHostVariable:R}),placeholder:"https://your-workspace.cloud.databricks.com",hint:"Only required if connecting from outside the workspace",variableNames:c,variables:r})]}):!b.on_behalf_of_user&&b.authMethod==="user"?t.jsxs("div",{className:"space-y-4 p-3 bg-slate-900/50 rounded border border-slate-600",children:[t.jsx("p",{className:"text-xs text-slate-400 font-medium",children:"User/Password Credentials"}),t.jsx(_n,{label:"Username",source:b.userSource,onSourceChange:R=>_({...b,userSource:R}),manualValue:b.user,onManualChange:R=>_({...b,user:R}),variableValue:b.userVariable,onVariableChange:R=>_({...b,userVariable:R}),placeholder:"postgres",variableNames:c,variables:r}),t.jsx(_n,{label:"Password",source:b.passwordSource,onSourceChange:R=>_({...b,passwordSource:R}),manualValue:b.password,onManualChange:R=>_({...b,password:R}),variableValue:b.passwordVariable,onVariableChange:R=>_({...b,passwordVariable:R}),placeholder:"your-password",isPassword:!0,variableNames:c,variables:r})]}):null,b.refName&&Dt(b.refName,l,a)&&t.jsxs("div",{className:"p-3 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm",children:['A resource with reference name "',b.refName,'" already exists. Please choose a unique name.']}),t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx(ee,{variant:"secondary",onClick:i,children:"Cancel"}),t.jsx(ee,{onClick:w,disabled:!b.refName||!b.name||b.type==="lakebase"&&!b.instance_name||b.type==="postgres"&&b.hostSource==="manual"&&!b.host||b.type==="postgres"&&b.hostSource==="variable"&&!b.hostVariable||Dt(b.refName,l,a),children:a?"Update":"Add"})]})]})]})}const ul={refName:"",configMode:"use_existing",endpointSource:"select",endpoint_name:"",endpoint_type:"STANDARD",indexSchemaSource:"direct",indexSchemaRefName:"",index_catalog:"",index_schema:"",indexNameSource:"select",index_name:"",sourceSchemaSource:"direct",sourceSchemaRefName:"",source_catalog:"",source_schema:"",source_table:"",primary_key:"",embedding_source_column:"",columns:[],doc_uri:"",embedding_model:"databricks-gte-large-en",sourcePathEnabled:!1,sourcePathSchemaSource:"direct",sourcePathSchemaRef:"",sourcePathVolumeCatalog:"",sourcePathVolumeSchema:"",sourcePathVolumeName:"",sourcePathPath:"",checkpointPathEnabled:!1,checkpointPathSchemaSource:"direct",checkpointPathSchemaRef:"",checkpointPathVolumeCatalog:"",checkpointPathVolumeSchema:"",checkpointPathVolumeName:"",checkpointPathPath:"",on_behalf_of_user:!1,authMethod:"default",servicePrincipalRef:"",clientIdSource:"variable",clientSecretSource:"variable",workspaceHostSource:"variable",patSource:"variable",client_id:"",client_secret:"",workspace_host:"",pat:"",clientIdVariable:"",clientSecretVariable:"",workspaceHostVariable:"",patVariable:""};function Kg({formData:e,setFormData:s,configuredSchemas:a,configuredSchemaOptions:n,catalogs:i,sourcePathSchemas:l,sourcePathVolumes:o,sourcePathVolumesLoading:u,checkpointPathSchemas:m,checkpointPathVolumes:h,checkpointPathVolumesLoading:r}){const c=Object.keys(a).length>0;return t.jsxs("div",{className:"space-y-4 p-3 bg-slate-900/50 rounded border border-slate-600",children:[t.jsxs("p",{className:"text-sm text-slate-300 font-medium",children:["Volume Paths ",t.jsx("span",{className:"text-slate-500 font-normal",children:"(Optional)"})]}),t.jsxs("div",{className:"space-y-3 p-3 bg-slate-800/30 rounded border border-slate-700",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Source Path"}),t.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:e.sourcePathEnabled,onChange:d=>s(g=>({...g,sourcePathEnabled:d.target.checked,sourcePathSchemaSource:c?"reference":"direct"})),className:"rounded border-slate-600 bg-slate-800 text-blue-500 focus:ring-blue-500"}),t.jsx("span",{className:"text-xs text-slate-400",children:"Enable"})]})]}),e.sourcePathEnabled&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-xs text-slate-400",children:"Schema"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[c&&t.jsx("button",{type:"button",onClick:()=>s(d=>({...d,sourcePathSchemaSource:"reference",sourcePathVolumeCatalog:"",sourcePathVolumeSchema:"",sourcePathVolumeName:""})),className:`px-2 py-1 text-xs rounded ${e.sourcePathSchemaSource==="reference"?"bg-blue-500/30 text-blue-300":"bg-slate-700 text-slate-400"}`,children:"Configured"}),t.jsx("button",{type:"button",onClick:()=>s(d=>({...d,sourcePathSchemaSource:"direct",sourcePathSchemaRef:"",sourcePathVolumeName:""})),className:`px-2 py-1 text-xs rounded ${e.sourcePathSchemaSource==="direct"?"bg-blue-500/30 text-blue-300":"bg-slate-700 text-slate-400"}`,children:"Select"})]})]}),e.sourcePathSchemaSource==="reference"?t.jsx(ae,{value:e.sourcePathSchemaRef,onChange:d=>{const g=d.target.value,v=a[g];s(S=>({...S,sourcePathSchemaRef:g,sourcePathVolumeCatalog:ke(v==null?void 0:v.catalog_name),sourcePathVolumeSchema:ke(v==null?void 0:v.schema_name),sourcePathVolumeName:""}))},options:[{value:"",label:"Select configured schema..."},...n],hint:"Select a previously configured schema"}):t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx(ae,{value:e.sourcePathVolumeCatalog,onChange:d=>s(g=>({...g,sourcePathVolumeCatalog:d.target.value,sourcePathVolumeSchema:"",sourcePathVolumeName:""})),options:[{value:"",label:"Catalog..."},...(i||[]).map(d=>({value:d.name,label:d.name}))]}),t.jsx(ae,{value:e.sourcePathVolumeSchema,onChange:d=>s(g=>({...g,sourcePathVolumeSchema:d.target.value,sourcePathVolumeName:""})),options:[{value:"",label:"Schema..."},...(l||[]).map(d=>({value:d.name,label:d.name}))],disabled:!e.sourcePathVolumeCatalog})]}),t.jsx(ae,{label:"Volume",value:e.sourcePathVolumeName,onChange:d=>s(g=>({...g,sourcePathVolumeName:d.target.value})),options:[{value:"",label:u?"Loading volumes...":"Select volume..."},...(o||[]).map(d=>({value:d.name,label:d.name}))],disabled:!e.sourcePathVolumeSchema||u,hint:"Select a volume from the schema"}),t.jsx(U,{label:"Path",value:e.sourcePathPath,onChange:d=>s(g=>({...g,sourcePathPath:d.target.value})),placeholder:"/path/to/source/data",hint:"Path within the volume for source data files"})]})]}),t.jsxs("div",{className:"space-y-3 p-3 bg-slate-800/30 rounded border border-slate-700",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Checkpoint Path"}),t.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:e.checkpointPathEnabled,onChange:d=>s(g=>({...g,checkpointPathEnabled:d.target.checked,checkpointPathSchemaSource:c?"reference":"direct"})),className:"rounded border-slate-600 bg-slate-800 text-blue-500 focus:ring-blue-500"}),t.jsx("span",{className:"text-xs text-slate-400",children:"Enable"})]})]}),e.checkpointPathEnabled&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-xs text-slate-400",children:"Schema"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[c&&t.jsx("button",{type:"button",onClick:()=>s(d=>({...d,checkpointPathSchemaSource:"reference",checkpointPathVolumeCatalog:"",checkpointPathVolumeSchema:"",checkpointPathVolumeName:""})),className:`px-2 py-1 text-xs rounded ${e.checkpointPathSchemaSource==="reference"?"bg-blue-500/30 text-blue-300":"bg-slate-700 text-slate-400"}`,children:"Configured"}),t.jsx("button",{type:"button",onClick:()=>s(d=>({...d,checkpointPathSchemaSource:"direct",checkpointPathSchemaRef:"",checkpointPathVolumeName:""})),className:`px-2 py-1 text-xs rounded ${e.checkpointPathSchemaSource==="direct"?"bg-blue-500/30 text-blue-300":"bg-slate-700 text-slate-400"}`,children:"Select"})]})]}),e.checkpointPathSchemaSource==="reference"?t.jsx(ae,{value:e.checkpointPathSchemaRef,onChange:d=>{const g=d.target.value,v=a[g];s(S=>({...S,checkpointPathSchemaRef:g,checkpointPathVolumeCatalog:ke(v==null?void 0:v.catalog_name),checkpointPathVolumeSchema:ke(v==null?void 0:v.schema_name),checkpointPathVolumeName:""}))},options:[{value:"",label:"Select configured schema..."},...n],hint:"Select a previously configured schema"}):t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx(ae,{value:e.checkpointPathVolumeCatalog,onChange:d=>s(g=>({...g,checkpointPathVolumeCatalog:d.target.value,checkpointPathVolumeSchema:"",checkpointPathVolumeName:""})),options:[{value:"",label:"Catalog..."},...(i||[]).map(d=>({value:d.name,label:d.name}))]}),t.jsx(ae,{value:e.checkpointPathVolumeSchema,onChange:d=>s(g=>({...g,checkpointPathVolumeSchema:d.target.value,checkpointPathVolumeName:""})),options:[{value:"",label:"Schema..."},...(m||[]).map(d=>({value:d.name,label:d.name}))],disabled:!e.checkpointPathVolumeCatalog})]}),t.jsx(ae,{label:"Volume",value:e.checkpointPathVolumeName,onChange:d=>s(g=>({...g,checkpointPathVolumeName:d.target.value})),options:[{value:"",label:r?"Loading volumes...":"Select volume..."},...(h||[]).map(d=>({value:d.name,label:d.name}))],disabled:!e.checkpointPathVolumeSchema||r,hint:"Select a volume from the schema"}),t.jsx(U,{label:"Path",value:e.checkpointPathPath,onChange:d=>s(g=>({...g,checkpointPathPath:d.target.value})),placeholder:"/path/to/checkpoints",hint:"Path within the volume for vector index checkpoints"})]})]})]})}function Xg({showForm:e,setShowForm:s,editingKey:a,setEditingKey:n,onClose:i}){var he,J,oe;const{config:l,addVectorStore:o,updateVectorStore:u,removeVectorStore:m}=nt(),h=((he=l.resources)==null?void 0:he.vector_stores)||{},r=((J=l.resources)==null?void 0:J.llms)||{},c=l.schemas||{},d=((oe=l.resources)==null?void 0:oe.volumes)||{},g=l.variables||{},v=l.service_principals||{},{data:S,loading:y,refetch:b}=Mm(),{data:_}=en(),[x,f]=A.useState(ul),[C,w]=A.useState(""),{data:I}=ea(x.index_catalog||null),{data:R}=ea(x.source_catalog||null),{data:k,loading:D}=Xl(x.source_catalog||null,x.source_schema||null),{data:L,loading:V}=Xl(x.index_catalog||null,x.index_schema||null),{data:B,loading:T,refetch:F}=Ng(x.source_catalog||null,x.source_schema||null,x.source_table||null),E=(B||[]).map(X=>({value:X.name,label:`${X.name}${X.type_text?` (${X.type_text})`:""}`}));A.useEffect(()=>{if(B&&B.length>0&&!C){const X=B.map(Z=>Z.name).join(", ");w(X)}},[B]);const[$,p]=A.useState(!1);A.useEffect(()=>{S&&x.endpoint_name&&!$&&a&&(S.some(Z=>Z.name===x.endpoint_name)&&x.endpointSource==="manual"&&f(Z=>({...Z,endpointSource:"select"})),p(!0))},[S,x.endpoint_name,$,a]),A.useEffect(()=>{e||p(!1)},[e]),Ql(x.endpoint_name||null);const{data:N}=ea(x.sourcePathVolumeCatalog||null),{data:P,loading:M}=Jl(x.sourcePathVolumeCatalog||null,x.sourcePathVolumeSchema||null),{data:O}=ea(x.checkpointPathVolumeCatalog||null),{data:W,loading:q}=Jl(x.checkpointPathVolumeCatalog||null,x.checkpointPathVolumeSchema||null),ce=Object.entries(c).map(([X,Z])=>({value:X,label:`${X} (${Z.catalog_name}.${Z.schema_name})`})),se=X=>{var me,Re,st,it,rt,tt,ze,Le,Ke,Ne,et,lt,ot,ve,Xe,qe,ct,At,Qt,zt,yt,_t,Pt,Kt,re,fe,Me;pa(X);const Z=h[X];if(Z){const we=Object.entries(c).find(([Oe,xt])=>{var wt,St,Ce,Ye;return xt.catalog_name===((St=(wt=Z.index)==null?void 0:wt.schema)==null?void 0:St.catalog_name)&&xt.schema_name===((Ye=(Ce=Z.index)==null?void 0:Ce.schema)==null?void 0:Ye.schema_name)}),We=Object.entries(c).find(([Oe,xt])=>{var wt,St,Ce,Ye;return xt.catalog_name===((St=(wt=Z.source_table)==null?void 0:wt.schema)==null?void 0:St.catalog_name)&&xt.schema_name===((Ye=(Ce=Z.source_table)==null?void 0:Ce.schema)==null?void 0:Ye.schema_name)}),He=Z.source_path;let bt=!1,Qe="direct",dt="",Zt="",ms="",j="",Y="";if(He!=null&&He.volume){bt=!0,Y=He.path||"";let Oe="",xt="",wt="";if(typeof He.volume=="string"){const Ce=Lt(He.volume),Ye=Ce.startsWith("*")?Ce.slice(1):Ce,ut=d[Ye];ut&&(Oe=ke((me=ut.schema)==null?void 0:me.catalog_name),xt=ke((Re=ut.schema)==null?void 0:Re.schema_name),wt=ut.name)}else Oe=ke((it=(st=He.volume)==null?void 0:st.schema)==null?void 0:it.catalog_name),xt=ke((tt=(rt=He.volume)==null?void 0:rt.schema)==null?void 0:tt.schema_name),wt=((ze=He.volume)==null?void 0:ze.name)||"";const St=Object.entries(c).find(([Ce,Ye])=>ke(Ye.catalog_name)===Oe&&ke(Ye.schema_name)===xt);St?(Qe="reference",dt=St[0]):Qe="direct",Zt=Oe,ms=xt,j=wt}const Q=Z.checkpoint_path;let xe=!1,Ee="direct",Ge="",De="",Pe="",Be="",Ss="";if(Q!=null&&Q.volume){xe=!0,Ss=Q.path||"";let Oe="",xt="",wt="";if(typeof Q.volume=="string"){const Ce=Lt(Q.volume),Ye=Ce.startsWith("*")?Ce.slice(1):Ce,ut=d[Ye];ut&&(Oe=ke((Le=ut.schema)==null?void 0:Le.catalog_name),xt=ke((Ke=ut.schema)==null?void 0:Ke.schema_name),wt=ut.name)}else Oe=ke((et=(Ne=Q.volume)==null?void 0:Ne.schema)==null?void 0:et.catalog_name),xt=ke((ot=(lt=Q.volume)==null?void 0:lt.schema)==null?void 0:ot.schema_name),wt=((ve=Q.volume)==null?void 0:ve.name)||"";const St=Object.entries(c).find(([Ce,Ye])=>ke(Ye.catalog_name)===Oe&&ke(Ye.schema_name)===xt);St?(Ee="reference",Ge=St[0]):Ee="direct",De=Oe,Pe=xt,Be=wt}const Cs=Z.source_table?"provision":"use_existing",ns=((Xe=Z.endpoint)==null?void 0:Xe.name)||"",ks=ns&&(S==null?void 0:S.some(Oe=>Oe.name===ns));f({refName:X,configMode:Cs,endpointSource:ns&&!ks?"manual":"select",endpoint_name:ns,endpoint_type:((qe=Z.endpoint)==null?void 0:qe.type)||"STANDARD",indexSchemaSource:we?"reference":"direct",indexSchemaRefName:we?we[0]:"",index_catalog:ke((At=(ct=Z.index)==null?void 0:ct.schema)==null?void 0:At.catalog_name),index_schema:ke((zt=(Qt=Z.index)==null?void 0:Qt.schema)==null?void 0:zt.schema_name),indexNameSource:"select",index_name:((yt=Z.index)==null?void 0:yt.name)||"",sourceSchemaSource:We?"reference":"direct",sourceSchemaRefName:We?We[0]:"",source_catalog:ke((Pt=(_t=Z.source_table)==null?void 0:_t.schema)==null?void 0:Pt.catalog_name),source_schema:ke((re=(Kt=Z.source_table)==null?void 0:Kt.schema)==null?void 0:re.schema_name),source_table:((fe=Z.source_table)==null?void 0:fe.name)||"",primary_key:Z.primary_key||"",embedding_source_column:Z.embedding_source_column||"",columns:Z.columns||[],doc_uri:Z.doc_uri||"",embedding_model:((Me=Z.embedding_model)==null?void 0:Me.name)||"databricks-gte-large-en",sourcePathEnabled:bt,sourcePathSchemaSource:Qe,sourcePathSchemaRef:dt,sourcePathVolumeCatalog:Zt,sourcePathVolumeSchema:ms,sourcePathVolumeName:j,sourcePathPath:Y,checkpointPathEnabled:xe,checkpointPathSchemaSource:Ee,checkpointPathSchemaRef:Ge,checkpointPathVolumeCatalog:De,checkpointPathVolumeSchema:Pe,checkpointPathVolumeName:Be,checkpointPathPath:Ss,...vn(Z,gs,Lt,v)}),w((Z.columns||[]).join(", ")),n(X),s(!0)}},H=X=>{Gt("Vector Store",X,()=>m(X))},z=()=>{const X=C.split(",").map(me=>me.trim()).filter(me=>me),Z={on_behalf_of_user:x.on_behalf_of_user||void 0};if(yn(Z,x),x.configMode==="use_existing")Z.index={schema:{catalog_name:x.index_catalog,schema_name:x.index_schema},name:x.index_name},x.primary_key&&(Z.primary_key=x.primary_key),X.length>0&&(Z.columns=X);else{if(Z.embedding_source_column=x.embedding_source_column,Z.primary_key=x.primary_key||void 0,Z.columns=X.length>0?X:void 0,Z.doc_uri=x.doc_uri||void 0,x.source_table&&x.source_catalog&&x.source_schema&&(Z.source_table={schema:{catalog_name:x.source_catalog,schema_name:x.source_schema},name:x.source_table}),x.endpoint_name&&(Z.endpoint={name:x.endpoint_name,type:x.endpoint_type}),(x.index_name||x.index_catalog||x.index_schema)&&(Z.index={schema:{catalog_name:x.index_catalog||x.source_catalog,schema_name:x.index_schema||x.source_schema},name:x.index_name||`${x.source_table}_index`}),x.embedding_model&&(Z.embedding_model={name:x.embedding_model}),x.sourcePathEnabled&&x.sourcePathVolumeName){const me={volume:{...x.sourcePathSchemaSource==="reference"&&x.sourcePathSchemaRef?{_schemaRef:x.sourcePathSchemaRef}:{schema:{catalog_name:x.sourcePathVolumeCatalog,schema_name:x.sourcePathVolumeSchema}},name:x.sourcePathVolumeName}};x.sourcePathPath&&(me.path=x.sourcePathPath),Z.source_path=me}if(x.checkpointPathEnabled&&x.checkpointPathVolumeName){const me={volume:{...x.checkpointPathSchemaSource==="reference"&&x.checkpointPathSchemaRef?{_schemaRef:x.checkpointPathSchemaRef}:{schema:{catalog_name:x.checkpointPathVolumeCatalog,schema_name:x.checkpointPathVolumeSchema}},name:x.checkpointPathVolumeName}};x.checkpointPathPath&&(me.path=x.checkpointPathPath),Z.checkpoint_path=me}}a?a!==x.refName?(m(a),o(x.refName,Z)):u(a,Z):o(x.refName,Z),s(!1),n(null),f(ul),w(""),i()},te=[{value:"",label:y?"Loading...":"Select an endpoint..."},...(S||[]).map(X=>{var Re;const Z=(Re=X.endpoint_status)==null?void 0:Re.state;let me="unknown";return Z==="ONLINE"?me="ready":Z==="PROVISIONING"||Z==="SCALING"?me="transitioning":(Z==="OFFLINE"||Z==="FAILED")&&(me="stopped"),{value:X.name,label:X.name,status:me}})],K=[{value:"",label:"Select embedding model..."},{value:"databricks-gte-large-en",label:"GTE Large (Embeddings)"},{value:"databricks-bge-large-en",label:"BGE Large (Embeddings)"},...Object.entries(r).map(([X,Z])=>({value:Z.name,label:`${X} (${Z.name})`}))];return t.jsxs($e,{className:"p-5",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(xs,{className:"w-5 h-5 text-violet-400"}),t.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Vector Stores"})]}),t.jsxs(ee,{variant:"secondary",size:"sm",onClick:()=>{const X=Object.keys(c).length>0;f({...ul,indexSchemaSource:X?"reference":"direct",sourceSchemaSource:X?"reference":"direct",sourcePathSchemaSource:X?"reference":"direct",checkpointPathSchemaSource:X?"reference":"direct"}),w(""),n(null),s(!0)},children:[t.jsx(Ie,{className:"w-4 h-4 mr-1"}),"Add Vector Store"]})]}),Object.keys(h).length>0&&t.jsx("div",{className:"space-y-2 mb-4",children:Object.entries(h).map(([X,Z])=>{var me,Re;return t.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800/50 rounded-lg border border-slate-700 cursor-pointer hover:bg-slate-800/70 transition-colors",onClick:()=>se(X),children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(xs,{className:"w-4 h-4 text-violet-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-slate-200",children:X}),t.jsxs("p",{className:"text-xs text-slate-500",children:[((me=Z.endpoint)==null?void 0:me.name)||"No endpoint","  ",((Re=Z.index)==null?void 0:Re.name)||"No index"]})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[Z.on_behalf_of_user&&t.jsxs(Se,{variant:"success",title:"On Behalf of User",children:[t.jsx(Os,{className:"w-3 h-3 mr-1"}),"OBO"]}),!Z.on_behalf_of_user&&Z.service_principal&&t.jsxs(Se,{variant:"info",title:"Service Principal",children:[t.jsx(Mt,{className:"w-3 h-3 mr-1"}),"SP"]}),!Z.on_behalf_of_user&&(Z.client_id||Z.client_secret)&&t.jsxs(Se,{variant:"warning",title:"OAuth2 / M2M",children:[t.jsx(Mt,{className:"w-3 h-3 mr-1"}),"OAuth"]}),!Z.on_behalf_of_user&&Z.pat&&t.jsxs(Se,{variant:"default",title:"Personal Access Token",children:[t.jsx(Mt,{className:"w-3 h-3 mr-1"}),"PAT"]}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:st=>{st.stopPropagation(),se(X)},children:t.jsx(ds,{className:"w-4 h-4"})}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:st=>{st.stopPropagation(),H(X)},children:t.jsx(Ze,{className:"w-4 h-4 text-red-400"})})]})]},X)})}),Object.keys(h).length===0&&!e&&t.jsx("p",{className:"text-slate-500 text-sm",children:"No vector stores configured. Add a vector store to enable semantic search."}),e&&t.jsxs("div",{className:"mt-4 p-4 bg-slate-800/50 rounded-lg border border-slate-700 space-y-4",children:[t.jsxs("h4",{className:"font-medium text-slate-200",children:[a?"Edit":"New"," Vector Store"]}),t.jsx(U,{label:"Reference Name",value:x.refName,onChange:X=>f({...x,refName:Ot(X.target.value)}),placeholder:"Products Vector Store",hint:"Type naturally - spaces become underscores",required:!0}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Configuration Mode"}),t.jsxs("div",{className:"inline-flex rounded-lg bg-slate-900/50 p-0.5",children:[t.jsx("button",{type:"button",onClick:()=>f({...x,configMode:"use_existing"}),className:`px-3 py-1 text-xs rounded-md font-medium transition-all duration-150 ${x.configMode==="use_existing"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Use Existing"}),t.jsx("button",{type:"button",onClick:()=>f({...x,configMode:"provision",embedding_model:x.embedding_model||"databricks-gte-large-en"}),className:`px-3 py-1 text-xs rounded-md font-medium transition-all duration-150 ${x.configMode==="provision"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Provision New"})]})]}),t.jsx("p",{className:"text-xs text-slate-500",children:x.configMode==="use_existing"?"Reference an existing vector search index":"Create a new index from a source table"})]}),x.configMode==="provision"&&t.jsxs("div",{className:"space-y-3 p-3 bg-slate-900/50 rounded border border-slate-600",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("p",{className:"text-sm text-slate-300 font-medium",children:["Vector Search Endpoint ",t.jsx("span",{className:"text-slate-500 font-normal",children:"(Optional)"})]}),t.jsx("p",{className:"text-xs text-slate-500",children:"Auto-detected if not specified"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{type:"button",onClick:()=>f({...x,endpointSource:"select"}),className:`text-xs px-2 py-1 rounded ${x.endpointSource==="select"?"bg-blue-500/30 text-blue-300":"text-slate-400 hover:text-white"}`,children:"Select"}),t.jsx("button",{type:"button",onClick:()=>f({...x,endpointSource:"manual"}),className:`text-xs px-2 py-1 rounded ${x.endpointSource==="manual"?"bg-blue-500/30 text-blue-300":"text-slate-400 hover:text-white"}`,children:"Manual"}),x.endpointSource==="select"&&t.jsxs("button",{type:"button",onClick:()=>b(),className:"text-xs text-slate-400 hover:text-white flex items-center space-x-1",disabled:y,children:[t.jsx(Ut,{className:`w-3 h-3 ${y?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]})]})]}),x.endpointSource==="select"?t.jsx($r,{options:te,value:x.endpoint_name,onChange:X=>{const Z=S==null?void 0:S.find(Re=>Re.name===X),me=(Z==null?void 0:Z.endpoint_type)==="OPTIMIZED_STORAGE"?"OPTIMIZED_STORAGE":"STANDARD";f({...x,endpoint_name:X,endpoint_type:X?me:x.endpoint_type})},placeholder:"Select an endpoint (or leave empty for auto-detection)..."}):t.jsx(U,{label:"",placeholder:"Enter endpoint name...",value:x.endpoint_name,onChange:X=>f({...x,endpoint_name:X.target.value})}),t.jsx(ae,{label:"Endpoint Type",value:x.endpoint_type,onChange:X=>f({...x,endpoint_type:X.target.value}),options:[{value:"STANDARD",label:"Standard"},{value:"OPTIMIZED_STORAGE",label:"Optimized Storage"}],hint:x.endpointSource==="select"&&x.endpoint_name?"Auto-detected from selected endpoint":"Only used if endpoint is specified",disabled:x.endpointSource==="select"&&!!x.endpoint_name})]}),t.jsxs("div",{className:"space-y-3 p-3 bg-slate-900/50 rounded border border-slate-600",children:[t.jsxs("div",{children:[t.jsxs("p",{className:"text-sm text-slate-300 font-medium",children:["Vector Search Index",x.configMode==="use_existing"&&t.jsx("span",{className:"text-red-400 font-normal ml-1",children:"(Required)"}),x.configMode==="provision"&&t.jsx("span",{className:"text-slate-500 font-normal ml-1",children:"(Optional - auto-generated)"})]}),t.jsx("p",{className:"text-xs text-slate-500",children:x.configMode==="use_existing"?"Select the existing vector search index to use":"Optionally specify a custom index name, or leave empty to auto-generate from source table"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Index Schema"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs("button",{type:"button",onClick:()=>f({...x,indexSchemaSource:"reference"}),className:`px-2 py-1 text-xs rounded flex items-center space-x-1 ${x.indexSchemaSource==="reference"?"bg-purple-500/30 text-purple-300":"bg-slate-700 text-slate-400"}`,children:[t.jsx(xs,{className:"w-3 h-3"}),t.jsx("span",{children:"Configured"})]}),t.jsx("button",{type:"button",onClick:()=>f({...x,indexSchemaSource:"direct"}),className:`px-2 py-1 text-xs rounded ${x.indexSchemaSource==="direct"?"bg-blue-500/30 text-blue-300":"bg-slate-700 text-slate-400"}`,children:"Select"})]})]}),x.indexSchemaSource==="reference"?t.jsxs("div",{className:"space-y-2",children:[t.jsx(ae,{value:x.indexSchemaRefName,onChange:X=>{const Z=X.target.value,me=c[Z];f({...x,indexSchemaRefName:Z,index_catalog:ke(me==null?void 0:me.catalog_name),index_schema:ke(me==null?void 0:me.schema_name)})},options:[{value:"",label:"Select configured schema..."},...ce]}),ce.length===0&&t.jsx("p",{className:"text-xs text-amber-400",children:'No schemas configured. Add one in Schemas section or switch to "Select".'})]}):t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsx(ae,{label:"Catalog",value:x.index_catalog,onChange:X=>f({...x,index_catalog:X.target.value,index_schema:"",indexSchemaRefName:""}),options:[{value:"",label:"Select catalog..."},...(_||[]).map(X=>({value:X.name,label:X.name}))]}),t.jsx(ae,{label:"Schema",value:x.index_schema,onChange:X=>f({...x,index_schema:X.target.value,indexSchemaRefName:""}),options:[{value:"",label:"Select schema..."},...(I||[]).map(X=>({value:X.name,label:X.name}))],disabled:!x.index_catalog})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Index Name"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{type:"button",onClick:()=>f({...x,indexNameSource:"select"}),className:`px-2 py-1 text-xs rounded ${x.indexNameSource==="select"?"bg-blue-500/30 text-blue-300":"bg-slate-700 text-slate-400"}`,children:"Select"}),t.jsx("button",{type:"button",onClick:()=>f({...x,indexNameSource:"manual"}),className:`px-2 py-1 text-xs rounded ${x.indexNameSource==="manual"?"bg-blue-500/30 text-blue-300":"bg-slate-700 text-slate-400"}`,children:"Manual"})]})]}),x.indexNameSource==="select"?t.jsx(ae,{value:x.index_name,onChange:X=>{const Z=X.target.value;f(me=>({...me,index_name:Z,refName:a?me.refName:Z?vt(Z):me.refName}))},options:[{value:"",label:V?"Loading tables...":"Select a table..."},...(L||[]).map(X=>({value:X.name,label:X.name}))],disabled:!x.index_catalog||!x.index_schema||V,hint:"Select a table from the index schema"}):t.jsx(U,{value:x.index_name,onChange:X=>f({...x,index_name:X.target.value}),placeholder:"products_index",hint:"Enter a custom index name"})]})]}),x.configMode==="provision"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"space-y-3 p-3 bg-slate-900/50 rounded border border-slate-600",children:[t.jsxs("div",{children:[t.jsxs("p",{className:"text-sm text-slate-300 font-medium",children:["Source Table ",t.jsx("span",{className:"text-red-400 font-normal",children:"(Required)"})]}),t.jsx("p",{className:"text-xs text-slate-500",children:"The table containing data to be indexed"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Source Schema"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs("button",{type:"button",onClick:()=>f({...x,sourceSchemaSource:"reference"}),className:`px-2 py-1 text-xs rounded flex items-center space-x-1 ${x.sourceSchemaSource==="reference"?"bg-purple-500/30 text-purple-300":"bg-slate-700 text-slate-400"}`,children:[t.jsx(xs,{className:"w-3 h-3"}),t.jsx("span",{children:"Configured"})]}),t.jsx("button",{type:"button",onClick:()=>f({...x,sourceSchemaSource:"direct"}),className:`px-2 py-1 text-xs rounded ${x.sourceSchemaSource==="direct"?"bg-blue-500/30 text-blue-300":"bg-slate-700 text-slate-400"}`,children:"Select"})]})]}),x.sourceSchemaSource==="reference"?t.jsxs("div",{className:"space-y-2",children:[t.jsx(ae,{value:x.sourceSchemaRefName,onChange:X=>{const Z=X.target.value,me=c[Z];f({...x,sourceSchemaRefName:Z,source_catalog:ke(me==null?void 0:me.catalog_name),source_schema:ke(me==null?void 0:me.schema_name),source_table:"",embedding_source_column:"",primary_key:"",doc_uri:"",columns:[]}),w("")},options:[{value:"",label:"Select configured schema..."},...ce]}),ce.length===0&&t.jsx("p",{className:"text-xs text-amber-400",children:'No schemas configured. Add one in Schemas section or switch to "Select".'})]}):t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsx(ae,{label:"Catalog",value:x.source_catalog,onChange:X=>{f({...x,source_catalog:X.target.value,source_schema:"",source_table:"",sourceSchemaRefName:"",embedding_source_column:"",primary_key:"",doc_uri:"",columns:[]}),w("")},options:[{value:"",label:"Select catalog..."},...(_||[]).map(X=>({value:X.name,label:X.name}))]}),t.jsx(ae,{label:"Schema",value:x.source_schema,onChange:X=>{f({...x,source_schema:X.target.value,source_table:"",sourceSchemaRefName:"",embedding_source_column:"",primary_key:"",doc_uri:"",columns:[]}),w("")},options:[{value:"",label:"Select schema..."},...(R||[]).map(X=>({value:X.name,label:X.name}))],disabled:!x.source_catalog})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"flex-1",children:t.jsx(ae,{label:"Table",value:x.source_table,onChange:X=>{f({...x,source_table:X.target.value,embedding_source_column:"",primary_key:"",doc_uri:"",columns:[]}),w("")},options:[{value:"",label:D?"Loading...":"Select table..."},...(k||[]).map(X=>({value:X.name,label:X.name}))],disabled:!x.source_schema&&!x.sourceSchemaRefName||D})}),x.source_table&&t.jsxs("button",{type:"button",onClick:()=>F(),className:"mt-6 text-xs text-slate-400 hover:text-white flex items-center space-x-1",disabled:T,children:[t.jsx(Ut,{className:`w-3 h-3 ${T?"animate-spin":""}`}),t.jsx("span",{children:"Refresh Columns"})]})]}),x.source_table&&t.jsxs("div",{className:"space-y-2 mt-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-slate-300 font-medium",children:"Columns to Sync"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Select columns to include in the vector index"})]}),T&&t.jsxs("span",{className:"text-xs text-slate-400 flex items-center space-x-1",children:[t.jsx(Nt,{className:"w-3 h-3 animate-spin"}),t.jsx("span",{children:"Loading..."})]})]}),E.length>0?t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"flex flex-wrap gap-2 max-h-40 overflow-y-auto p-2 bg-slate-800/50 rounded border border-slate-700",children:E.map(X=>{const Z=C.split(",").map(me=>me.trim()).includes(X.value);return t.jsx("button",{type:"button",onClick:()=>{const me=C.split(",").map(Re=>Re.trim()).filter(Re=>Re);w(Z?me.filter(Re=>Re!==X.value).join(", "):[...me,X.value].join(", "))},className:`px-2 py-1 text-xs rounded transition-colors ${Z?"bg-blue-500/30 text-blue-300 border border-blue-500/50":"bg-slate-700 text-slate-400 hover:bg-slate-600"}`,children:X.value},X.value)})}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("p",{className:"text-xs text-slate-500",children:["Selected: ",C.split(",").filter(X=>X.trim()).length||0," of ",E.length]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{type:"button",onClick:()=>w(E.map(X=>X.value).join(", ")),className:"text-xs text-blue-400 hover:text-blue-300",children:"Select All"}),t.jsx("button",{type:"button",onClick:()=>w(""),className:"text-xs text-slate-400 hover:text-slate-300",children:"Clear All"})]})]})]}):t.jsx(U,{label:"",value:C,onChange:X=>w(X.target.value),placeholder:"id, name, description, category",hint:"Enter comma-separated column names"})]})]}),t.jsxs("div",{className:"space-y-3 p-3 bg-slate-900/50 rounded border border-slate-600",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("p",{className:"text-sm text-slate-300 font-medium",children:"Embedding Configuration"}),T&&t.jsxs("span",{className:"text-xs text-slate-400 flex items-center space-x-1",children:[t.jsx(Nt,{className:"w-3 h-3 animate-spin"}),t.jsx("span",{children:"Loading columns..."})]})]}),t.jsx(ae,{label:"Embedding Model",value:x.embedding_model,onChange:X=>f({...x,embedding_model:X.target.value}),options:K,hint:"Model used to create embeddings"}),t.jsx(ae,{label:"Embedding Source Column",value:x.embedding_source_column,onChange:X=>f({...x,embedding_source_column:X.target.value}),options:[{value:"",label:T?"Loading columns...":E.length>0?"Select column...":"Select a table first..."},...E],hint:"Column containing text to embed (typically text/string columns)",disabled:!x.source_table||T}),t.jsx(ae,{label:"Primary Key",value:x.primary_key,onChange:X=>f({...x,primary_key:X.target.value}),options:[{value:"",label:T?"Loading columns...":E.length>0?"Select primary key column...":"Select a table first..."},...E],hint:"Primary key column for the source table",disabled:!x.source_table||T})]}),t.jsx(ae,{label:"Document URI Column (Optional)",value:x.doc_uri,onChange:X=>f({...x,doc_uri:X.target.value}),options:[{value:"",label:E.length>0?"None (no document URIs)":"Select a table first..."},...E],hint:"Column containing document URIs for linking",disabled:!x.source_table||T}),t.jsx(Kg,{formData:x,setFormData:f,configuredSchemas:c,configuredSchemaOptions:ce,catalogs:_,sourcePathSchemas:N,sourcePathVolumes:P,sourcePathVolumesLoading:M,checkpointPathSchemas:O,checkpointPathVolumes:W,checkpointPathVolumesLoading:q})]}),t.jsx(bn,{formData:x,setFormData:f,variables:g,servicePrincipals:v,variableNames:Object.keys(g)}),x.refName&&Dt(x.refName,l,a)&&t.jsxs("div",{className:"p-3 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm",children:['A resource with reference name "',x.refName,'" already exists. Please choose a unique name.']}),t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx(ee,{variant:"secondary",onClick:i,children:"Cancel"}),t.jsx(ee,{onClick:z,disabled:!x.refName||Dt(x.refName,l,a)||(x.configMode==="use_existing"?!x.index_name||!x.index_catalog||!x.index_schema:!x.source_table||!x.embedding_source_column),children:a?"Update":"Add"})]})]})]})}function Jg({showForm:e,setShowForm:s,editingKey:a,setEditingKey:n,onClose:i}){var x;const{config:l,addDatabricksApp:o,updateDatabricksApp:u,removeDatabricksApp:m}=nt(),h=((x=l.resources)==null?void 0:x.apps)||{},r=l.variables||{},c=l.service_principals||{},[d,g]=A.useState("select"),[v,S]=A.useState({refName:"",name:"",on_behalf_of_user:!1,authMethod:"default",servicePrincipalRef:"",clientIdSource:"variable",clientSecretSource:"variable",workspaceHostSource:"variable",patSource:"variable",client_id:"",client_secret:"",workspace_host:"",pat:"",clientIdVariable:"",clientSecretVariable:"",workspaceHostVariable:"",patVariable:""}),y=f=>{pa(f);const C=h[f],w=vn(C,gs,Lt,c);S({refName:f,name:C.name,...w}),n(f),s(!0)},b=()=>{const f={name:v.name,on_behalf_of_user:v.on_behalf_of_user};yn(f,v),a?a!==v.refName?(m(a),o(v.refName,f)):u(v.refName,f):o(v.refName,f),S({refName:"",name:"",on_behalf_of_user:!1,authMethod:"default",servicePrincipalRef:"",clientIdSource:"variable",clientSecretSource:"variable",workspaceHostSource:"variable",patSource:"variable",client_id:"",client_secret:"",workspace_host:"",pat:"",clientIdVariable:"",clientSecretVariable:"",workspaceHostVariable:"",patVariable:""}),i()},_=f=>{Gt("Databricks App",f,()=>m(f))};return t.jsxs($e,{className:"p-5",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Tl,{className:"w-5 h-5 text-purple-400"}),t.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Databricks Apps"})]}),t.jsxs(ee,{variant:"secondary",size:"sm",onClick:()=>{S({refName:"",name:"",on_behalf_of_user:!1,authMethod:"default",servicePrincipalRef:"",clientIdSource:"variable",clientSecretSource:"variable",workspaceHostSource:"variable",patSource:"variable",client_id:"",client_secret:"",workspace_host:"",pat:"",clientIdVariable:"",clientSecretVariable:"",workspaceHostVariable:"",patVariable:""}),n(null),s(!0)},children:[t.jsx(Ie,{className:"w-4 h-4 mr-1"}),"Add App"]})]}),t.jsx("div",{className:"mb-4 p-3 bg-purple-900/20 border border-purple-500/30 rounded-lg",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(Ka,{className:"w-4 h-4 text-purple-400 mt-0.5 flex-shrink-0"}),t.jsx("p",{className:"text-sm text-purple-300/80",children:"Databricks Apps allow your agents to interact with deployed applications. Configure the app instance name to enable app-to-app communication. The URL is automatically retrieved from the workspace at runtime."})]})}),Object.keys(h).length>0&&t.jsx("div",{className:"space-y-2 mb-4",children:Object.entries(h).map(([f,C])=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800/50 rounded-lg border border-slate-700 cursor-pointer hover:bg-slate-800/70 transition-colors",onClick:()=>y(f),children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Tl,{className:"w-4 h-4 text-purple-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-slate-200",children:f}),t.jsxs("p",{className:"text-xs text-slate-500",children:["App: ",C.name]})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[C.on_behalf_of_user&&t.jsxs(Se,{variant:"success",title:"On Behalf of User",children:[t.jsx(Os,{className:"w-3 h-3 mr-1"}),"OBO"]}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:w=>{w.stopPropagation(),y(f)},children:t.jsx(ds,{className:"w-4 h-4"})}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:w=>{w.stopPropagation(),_(f)},children:t.jsx(Ze,{className:"w-4 h-4 text-red-400"})})]})]},f))}),Object.keys(h).length===0&&!e&&t.jsx("p",{className:"text-slate-500 text-sm",children:"No Databricks Apps configured."}),e&&t.jsxs("div",{className:"mt-4 p-4 bg-slate-800/50 rounded-lg border border-slate-700 space-y-4",children:[t.jsxs("h4",{className:"font-medium text-slate-200",children:[a?"Edit":"New"," Databricks App"]}),t.jsx(U,{label:"Reference Name",value:v.refName,onChange:f=>S({...v,refName:Ot(f.target.value)}),placeholder:"my_databricks_app",hint:"Type naturally - spaces become underscores",required:!0}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("label",{className:"text-sm font-medium text-slate-300",children:["App Instance Name ",t.jsx("span",{className:"text-red-400",children:"*"})]}),t.jsxs("div",{className:"inline-flex rounded-md bg-slate-900/50 p-0.5",children:[t.jsxs("button",{type:"button",onClick:()=>g("select"),className:`px-2 py-0.5 text-xs rounded font-medium transition-all ${d==="select"?"bg-blue-500/20 text-blue-400 border border-blue-500/40":"text-slate-400 hover:text-slate-300"}`,children:[t.jsx($t,{className:"w-3 h-3 inline mr-1"}),"Select"]}),t.jsxs("button",{type:"button",onClick:()=>g("manual"),className:`px-2 py-0.5 text-xs rounded font-medium transition-all ${d==="manual"?"bg-purple-500/20 text-purple-400 border border-purple-500/40":"text-slate-400 hover:text-slate-300"}`,children:[t.jsx(Lr,{className:"w-3 h-3 inline mr-1"}),"Manual"]})]})]}),d==="select"?t.jsx(Rm,{label:"",value:v.name,onChange:f=>{S({...v,name:f,refName:v.refName||vt(f)})},placeholder:"Select a Databricks App",hint:"Select an app from your workspace. The URL is retrieved automatically at runtime.",required:!0}):t.jsx(U,{value:v.name,onChange:f=>{S({...v,name:f.target.value,refName:v.refName||vt(f.target.value)})},placeholder:"my-databricks-app",hint:"Enter the unique name of the Databricks App in your workspace."})]}),t.jsx(bn,{formData:v,setFormData:f=>S({...v,...f}),servicePrincipals:c,variables:r,variableNames:Object.keys(r)}),v.refName&&Dt(v.refName,l,a)&&t.jsxs("div",{className:"p-3 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm",children:['A resource with reference name "',v.refName,'" already exists. Please choose a unique name.']}),t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx(ee,{variant:"secondary",onClick:i,children:"Cancel"}),t.jsx(ee,{onClick:b,disabled:!v.refName||!v.name||Dt(v.refName,l,a),children:a?"Update":"Add"})]})]})]})}const Jt=A.forwardRef(({className:e,label:s,error:a,hint:n,id:i,...l},o)=>{const u=i||(s==null?void 0:s.toLowerCase().replace(/\s+/g,"-"));return t.jsxs("div",{className:"space-y-1.5",children:[s&&t.jsxs("label",{htmlFor:u,className:"block text-sm font-medium text-slate-300",children:[s,l.required&&t.jsx("span",{className:"text-red-400 ml-1",children:"*"})]}),t.jsx("textarea",{ref:o,id:u,className:pt("w-full px-3 py-2 bg-slate-800/50 border rounded-lg text-slate-200 placeholder-slate-500","focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500","transition-all duration-200 resize-none font-mono text-sm",a?"border-red-500/50":"border-slate-700",e),...l}),n&&!a&&t.jsx("p",{className:"text-xs text-slate-500",children:n}),a&&t.jsx("p",{className:"text-xs text-red-400",children:a})]})});Jt.displayName="Textarea";const Qg=[{value:"",label:"= (equals)"},{value:" NOT",label:"!= (not equals)"},{value:" <",label:"< (less than)"},{value:" <=",label:"<= (less or equal)"},{value:" >",label:"> (greater than)"},{value:" >=",label:">= (greater or equal)"},{value:" LIKE",label:"LIKE (pattern match)"}];function ed(){return`filter_${Date.now()}_${Math.random().toString(36).substring(2,11)}`}const Zg=[{value:"",label:"None (use Databricks columns reranking only)"},{value:"ms-marco-TinyBERT-L-2-v2",label:"TinyBERT L-2 (~4MB, fastest)"},{value:"ms-marco-MiniLM-L-12-v2",label:"MiniLM L-12 (~34MB, best cross-encoder, recommended)"},{value:"rank-T5-flan",label:"T5-flan (~110MB, best non cross-encoder)"},{value:"ms-marco-MultiBERT-L-12",label:"MultiBERT L-12 (~150MB, 100+ languages)"},{value:"ce-esci-MiniLM-L12-v2",label:"ESCI MiniLM L-12 (e-commerce optimized)"},{value:"miniReranker_arabic_v1",label:"Arabic Reranker (Arabic language)"}],eb=[{value:"ANN",label:"ANN (Approximate Nearest Neighbor)"},{value:"HYBRID",label:"Hybrid"}];function td(){return`col_${Date.now()}_${Math.random().toString(36).substring(2,11)}`}function sd(){return`ex_${Date.now()}_${Math.random().toString(36).substring(2,11)}`}function tb(){var ce,se;const{config:e,addRetriever:s,updateRetriever:a,removeRetriever:n}=nt(),[i,l]=A.useState(!1),[o,u]=A.useState(null),[m,h]=A.useState(!1),[r,c]=A.useState(!1),[d,g]=A.useState(!1),[v,S]=A.useState(!1),[y,b]=A.useState(!1),[_,x]=A.useState(!1),[f,C]=A.useState({refName:"",vectorStoreRef:"",columns:"",numResults:"10",queryType:"ANN",filters:[],enableRouter:!1,routerModelRef:"",routerDefaultMode:"standard",routerAutoBypass:!0,enableInstructed:!1,instructedModelRef:"",instructedColumns:[],instructedConstraints:"",instructedMaxSubqueries:"3",instructedRrfK:"60",instructedExamples:[],instructedNormalizeFilterCase:"",enableVerifier:!1,verifierModelRef:"",verifierOnFailure:"warn",verifierMaxRetries:"1",enableRerank:!1,rerankMode:"default",rerankModel:"ms-marco-MiniLM-L-12-v2",rerankTopN:"",rerankCacheDir:"~/.dao_ai/cache/flashrank",rerankColumns:"",enableInstructionAwareRerank:!1,instructionAwareModelRef:"",instructionAwareInstructions:"",instructionAwareTopN:""}),w=e.retrievers||{},I=((ce=e.resources)==null?void 0:ce.vector_stores)||{},R=((se=e.resources)==null?void 0:se.llms)||{},k=Object.keys(I).length>0,D=Object.entries(I).map(([H,z])=>({value:H,label:`${H} (${z.embedding_source_column||"no column"})`})),L=Object.entries(R).map(([H,z])=>({value:H,label:`${H} (${z.name})`})),V=()=>{C({refName:"",vectorStoreRef:"",columns:"",numResults:"10",queryType:"ANN",filters:[],enableRouter:!1,routerModelRef:"",routerDefaultMode:"standard",routerAutoBypass:!0,enableInstructed:!1,instructedModelRef:"",instructedColumns:[],instructedConstraints:"",instructedMaxSubqueries:"3",instructedRrfK:"60",instructedExamples:[],instructedNormalizeFilterCase:"",enableVerifier:!1,verifierModelRef:"",verifierOnFailure:"warn",verifierMaxRetries:"1",enableRerank:!1,rerankMode:"default",rerankModel:"ms-marco-MiniLM-L-12-v2",rerankTopN:"",rerankCacheDir:"~/.dao_ai/cache/flashrank",rerankColumns:"",enableInstructionAwareRerank:!1,instructionAwareModelRef:"",instructionAwareInstructions:"",instructionAwareTopN:""}),u(null),h(!1),c(!1),g(!1),S(!1),b(!1),x(!1)},{scrollToAsset:B}=zs(),T=H=>{if(!H)return"";if(typeof H=="string")return H.startsWith("*")?H.slice(1):H;const z=H.name;if(!z)return"";for(const[te,K]of Object.entries(R))if(K.name===z){const he=H.temperature===void 0||K.temperature===void 0||H.temperature===K.temperature,J=H.max_tokens===void 0||K.max_tokens===void 0||H.max_tokens===K.max_tokens;if(he&&J)return te}return""},F=H=>{var Kt,re,fe,Me,we,We,He,bt,Qe,dt,Zt,ms,j,Y;B(H);const z=w[H];let te="";if(z.vector_store){const Q=Object.entries(I).find(([,xe])=>{var Ee,Ge;return xe.embedding_source_column===z.vector_store.embedding_source_column&&((Ee=xe.source_table)==null?void 0:Ee.name)===((Ge=z.vector_store.source_table)==null?void 0:Ge.name)});Q&&(te=Q[0])}let K=!1,he="",J="standard",oe=!0;(Kt=z.instructed)!=null&&Kt.router&&(K=!0,he=T(z.instructed.router.model),J=z.instructed.router.default_mode||"standard",oe=z.instructed.router.auto_bypass!==!1);let X=!1,Z="",me=[],Re="",st="3",it="60",rt=[],tt="";if(z.instructed){X=!0,me=(z.instructed.columns||[]).map(xe=>{var Ee;return{id:td(),name:xe.name,type:xe.type||"string",operators:((Ee=xe.operators)==null?void 0:Ee.join(", "))||"",description:xe.description||""}}),Re=(z.instructed.constraints||[]).join(`
`);const Q=z.instructed.decomposition;Z=T(Q==null?void 0:Q.model),st=((re=Q==null?void 0:Q.max_subqueries)==null?void 0:re.toString())||"3",it=((fe=Q==null?void 0:Q.rrf_k)==null?void 0:fe.toString())||"60",rt=((Q==null?void 0:Q.examples)||[]).map(xe=>({id:sd(),query:xe.query,filters:JSON.stringify(xe.filters||{})})),tt=(Q==null?void 0:Q.normalize_filter_case)||""}let ze=!1,Le="",Ke="warn",Ne="1";(Me=z.instructed)!=null&&Me.verifier&&(ze=!0,Le=T(z.instructed.verifier.model),Ke=z.instructed.verifier.on_failure||"warn",Ne=((we=z.instructed.verifier.max_retries)==null?void 0:we.toString())||"1");let et=!1,lt="default",ot="ms-marco-MiniLM-L-12-v2",ve="",Xe="~/.dao_ai/cache/flashrank",qe="",ct=!1,At="",Qt="",zt="";z.rerank&&(et=!0,typeof z.rerank=="boolean"?lt="default":(lt="custom",ot=z.rerank.model||"",ve=((We=z.rerank.top_n)==null?void 0:We.toString())||"",Xe=z.rerank.cache_dir||Xe,qe=((He=z.rerank.columns)==null?void 0:He.join(", "))||"")),(bt=z.instructed)!=null&&bt.rerank&&(ct=!0,At=T(z.instructed.rerank.model),Qt=z.instructed.rerank.instructions||"",zt=((Qe=z.instructed.rerank.top_n)==null?void 0:Qe.toString())||"");const yt=te?I[te]:null,_t=new Set;yt&&(yt.columns&&Array.isArray(yt.columns)&&yt.columns.forEach(Q=>_t.add(Q)),yt.embedding_source_column&&_t.add(yt.embedding_source_column),yt.primary_key&&_t.add(yt.primary_key),yt.doc_uri&&_t.add(yt.doc_uri));const Pt=[];(dt=z.search_parameters)!=null&&dt.filters&&Object.entries(z.search_parameters.filters).forEach(([Q,xe])=>{let Ee=Q,Ge="";const De=[" NOT"," <="," >="," <"," >"," LIKE"];for(const Be of De)if(Q.endsWith(Be)){Ee=Q.slice(0,-Be.length),Ge=Be;break}const Pe=_t.has(Ee)?"select":"manual";Pt.push({id:ed(),columnSource:Pe,column:Ee,operator:Ge,value:String(xe)})}),C({refName:H,vectorStoreRef:te,columns:((Zt=z.columns)==null?void 0:Zt.join(", "))||"",numResults:((j=(ms=z.search_parameters)==null?void 0:ms.num_results)==null?void 0:j.toString())||"10",queryType:((Y=z.search_parameters)==null?void 0:Y.query_type)||"ANN",filters:Pt,enableRouter:K,routerModelRef:he,routerDefaultMode:J,routerAutoBypass:oe,enableInstructed:X,instructedModelRef:Z,instructedColumns:me,instructedConstraints:Re,instructedMaxSubqueries:st,instructedRrfK:it,instructedExamples:rt,instructedNormalizeFilterCase:tt,enableVerifier:ze,verifierModelRef:Le,verifierOnFailure:Ke,verifierMaxRetries:Ne,enableRerank:et,rerankMode:lt,rerankModel:ot,rerankTopN:ve,rerankCacheDir:Xe,rerankColumns:qe,enableInstructionAwareRerank:ct,instructionAwareModelRef:At,instructionAwareInstructions:Qt,instructionAwareTopN:zt}),u(H),h(X),g(et),S(ct),b(K),x(ze),l(!0)},E=H=>{if(H.preventDefault(),!f.refName||!f.vectorStoreRef)return;const z=I[f.vectorStoreRef];if(!z)return;const te=f.columns.split(",").map(Z=>Z.trim()).filter(Z=>Z.length>0),K={};f.filters.forEach(Z=>{if(Z.column&&Z.value){const me=Z.operator?`${Z.column}${Z.operator}`:Z.column;let Re=Z.value;Z.value==="true"?Re=!0:Z.value==="false"?Re=!1:!isNaN(Number(Z.value))&&Z.value.trim()!==""&&(Re=Number(Z.value)),K[me]=Re}});const he={num_results:parseInt(f.numResults)||10,filters:Object.keys(K).length>0?K:void 0,query_type:f.queryType};let J;if(f.enableRerank)if(f.rerankMode==="default")J=!0;else{const Z=f.rerankColumns.split(",").map(me=>me.trim()).filter(me=>me.length>0);J={model:f.rerankModel||void 0,top_n:f.rerankTopN?parseInt(f.rerankTopN):void 0,cache_dir:f.rerankCacheDir||void 0,columns:Z.length>0?Z:void 0}}let oe;if(f.enableInstructed&&f.instructedColumns.some(Z=>Z.name.trim())){const Z=f.instructedColumns.filter(Le=>Le.name.trim()).map(Le=>{var Ke;return{name:Le.name.trim(),type:Le.type,operators:Le.operators?Le.operators.split(",").map(Ne=>Ne.trim()).filter(Ne=>Ne):void 0,...((Ke=Le.description)==null?void 0:Ke.trim())&&{description:Le.description.trim()}}}),me=f.instructedConstraints.split(`
`).map(Le=>Le.trim()).filter(Le=>Le.length>0),Re=f.instructedExamples.filter(Le=>Le.query.trim()).map(Le=>{let Ke={};try{Ke=JSON.parse(Le.filters||"{}")}catch{Ke={}}return{query:Le.query.trim(),filters:Ke}}),it=f.instructedModelRef||Re.length>0||f.instructedNormalizeFilterCase||parseInt(f.instructedMaxSubqueries)!==3||parseInt(f.instructedRrfK)!==60?{model:f.instructedModelRef||void 0,max_subqueries:parseInt(f.instructedMaxSubqueries)||3,rrf_k:parseInt(f.instructedRrfK)||60,examples:Re.length>0?Re:void 0,normalize_filter_case:f.instructedNormalizeFilterCase||void 0}:void 0;let rt;f.enableInstructionAwareRerank&&(rt={model:f.instructionAwareModelRef||void 0,instructions:f.instructionAwareInstructions||void 0,top_n:f.instructionAwareTopN?parseInt(f.instructionAwareTopN):void 0});let tt;f.enableRouter&&(tt={model:f.routerModelRef||void 0,default_mode:f.routerDefaultMode,auto_bypass:f.routerAutoBypass});let ze;f.enableVerifier&&(ze={model:f.verifierModelRef||void 0,on_failure:f.verifierOnFailure,max_retries:parseInt(f.verifierMaxRetries)||1}),oe={columns:Z,constraints:me.length>0?me:void 0,decomposition:it,rerank:rt,router:tt,verifier:ze}}const X={vector_store:z,columns:te.length>0?te:void 0,search_parameters:he,rerank:J,instructed:oe};o&&o!==f.refName?(n(o),s(f.refName,X)):o?a(f.refName,X):s(f.refName,X),V(),l(!1)},$=H=>{const{name:z,value:te,type:K}=H.target;if(K==="checkbox"){const he=H.target.checked;C(J=>{const oe={...J,[z]:he};return he&&(z==="enableInstructionAwareRerank"||z==="enableRouter"||z==="enableVerifier")&&(oe.enableInstructed=!0,h(!0)),oe})}else C(he=>({...he,[z]:te}))},p=H=>{C(z=>{var K;const te={...z,vectorStoreRef:H};return(K=I[H])!=null&&K.columns?te.columns=I[H].columns.join(", "):te.columns="",!z.refName&&H&&(te.refName=`${hn(H)}_retriever`),te})},P=(()=>{if(!f.vectorStoreRef)return[];const H=I[f.vectorStoreRef];if(!H)return[];const z=new Set;return H.columns&&Array.isArray(H.columns)&&H.columns.forEach(te=>z.add(te)),H.embedding_source_column&&z.add(H.embedding_source_column),H.primary_key&&z.add(H.primary_key),H.doc_uri&&z.add(H.doc_uri),Array.from(z).sort()})(),M=P.length>0,O=()=>{C(H=>({...H,filters:[...H.filters,{id:ed(),columnSource:M?"select":"manual",column:"",operator:"",value:""}]}))},W=(H,z,te)=>{C(K=>({...K,filters:K.filters.map(he=>he.id!==H?he:z==="columnSource"?{...he,columnSource:te,column:""}:{...he,[z]:te})}))},q=H=>{C(z=>({...z,filters:z.filters.filter(te=>te.id!==H)}))};return t.jsxs("div",{className:"p-6 space-y-6",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl font-semibold text-slate-100 flex items-center gap-2",children:[t.jsx(Ba,{className:"w-5 h-5 text-blue-400"}),"Retrievers"]}),t.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Configure vector search retrievers for semantic search and information retrieval"})]})}),!k&&t.jsx($e,{className:"bg-amber-500/10 border-amber-500/30",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-amber-500/20 flex items-center justify-center",children:t.jsx(xs,{className:"w-4 h-4 text-amber-400"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-amber-200",children:"No Vector Stores Configured"}),t.jsx("p",{className:"text-xs text-amber-300/70 mt-1",children:"Retrievers require a vector store. Configure at least one vector store in the Resources section first."})]})]})}),t.jsxs(ee,{onClick:()=>{V(),l(!0)},variant:"primary",size:"sm",disabled:!k,className:"self-start",children:[t.jsx(Ie,{className:"w-4 h-4 mr-1"}),"Add Retriever"]}),Object.keys(w).length>0&&t.jsx("div",{className:"space-y-2",children:Object.entries(w).map(([H,z])=>{var te,K,he,J,oe,X;return t.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800/50 rounded-lg border border-slate-700 cursor-pointer hover:bg-slate-800/70 transition-colors",onClick:()=>F(H),children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Ba,{className:"w-4 h-4 text-blue-400"}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("p",{className:"font-medium text-slate-200",children:H}),t.jsxs(Se,{variant:"info",children:[((te=z.search_parameters)==null?void 0:te.num_results)||10," results"]}),((K=z.search_parameters)==null?void 0:K.filters)&&Object.keys(z.search_parameters.filters).length>0&&t.jsxs(Se,{variant:"warning",children:[Object.keys(z.search_parameters.filters).length," filter",Object.keys(z.search_parameters.filters).length!==1?"s":""]}),z.rerank&&t.jsx(Se,{variant:"success",children:"Rerank"}),z.instructed&&t.jsx(Se,{variant:"info",children:"Instructed"}),((he=z.instructed)==null?void 0:he.rerank)&&t.jsx(Se,{variant:"info",children:"LLM Rerank"}),((J=z.instructed)==null?void 0:J.router)&&t.jsx(Se,{variant:"info",children:"Router"}),((oe=z.instructed)==null?void 0:oe.verifier)&&t.jsx(Se,{variant:"info",children:"Verifier"})]}),t.jsxs("p",{className:"text-xs text-slate-500",children:[((X=z.search_parameters)==null?void 0:X.query_type)||"ANN",z.columns&&z.columns.length>0&&t.jsxs(t.Fragment,{children:["  ",z.columns.slice(0,2).join(", "),z.columns.length>2&&` +${z.columns.length-2}`]})]})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ee,{variant:"ghost",size:"sm",onClick:Z=>{Z.stopPropagation(),F(H)},children:t.jsx(ds,{className:"w-4 h-4"})}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:Z=>{Z.stopPropagation(),Gt("Retriever",H,()=>n(H))},children:t.jsx(Ze,{className:"w-4 h-4 text-red-400"})})]})]},H)})}),Object.keys(w).length===0&&k&&t.jsxs("div",{className:"text-center py-8 text-slate-500",children:[t.jsx(Ba,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),t.jsx("p",{children:"No retrievers configured yet"}),t.jsx("p",{className:"text-xs mt-1",children:"Add a retriever to enable semantic search capabilities for your agents"})]}),t.jsx(ws,{isOpen:i,onClose:()=>{V(),l(!1)},title:o?"Edit Retriever":"Add Retriever",size:"lg",children:t.jsxs("form",{onSubmit:E,className:"space-y-6",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsx("h3",{className:"text-sm font-medium text-slate-300 border-b border-slate-700 pb-2",children:"Basic Configuration"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(U,{label:"Reference Name",name:"refName",value:f.refName,onChange:H=>C(z=>({...z,refName:Ot(H.target.value)})),placeholder:"Products Retriever",hint:"Type naturally - spaces become underscores",required:!0}),t.jsx(ae,{label:"Vector Store",value:f.vectorStoreRef,onChange:H=>p(H.target.value),options:[{value:"",label:"Select a vector store..."},...D],hint:"Select a configured vector store",required:!0})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Return Columns"}),(()=>{const H=f.vectorStoreRef?I[f.vectorStoreRef]:null,z=(H==null?void 0:H.columns)||[];return z.length>0?t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"flex flex-wrap gap-2 max-h-40 overflow-y-auto p-2 bg-slate-800/50 rounded border border-slate-700",children:z.map(te=>{const he=f.columns.split(",").map(J=>J.trim()).filter(J=>J).includes(te);return t.jsx("button",{type:"button",onClick:()=>{const J=f.columns.split(",").map(oe=>oe.trim()).filter(oe=>oe);C(he?oe=>({...oe,columns:J.filter(X=>X!==te).join(", ")}):oe=>({...oe,columns:[...J,te].join(", ")}))},className:`px-2 py-1 text-xs rounded transition-colors ${he?"bg-blue-500/30 text-blue-300 border border-blue-500/50":"bg-slate-700 text-slate-400 hover:bg-slate-600"}`,children:te},te)})}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("p",{className:"text-xs text-slate-500",children:["Click columns to select/deselect. Selected: ",f.columns.split(",").filter(te=>te.trim()).length||0]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{type:"button",onClick:()=>C(te=>({...te,columns:z.join(", ")})),className:"text-xs text-blue-400 hover:text-blue-300",children:"Select All"}),t.jsx("button",{type:"button",onClick:()=>C(te=>({...te,columns:""})),className:"text-xs text-slate-400 hover:text-slate-300",children:"Clear All"})]})]})]}):t.jsx(U,{name:"columns",value:f.columns,onChange:$,placeholder:"product_id, name, description",hint:f.vectorStoreRef?"Vector store has no columns defined. Enter comma-separated column names.":"Select a vector store to see available columns, or enter comma-separated column names"})})()]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("h3",{className:"text-sm font-medium text-slate-300 border-b border-slate-700 pb-2",children:"Search Parameters"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(U,{label:"Number of Results",name:"numResults",type:"number",value:f.numResults,onChange:$,placeholder:"10",hint:"Maximum number of results to return"}),t.jsx(ae,{label:"Query Type",value:f.queryType,onChange:H=>C(z=>({...z,queryType:H.target.value})),options:eb,hint:"Search algorithm to use"})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between border-b border-slate-700 pb-2",children:[t.jsxs("h3",{className:"text-sm font-medium text-slate-300 flex items-center gap-2",children:[t.jsx(df,{className:"w-4 h-4"}),"Filters (Optional)"]}),t.jsxs(ee,{type:"button",variant:"ghost",size:"sm",onClick:O,children:[t.jsx(Ie,{className:"w-4 h-4 mr-1"}),"Add Filter"]})]}),f.filters.length===0?t.jsx("div",{className:"text-xs text-slate-500 italic py-2",children:"No filters configured. Add filters to narrow down search results based on column values."}):t.jsx("div",{className:"space-y-3",children:f.filters.map(H=>t.jsxs("div",{className:"flex items-start gap-2 p-3 bg-slate-800/50 rounded-lg border border-slate-700",children:[t.jsxs("div",{className:"flex-1 space-y-3",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("div",{className:"flex items-center justify-between h-5 mb-1",children:[t.jsx("label",{className:"text-xs font-medium text-slate-400",children:"Column"}),t.jsxs("div",{className:"flex",children:[t.jsx("button",{type:"button",onClick:()=>W(H.id,"columnSource","select"),className:`px-2 py-0.5 text-[10px] rounded-l border transition-colors ${H.columnSource==="select"?"bg-blue-600 border-blue-600 text-white":"bg-slate-800 border-slate-600 text-slate-400 hover:bg-slate-700"} ${M?"":"opacity-50 cursor-not-allowed"}`,disabled:!M,title:M?"Select from available columns":"No columns available",children:"Select"}),t.jsx("button",{type:"button",onClick:()=>W(H.id,"columnSource","manual"),className:`px-2 py-0.5 text-[10px] rounded-r border-t border-r border-b transition-colors ${H.columnSource==="manual"?"bg-blue-600 border-blue-600 text-white":"bg-slate-800 border-slate-600 text-slate-400 hover:bg-slate-700"}`,children:"Manual"})]})]}),H.columnSource==="select"&&M?t.jsxs("select",{value:H.column,onChange:z=>W(H.id,"column",z.target.value),className:"w-full h-[38px] px-3 bg-slate-800 border border-slate-700 rounded-lg text-sm text-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"Select column..."}),P.map(z=>t.jsx("option",{value:z,children:z},z))]}):t.jsx("input",{type:"text",value:H.column,onChange:z=>W(H.id,"column",z.target.value),placeholder:"column_name",className:"w-full h-[38px] px-3 bg-slate-800 border border-slate-700 rounded-lg text-sm text-slate-100 placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{className:"flex flex-col",children:[t.jsx("div",{className:"flex items-center justify-between h-5 mb-1",children:t.jsx("label",{className:"text-xs font-medium text-slate-400",children:"Operator"})}),t.jsx("select",{value:H.operator,onChange:z=>W(H.id,"operator",z.target.value),className:"w-full h-[38px] px-3 bg-slate-800 border border-slate-700 rounded-lg text-sm text-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-500",children:Qg.map(z=>t.jsx("option",{value:z.value,children:z.label},z.value))})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"Value"}),t.jsx("input",{type:"text",value:H.value,onChange:z=>W(H.id,"value",z.target.value),placeholder:"filter value",className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-sm text-slate-100 placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"}),t.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"Strings, numbers, or booleans (true/false)"})]})]}),t.jsx("button",{type:"button",onClick:()=>q(H.id),className:"mt-4 p-1.5 text-slate-400 hover:text-red-400 hover:bg-red-400/10 rounded transition-colors",title:"Remove filter",children:t.jsx(_a,{className:"w-4 h-4"})})]},H.id))}),t.jsx("p",{className:"text-xs text-slate-500",children:"Filters restrict search results to rows matching the specified conditions. Use column names from your source table. Values are automatically parsed as numbers or booleans when applicable."})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("button",{type:"button",onClick:()=>g(!d),className:"flex items-center gap-2 text-sm font-medium text-slate-300 border-b border-slate-700 pb-2 flex-1 hover:text-slate-100 transition-colors",children:[d?t.jsx(Wt,{className:"w-4 h-4"}):t.jsx(Fa,{className:"w-4 h-4"}),t.jsx(Zp,{className:"w-4 h-4 text-slate-400"}),"Standard Reranking",f.enableRerank&&t.jsx(Se,{variant:"success",className:"ml-2",children:"Enabled"})]}),t.jsxs("label",{className:"flex items-center gap-2 text-sm border-b border-slate-700 pb-2 pl-3",children:[t.jsx("input",{type:"checkbox",name:"enableRerank",checked:f.enableRerank,onChange:$,className:"rounded border-slate-600 bg-slate-700 text-blue-500 focus:ring-blue-500 focus:ring-offset-slate-800"}),t.jsx("span",{className:"text-slate-400",children:"Enable"})]})]}),d&&f.enableRerank&&t.jsxs("div",{className:"space-y-4 pl-4 border-l-2 border-slate-600",children:[t.jsxs("div",{className:"flex gap-4 mb-4",children:[t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"radio",name:"rerankMode",value:"default",checked:f.rerankMode==="default",onChange:()=>C(H=>({...H,rerankMode:"default"})),className:"text-blue-500 focus:ring-blue-500"}),t.jsx("span",{className:"text-sm text-slate-300",children:"Use defaults"}),t.jsx("span",{className:"text-xs text-slate-500",children:"(rerank: true)"})]}),t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"radio",name:"rerankMode",value:"custom",checked:f.rerankMode==="custom",onChange:()=>C(H=>({...H,rerankMode:"custom"})),className:"text-blue-500 focus:ring-blue-500"}),t.jsx("span",{className:"text-sm text-slate-300",children:"Custom configuration"})]})]}),f.rerankMode==="default"?t.jsx("div",{className:"p-3 bg-slate-800/30 rounded-lg border border-slate-700/50 text-sm text-slate-400",children:"Uses FlashRank with default settings (ms-marco-MiniLM-L-12-v2 model). Switch to custom configuration for advanced options."}):t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"text-xs text-slate-500 mb-3",children:"Choose between FlashRank (local cross-encoder) and/or Databricks server-side column reranking."}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(ae,{label:"FlashRank Model (Local)",value:f.rerankModel,onChange:H=>C(z=>({...z,rerankModel:H.target.value})),options:Zg,hint:"Cross-encoder model for semantic reranking"}),t.jsx(U,{label:"Top N Results",name:"rerankTopN",type:"number",value:f.rerankTopN,onChange:$,placeholder:"5",hint:"Number of results after reranking (leave empty to use search num_results)"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Databricks Columns (Server-side Reranking)"}),t.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Select columns for Databricks server-side reranking. Can be used with or without FlashRank."}),P.length>0?t.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-40 overflow-y-auto p-3 bg-slate-900/50 rounded-lg border border-slate-600",children:P.map(H=>{const z=f.rerankColumns.split(",").map(K=>K.trim()).filter(K=>K),te=z.includes(H);return t.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:te,onChange:K=>{let he;K.target.checked?he=[...z,H]:he=z.filter(J=>J!==H),C(J=>({...J,rerankColumns:he.join(", ")}))},className:"w-4 h-4 rounded border-slate-600 bg-slate-800 text-blue-500 focus:ring-blue-500 focus:ring-offset-0"}),t.jsx("span",{className:"text-sm text-slate-300",children:H})]},H)})}):t.jsx("div",{className:"p-3 bg-slate-900/50 rounded-lg border border-slate-600 text-slate-500 text-sm",children:f.vectorStoreRef?"No columns found in selected vector store":"Select a vector store to see available columns"}),f.rerankColumns&&t.jsxs("p",{className:"text-xs text-slate-400",children:["Selected: ",f.rerankColumns]})]}),t.jsx(U,{label:"Cache Directory",name:"rerankCacheDir",value:f.rerankCacheDir,onChange:$,placeholder:"~/.dao_ai/cache/flashrank",hint:"Directory to cache downloaded model weights"})]})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("button",{type:"button",onClick:()=>h(!m),className:"flex items-center gap-2 text-sm font-medium text-slate-300 border-b border-slate-700 pb-2 flex-1 hover:text-slate-100 transition-colors",children:[m?t.jsx(Wt,{className:"w-4 h-4"}):t.jsx(Fa,{className:"w-4 h-4"}),t.jsx(br,{className:"w-4 h-4 text-amber-400"}),"Instructed Retrieval",f.enableInstructed&&t.jsx(Se,{variant:"info",className:"ml-2",children:["Enabled",f.enableInstructionAwareRerank&&"Rerank",f.enableRouter&&"Router",f.enableVerifier&&"Verifier"].filter(Boolean).join(", ")})]}),t.jsxs("label",{className:"flex items-center gap-2 text-sm border-b border-slate-700 pb-2 pl-3",children:[t.jsx("input",{type:"checkbox",name:"enableInstructed",checked:f.enableInstructed,onChange:$,className:"rounded border-slate-600 bg-slate-700 text-blue-500 focus:ring-blue-500 focus:ring-offset-slate-800"}),t.jsx("span",{className:"text-slate-400",children:"Enable"})]})]}),m&&f.enableInstructed&&t.jsxs("div",{className:"space-y-4 pl-4 border-l-2 border-amber-500/30",children:[t.jsx("p",{className:"text-xs text-slate-500",children:"Column metadata is the single source of truth for schema context. Each pipeline component (decomposition, routing, verification, reranking) generates the specific context it needs from the structured column data."}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("label",{className:"text-sm font-medium text-slate-300",children:["Schema Columns ",t.jsx("span",{className:"text-red-400",children:"*"})]}),t.jsxs(ee,{type:"button",variant:"ghost",size:"sm",onClick:()=>C(H=>({...H,instructedColumns:[...H.instructedColumns,{id:td(),name:"",type:"string",operators:"",description:""}]})),children:[t.jsx(Ie,{className:"w-3 h-3 mr-1"}),"Add Column"]})]}),f.instructedColumns.length>0&&t.jsx("div",{className:"space-y-2",children:f.instructedColumns.map((H,z)=>t.jsxs("div",{className:"space-y-1 p-2 bg-slate-900/50 rounded border border-slate-700/50",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"text",value:H.name,onChange:te=>{const K=[...f.instructedColumns];K[z]={...H,name:te.target.value},C(he=>({...he,instructedColumns:K}))},placeholder:"Column name",className:"flex-1 px-2 py-1 bg-slate-800 border border-slate-700 rounded text-sm text-slate-100 placeholder-slate-500"}),t.jsxs("select",{value:H.type,onChange:te=>{const K=[...f.instructedColumns];K[z]={...H,type:te.target.value},C(he=>({...he,instructedColumns:K}))},className:"px-2 py-1 bg-slate-800 border border-slate-700 rounded text-sm text-slate-100",children:[t.jsx("option",{value:"string",children:"string"}),t.jsx("option",{value:"number",children:"number"}),t.jsx("option",{value:"boolean",children:"boolean"}),t.jsx("option",{value:"datetime",children:"datetime"})]}),t.jsx("input",{type:"text",value:H.operators,onChange:te=>{const K=[...f.instructedColumns];K[z]={...H,operators:te.target.value},C(he=>({...he,instructedColumns:K}))},placeholder:"Operators (comma-sep)",className:"w-32 px-2 py-1 bg-slate-800 border border-slate-700 rounded text-sm text-slate-100 placeholder-slate-500"}),t.jsx("button",{type:"button",onClick:()=>C(te=>({...te,instructedColumns:te.instructedColumns.filter(K=>K.id!==H.id)})),className:"p-1 text-slate-400 hover:text-red-400",children:t.jsx(_a,{className:"w-3 h-3"})})]}),t.jsx("input",{type:"text",value:H.description,onChange:te=>{const K=[...f.instructedColumns];K[z]={...H,description:te.target.value},C(he=>({...he,instructedColumns:K}))},placeholder:"Description (e.g. Brand/manufacturer - MILWAUKEE, DEWALT, etc.)",className:"w-full px-2 py-1 bg-slate-800 border border-slate-700 rounded text-sm text-slate-100 placeholder-slate-500"})]},H.id))}),t.jsx("p",{className:"text-xs text-slate-500",children:"At least one column is required. Column names, types, operators, and descriptions are embedded into JSON schemas and prompts for each pipeline component automatically. Operators: empty for equality, NOT, <, <=, >, >=, LIKE"})]}),t.jsx(Jt,{label:"Default Constraints",name:"instructedConstraints",value:f.instructedConstraints,onChange:$,placeholder:`Prefer recent products
Prioritize exact brand matches`,rows:3,hint:"One constraint per line"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("button",{type:"button",onClick:()=>c(!r),className:"flex items-center gap-2 text-sm font-medium text-slate-300 hover:text-slate-100 transition-colors",children:[r?t.jsx(Wt,{className:"w-3 h-3"}):t.jsx(Fa,{className:"w-3 h-3"}),t.jsx(xs,{className:"w-4 h-4 text-amber-400"}),"Query Decomposition"]}),r&&t.jsxs("div",{className:"space-y-4 pl-4 border-l-2 border-amber-500/20",children:[t.jsx("p",{className:"text-xs text-slate-500",children:"Decomposes user queries into multiple subqueries with metadata filters and merges results using RRF."}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsx(ae,{label:"Decomposition Model",value:f.instructedModelRef,onChange:H=>C(z=>({...z,instructedModelRef:H.target.value})),options:[{value:"",label:"Select LLM..."},...L],hint:"Fast model recommended"}),t.jsx(ae,{label:"Normalize Filter Case",value:f.instructedNormalizeFilterCase,onChange:H=>C(z=>({...z,instructedNormalizeFilterCase:H.target.value})),options:[{value:"",label:"No normalization"},{value:"uppercase",label:"Uppercase"},{value:"lowercase",label:"Lowercase"}],hint:"Auto-normalize filter values"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsx(U,{label:"Max Subqueries",name:"instructedMaxSubqueries",type:"number",value:f.instructedMaxSubqueries,onChange:$,placeholder:"3",hint:"Maximum parallel subqueries"}),t.jsx(U,{label:"RRF K Constant",name:"instructedRrfK",type:"number",value:f.instructedRrfK,onChange:$,placeholder:"60",hint:"Lower values weight top ranks more"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Few-Shot Examples (Optional)"}),t.jsxs(ee,{type:"button",variant:"ghost",size:"sm",onClick:()=>C(H=>({...H,instructedExamples:[...H.instructedExamples,{id:sd(),query:"",filters:"{}"}]})),children:[t.jsx(Ie,{className:"w-3 h-3 mr-1"}),"Add Example"]})]}),f.instructedExamples.length>0&&t.jsx("div",{className:"space-y-2",children:f.instructedExamples.map((H,z)=>t.jsxs("div",{className:"flex items-start gap-2 p-2 bg-slate-900/50 rounded border border-slate-700/50",children:[t.jsxs("div",{className:"flex-1 space-y-2",children:[t.jsx("input",{type:"text",value:H.query,onChange:te=>{const K=[...f.instructedExamples];K[z]={...H,query:te.target.value},C(he=>({...he,instructedExamples:K}))},placeholder:"Query: e.g., cheap drills",className:"w-full px-2 py-1 bg-slate-800 border border-slate-700 rounded text-sm text-slate-100 placeholder-slate-500"}),t.jsx("input",{type:"text",value:H.filters,onChange:te=>{const K=[...f.instructedExamples];K[z]={...H,filters:te.target.value},C(he=>({...he,instructedExamples:K}))},placeholder:'Filters JSON: e.g., {"price <": 100}',className:"w-full px-2 py-1 bg-slate-800 border border-slate-700 rounded text-sm text-slate-100 placeholder-slate-500 font-mono text-xs"})]}),t.jsx("button",{type:"button",onClick:()=>C(te=>({...te,instructedExamples:te.instructedExamples.filter(K=>K.id!==H.id)})),className:"p-1 text-slate-400 hover:text-red-400",children:t.jsx(_a,{className:"w-3 h-3"})})]},H.id))}),t.jsx("p",{className:"text-xs text-slate-500",children:"Domain-specific examples for better filter translation"})]})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("button",{type:"button",onClick:()=>S(!v),className:"flex items-center gap-2 text-sm font-medium text-slate-300 hover:text-slate-100 transition-colors",children:[v?t.jsx(Wt,{className:"w-3 h-3"}):t.jsx(Fa,{className:"w-3 h-3"}),t.jsx(Rt,{className:"w-4 h-4 text-violet-400"}),"Instruction-Aware Reranking",f.enableInstructionAwareRerank&&t.jsx(Se,{variant:"info",className:"ml-1",children:"Enabled"})]}),t.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[t.jsx("input",{type:"checkbox",name:"enableInstructionAwareRerank",checked:f.enableInstructionAwareRerank,onChange:$,className:"rounded border-slate-600 bg-slate-700 text-blue-500 focus:ring-blue-500 focus:ring-offset-slate-800"}),t.jsx("span",{className:"text-slate-400",children:"Enable"})]})]}),v&&f.enableInstructionAwareRerank&&t.jsxs("div",{className:"space-y-3 pl-4 border-l-2 border-violet-500/30",children:[t.jsx("p",{className:"text-xs text-slate-500",children:"LLM-based reranking that considers user instructions and constraints. Runs after standard reranking."}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsx(ae,{label:"Reranking Model",value:f.instructionAwareModelRef,onChange:H=>C(z=>({...z,instructionAwareModelRef:H.target.value})),options:[{value:"",label:"Select LLM..."},...L],hint:"Fast model recommended"}),t.jsx(U,{label:"Top N Results",name:"instructionAwareTopN",type:"number",value:f.instructionAwareTopN,onChange:$,placeholder:"10",hint:"Number of results after instruction reranking"})]}),t.jsx(Jt,{label:"Reranking Instructions",name:"instructionAwareInstructions",value:f.instructionAwareInstructions,onChange:$,placeholder:"Prioritize results matching price and brand constraints.",rows:3,hint:"Custom instructions for constraint prioritization"})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("button",{type:"button",onClick:()=>b(!y),className:"flex items-center gap-2 text-sm font-medium text-slate-300 hover:text-slate-100 transition-colors",children:[y?t.jsx(Wt,{className:"w-3 h-3"}):t.jsx(Fa,{className:"w-3 h-3"}),t.jsx(gf,{className:"w-4 h-4 text-blue-400"}),"Query Router",f.enableRouter&&t.jsx(Se,{variant:"info",className:"ml-1",children:"Enabled"})]}),t.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[t.jsx("input",{type:"checkbox",name:"enableRouter",checked:f.enableRouter,onChange:$,className:"rounded border-slate-600 bg-slate-700 text-blue-500 focus:ring-blue-500 focus:ring-offset-slate-800"}),t.jsx("span",{className:"text-slate-400",children:"Enable"})]})]}),y&&f.enableRouter&&t.jsxs("div",{className:"space-y-3 pl-4 border-l-2 border-blue-500/30",children:[t.jsx("p",{className:"text-xs text-slate-500",children:"Routes queries to standard or instructed execution mode based on query characteristics."}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsx(ae,{label:"Router Model",value:f.routerModelRef,onChange:H=>C(z=>({...z,routerModelRef:H.target.value})),options:[{value:"",label:"Select LLM..."},...L],hint:"Fast model recommended"}),t.jsx(ae,{label:"Default Mode",value:f.routerDefaultMode,onChange:H=>C(z=>({...z,routerDefaultMode:H.target.value})),options:[{value:"standard",label:"Standard"},{value:"instructed",label:"Instructed"}],hint:"Fallback if routing fails"})]}),t.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[t.jsx("input",{type:"checkbox",name:"routerAutoBypass",checked:f.routerAutoBypass,onChange:$,className:"rounded border-slate-600 bg-slate-700 text-blue-500 focus:ring-blue-500 focus:ring-offset-slate-800"}),t.jsx("span",{className:"text-slate-400",children:"Auto-bypass instruction reranker and verifier for standard mode"})]})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("button",{type:"button",onClick:()=>x(!_),className:"flex items-center gap-2 text-sm font-medium text-slate-300 hover:text-slate-100 transition-colors",children:[_?t.jsx(Wt,{className:"w-3 h-3"}):t.jsx(Fa,{className:"w-3 h-3"}),t.jsx(go,{className:"w-4 h-4 text-green-400"}),"Result Verifier",f.enableVerifier&&t.jsx(Se,{variant:"info",className:"ml-1",children:"Enabled"})]}),t.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[t.jsx("input",{type:"checkbox",name:"enableVerifier",checked:f.enableVerifier,onChange:$,className:"rounded border-slate-600 bg-slate-700 text-blue-500 focus:ring-blue-500 focus:ring-offset-slate-800"}),t.jsx("span",{className:"text-slate-400",children:"Enable"})]})]}),_&&f.enableVerifier&&t.jsxs("div",{className:"space-y-3 pl-4 border-l-2 border-green-500/30",children:[t.jsx("p",{className:"text-xs text-slate-500",children:"Validates search results against user constraints with structured feedback for retry."}),t.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.jsx(ae,{label:"Verifier Model",value:f.verifierModelRef,onChange:H=>C(z=>({...z,verifierModelRef:H.target.value})),options:[{value:"",label:"Select LLM..."},...L],hint:"Fast model recommended"}),t.jsx(ae,{label:"On Failure",value:f.verifierOnFailure,onChange:H=>C(z=>({...z,verifierOnFailure:H.target.value})),options:[{value:"warn",label:"Warn"},{value:"retry",label:"Retry"},{value:"warn_and_retry",label:"Warn & Retry"}],hint:"Behavior when verification fails"}),t.jsx(U,{label:"Max Retries",name:"verifierMaxRetries",type:"number",value:f.verifierMaxRetries,onChange:$,placeholder:"1",hint:"Retry attempts before warning"})]})]})]})]})]}),t.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-slate-700",children:[t.jsx(ee,{type:"button",variant:"ghost",onClick:()=>{V(),l(!1)},children:"Cancel"}),t.jsxs(ee,{type:"submit",variant:"primary",children:[o?"Update":"Add"," Retriever"]})]})]})})]})}function Es(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean")return String(e);if(typeof e=="object"){const s=e;if("env"in s&&typeof s.env=="string"){const a=s.default_value;return a!=null?String(a):`$${s.env}`}if("scope"in s&&"secret"in s)return`{{secrets/${s.scope}/${s.secret}}}`;if("type"in s&&s.type==="primitive"&&"value"in s)return String(s.value);if("default_value"in s&&s.default_value!==void 0)return String(s.default_value)}return""}function ar({label:e,source:s,onSourceChange:a,manualValue:n,onManualChange:i,variableValue:l,onVariableChange:o,placeholder:u,type:m="text",hint:h,required:r=!1,variables:c}){const d=Object.keys(c);return t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("label",{className:"text-sm font-medium text-slate-300",children:[e,r&&t.jsx("span",{className:"text-red-400 ml-1",children:"*"})]}),t.jsxs("div",{className:"inline-flex rounded-lg bg-slate-900/50 p-0.5",children:[t.jsx("button",{type:"button",onClick:()=>a("variable"),className:`px-3 py-1 text-xs rounded-md font-medium transition-all duration-150 ${s==="variable"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Variable"}),t.jsx("button",{type:"button",onClick:()=>a("manual"),className:`px-3 py-1 text-xs rounded-md font-medium transition-all duration-150 ${s==="manual"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Manual"})]})]}),s==="variable"?t.jsx(ae,{value:l,onChange:g=>o(g.target.value),options:[{value:"",label:"Select a variable..."},...d.map(g=>({value:g,label:g}))],hint:d.length===0?"Define variables in the Variables section first":h,required:r}):t.jsx(U,{value:n,onChange:g=>i(g.target.value),placeholder:u,type:m,hint:h,required:r})]})}function os({label:e,resourceType:s,configuredOptions:a,configuredValue:n,onConfiguredChange:i,source:l,onSourceChange:o,children:u,hint:m}){return t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:e}),t.jsxs("div",{className:"inline-flex rounded-lg bg-slate-900/50 p-0.5",children:[t.jsx("button",{type:"button",onClick:()=>o("configured"),className:`px-3 py-1 text-xs rounded-md font-medium transition-all duration-150 ${l==="configured"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Configured"}),t.jsx("button",{type:"button",onClick:()=>o("select"),className:`px-3 py-1 text-xs rounded-md font-medium transition-all duration-150 ${l==="select"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Select"})]})]}),l==="configured"?t.jsxs("div",{className:"space-y-1",children:[t.jsx(ae,{options:[{value:"",label:`Select configured ${s}...`},...a],value:n,onChange:h=>i(h.target.value)}),a.length===0&&t.jsxs("p",{className:"text-xs text-amber-400",children:["No ",s,'s configured. Add one in Resources section or switch to "Select".']})]}):u,m&&t.jsx("p",{className:"text-xs text-slate-500",children:m})]})}const sb=[{value:"factory",label:"Factory Function"},{value:"python",label:"Python Function"},{value:"inline",label:"Inline Function"},{value:"unity_catalog",label:"Unity Catalog Function"},{value:"mcp",label:"MCP Server"}],ml=[{value:"dao_ai.tools.create_genie_tool",label:"Genie Tool",description:"Query data using natural language via Databricks Genie",icon:Xa},{value:"dao_ai.tools.create_vector_search_tool",label:"Vector Search Tool",description:"Semantic search over documents using vector embeddings",icon:Ba},{value:"dao_ai.tools.create_search_tool",label:"Web Search Tool",description:"Search the web using DuckDuckGo",icon:Ba},{value:"dao_ai.tools.create_execute_statement_tool",label:"SQL Statement Tool",description:"Execute a pre-configured SQL statement against a warehouse",icon:vi},{value:"dao_ai.tools.create_send_email_tool",label:"Email Tool",description:"Send emails via SMTP",icon:ff},{value:"dao_ai.tools.create_send_slack_message_tool",label:"Slack Message Tool",description:"Send messages to Slack channels",icon:Xa},{value:"dao_ai.tools.create_agent_endpoint_tool",label:"Agent Endpoint Tool",description:"Call another deployed agent endpoint",icon:ts},{value:"custom",label:"Custom Factory...",description:"Specify a custom factory function path",icon:ma}],hl=[{value:"dao_ai.tools.current_time_tool",label:"Current Time",description:"Get the current date and time",icon:Rn},{value:"dao_ai.tools.time_in_timezone_tool",label:"Time in Timezone",description:"Get time in a specific timezone",icon:Rn},{value:"dao_ai.tools.add_time_tool",label:"Add Time",description:"Add days, hours, or minutes to a datetime",icon:Rc},{value:"dao_ai.tools.time_difference_tool",label:"Time Difference",description:"Calculate the difference between two datetimes",icon:tf},{value:"dao_ai.tools.is_business_hours_tool",label:"Business Hours Check",description:"Check if a time falls within business hours",icon:Rn},{value:"dao_ai.tools.format_time_tool",label:"Format Time",description:"Format datetime strings in various formats",icon:Rn},{value:"dao_ai.tools.time_until_tool",label:"Time Until",description:"Calculate time remaining until a target datetime",icon:Rc},{value:"custom",label:"Custom Python Function...",description:"Specify a custom Python function path",icon:ma}],ab=[{value:"url",label:"Direct URL",description:"Connect to any MCP server via URL"},{value:"app",label:"Databricks App",description:"MCP server hosted in a Databricks App"},{value:"genie",label:"Genie Room",description:"Databricks Genie MCP server"},{value:"vector_search",label:"Vector Search",description:"Databricks Vector Search MCP server"},{value:"functions",label:"UC Functions",description:"Unity Catalog Functions MCP server"},{value:"sql",label:"SQL (DBSQL)",description:"Databricks SQL MCP server"},{value:"connection",label:"UC Connection",description:"External MCP server via UC Connection"}],ad={sourceType:"url",urlSource:"manual",url:"",urlVariable:"",appSource:"configured",appRefName:"",appName:"",genieSource:"select",genieRefName:"",genieSpaceId:"",genieName:"",genieDescription:"",vectorStoreSource:"select",vectorStoreRefName:"",vectorEndpoint:"",vectorIndex:"",vectorCatalog:"",vectorSchema:"",schemaSource:"select",schemaRefName:"",functionsCatalog:"",functionsSchema:"",connectionSource:"select",connectionRefName:"",connectionName:"",warehouseSource:"select",warehouseRefName:"",warehouseId:"",useCredentials:!0,credentialsMode:"service_principal",servicePrincipalRef:"",clientIdSource:"variable",clientIdVar:"",clientIdManual:"",clientSecretSource:"variable",clientSecretVar:"",clientSecretManual:"",workspaceHostSource:"variable",workspaceHostVar:"",workspaceHostManual:"",includeTools:[],excludeTools:[],availableTools:[],availableToolsLoading:!1,availableToolsError:""},nd={enabled:!1,reviewPrompt:"Please review the tool call",allowApprove:!0,allowEdit:!0,allowReject:!0};function nr(e){const s=e.split(".");let a=s[s.length-1];a=a.replace(/^create_/,"").replace(/_tool$/,"");const n=a.toLowerCase().trim().replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"");return n?`${n}_tool`:""}function Ds(e,s){if(!s)return"";let a=s.toLowerCase().trim().replace(/[^a-z0-9]+/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,""),n="";switch(e){case"genie":n="_genie_tool";break;case"vector_search":n="_vector_search_tool";break;case"functions":n="_uc_functions_tool";break;case"sql":n="_sql_tool";break;case"app":n="_app_tool";break;case"connection":n="_connection_tool";break;case"url":n="_mcp_tool";break;default:n="_tool"}return a?`${a}${n}`:""}function nb(){var we,We,He,bt,Qe,dt,Zt,ms;const{config:e,addTool:s,updateTool:a,removeTool:n}=nt(),{data:i}=Sm(),l=i==null?void 0:i.host,[o,u]=A.useState(!1),[m,h]=A.useState(null),[r,c]=A.useState({refName:"",name:"",type:"factory",functionName:"",customFunctionName:"",args:"{}",inlineCode:"",genieSource:"configured",genieRefName:"",genieSpaceId:"",geniePersistConversation:!0,genieTruncateResults:!1,genieLruCacheEnabled:!1,genieLruCacheCapacity:1e3,genieLruCacheTtl:86400,genieLruCacheTtlNeverExpires:!1,genieLruCacheWarehouseSource:"configured",genieLruCacheWarehouseRefName:"",genieLruCacheWarehouseId:"",genieSemanticCacheEnabled:!1,genieSemanticCacheTtl:86400,genieSemanticCacheTtlNeverExpires:!1,genieSemanticCacheSimilarityThreshold:.85,genieSemanticCacheContextSimilarityThreshold:.8,genieSemanticCacheQuestionWeight:.6,genieSemanticCacheContextWeight:.4,genieSemanticCacheContextWindowSize:4,genieSemanticCacheMaxContextTokens:2e3,genieSemanticCacheEmbeddingModelSource:"configured",genieSemanticCacheEmbeddingModelRefName:"",genieSemanticCacheEmbeddingModelManual:"databricks-gte-large-en",genieSemanticCacheTableName:"genie_context_aware_cache",genieSemanticCacheDatabaseSource:"configured",genieSemanticCacheDatabaseRefName:"",genieSemanticCacheWarehouseSource:"configured",genieSemanticCacheWarehouseRefName:"",genieSemanticCacheWarehouseId:"",genieSemanticCachePromptHistoryTable:"genie_prompt_history",genieSemanticCacheMaxPromptHistoryLength:50,genieSemanticCacheUseGenieApiForHistory:!1,genieSemanticCachePromptHistoryTtlEnabled:!1,genieSemanticCachePromptHistoryTtl:86400,genieSemanticCacheIvfflatListsAuto:!0,genieSemanticCacheIvfflatLists:100,genieSemanticCacheIvfflatProbesAuto:!0,genieSemanticCacheIvfflatProbes:10,genieSemanticCacheIvfflatCandidates:20,genieInMemoryCacheEnabled:!1,genieInMemoryCacheTtl:604800,genieInMemoryCacheTtlNeverExpires:!1,genieInMemoryCacheCapacity:1e4,genieInMemoryCacheCapacityUnlimited:!1,genieInMemoryCacheSimilarityThreshold:.85,genieInMemoryCacheContextSimilarityThreshold:.8,genieInMemoryCacheQuestionWeight:.6,genieInMemoryCacheContextWeight:.4,genieInMemoryCacheContextWindowSize:3,genieInMemoryCacheMaxContextTokens:2e3,genieInMemoryCacheEmbeddingModelSource:"configured",genieInMemoryCacheEmbeddingModelRefName:"",genieInMemoryCacheEmbeddingModelManual:"databricks-gte-large-en",genieInMemoryCacheWarehouseSource:"configured",genieInMemoryCacheWarehouseRefName:"",genieInMemoryCacheWarehouseId:"",warehouseSource:"configured",warehouseRefName:"",warehouseId:"",vectorSearchSourceType:"retriever",retrieverSource:"configured",retrieverRefName:"",vectorEndpoint:"",vectorIndex:"",vectorStoreSource:"configured",vectorStoreRefName:"",vsVectorEndpoint:"",vsVectorIndex:"",vsVectorCatalog:"",vsVectorSchema:"",schemaSource:"configured",schemaRefName:"",ucCatalog:"",ucSchema:"",functionSource:"configured",functionRefName:"",ucFunction:"",slackConnectionSource:"configured",slackConnectionRefName:"",slackChannelId:"",slackChannelName:"",agentLlmSource:"configured",agentLlmRefName:"",vectorSearchDescription:"",ucPartialArgs:[],emailHost:"smtp.gmail.com",emailHostSource:"manual",emailHostVariable:"",emailPort:"587",emailPortSource:"manual",emailPortVariable:"",emailUsername:"",emailUsernameSource:"manual",emailUsernameVariable:"",emailPassword:"",emailPasswordSource:"manual",emailPasswordVariable:"",emailSenderEmail:"",emailSenderEmailSource:"manual",emailSenderEmailVariable:"",emailUseTls:!0,emailToolName:"",emailToolDescription:""}),[d,g]=A.useState(ad),[v,S]=A.useState(nd),[y,b]=A.useState(!1),[_,x]=A.useState(!1),[f,C]=A.useState(!1),w=((we=e.resources)==null?void 0:we.genie_rooms)||{},I=((We=e.resources)==null?void 0:We.vector_stores)||{},R=e.retrievers||{},k=e.schemas||{},D=((He=e.resources)==null?void 0:He.functions)||{},L=((bt=e.resources)==null?void 0:bt.connections)||{},V=((Qe=e.resources)==null?void 0:Qe.llms)||{},B=((dt=e.resources)==null?void 0:dt.warehouses)||{},T=((Zt=e.resources)==null?void 0:Zt.databases)||{},F=j=>{for(const[Y,Q]of Object.entries(w)){const xe=Es(j.space_id),Ee=Es(Q.space_id);if(xe&&Ee&&xe===Ee||j.name&&Q.name===j.name)return Y}return null},E=j=>{for(const[Y,Q]of Object.entries(R))if(JSON.stringify(Q)===JSON.stringify(j))return Y;return null},$=j=>{for(const[Y,Q]of Object.entries(L))if(j.name&&Q.name===j.name)return Y;return null},p=j=>{for(const[Y,Q]of Object.entries(V))if(j.name&&Q.name===j.name)return Y;return null},N=j=>{for(const[Y,Q]of Object.entries(B))if(j.warehouse_id&&Q.warehouse_id===j.warehouse_id)return Y;return null},P=j=>{for(const[Y,Q]of Object.entries(T))if(j.name&&Q.name===j.name)return Y;return null},M=j=>{const Y=vm();if(!Y)return null;const Q=j.toLowerCase().replace(/-/g,"_");for(const[xe,Ee]of Object.entries(Y.aliasUsage))for(const Ge of Ee){const De=Ge.toLowerCase().replace(/-/g,"_");if(Q===De||Q.endsWith(De)||De.endsWith(Q))return xe}return null},O=j=>{for(const[Y,Q]of Object.entries(D))if(j.name&&Q.name===j.name)if(j.schema&&Q.schema){const xe=j.schema,Ee=Q.schema;if(xe.catalog_name===Ee.catalog_name&&xe.schema_name===Ee.schema_name)return Y}else return Y;return null},W=Object.entries(((ms=e.resources)==null?void 0:ms.apps)||{}).map(([j,Y])=>({value:j,label:`${j} (${Y.name})`})),q=Object.entries(w).map(([j,Y])=>({value:j,label:`${j} (${Y.name||Es(Y.space_id)})`})),ce=Object.entries(I).map(([j])=>({value:j,label:j})),se=Object.entries(R).map(([j,Y])=>{var Q;return{value:j,label:`${j} (${((Q=Y.search_parameters)==null?void 0:Q.num_results)||10} results)`}}),H=Object.entries(k).map(([j,Y])=>({value:j,label:`${j} (${Es(Y.catalog_name)}.${Es(Y.schema_name)})`})),z=Object.entries(D).map(([j,Y])=>({value:j,label:`${j} (${Y.name})`})),te=Object.entries(L).map(([j,Y])=>({value:j,label:`${j} (${Y.name})`})),K=Object.entries(V).map(([j,Y])=>({value:j,label:`${j} (${Y.name||j})`})),he=Object.entries(B).map(([j,Y])=>({value:j,label:`${j} (${Y.name||j})`})),J=Object.entries(T).map(([j,Y])=>({value:j,label:`${j} (${Y.name||j})`})),oe=e.tools||{},X=e.variables||{},Z=e.service_principals||{},me=Object.keys(X),Re=Object.keys(Z),st=[{value:"",label:"Select a variable..."},...me.map(j=>({value:j,label:j}))],it=[{value:"",label:"Select a service principal..."},...Re.map(j=>({value:j,label:j}))],{data:rt,loading:tt,refetch:ze}=Cm(r.ucCatalog||null,r.ucSchema||null),{data:Le,loading:Ke,refetch:Ne}=Ql(r.vectorEndpoint||null),{data:et,loading:lt,refetch:ot}=Ql(d.vectorEndpoint||null),{data:ve}=Ro(),Xe=()=>{if(!v.enabled)return;const j=[];return v.allowApprove&&j.push("approve"),v.allowEdit&&j.push("edit"),v.allowReject&&j.push("reject"),{review_prompt:v.reviewPrompt||void 0,allowed_decisions:j.length>0?j:void 0}},qe=()=>{const j={type:"mcp"};switch(d.useCredentials&&(d.credentialsMode==="service_principal"&&d.servicePrincipalRef?j.service_principal=`*${d.servicePrincipalRef}`:d.credentialsMode==="manual"&&(d.clientIdSource==="variable"&&d.clientIdVar?j.client_id=`*${d.clientIdVar}`:d.clientIdSource==="manual"&&d.clientIdManual&&(j.client_id=d.clientIdManual),d.clientSecretSource==="variable"&&d.clientSecretVar?j.client_secret=`*${d.clientSecretVar}`:d.clientSecretSource==="manual"&&d.clientSecretManual&&(j.client_secret=d.clientSecretManual),d.workspaceHostSource==="variable"&&d.workspaceHostVar?j.workspace_host=`*${d.workspaceHostVar}`:d.workspaceHostSource==="manual"&&d.workspaceHostManual&&(j.workspace_host=d.workspaceHostManual))),d.sourceType){case"url":d.urlSource==="variable"&&d.urlVariable?j.url=`__REF__${d.urlVariable}`:j.url=d.url;break;case"genie":d.genieSource==="configured"&&d.genieRefName?j.genie_room=`*${d.genieRefName}`:d.genieSource==="select"&&d.genieSpaceId&&(j.genie_room={name:d.genieName||"Genie Room",space_id:d.genieSpaceId,description:d.genieDescription||void 0});break;case"vector_search":d.vectorStoreSource==="configured"&&d.vectorStoreRefName?j.vector_search=`*${d.vectorStoreRefName}`:d.vectorStoreSource==="select"&&d.vectorIndex&&(j.vector_search={source_table:{schema:{catalog_name:d.vectorCatalog,schema_name:d.vectorSchema}},embedding_source_column:"content",index:{name:d.vectorIndex},endpoint:{name:d.vectorEndpoint}});break;case"functions":d.schemaSource==="configured"&&d.schemaRefName?j.functions=`*${d.schemaRefName}`:d.functionsCatalog&&d.functionsSchema&&(j.functions={catalog_name:d.functionsCatalog,schema_name:d.functionsSchema});break;case"sql":j.sql=!0;break;case"app":d.appSource==="configured"&&d.appRefName?j.app=`*${d.appRefName}`:d.appSource==="select"&&d.appName&&(j.app={name:d.appName});break;case"connection":d.connectionSource==="configured"&&d.connectionRefName?j.connection=`*${d.connectionRefName}`:d.connectionName&&(j.connection={name:d.connectionName});break}return d.includeTools.length>0&&(j.include_tools=d.includeTools),d.excludeTools.length>0&&(j.exclude_tools=d.excludeTools),j},ct=j=>{j.preventDefault();const Y=r.functionName==="custom"?r.customFunctionName:r.functionName;if(!r.refName.trim()||!r.name.trim())return;let Q;const xe=Xe();if(r.type==="factory"){let De={};if(r.functionName==="dao_ai.tools.create_genie_tool"){const Pe={name:r.name,description:"Tool for querying via Genie",persist_conversation:r.geniePersistConversation,truncate_results:r.genieTruncateResults};if(r.genieSource==="configured"&&r.genieRefName?Pe.genie_room=`__REF__${r.genieRefName}`:Pe.genie_room={space_id:r.genieSpaceId},r.genieLruCacheEnabled){const Be={capacity:r.genieLruCacheCapacity,time_to_live_seconds:r.genieLruCacheTtlNeverExpires?null:r.genieLruCacheTtl};r.genieLruCacheWarehouseSource==="configured"&&r.genieLruCacheWarehouseRefName?Be.warehouse=`__REF__${r.genieLruCacheWarehouseRefName}`:r.genieLruCacheWarehouseId&&(Be.warehouse={name:"lru_cache_warehouse",warehouse_id:r.genieLruCacheWarehouseId}),Pe.lru_cache_parameters=Be}if(r.genieSemanticCacheEnabled){const Be={time_to_live_seconds:r.genieSemanticCacheTtlNeverExpires?null:r.genieSemanticCacheTtl,similarity_threshold:r.genieSemanticCacheSimilarityThreshold,context_similarity_threshold:r.genieSemanticCacheContextSimilarityThreshold,question_weight:r.genieSemanticCacheQuestionWeight,context_weight:r.genieSemanticCacheContextWeight,context_window_size:r.genieSemanticCacheContextWindowSize,max_context_tokens:r.genieSemanticCacheMaxContextTokens,table_name:r.genieSemanticCacheTableName};r.genieSemanticCachePromptHistoryTable!=="genie_prompt_history"&&(Be.prompt_history_table=r.genieSemanticCachePromptHistoryTable),r.genieSemanticCacheMaxPromptHistoryLength!==50&&(Be.max_prompt_history_length=r.genieSemanticCacheMaxPromptHistoryLength),r.genieSemanticCacheUseGenieApiForHistory&&(Be.use_genie_api_for_history=!0),r.genieSemanticCachePromptHistoryTtlEnabled&&(Be.prompt_history_ttl_seconds=r.genieSemanticCachePromptHistoryTtl),r.genieSemanticCacheIvfflatListsAuto||(Be.ivfflat_lists=r.genieSemanticCacheIvfflatLists),r.genieSemanticCacheIvfflatProbesAuto||(Be.ivfflat_probes=r.genieSemanticCacheIvfflatProbes),r.genieSemanticCacheIvfflatCandidates!==20&&(Be.ivfflat_candidates=r.genieSemanticCacheIvfflatCandidates),r.genieSemanticCacheEmbeddingModelSource==="configured"&&r.genieSemanticCacheEmbeddingModelRefName?Be.embedding_model=`__REF__${r.genieSemanticCacheEmbeddingModelRefName}`:r.genieSemanticCacheEmbeddingModelManual&&(Be.embedding_model=r.genieSemanticCacheEmbeddingModelManual),r.genieSemanticCacheDatabaseSource==="configured"&&r.genieSemanticCacheDatabaseRefName&&(Be.database=`__REF__${r.genieSemanticCacheDatabaseRefName}`),r.genieSemanticCacheWarehouseSource==="configured"&&r.genieSemanticCacheWarehouseRefName?Be.warehouse=`__REF__${r.genieSemanticCacheWarehouseRefName}`:r.genieSemanticCacheWarehouseId&&(Be.warehouse={name:"semantic_cache_warehouse",warehouse_id:r.genieSemanticCacheWarehouseId}),Pe.context_aware_cache_parameters=Be}if(r.genieInMemoryCacheEnabled){const Be={time_to_live_seconds:r.genieInMemoryCacheTtlNeverExpires?null:r.genieInMemoryCacheTtl,similarity_threshold:r.genieInMemoryCacheSimilarityThreshold,context_similarity_threshold:r.genieInMemoryCacheContextSimilarityThreshold,question_weight:r.genieInMemoryCacheQuestionWeight,context_weight:r.genieInMemoryCacheContextWeight,context_window_size:r.genieInMemoryCacheContextWindowSize,max_context_tokens:r.genieInMemoryCacheMaxContextTokens,capacity:r.genieInMemoryCacheCapacityUnlimited?null:r.genieInMemoryCacheCapacity};r.genieInMemoryCacheEmbeddingModelSource==="configured"&&r.genieInMemoryCacheEmbeddingModelRefName?Be.embedding_model=`__REF__${r.genieInMemoryCacheEmbeddingModelRefName}`:r.genieInMemoryCacheEmbeddingModelManual&&(Be.embedding_model=r.genieInMemoryCacheEmbeddingModelManual),r.genieInMemoryCacheWarehouseSource==="configured"&&r.genieInMemoryCacheWarehouseRefName?Be.warehouse=`__REF__${r.genieInMemoryCacheWarehouseRefName}`:r.genieInMemoryCacheWarehouseId&&(Be.warehouse={name:"in_memory_cache_warehouse",warehouse_id:r.genieInMemoryCacheWarehouseId}),Pe.in_memory_context_aware_cache_parameters=Be}De=Pe}else if(r.functionName==="dao_ai.tools.create_vector_search_tool"){const Pe={name:r.name,...r.vectorSearchDescription&&{description:r.vectorSearchDescription}};r.vectorSearchSourceType==="retriever"?r.retrieverSource==="configured"&&r.retrieverRefName?De={...Pe,retriever:`__REF__${r.retrieverRefName}`}:De={...Pe,index_name:r.vectorIndex}:r.vectorStoreSource==="configured"&&r.vectorStoreRefName?De={...Pe,vector_store:`__REF__${r.vectorStoreRefName}`}:De={...Pe,vector_store:{index:{name:r.vsVectorIndex},source_table:{schema:{catalog_name:r.vsVectorCatalog,schema_name:r.vsVectorSchema}}}}}else if(r.functionName==="dao_ai.tools.create_send_slack_message_tool"){const Pe={name:r.name};r.slackConnectionSource==="configured"&&r.slackConnectionRefName&&(Pe.connection=`__REF__${r.slackConnectionRefName}`),r.slackChannelId?Pe.channel_id=r.slackChannelId:r.slackChannelName&&(Pe.channel_name=r.slackChannelName),De=Pe}else if(r.functionName==="dao_ai.tools.create_agent_endpoint_tool"){const Pe={name:r.name};r.agentLlmSource==="configured"&&r.agentLlmRefName&&(Pe.llm=`__REF__${r.agentLlmRefName}`),De=Pe}else if(r.functionName==="dao_ai.tools.create_send_email_tool"){const Pe={};r.emailHostSource==="variable"&&r.emailHostVariable?Pe.host=`*${r.emailHostVariable}`:Pe.host=r.emailHost,r.emailPortSource==="variable"&&r.emailPortVariable?Pe.port=`*${r.emailPortVariable}`:Pe.port=parseInt(r.emailPort)||587,r.emailUsernameSource==="variable"&&r.emailUsernameVariable?Pe.username=`*${r.emailUsernameVariable}`:Pe.username=r.emailUsername,r.emailPasswordSource==="variable"&&r.emailPasswordVariable?Pe.password=`*${r.emailPasswordVariable}`:Pe.password=r.emailPassword,(r.emailSenderEmail||r.emailSenderEmailVariable)&&(r.emailSenderEmailSource==="variable"&&r.emailSenderEmailVariable?Pe.sender_email=`*${r.emailSenderEmailVariable}`:r.emailSenderEmail&&(Pe.sender_email=r.emailSenderEmail)),Pe.use_tls=r.emailUseTls,De={smtp_config:Pe,...r.emailToolName&&{name:r.emailToolName},...r.emailToolDescription&&{description:r.emailToolDescription}}}else try{De=JSON.parse(r.args||"{}")}catch{}Q={type:"factory",name:Y||r.functionName,args:De,...xe&&{human_in_the_loop:xe}}}else if(r.type==="python")Q={type:"python",name:Y,...xe&&{human_in_the_loop:xe}};else if(r.type==="inline")Q={type:"inline",code:r.inlineCode,...xe&&{human_in_the_loop:xe}};else if(r.type==="unity_catalog"){let De;if(r.ucPartialArgs.length>0){De={};for(const Pe of r.ucPartialArgs)Pe.name&&Pe.value&&(Pe.source==="manual"?De[Pe.name]=Pe.value:De[Pe.name]=`__REF__${Pe.value}`);Object.keys(De).length===0&&(De=void 0)}r.functionSource==="configured"&&r.functionRefName?Q={type:"unity_catalog",resource:r.functionRefName,...De&&{partial_args:De},...xe&&{human_in_the_loop:xe}}:Q={type:"unity_catalog",resource:{schema:{catalog_name:r.ucCatalog,schema_name:r.ucSchema},name:r.ucFunction.split(".").pop()||r.ucFunction},...De&&{partial_args:De},...xe&&{human_in_the_loop:xe}}}else if(r.type==="mcp"){if(d.sourceType==="connection"&&!(d.connectionSource==="configured"&&d.connectionRefName||d.connectionSource==="select"&&d.connectionName))return;Q=qe(),xe&&(Q.human_in_the_loop=xe)}else Q=Y;const Ee={name:r.name,function:Q},Ge=r.refName.trim()||r.name;m?m!==Ge?(n(m),s(Ge,Ee)):a(Ge,Ee):s(Ge,Ee),At(),u(!1)},At=()=>{c({refName:"",name:"",type:"factory",functionName:"",customFunctionName:"",args:"{}",inlineCode:"",genieSource:"configured",genieRefName:"",genieSpaceId:"",geniePersistConversation:!0,genieTruncateResults:!1,genieLruCacheEnabled:!1,genieLruCacheCapacity:1e3,genieLruCacheTtl:86400,genieLruCacheTtlNeverExpires:!1,genieLruCacheWarehouseSource:"configured",genieLruCacheWarehouseRefName:"",genieLruCacheWarehouseId:"",genieSemanticCacheEnabled:!1,genieSemanticCacheTtl:86400,genieSemanticCacheTtlNeverExpires:!1,genieSemanticCacheSimilarityThreshold:.85,genieSemanticCacheContextSimilarityThreshold:.8,genieSemanticCacheQuestionWeight:.6,genieSemanticCacheContextWeight:.4,genieSemanticCacheContextWindowSize:4,genieSemanticCacheMaxContextTokens:2e3,genieSemanticCacheEmbeddingModelSource:"configured",genieSemanticCacheEmbeddingModelRefName:"",genieSemanticCacheEmbeddingModelManual:"databricks-gte-large-en",genieSemanticCacheTableName:"genie_context_aware_cache",genieSemanticCacheDatabaseSource:"configured",genieSemanticCacheDatabaseRefName:"",genieSemanticCacheWarehouseSource:"configured",genieSemanticCacheWarehouseRefName:"",genieSemanticCacheWarehouseId:"",genieSemanticCachePromptHistoryTable:"genie_prompt_history",genieSemanticCacheMaxPromptHistoryLength:50,genieSemanticCacheUseGenieApiForHistory:!1,genieSemanticCachePromptHistoryTtlEnabled:!1,genieSemanticCachePromptHistoryTtl:86400,genieSemanticCacheIvfflatListsAuto:!0,genieSemanticCacheIvfflatLists:100,genieSemanticCacheIvfflatProbesAuto:!0,genieSemanticCacheIvfflatProbes:10,genieSemanticCacheIvfflatCandidates:20,genieInMemoryCacheEnabled:!1,genieInMemoryCacheTtl:604800,genieInMemoryCacheTtlNeverExpires:!1,genieInMemoryCacheCapacity:1e4,genieInMemoryCacheCapacityUnlimited:!1,genieInMemoryCacheSimilarityThreshold:.85,genieInMemoryCacheContextSimilarityThreshold:.8,genieInMemoryCacheQuestionWeight:.6,genieInMemoryCacheContextWeight:.4,genieInMemoryCacheContextWindowSize:3,genieInMemoryCacheMaxContextTokens:2e3,genieInMemoryCacheEmbeddingModelSource:"configured",genieInMemoryCacheEmbeddingModelRefName:"",genieInMemoryCacheEmbeddingModelManual:"databricks-gte-large-en",genieInMemoryCacheWarehouseSource:"configured",genieInMemoryCacheWarehouseRefName:"",genieInMemoryCacheWarehouseId:"",warehouseSource:"configured",warehouseRefName:"",warehouseId:"",vectorSearchSourceType:"retriever",retrieverSource:"configured",retrieverRefName:"",vectorEndpoint:"",vectorIndex:"",vectorStoreSource:"configured",vectorStoreRefName:"",vsVectorEndpoint:"",vsVectorIndex:"",vsVectorCatalog:"",vsVectorSchema:"",schemaSource:"configured",schemaRefName:"",ucCatalog:"",ucSchema:"",functionSource:"configured",functionRefName:"",ucFunction:"",slackConnectionSource:"configured",slackConnectionRefName:"",slackChannelId:"",slackChannelName:"",agentLlmSource:"configured",agentLlmRefName:"",vectorSearchDescription:"",ucPartialArgs:[],emailHost:"smtp.gmail.com",emailHostSource:"manual",emailHostVariable:"",emailPort:"587",emailPortSource:"manual",emailPortVariable:"",emailUsername:"",emailUsernameSource:"manual",emailUsernameVariable:"",emailPassword:"",emailPasswordSource:"manual",emailPasswordVariable:"",emailSenderEmail:"",emailSenderEmailSource:"manual",emailSenderEmailVariable:"",emailUseTls:!0,emailToolName:"",emailToolDescription:""});const j=Object.keys(L).length>0,Y=Object.keys(k).length>0,Q=Object.keys(w).length>0,xe=Object.keys(I).length>0;g({...ad,connectionSource:j?"configured":"select",schemaSource:Y?"configured":"select",genieSource:Q?"configured":"select",vectorStoreSource:xe?"configured":"select"}),S(nd),b(!1),x(!1),C(!1),h(null)},{scrollToAsset:Qt}=zs(),zt=(j,Y)=>{var xe,Ee,Ge,De,Pe,Be,Ss,Cs,ns,ks,Oe,xt,wt,St,Ce,Ye,ut,G,ue;Qt(j),h(j),x(!0),C(!0);const Q=Y.function;if(typeof Q=="string"){const de=hl.some(ne=>ne.value===Q),ie=ml.some(ne=>ne.value===Q);c(ne=>({...ne,refName:j,name:Y.name,type:de?"python":ie?"factory":"python",functionName:de||ie?Q:"custom",customFunctionName:de||ie?"":Q}))}else if(typeof Q=="object"){const de=Q.type||"factory";if(Q.human_in_the_loop){const ie=Q.human_in_the_loop,ne=ie.allowed_decisions||["approve","edit","reject"];b(!0),S({enabled:!0,reviewPrompt:ie.review_prompt||"Please review the tool call",allowApprove:ne.includes("approve"),allowEdit:ne.includes("edit"),allowReject:ne.includes("reject")})}if(de==="factory"&&"args"in Q){const ie=Q,ne=ie.name||"",be=ml.some(pe=>pe.value===ne),le=ie.args||{};let je="configured",_e="",Fe="";if(le.genie_room){if(typeof le.genie_room=="string"&&le.genie_room.startsWith("__REF__"))_e=le.genie_room.replace("__REF__",""),je="configured";else if(typeof le.genie_room=="object"&&le.genie_room!==null){const pe=le.genie_room,qs=F(pe);qs?(_e=qs,je="configured"):pe.space_id&&(Fe=Es(pe.space_id),je="select")}}let mt="retriever",Ve="configured",Ht="",Xt="",rs="configured",es="",It="",bs="",Hs="";if(le.vector_store){if(mt="vector_store",typeof le.vector_store=="string"&&le.vector_store.startsWith("__REF__"))es=le.vector_store.replace("__REF__",""),rs="configured";else if(typeof le.vector_store=="object"&&le.vector_store!==null){const pe=le.vector_store,qs=(xe=Object.entries(I).find(([,Rs])=>{var ga,Ts;return((ga=Rs.index)==null?void 0:ga.name)===((Ts=pe.index)==null?void 0:Ts.name)}))==null?void 0:xe[0];qs?(es=qs,rs="configured"):(rs="select",It=((Ee=pe.index)==null?void 0:Ee.name)||"",bs=((De=(Ge=pe.source_table)==null?void 0:Ge.schema)==null?void 0:De.catalog_name)||"",Hs=((Be=(Pe=pe.source_table)==null?void 0:Pe.schema)==null?void 0:Be.schema_name)||"")}}else if(le.retriever){if(mt="retriever",typeof le.retriever=="string"&&le.retriever.startsWith("__REF__"))Ht=le.retriever.replace("__REF__",""),Ve="configured";else if(typeof le.retriever=="object"&&le.retriever!==null){const pe=E(le.retriever);pe?(Ht=pe,Ve="configured"):Ve="select"}}le.index_name&&!Ht&&mt==="retriever"&&(Xt=le.index_name,Ve="select");let Ls="configured",Bs="";if(le.connection){if(typeof le.connection=="string"&&le.connection.startsWith("__REF__"))Bs=le.connection.replace("__REF__",""),Ls="configured";else if(typeof le.connection=="object"&&le.connection!==null){const pe=$(le.connection);pe?(Bs=pe,Ls="configured"):Ls="select"}}let $s="smtp.gmail.com",na="manual",ra="",Ws="587",Ma="manual",Ra="",Ta="",Ea="manual",Aa="",Pa="",Ia="manual",Oa="",La="",$a="manual",Ct="",Bt=!0,hs="",vs="";if(le.smtp_config){const pe=le.smtp_config;typeof pe.host=="string"&&(pe.host.startsWith("*")?(na="variable",ra=pe.host.substring(1)):$s=pe.host),pe.port&&(typeof pe.port=="string"&&pe.port.startsWith("*")?(Ma="variable",Ra=pe.port.substring(1)):Ws=String(pe.port)),typeof pe.username=="string"&&(pe.username.startsWith("*")?(Ea="variable",Aa=pe.username.substring(1)):Ta=pe.username),typeof pe.password=="string"&&(pe.password.startsWith("*")?(Ia="variable",Oa=pe.password.substring(1)):Pa=pe.password),pe.sender_email&&(typeof pe.sender_email=="string"&&pe.sender_email.startsWith("*")?($a="variable",Ct=pe.sender_email.substring(1)):La=String(pe.sender_email)),typeof pe.use_tls=="boolean"&&(Bt=pe.use_tls)}le.name&&typeof le.name=="string"&&(hs=le.name),le.description&&typeof le.description=="string"&&(vs=le.description);let is="configured",xa="";if(le.llm){if(typeof le.llm=="string"&&le.llm.startsWith("__REF__"))xa=le.llm.replace("__REF__",""),is="configured";else if(typeof le.llm=="object"&&le.llm!==null){const pe=p(le.llm);pe?(xa=pe,is="configured"):is="select"}}let gt=!1,ls=1e3,kt=86400,Je=!1,jt="configured",Ms="",ht="";if(le.lru_cache_parameters){gt=!0;const pe=le.lru_cache_parameters;ls=pe.capacity??1e3,pe.time_to_live_seconds===null?Je=!0:kt=pe.time_to_live_seconds??86400;const qs=`tools.${j}.function.args.lru_cache_parameters.warehouse`,Rs=M(qs);if(Rs&&B[Rs])Ms=Rs,jt="configured";else if(typeof pe.warehouse=="string"&&pe.warehouse.startsWith("__REF__"))Ms=pe.warehouse.replace("__REF__",""),jt="configured";else if(typeof pe.warehouse=="object"&&pe.warehouse!==null){const ga=pe.warehouse,Ts=N(ga);Ts?(Ms=Ts,jt="configured"):(ht=ga.warehouse_id||"",jt="select")}}let Ue=!1,ps=86400,Kn=!1,Us=.85,Vs=.8,Yo=.6,Ko=.4,Xo=4,Jo=2e3,tn="configured",Xn="",Qi="databricks-gte-large-en",Qo="genie_context_aware_cache",Wr="configured",Ur="",Jn="configured",qr="",Zo="",ec="genie_prompt_history",tc=50,sc=!1,ac=!1,nc=86400,rc=!0,ic=100,lc=!0,oc=10,cc=20;if(le.context_aware_cache_parameters||le.semantic_cache_parameters){Ue=!0;const pe=le.context_aware_cache_parameters||le.semantic_cache_parameters;pe.time_to_live_seconds===null?Kn=!0:ps=pe.time_to_live_seconds??86400,Us=pe.similarity_threshold??.85,Vs=pe.context_similarity_threshold??.8,Yo=pe.question_weight??.6,Ko=pe.context_weight??.4,Xo=pe.context_window_size??4,Jo=pe.max_context_tokens??2e3,Qo=pe.table_name??"genie_context_aware_cache",ec=pe.prompt_history_table??"genie_prompt_history",tc=pe.max_prompt_history_length??50,sc=pe.use_genie_api_for_history??!1,pe.prompt_history_ttl_seconds!=null&&(ac=!0,nc=pe.prompt_history_ttl_seconds),pe.ivfflat_lists!=null&&(rc=!1,ic=pe.ivfflat_lists),pe.ivfflat_probes!=null&&(lc=!1,oc=pe.ivfflat_probes),cc=pe.ivfflat_candidates??20;const qs=`tools.${j}.function.args.context_aware_cache_parameters.embedding_model`,Rs=M(qs);if(Rs&&V[Rs])Xn=Rs,tn="configured";else if(typeof pe.embedding_model=="string")if(pe.embedding_model.startsWith("__REF__"))Xn=pe.embedding_model.replace("__REF__",""),tn="configured";else{const Ks=Object.entries(V).find(([,ia])=>ia.name===pe.embedding_model);Ks?(Xn=Ks[0],tn="configured"):(Qi=pe.embedding_model,tn="select")}else if(typeof pe.embedding_model=="object"&&pe.embedding_model!==null){const Ks=pe.embedding_model,ia=p(Ks);ia?(Xn=ia,tn="configured"):Ks.name&&(Qi=Ks.name,tn="select")}const ga=`tools.${j}.function.args.context_aware_cache_parameters.database`,Ts=M(ga);if(Ts&&T[Ts])Ur=Ts,Wr="configured";else if(typeof pe.database=="string"&&pe.database.startsWith("__REF__"))Ur=pe.database.replace("__REF__",""),Wr="configured";else if(typeof pe.database=="object"&&pe.database!==null){const Ks=pe.database,ia=P(Ks);ia&&(Ur=ia,Wr="configured")}const Gs=`tools.${j}.function.args.context_aware_cache_parameters.warehouse`,Ys=M(Gs);if(Ys&&B[Ys])qr=Ys,Jn="configured";else if(typeof pe.warehouse=="string"&&pe.warehouse.startsWith("__REF__"))qr=pe.warehouse.replace("__REF__",""),Jn="configured";else if(typeof pe.warehouse=="object"&&pe.warehouse!==null){const Ks=pe.warehouse,ia=N(Ks);ia?(qr=ia,Jn="configured"):(Zo=Ks.warehouse_id||"",Jn="select")}}let dc=!1,uc=604800,mc=!1,hc=1e4,pc=!1,fc=.85,xc=.8,gc=.6,bc=.4,vc=3,yc=2e3,sn="configured",Qn="",Zi="databricks-gte-large-en",Zn="configured",Gr="",jc="";if(le.in_memory_context_aware_cache_parameters||le.in_memory_semantic_cache_parameters){dc=!0;const pe=le.in_memory_context_aware_cache_parameters||le.in_memory_semantic_cache_parameters;pe.time_to_live_seconds===null?mc=!0:uc=pe.time_to_live_seconds??604800,pe.capacity===null?pc=!0:hc=pe.capacity??1e4,fc=pe.similarity_threshold??.85,xc=pe.context_similarity_threshold??.8,gc=pe.question_weight??.6,bc=pe.context_weight??.4,vc=pe.context_window_size??3,yc=pe.max_context_tokens??2e3;const qs=`tools.${j}.function.args.in_memory_context_aware_cache_parameters.embedding_model`,Rs=M(qs);if(Rs&&V[Rs])Qn=Rs,sn="configured";else if(typeof pe.embedding_model=="string")if(pe.embedding_model.startsWith("__REF__"))Qn=pe.embedding_model.replace("__REF__",""),sn="configured";else{const Gs=Object.entries(V).find(([,Ys])=>Ys.name===pe.embedding_model);Gs?(Qn=Gs[0],sn="configured"):(Zi=pe.embedding_model,sn="select")}else if(typeof pe.embedding_model=="object"&&pe.embedding_model!==null){const Gs=pe.embedding_model,Ys=p(Gs);Ys?(Qn=Ys,sn="configured"):Gs.name&&(Zi=Gs.name,sn="select")}const ga=`tools.${j}.function.args.in_memory_context_aware_cache_parameters.warehouse`,Ts=M(ga);if(Ts&&B[Ts])Gr=Ts,Zn="configured";else if(typeof pe.warehouse=="string"&&pe.warehouse.startsWith("__REF__"))Gr=pe.warehouse.replace("__REF__",""),Zn="configured";else if(typeof pe.warehouse=="object"&&pe.warehouse!==null){const Gs=pe.warehouse,Ys=N(Gs);Ys?(Gr=Ys,Zn="configured"):(jc=Gs.warehouse_id||"",Zn="select")}}c(pe=>({...pe,refName:j,name:Y.name,type:"factory",functionName:be?ne:"custom",customFunctionName:be?"":ne,genieSource:je,genieRefName:_e,genieSpaceId:Fe,geniePersistConversation:le.persist_conversation??!0,genieTruncateResults:le.truncate_results??!1,genieLruCacheEnabled:gt,genieLruCacheCapacity:ls,genieLruCacheTtl:kt,genieLruCacheTtlNeverExpires:Je,genieLruCacheWarehouseSource:jt,genieLruCacheWarehouseRefName:Ms,genieLruCacheWarehouseId:ht,genieSemanticCacheEnabled:Ue,genieSemanticCacheTtl:ps,genieSemanticCacheTtlNeverExpires:Kn,genieSemanticCacheSimilarityThreshold:Us,genieSemanticCacheContextSimilarityThreshold:Vs,genieSemanticCacheQuestionWeight:Yo,genieSemanticCacheContextWeight:Ko,genieSemanticCacheContextWindowSize:Xo,genieSemanticCacheMaxContextTokens:Jo,genieSemanticCacheEmbeddingModelSource:tn,genieSemanticCacheEmbeddingModelRefName:Xn,genieSemanticCacheEmbeddingModelManual:Qi,genieSemanticCacheTableName:Qo,genieSemanticCacheDatabaseSource:Wr,genieSemanticCacheDatabaseRefName:Ur,genieSemanticCacheWarehouseSource:Jn,genieSemanticCacheWarehouseRefName:qr,genieSemanticCacheWarehouseId:Zo,genieSemanticCachePromptHistoryTable:ec,genieSemanticCacheMaxPromptHistoryLength:tc,genieSemanticCacheUseGenieApiForHistory:sc,genieSemanticCachePromptHistoryTtlEnabled:ac,genieSemanticCachePromptHistoryTtl:nc,genieSemanticCacheIvfflatListsAuto:rc,genieSemanticCacheIvfflatLists:ic,genieSemanticCacheIvfflatProbesAuto:lc,genieSemanticCacheIvfflatProbes:oc,genieSemanticCacheIvfflatCandidates:cc,genieInMemoryCacheEnabled:dc,genieInMemoryCacheTtl:uc,genieInMemoryCacheTtlNeverExpires:mc,genieInMemoryCacheCapacity:hc,genieInMemoryCacheCapacityUnlimited:pc,genieInMemoryCacheSimilarityThreshold:fc,genieInMemoryCacheContextSimilarityThreshold:xc,genieInMemoryCacheQuestionWeight:gc,genieInMemoryCacheContextWeight:bc,genieInMemoryCacheContextWindowSize:vc,genieInMemoryCacheMaxContextTokens:yc,genieInMemoryCacheEmbeddingModelSource:sn,genieInMemoryCacheEmbeddingModelRefName:Qn,genieInMemoryCacheEmbeddingModelManual:Zi,genieInMemoryCacheWarehouseSource:Zn,genieInMemoryCacheWarehouseRefName:Gr,genieInMemoryCacheWarehouseId:jc,vectorSearchSourceType:mt,retrieverSource:Ve,retrieverRefName:Ht,vectorIndex:Xt,vectorStoreSource:rs,vectorStoreRefName:es,vsVectorIndex:It,vsVectorCatalog:bs,vsVectorSchema:Hs,vectorSearchDescription:le.description||"",slackConnectionSource:Ls,slackConnectionRefName:Bs,slackChannelId:le.channel_id||"",slackChannelName:le.channel_name||"",agentLlmSource:is,agentLlmRefName:xa,emailHost:$s,emailHostSource:na,emailHostVariable:ra,emailPort:Ws,emailPortSource:Ma,emailPortVariable:Ra,emailUsername:Ta,emailUsernameSource:Ea,emailUsernameVariable:Aa,emailPassword:Pa,emailPasswordSource:Ia,emailPasswordVariable:Oa,emailSenderEmail:La,emailSenderEmailSource:$a,emailSenderEmailVariable:Ct,emailUseTls:Bt,emailToolName:hs,emailToolDescription:vs}))}else if(de==="python"){const ie="name"in Q?Q.name:"",ne=hl.some(be=>be.value===ie);c(be=>({...be,refName:j,name:Y.name,type:"python",functionName:ne?ie:"custom",customFunctionName:ne?"":ie}))}else if(de==="inline"){const ie="code"in Q?Q.code:"";c(ne=>({...ne,refName:j,name:Y.name,type:"inline",inlineCode:ie}))}else if(de==="unity_catalog"){const ie=Q,ne=ie.resource,be=ie.partial_args||{},le=Object.entries(be).map(([je,_e])=>{let Fe="manual",mt=String(_e);if(typeof _e=="string"&&_e.startsWith("__REF__")){const Ve=_e.replace("__REF__","");(e.service_principals||{})[Ve]?(Fe="service_principal",mt=Ve):(Fe="variable",mt=Ve)}return{id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:je,source:Fe,value:mt}});if(typeof ne=="string"){const je=ne.startsWith("*")?ne.slice(1):ne;c(_e=>({..._e,refName:j,name:Y.name,type:"unity_catalog",functionSource:"configured",functionRefName:je,ucPartialArgs:le}))}else if(ne&&typeof ne=="object"){const je=ne,_e=je.schema,Fe=je.name||"",mt=O({name:Fe,schema:_e});if(mt)c(Ve=>({...Ve,refName:j,name:Y.name,type:"unity_catalog",functionSource:"configured",functionRefName:mt,ucPartialArgs:le}));else{let Ve=Fe;_e&&"catalog_name"in _e&&"schema_name"in _e&&(Ve=`${_e.catalog_name}.${_e.schema_name}.${Fe}`),c(Ht=>({...Ht,refName:j,name:Y.name,type:"unity_catalog",functionSource:"select",ucFunction:Ve,ucPartialArgs:le}))}}else c(je=>({...je,refName:j,name:Y.name,type:"unity_catalog",functionSource:"select",ucFunction:"",ucPartialArgs:le}))}else if(de==="mcp"){const ie=Q;if(c(ne=>({...ne,refName:j,name:Y.name,type:"mcp"})),ie.connection){const ne=ie.connection,be=typeof ne=="string"&&ne.startsWith("*"),le=be?ne.slice(1):(ne==null?void 0:ne.name)||"",je=(Ss=Object.entries(L).find(([_e,Fe])=>be?_e===le:Fe.name===le))==null?void 0:Ss[0];g(_e=>({..._e,sourceType:"connection",connectionSource:je?"configured":"select",connectionRefName:je||"",connectionName:je?"":le}))}else if(ie.genie_room){const ne=ie.genie_room,be=typeof ne=="string"&&ne.startsWith("*"),le=be?ne.slice(1):"",je=Es(ne==null?void 0:ne.space_id),_e=be?le:(Cs=Object.entries(w).find(([,Ve])=>Es(Ve.space_id)===je||Ve.name===(ne==null?void 0:ne.name)))==null?void 0:Cs[0];let Fe="",mt="";if(_e){const Ve=w[_e];Fe=(Ve==null?void 0:Ve.name)||_e,mt=(Ve==null?void 0:Ve.description)||""}else ne!=null&&ne.name&&(Fe=ne.name,mt=ne.description||"");g(Ve=>({...Ve,sourceType:"genie",genieSource:_e?"configured":"select",genieRefName:_e||"",genieSpaceId:!_e&&(ne!=null&&ne.space_id)?je:"",genieName:Fe,genieDescription:mt}))}else if(ie.vector_search){const ne=ie.vector_search;let be="select",le="",je="",_e="",Fe="",mt="";if(typeof ne=="string"&&ne.startsWith("*"))le=ne.slice(1),be="configured";else if(typeof ne=="object"&&ne!==null){const Ve=ne,Ht=((ns=e.resources)==null?void 0:ns.vector_stores)||{};let Xt;const rs=typeof Ve.index=="string"?Ve.index:(ks=Ve.index)==null?void 0:ks.name;rs&&(Xt=(Oe=Object.entries(Ht).find(([,es])=>{const It=es.index;return(typeof It=="string"?It:It==null?void 0:It.name)===rs}))==null?void 0:Oe[0]),!Xt&&((xt=Ve.endpoint)!=null&&xt.name)&&(Xt=(wt=Object.entries(Ht).find(([,es])=>{var It,bs;return((It=es.endpoint)==null?void 0:It.name)===((bs=Ve.endpoint)==null?void 0:bs.name)}))==null?void 0:wt[0]),Xt||(Xt=(St=Object.entries(Ht).find(([,es])=>JSON.stringify(es)===JSON.stringify(Ve)))==null?void 0:St[0]),Xt?(le=Xt,be="configured"):(be="select",je=rs||"",_e=((Ye=(Ce=Ve.source_table)==null?void 0:Ce.schema)==null?void 0:Ye.catalog_name)||"",Fe=((G=(ut=Ve.source_table)==null?void 0:ut.schema)==null?void 0:G.schema_name)||"",mt=((ue=Ve.endpoint)==null?void 0:ue.name)||"")}g(Ve=>({...Ve,sourceType:"vector_search",vectorStoreSource:be,vectorStoreRefName:le,vectorIndex:je,vectorCatalog:_e,vectorSchema:Fe,vectorEndpoint:mt}))}else if(ie.functions){const ne=ie.functions;g(be=>({...be,sourceType:"functions",functionsCatalog:(ne==null?void 0:ne.catalog_name)||"",functionsSchema:(ne==null?void 0:ne.schema_name)||""}))}else if(ie.sql)g(ne=>({...ne,sourceType:"sql"}));else if(ie.app){const ne=ie.app,be=typeof ne=="string"&&ne.startsWith("*"),le=be?ne.slice(1):"",je=typeof ne=="object"&&ne.name?ne.name:"";g(_e=>({..._e,sourceType:"app",appSource:be?"configured":"select",appRefName:le,appName:je}))}else if(ie.url){const ne=typeof ie.url=="string"?ie.url:"",be=ne.startsWith("__REF__");g(le=>({...le,sourceType:"url",urlSource:be?"variable":"manual",url:be?"":ne,urlVariable:be?ne.substring(7):""}))}(ie.include_tools||ie.exclude_tools)&&g(ne=>({...ne,includeTools:ie.include_tools||[],excludeTools:ie.exclude_tools||[]}))}}u(!0)},yt=j=>{var Y;return typeof j.function=="string"?"string":((Y=j.function)==null?void 0:Y.type)||"unknown"},_t=j=>{var Y;return typeof j.function=="string"?!1:!!((Y=j.function)!=null&&Y.human_in_the_loop)},Pt=j=>{const Y=yt(j);if(Y==="mcp")return pf;if(Y==="unity_catalog")return $t;if(Y==="inline")return nf;if(typeof j.function=="object"&&j.function.name){if(j.function.name.includes("genie"))return Xa;if(j.function.name.includes("vector")||j.function.name.includes("search"))return Ba;if(j.function.name.includes("time"))return Rn;if(j.function.name.includes("agent"))return ts}return ma},Kt=[{value:"",label:"Select a function..."},...(rt||[]).map(j=>({value:j.full_name,label:`${j.name}${j.comment?` - ${j.comment}`:""}`}))],re=[{value:"",label:"Select an index..."},...(Le||[]).map(j=>({value:j.name,label:`${j.name}${j.index_type?` (${j.index_type})`:""}`}))],fe=[{value:"",label:"Select an index..."},...(et||[]).map(j=>({value:j.name,label:`${j.name}${j.index_type?` (${j.index_type})`:""}`}))],Me=j=>j?"env"in j?`env: ${j.env}`:"scope"in j&&"secret"in j?`secret: ${j.scope}/${j.secret}`:"value"in j?`value: ${String(j.value)}`:"options"in j?`composite (${j.options.length} options)`:"unknown":"unknown";return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-white",children:"Tools"}),t.jsx("p",{className:"text-slate-400 mt-1",children:"Configure tools that agents can use to perform tasks"})]}),t.jsxs(ee,{onClick:()=>u(!0),children:[t.jsx(Ie,{className:"w-4 h-4"}),"Add Tool"]})]}),Object.keys(oe).length===0?t.jsxs($e,{className:"text-center py-12",children:[t.jsx(ma,{className:"w-12 h-12 mx-auto text-slate-600 mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-slate-300 mb-2",children:"No tools configured"}),t.jsx("p",{className:"text-slate-500 mb-4",children:"Tools enable agents to interact with external systems and data."}),t.jsxs(ee,{onClick:()=>u(!0),children:[t.jsx(Ie,{className:"w-4 h-4"}),"Add Your First Tool"]})]}):t.jsx("div",{className:"grid gap-4",children:Object.entries(oe).map(([j,Y])=>{const Q=Pt(Y);return t.jsx($e,{variant:"interactive",className:"group cursor-pointer",onClick:()=>zt(j,Y),children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("div",{className:"w-10 h-10 rounded-lg bg-amber-500/20 flex items-center justify-center",children:t.jsx(Q,{className:"w-5 h-5 text-amber-400"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-white",children:j}),j!==Y.name&&t.jsxs("p",{className:"text-xs text-slate-500",children:["name: ",Y.name]}),t.jsx("p",{className:"text-sm text-slate-400 font-mono",children:typeof Y.function=="object"?"name"in Y.function?Y.function.name:`${Y.function.type}`:Y.function})]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[_t(Y)&&t.jsxs(Se,{variant:"success",title:"Human In The Loop Enabled",children:[t.jsx(Dn,{className:"w-3 h-3 mr-1"}),"HITL"]}),t.jsx(Se,{variant:"warning",children:yt(Y)}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:xe=>{xe.stopPropagation(),zt(j,Y)},title:"Edit tool",children:t.jsx(Lr,{className:"w-4 h-4"})}),t.jsx(ee,{variant:"danger",size:"sm",onClick:xe=>{xe.stopPropagation(),Gt("Tool",j,()=>n(j))},title:"Delete tool",children:t.jsx(Ze,{className:"w-4 h-4"})})]})]})},j)})}),t.jsx(ws,{isOpen:o,onClose:()=>{u(!1),At()},title:m?"Edit Tool":"Add Tool",description:m?"Modify the tool configuration":"Configure a tool for your agents",size:"lg",children:t.jsxs("form",{onSubmit:ct,className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(U,{label:"Reference Name",placeholder:"e.g., find_product_by_sku_tool",value:r.refName,onChange:j=>{const Y=Ot(j.target.value);c(_?{...r,refName:Y}:{...r,refName:Y,name:Y}),C(!0)},hint:"YAML key (spaces become underscores)",required:!0}),t.jsx(ae,{label:"Tool Type",options:sb,value:r.type,onChange:j=>c({...r,type:j.target.value})})]}),t.jsx(U,{label:"Tool Name",placeholder:"e.g., find_product_by_sku_uc",value:r.name,onChange:j=>{const Y=j.target.value;if(f)c({...r,name:Y});else{const Q=Ot(Y);c({...r,name:Y,refName:Q})}x(!0)},hint:"The name property inside the tool config (can differ from reference name)",required:!0}),r.type==="factory"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Factory Function"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:ml.map(j=>{const Y=j.icon,Q=r.functionName===j.value;return t.jsxs("button",{type:"button",onClick:()=>{const xe=nr(j.value);c({...r,functionName:j.value,name:_?r.name:xe,refName:f?r.refName:xe})},className:`p-3 rounded-lg border text-left transition-all ${Q?"border-blue-500 bg-blue-500/10":"border-slate-700 hover:border-slate-600 bg-slate-800/50"}`,children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Y,{className:`w-4 h-4 ${Q?"text-blue-400":"text-slate-400"}`}),t.jsx("span",{className:`text-sm font-medium ${Q?"text-white":"text-slate-300"}`,children:j.label})]}),t.jsx("p",{className:"text-xs text-slate-500 mt-1",children:j.description})]},j.value)})})]}),r.functionName==="dao_ai.tools.create_genie_tool"&&t.jsxs("div",{className:"space-y-4 p-4 bg-slate-800/50 rounded-lg border border-slate-700",children:[t.jsx("h4",{className:"text-sm font-medium text-slate-300",children:"Genie Tool Configuration"}),t.jsx(os,{label:"Genie Room",resourceType:"Genie room",configuredOptions:q,configuredValue:r.genieRefName,onConfiguredChange:j=>c({...r,genieRefName:j,genieSpaceId:""}),source:r.genieSource,onSourceChange:j=>c({...r,genieSource:j}),children:t.jsx(Kc,{value:r.genieSpaceId,onChange:j=>{const Y=ve==null?void 0:ve.find(xe=>xe.space_id===j),Q=(Y==null?void 0:Y.title)||"";c({...r,genieSpaceId:j,genieRefName:"",name:m?r.name:Q})},required:!0})}),t.jsxs("div",{className:"space-y-3 pt-2 border-t border-slate-700",children:[t.jsx("h5",{className:"text-xs font-medium text-slate-400 uppercase tracking-wider",children:"Options"}),t.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[t.jsx("input",{type:"checkbox",checked:r.geniePersistConversation,onChange:j=>c({...r,geniePersistConversation:j.target.checked}),className:"mt-0.5 w-4 h-4 rounded border-slate-600 bg-slate-800 text-violet-500 focus:ring-violet-500 focus:ring-offset-slate-900"}),t.jsxs("div",{children:[t.jsx("span",{className:"text-sm text-slate-200 group-hover:text-white",children:"Persist Conversation"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Keep conversation context across tool calls for multi-turn conversations within the same Genie space"})]})]}),t.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[t.jsx("input",{type:"checkbox",checked:r.genieTruncateResults,onChange:j=>c({...r,genieTruncateResults:j.target.checked}),className:"mt-0.5 w-4 h-4 rounded border-slate-600 bg-slate-800 text-violet-500 focus:ring-violet-500 focus:ring-offset-slate-900"}),t.jsxs("div",{children:[t.jsx("span",{className:"text-sm text-slate-200 group-hover:text-white",children:"Truncate Results"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Truncate large query results to fit within token limits"})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[t.jsx("input",{type:"checkbox",checked:r.genieLruCacheEnabled,onChange:j=>c({...r,genieLruCacheEnabled:j.target.checked}),className:"mt-0.5 w-4 h-4 rounded border-slate-600 bg-slate-800 text-violet-500 focus:ring-violet-500 focus:ring-offset-slate-900"}),t.jsxs("div",{children:[t.jsx("span",{className:"text-sm text-slate-200 group-hover:text-white",children:"Enable LRU Cache"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Cache query results using Least Recently Used eviction policy"})]})]}),r.genieLruCacheEnabled&&t.jsxs("div",{className:"ml-7 space-y-3 p-3 bg-slate-900/50 rounded-lg border border-slate-700/50",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsx(U,{label:"Capacity",type:"number",value:r.genieLruCacheCapacity.toString(),onChange:j=>c({...r,genieLruCacheCapacity:parseInt(j.target.value)||1e3}),hint:"Max cached entries"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"TTL (seconds)"}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("input",{type:"number",value:r.genieLruCacheTtlNeverExpires?"":r.genieLruCacheTtl,onChange:j=>c({...r,genieLruCacheTtl:parseInt(j.target.value)||86400}),disabled:r.genieLruCacheTtlNeverExpires,className:"flex-1 px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-violet-500 focus:ring-1 focus:ring-violet-500 disabled:opacity-50"})}),t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:r.genieLruCacheTtlNeverExpires,onChange:j=>c({...r,genieLruCacheTtlNeverExpires:j.target.checked}),className:"w-3 h-3 rounded border-slate-600 bg-slate-800 text-violet-500"}),t.jsx("span",{className:"text-xs text-slate-400",children:"Never expires"})]})]})]}),t.jsx(os,{label:"Warehouse",resourceType:"Warehouse",configuredOptions:he,configuredValue:r.genieLruCacheWarehouseRefName,onConfiguredChange:j=>c({...r,genieLruCacheWarehouseRefName:j,genieLruCacheWarehouseId:""}),source:r.genieLruCacheWarehouseSource,onSourceChange:j=>c({...r,genieLruCacheWarehouseSource:j}),hint:"SQL warehouse for cache operations",children:t.jsx(U,{label:"Warehouse ID",placeholder:"Enter warehouse ID",value:r.genieLruCacheWarehouseId,onChange:j=>c({...r,genieLruCacheWarehouseId:j.target.value,genieLruCacheWarehouseRefName:""})})})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[t.jsx("input",{type:"checkbox",checked:r.genieSemanticCacheEnabled,onChange:j=>c({...r,genieSemanticCacheEnabled:j.target.checked}),className:"mt-0.5 w-4 h-4 rounded border-slate-600 bg-slate-800 text-violet-500 focus:ring-violet-500 focus:ring-offset-slate-900"}),t.jsxs("div",{children:[t.jsx("span",{className:"text-sm text-slate-200 group-hover:text-white",children:"Enable Persistent Context-Aware Cache"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Context-aware similarity matching with database-backed storage (requires Lakebase database)"})]})]}),r.genieSemanticCacheEnabled&&t.jsxs("div",{className:"ml-7 space-y-3 p-3 bg-slate-900/50 rounded-lg border border-slate-700/50",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsx(U,{label:"Question Similarity Threshold",type:"number",step:"0.01",min:"0",max:"1",value:r.genieSemanticCacheSimilarityThreshold.toString(),onChange:j=>c({...r,genieSemanticCacheSimilarityThreshold:parseFloat(j.target.value)||.85}),hint:"Min similarity for question matching (0-1)"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"TTL (seconds)"}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("input",{type:"number",value:r.genieSemanticCacheTtlNeverExpires?"":r.genieSemanticCacheTtl,onChange:j=>c({...r,genieSemanticCacheTtl:parseInt(j.target.value)||86400}),disabled:r.genieSemanticCacheTtlNeverExpires,className:"flex-1 px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-violet-500 focus:ring-1 focus:ring-violet-500 disabled:opacity-50"})}),t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:r.genieSemanticCacheTtlNeverExpires,onChange:j=>c({...r,genieSemanticCacheTtlNeverExpires:j.target.checked}),className:"w-3 h-3 rounded border-slate-600 bg-slate-800 text-violet-500"}),t.jsx("span",{className:"text-xs text-slate-400",children:"Never expires"})]})]})]}),t.jsxs("div",{className:"space-y-3 p-3 bg-slate-800/30 rounded-lg border border-slate-700/30",children:[t.jsx("h5",{className:"text-xs font-semibold text-slate-300 uppercase tracking-wide",children:"Conversation-Aware Settings"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Cache considers conversation context, not just the current question"}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsx(U,{label:"Context Similarity Threshold",type:"number",step:"0.01",min:"0",max:"1",value:r.genieSemanticCacheContextSimilarityThreshold.toString(),onChange:j=>c({...r,genieSemanticCacheContextSimilarityThreshold:parseFloat(j.target.value)||.8}),hint:"Min similarity for conversation context (0-1)"}),t.jsx(U,{label:"Question Weight",type:"number",step:"0.01",min:"0",max:"1",value:r.genieSemanticCacheQuestionWeight.toString(),onChange:j=>{const Y=parseFloat(j.target.value)||.6;c({...r,genieSemanticCacheQuestionWeight:Y,genieSemanticCacheContextWeight:1-Y})},hint:"Weight for question similarity. Context weight = 1 - this"}),t.jsx(U,{label:"Context Window Size",type:"number",min:"1",max:"10",value:r.genieSemanticCacheContextWindowSize.toString(),onChange:j=>c({...r,genieSemanticCacheContextWindowSize:parseInt(j.target.value)||4}),hint:"Number of previous turns to include"}),t.jsx(U,{label:"Max Context Tokens",type:"number",step:"100",min:"100",max:"10000",value:r.genieSemanticCacheMaxContextTokens.toString(),onChange:j=>c({...r,genieSemanticCacheMaxContextTokens:parseInt(j.target.value)||2e3}),hint:"Max tokens to prevent long embeddings"})]})]}),t.jsx(os,{label:"Embedding Model",resourceType:"LLM",configuredOptions:K,configuredValue:r.genieSemanticCacheEmbeddingModelRefName,onConfiguredChange:j=>c({...r,genieSemanticCacheEmbeddingModelRefName:j,genieSemanticCacheEmbeddingModelManual:""}),source:r.genieSemanticCacheEmbeddingModelSource,onSourceChange:j=>c({...r,genieSemanticCacheEmbeddingModelSource:j}),hint:"Model for computing embeddings",children:t.jsx(U,{label:"Model Name",placeholder:"databricks-gte-large-en",value:r.genieSemanticCacheEmbeddingModelManual,onChange:j=>c({...r,genieSemanticCacheEmbeddingModelManual:j.target.value,genieSemanticCacheEmbeddingModelRefName:""}),hint:"Enter embedding model name manually"})}),t.jsx(U,{label:"Cache Table Name",placeholder:"genie_semantic_cache",value:r.genieSemanticCacheTableName,onChange:j=>c({...r,genieSemanticCacheTableName:j.target.value}),hint:"Table to store cache entries"}),t.jsx(ae,{label:"Database (Lakebase)",value:r.genieSemanticCacheDatabaseRefName,onChange:j=>c({...r,genieSemanticCacheDatabaseRefName:j.target.value,genieSemanticCacheDatabaseSource:"configured"}),hint:"Lakebase database for context-aware cache storage",options:J,placeholder:"Select configured database..."}),t.jsx(os,{label:"Warehouse",resourceType:"Warehouse",configuredOptions:he,configuredValue:r.genieSemanticCacheWarehouseRefName,onConfiguredChange:j=>c({...r,genieSemanticCacheWarehouseRefName:j,genieSemanticCacheWarehouseId:""}),source:r.genieSemanticCacheWarehouseSource,onSourceChange:j=>c({...r,genieSemanticCacheWarehouseSource:j}),hint:"SQL warehouse for cache operations",children:t.jsx(U,{label:"Warehouse ID",placeholder:"Enter warehouse ID",value:r.genieSemanticCacheWarehouseId,onChange:j=>c({...r,genieSemanticCacheWarehouseId:j.target.value,genieSemanticCacheWarehouseRefName:""})})}),t.jsxs("div",{className:"space-y-3 p-3 bg-slate-800/30 rounded-lg border border-slate-700/30",children:[t.jsx("h5",{className:"text-xs font-semibold text-slate-300 uppercase tracking-wide",children:"Prompt History"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Stores user prompts to maintain conversation context for accurate context-aware matching"}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsx(U,{label:"History Table Name",placeholder:"genie_prompt_history",value:r.genieSemanticCachePromptHistoryTable,onChange:j=>c({...r,genieSemanticCachePromptHistoryTable:j.target.value||"genie_prompt_history"}),hint:"Table for storing prompt history"}),t.jsx(U,{label:"Max History Length",type:"number",min:"1",max:"1000",value:r.genieSemanticCacheMaxPromptHistoryLength.toString(),onChange:j=>c({...r,genieSemanticCacheMaxPromptHistoryLength:parseInt(j.target.value)||50}),hint:"Max prompts per conversation"})]}),t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:r.genieSemanticCacheUseGenieApiForHistory,onChange:j=>c({...r,genieSemanticCacheUseGenieApiForHistory:j.target.checked}),className:"w-3 h-3 rounded border-slate-600 bg-slate-800 text-violet-500"}),t.jsx("span",{className:"text-xs text-slate-400",children:"Use Genie API for history (fallback when local history is empty)"})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:r.genieSemanticCachePromptHistoryTtlEnabled,onChange:j=>c({...r,genieSemanticCachePromptHistoryTtlEnabled:j.target.checked}),className:"w-3 h-3 rounded border-slate-600 bg-slate-800 text-violet-500"}),t.jsx("span",{className:"text-xs text-slate-400",children:"Custom prompt history TTL (default: use cache TTL)"})]}),r.genieSemanticCachePromptHistoryTtlEnabled&&t.jsx(U,{label:"Prompt History TTL (seconds)",type:"number",min:"1",value:r.genieSemanticCachePromptHistoryTtl.toString(),onChange:j=>c({...r,genieSemanticCachePromptHistoryTtl:parseInt(j.target.value)||86400}),hint:"TTL for prompt history entries"})]})]}),t.jsxs("div",{className:"space-y-3 p-3 bg-slate-800/30 rounded-lg border border-slate-700/30",children:[t.jsx("h5",{className:"text-xs font-semibold text-slate-300 uppercase tracking-wide",children:"IVFFlat Index Tuning"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Controls recall vs speed trade-offs for pg_vector similarity search at scale"}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:r.genieSemanticCacheIvfflatListsAuto,onChange:j=>c({...r,genieSemanticCacheIvfflatListsAuto:j.target.checked}),className:"w-3 h-3 rounded border-slate-600 bg-slate-800 text-violet-500"}),t.jsx("span",{className:"text-xs text-slate-400",children:"Auto-compute IVF lists"})]}),!r.genieSemanticCacheIvfflatListsAuto&&t.jsx(U,{label:"IVFFlat Lists",type:"number",min:"1",value:r.genieSemanticCacheIvfflatLists.toString(),onChange:j=>c({...r,genieSemanticCacheIvfflatLists:parseInt(j.target.value)||100}),hint:"Number of IVF lists (auto: max(100, sqrt(rows)))"})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:r.genieSemanticCacheIvfflatProbesAuto,onChange:j=>c({...r,genieSemanticCacheIvfflatProbesAuto:j.target.checked}),className:"w-3 h-3 rounded border-slate-600 bg-slate-800 text-violet-500"}),t.jsx("span",{className:"text-xs text-slate-400",children:"Auto-compute probes"})]}),!r.genieSemanticCacheIvfflatProbesAuto&&t.jsx(U,{label:"IVFFlat Probes",type:"number",min:"1",value:r.genieSemanticCacheIvfflatProbes.toString(),onChange:j=>c({...r,genieSemanticCacheIvfflatProbes:parseInt(j.target.value)||10}),hint:"Lists to probe per query (auto: max(10, sqrt(lists)))"})]})]}),t.jsx(U,{label:"IVFFlat Candidates",type:"number",min:"1",value:r.genieSemanticCacheIvfflatCandidates.toString(),onChange:j=>c({...r,genieSemanticCacheIvfflatCandidates:parseInt(j.target.value)||20}),hint:"Top-K candidates before Python-side reranking (default: 20)"})]})]})]}),t.jsxs("div",{className:"space-y-2 mt-4 pt-4 border-t border-slate-700/50",children:[t.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[t.jsx("input",{type:"checkbox",checked:r.genieInMemoryCacheEnabled,onChange:j=>c({...r,genieInMemoryCacheEnabled:j.target.checked}),className:"mt-0.5 w-4 h-4 rounded border-slate-600 bg-slate-800 text-violet-500 focus:ring-violet-500 focus:ring-offset-slate-900"}),t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium text-slate-300 group-hover:text-white",children:"Enable In-Memory Context-Aware Cache"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Context-aware similarity matching stored in memory (no database required, single-instance only)"})]})]}),r.genieInMemoryCacheEnabled&&t.jsxs("div",{className:"ml-7 space-y-3 p-3 bg-slate-900/50 rounded-lg border border-slate-700/50",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsx(U,{label:"Similarity Threshold",type:"number",step:"0.01",min:"0",max:"1",value:r.genieInMemoryCacheSimilarityThreshold.toString(),onChange:j=>c({...r,genieInMemoryCacheSimilarityThreshold:parseFloat(j.target.value)||.85}),hint:"Min similarity for question matching (0-1)"}),t.jsx(U,{label:"Context Similarity Threshold",type:"number",step:"0.01",min:"0",max:"1",value:r.genieInMemoryCacheContextSimilarityThreshold.toString(),onChange:j=>c({...r,genieInMemoryCacheContextSimilarityThreshold:parseFloat(j.target.value)||.8}),hint:"Min similarity for context matching (0-1)"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsx(U,{label:"Question Weight",type:"number",step:"0.1",min:"0",max:"1",value:r.genieInMemoryCacheQuestionWeight.toString(),onChange:j=>{const Y=parseFloat(j.target.value)||.6;c({...r,genieInMemoryCacheQuestionWeight:Y,genieInMemoryCacheContextWeight:1-Y})},hint:"Weight for question similarity (0-1)"}),t.jsx(U,{label:"Context Weight",type:"number",step:"0.1",min:"0",max:"1",value:r.genieInMemoryCacheContextWeight.toString(),onChange:j=>{const Y=parseFloat(j.target.value)||.4;c({...r,genieInMemoryCacheContextWeight:Y,genieInMemoryCacheQuestionWeight:1-Y})},hint:"Weight for context similarity (0-1)"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsx(U,{label:"Context Window Size",type:"number",min:"1",value:r.genieInMemoryCacheContextWindowSize.toString(),onChange:j=>c({...r,genieInMemoryCacheContextWindowSize:parseInt(j.target.value)||3}),hint:"Number of previous turns to include"}),t.jsx(U,{label:"Max Context Tokens",type:"number",min:"100",value:r.genieInMemoryCacheMaxContextTokens.toString(),onChange:j=>c({...r,genieInMemoryCacheMaxContextTokens:parseInt(j.target.value)||2e3}),hint:"Maximum context length"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Max Cache Entries"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"number",min:"100",value:r.genieInMemoryCacheCapacityUnlimited?"":r.genieInMemoryCacheCapacity,onChange:j=>c({...r,genieInMemoryCacheCapacity:parseInt(j.target.value)||1e4}),disabled:r.genieInMemoryCacheCapacityUnlimited,className:"flex-1 px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-violet-500 focus:ring-1 focus:ring-violet-500 disabled:opacity-50"}),t.jsxs("label",{className:"flex items-center gap-1.5 text-xs text-slate-400 cursor-pointer whitespace-nowrap",children:[t.jsx("input",{type:"checkbox",checked:r.genieInMemoryCacheCapacityUnlimited,onChange:j=>c({...r,genieInMemoryCacheCapacityUnlimited:j.target.checked}),className:"w-3 h-3 rounded border-slate-600 bg-slate-800 text-violet-500"}),"Unlimited"]})]}),t.jsx("p",{className:"text-xs text-slate-500",children:"LRU eviction when full (~200MB per 10k entries)"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"TTL (seconds)"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"number",min:"1",value:r.genieInMemoryCacheTtlNeverExpires?"":r.genieInMemoryCacheTtl,onChange:j=>c({...r,genieInMemoryCacheTtl:parseInt(j.target.value)||604800}),disabled:r.genieInMemoryCacheTtlNeverExpires,className:"flex-1 px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-violet-500 focus:ring-1 focus:ring-violet-500 disabled:opacity-50"}),t.jsxs("label",{className:"flex items-center gap-1.5 text-xs text-slate-400 cursor-pointer whitespace-nowrap",children:[t.jsx("input",{type:"checkbox",checked:r.genieInMemoryCacheTtlNeverExpires,onChange:j=>c({...r,genieInMemoryCacheTtlNeverExpires:j.target.checked}),className:"w-3 h-3 rounded border-slate-600 bg-slate-800 text-violet-500"}),"Never"]})]}),t.jsx("p",{className:"text-xs text-slate-500",children:"Default: 604800 (1 week)"})]})]}),t.jsx(os,{label:"Embedding Model",resourceType:"LLM",configuredOptions:K,configuredValue:r.genieInMemoryCacheEmbeddingModelRefName,onConfiguredChange:j=>c({...r,genieInMemoryCacheEmbeddingModelRefName:j,genieInMemoryCacheEmbeddingModelManual:""}),source:r.genieInMemoryCacheEmbeddingModelSource,onSourceChange:j=>c({...r,genieInMemoryCacheEmbeddingModelSource:j}),hint:"Model for computing embeddings",children:t.jsx(U,{label:"Model Name",placeholder:"databricks-gte-large-en",value:r.genieInMemoryCacheEmbeddingModelManual,onChange:j=>c({...r,genieInMemoryCacheEmbeddingModelManual:j.target.value,genieInMemoryCacheEmbeddingModelRefName:""}),hint:"Enter embedding model name manually"})}),t.jsx(os,{label:"Warehouse",resourceType:"Warehouse",configuredOptions:he,configuredValue:r.genieInMemoryCacheWarehouseRefName,onConfiguredChange:j=>c({...r,genieInMemoryCacheWarehouseRefName:j,genieInMemoryCacheWarehouseId:""}),source:r.genieInMemoryCacheWarehouseSource,onSourceChange:j=>c({...r,genieInMemoryCacheWarehouseSource:j}),hint:"SQL warehouse for re-executing cached SQL (required)",children:t.jsx(U,{label:"Warehouse ID",placeholder:"Enter warehouse ID",value:r.genieInMemoryCacheWarehouseId,onChange:j=>c({...r,genieInMemoryCacheWarehouseId:j.target.value,genieInMemoryCacheWarehouseRefName:""})})})]})]})]})]}),r.functionName==="dao_ai.tools.create_vector_search_tool"&&t.jsxs("div",{className:"space-y-4 p-4 bg-slate-800/50 rounded-lg border border-slate-700",children:[t.jsx("h4",{className:"text-sm font-medium text-slate-300",children:"Vector Search Configuration"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-xs font-medium text-slate-400",children:"Source Type:"}),t.jsxs("div",{className:"inline-flex rounded-lg bg-slate-900/50 p-0.5",children:[t.jsx("button",{type:"button",onClick:()=>c({...r,vectorSearchSourceType:"retriever"}),className:`px-3 py-1.5 text-xs rounded-md font-medium transition-all duration-150 ${r.vectorSearchSourceType==="retriever"?"bg-teal-500/20 text-teal-400 border border-teal-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Retriever"}),t.jsx("button",{type:"button",onClick:()=>c({...r,vectorSearchSourceType:"vector_store"}),className:`px-3 py-1.5 text-xs rounded-md font-medium transition-all duration-150 ${r.vectorSearchSourceType==="vector_store"?"bg-teal-500/20 text-teal-400 border border-teal-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Vector Store"})]}),t.jsx("p",{className:"text-xs text-slate-500",children:r.vectorSearchSourceType==="retriever"?"Retriever provides full search configuration with parameters and optional reranking":"Vector Store uses default search parameters for simpler configuration"})]}),r.vectorSearchSourceType==="retriever"&&t.jsx(os,{label:"Retriever",resourceType:"Retriever",configuredOptions:se,configuredValue:r.retrieverRefName,onConfiguredChange:j=>c({...r,retrieverRefName:j,vectorEndpoint:"",vectorIndex:""}),source:r.retrieverSource,onSourceChange:j=>c({...r,retrieverSource:j}),hint:r.retrieverSource==="configured"?"Use a pre-configured retriever from the Retrievers section":void 0,children:t.jsxs("div",{className:"space-y-4",children:[t.jsx(ol,{label:"Vector Search Endpoint",value:r.vectorEndpoint,onChange:j=>c({...r,vectorEndpoint:j,vectorIndex:"",retrieverRefName:""}),required:!0}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Vector Index"}),r.vectorEndpoint&&t.jsxs("button",{type:"button",onClick:()=>Ne(),className:"text-xs text-slate-400 hover:text-white flex items-center space-x-1",disabled:Ke,children:[t.jsx(Ut,{className:`w-3 h-3 ${Ke?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]})]}),t.jsx(ae,{options:re,value:r.vectorIndex,onChange:j=>c({...r,vectorIndex:j.target.value}),disabled:!r.vectorEndpoint||Ke,required:!0})]})]})}),r.vectorSearchSourceType==="vector_store"&&t.jsx(os,{label:"Vector Store",resourceType:"Vector Store",configuredOptions:ce,configuredValue:r.vectorStoreRefName,onConfiguredChange:j=>c({...r,vectorStoreRefName:j,vsVectorEndpoint:"",vsVectorIndex:"",vsVectorCatalog:"",vsVectorSchema:""}),source:r.vectorStoreSource,onSourceChange:j=>c({...r,vectorStoreSource:j}),hint:r.vectorStoreSource==="configured"?"Use a pre-configured vector store from the Resources section":void 0,children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(cr,{label:"Catalog",value:r.vsVectorCatalog,onChange:j=>c({...r,vsVectorCatalog:j,vsVectorSchema:""}),required:!0}),t.jsx(dr,{label:"Schema",value:r.vsVectorSchema,catalog:r.vsVectorCatalog,onChange:j=>c({...r,vsVectorSchema:j}),required:!0})]}),t.jsx(ol,{label:"Vector Search Endpoint",value:r.vsVectorEndpoint,onChange:j=>c({...r,vsVectorEndpoint:j,vsVectorIndex:""}),required:!0}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Vector Index"}),r.vsVectorEndpoint&&t.jsxs("button",{type:"button",onClick:()=>Ne(),className:"text-xs text-slate-400 hover:text-white flex items-center space-x-1",disabled:Ke,children:[t.jsx(Ut,{className:`w-3 h-3 ${Ke?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]})]}),t.jsx(ae,{options:re,value:r.vsVectorIndex,onChange:j=>c({...r,vsVectorIndex:j.target.value}),disabled:!r.vsVectorEndpoint||Ke,required:!0})]})]})}),t.jsx("div",{className:"pt-2 border-t border-slate-700",children:t.jsx(U,{label:"Description",placeholder:"e.g., Search product documentation for answers",value:r.vectorSearchDescription,onChange:j=>c({...r,vectorSearchDescription:j.target.value}),hint:"Optional description for the tool (defaults to generic description)"})})]}),r.functionName==="dao_ai.tools.create_send_slack_message_tool"&&t.jsxs("div",{className:"space-y-4 p-4 bg-slate-800/50 rounded-lg border border-slate-700",children:[t.jsx("h4",{className:"text-sm font-medium text-slate-300",children:"Slack Message Tool Configuration"}),t.jsx(os,{label:"Slack Connection",resourceType:"Connection",configuredOptions:te,configuredValue:r.slackConnectionRefName,onConfiguredChange:j=>c({...r,slackConnectionRefName:j}),source:r.slackConnectionSource,onSourceChange:j=>c({...r,slackConnectionSource:j}),hint:"Unity Catalog connection to Slack",children:t.jsx("p",{className:"text-sm text-slate-400",children:"Select a configured connection or create one in the Resources section"})}),t.jsxs("div",{className:"space-y-3 pt-2 border-t border-slate-700",children:[t.jsx("h5",{className:"text-xs font-medium text-slate-400 uppercase tracking-wider",children:"Channel Configuration"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Provide either a Channel ID or Channel Name. Channel ID is preferred if known."}),t.jsx(U,{label:"Channel ID",placeholder:"e.g., C1234567890",value:r.slackChannelId,onChange:j=>c({...r,slackChannelId:j.target.value}),hint:"Slack channel ID (e.g., C1234567890). Takes precedence over channel name."}),t.jsx(U,{label:"Channel Name",placeholder:"e.g., general or #general",value:r.slackChannelName,onChange:j=>c({...r,slackChannelName:j.target.value}),hint:"Slack channel name. Used to lookup channel ID if not provided above."})]})]}),r.functionName==="dao_ai.tools.create_agent_endpoint_tool"&&t.jsxs("div",{className:"space-y-4 p-4 bg-slate-800/50 rounded-lg border border-slate-700",children:[t.jsx("h4",{className:"text-sm font-medium text-slate-300",children:"Agent Endpoint Tool Configuration"}),t.jsx(os,{label:"LLM / Agent Endpoint",resourceType:"LLM",configuredOptions:K,configuredValue:r.agentLlmRefName,onConfiguredChange:j=>c({...r,agentLlmRefName:j}),source:r.agentLlmSource,onSourceChange:j=>c({...r,agentLlmSource:j}),hint:"Select the LLM or agent endpoint to call",children:t.jsx("p",{className:"text-sm text-slate-400",children:"Configure an LLM in the Resources section, then select it here"})})]}),r.functionName==="dao_ai.tools.create_send_email_tool"&&t.jsxs("div",{className:"space-y-4 p-4 bg-slate-800/50 rounded-lg border border-slate-700",children:[t.jsx("h4",{className:"text-sm font-medium text-slate-300",children:"Email Tool Configuration"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("p",{className:"text-sm text-slate-400",children:"Configure SMTP settings for sending emails"}),t.jsx(ar,{label:"SMTP Host",manualValue:r.emailHost,onManualChange:j=>c({...r,emailHost:j}),variableValue:r.emailHostVariable,onVariableChange:j=>c({...r,emailHostVariable:j}),source:r.emailHostSource,onSourceChange:j=>c({...r,emailHostSource:j}),placeholder:"smtp.gmail.com",hint:"SMTP server hostname",variables:X}),t.jsx(ar,{label:"SMTP Port",manualValue:r.emailPort,onManualChange:j=>c({...r,emailPort:j}),variableValue:r.emailPortVariable,onVariableChange:j=>c({...r,emailPortVariable:j}),source:r.emailPortSource,onSourceChange:j=>c({...r,emailPortSource:j}),placeholder:"587",hint:"SMTP server port (typically 587 for TLS)",variables:X,type:"number"}),t.jsx(ar,{label:"SMTP Username",manualValue:r.emailUsername,onManualChange:j=>c({...r,emailUsername:j}),variableValue:r.emailUsernameVariable,onVariableChange:j=>c({...r,emailUsernameVariable:j}),source:r.emailUsernameSource,onSourceChange:j=>c({...r,emailUsernameSource:j}),placeholder:"user@example.com",hint:"SMTP authentication username",variables:X,required:!0}),t.jsx(ar,{label:"SMTP Password",manualValue:r.emailPassword,onManualChange:j=>c({...r,emailPassword:j}),variableValue:r.emailPasswordVariable,onVariableChange:j=>c({...r,emailPasswordVariable:j}),source:r.emailPasswordSource,onSourceChange:j=>c({...r,emailPasswordSource:j}),placeholder:"password or app-specific password",hint:"SMTP authentication password (recommended: use a variable for security)",variables:X,type:"password",required:!0}),t.jsx(ar,{label:"Sender Email (Optional)",manualValue:r.emailSenderEmail,onManualChange:j=>c({...r,emailSenderEmail:j}),variableValue:r.emailSenderEmailVariable,onVariableChange:j=>c({...r,emailSenderEmailVariable:j}),source:r.emailSenderEmailSource,onSourceChange:j=>c({...r,emailSenderEmailSource:j}),placeholder:"bot@example.com (defaults to username)",hint:"Email address to use as sender. If not provided, username will be used.",variables:X}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"checkbox",id:"emailUseTls",checked:r.emailUseTls,onChange:j=>c({...r,emailUseTls:j.target.checked}),className:"rounded border-slate-600 bg-slate-700 text-purple-500 focus:ring-purple-500"}),t.jsx("label",{htmlFor:"emailUseTls",className:"text-sm text-slate-300",children:"Use TLS Encryption (Recommended)"})]}),t.jsx(U,{label:"Tool Name (Optional)",value:r.emailToolName,onChange:j=>c({...r,emailToolName:j.target.value}),placeholder:"send_email",hint:"Custom name for the email tool function"}),t.jsx(Jt,{label:"Tool Description (Optional)",value:r.emailToolDescription,onChange:j=>c({...r,emailToolDescription:j.target.value}),placeholder:"Send an email to a recipient",rows:2,hint:"Custom description for the email tool"})]})]}),r.functionName==="custom"&&t.jsx(U,{label:"Custom Factory Function",placeholder:"e.g., my_package.tools.my_factory",value:r.customFunctionName,onChange:j=>c({...r,customFunctionName:j.target.value}),required:!0}),r.functionName==="custom"&&t.jsx(Jt,{label:"Arguments (JSON)",placeholder:'{"key": "value"}',value:r.args,onChange:j=>c({...r,args:j.target.value}),rows:6,hint:"JSON object passed to the factory function"})]}),r.type==="python"&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Python Tool Function"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Python functions decorated with @tool that can be used directly as tools"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:hl.map(j=>{const Y=j.icon,Q=r.functionName===j.value;return t.jsx("button",{type:"button",onClick:()=>{const xe=j.value!=="custom"?nr(j.value):"";c({...r,functionName:j.value,customFunctionName:"",name:_?r.name:xe,refName:f?r.refName:xe})},className:`p-3 rounded-lg border text-left transition-all ${Q?"border-violet-500 bg-violet-500/10":"border-slate-700 bg-slate-800/50 hover:border-slate-600"}`,children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(Y,{className:`w-4 h-4 mt-0.5 ${Q?"text-violet-400":"text-slate-400"}`}),t.jsxs("div",{children:[t.jsx("div",{className:`text-sm font-medium ${Q?"text-violet-400":"text-slate-300"}`,children:j.label}),t.jsx("div",{className:"text-xs text-slate-500",children:j.description})]})]})},j.value)})})]}),r.functionName==="custom"&&t.jsx(U,{label:"Custom Python Function Path",placeholder:"e.g., my_package.tools.my_function",value:r.customFunctionName,onChange:j=>{const Y=j.target.value,Q=nr(Y);c({...r,customFunctionName:Y,name:_?r.name:Q,refName:f?r.refName:Q})},hint:"Fully qualified path to a Python function decorated with @tool",required:!0})]}),r.type==="inline"&&t.jsxs("div",{className:"space-y-4 p-4 bg-slate-800/50 rounded-lg border border-slate-700",children:[t.jsx("h4",{className:"text-sm font-medium text-slate-300",children:"Inline Function Code"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Define a Python tool function directly in the configuration. The code must import @tool from langchain.tools and define exactly one function decorated with @tool."}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Python Code"}),t.jsx("textarea",{value:r.inlineCode,onChange:j=>c({...r,inlineCode:j.target.value}),placeholder:`from langchain.tools import tool

@tool
def my_tool(param: str) -> str:
    """Description of what this tool does.
    
    Args:
        param: Description of the parameter
        
    Returns:
        The result of the tool
    """
    # Your tool logic here
    return f"Result: {param}"`,className:"w-full h-64 px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-violet-500 focus:ring-1 focus:ring-violet-500 font-mono text-sm",spellCheck:!1}),t.jsx("p",{className:"text-xs text-slate-500",children:"The function name defined in the code becomes the tool name used by the agent."})]})]}),r.type==="unity_catalog"&&t.jsxs("div",{className:"space-y-4 p-4 bg-slate-800/50 rounded-lg border border-slate-700",children:[t.jsx("h4",{className:"text-sm font-medium text-slate-300",children:"Unity Catalog Function"}),t.jsx("div",{className:"space-y-2",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Function Source"}),t.jsxs("div",{className:"inline-flex rounded-lg bg-slate-900/50 p-0.5",children:[t.jsx("button",{type:"button",onClick:()=>c({...r,functionSource:"configured",ucCatalog:"",ucSchema:"",ucFunction:""}),className:`px-3 py-1 text-xs rounded-md font-medium transition-all duration-150 ${r.functionSource==="configured"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Configured"}),t.jsx("button",{type:"button",onClick:()=>c({...r,functionSource:"select",functionRefName:""}),className:`px-3 py-1 text-xs rounded-md font-medium transition-all duration-150 ${r.functionSource==="select"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Select"})]})]})}),r.functionSource==="configured"&&t.jsxs("div",{className:"space-y-2",children:[t.jsx(ae,{options:[{value:"",label:"Select a configured function..."},...z],value:r.functionRefName,onChange:j=>{const Y=j.target.value,Q=D[Y],xe=nr((Q==null?void 0:Q.name)||Y);c({...r,functionRefName:Y,ucFunction:"",ucCatalog:"",ucSchema:"",name:_?r.name:xe,refName:f?r.refName:xe})}}),z.length===0&&t.jsx("p",{className:"text-xs text-amber-400",children:'No functions configured. Add one in Resources  Functions or switch to "Select".'}),t.jsx("p",{className:"text-xs text-slate-500",children:"Select a pre-configured function from the Resources section"})]}),r.functionSource==="select"&&t.jsxs("div",{className:"space-y-4",children:[t.jsx(os,{label:"Schema",resourceType:"schema",configuredOptions:H,configuredValue:r.schemaRefName,onConfiguredChange:j=>{const Y=k[j];c({...r,schemaRefName:j,ucCatalog:Es(Y==null?void 0:Y.catalog_name),ucSchema:Es(Y==null?void 0:Y.schema_name),ucFunction:""})},source:r.schemaSource,onSourceChange:j=>c({...r,schemaSource:j}),children:t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(cr,{label:"Catalog",value:r.ucCatalog,onChange:j=>c({...r,ucCatalog:j,ucSchema:"",ucFunction:"",schemaRefName:""}),required:!0}),t.jsx(dr,{label:"Schema",value:r.ucSchema,onChange:j=>c({...r,ucSchema:j,ucFunction:"",schemaRefName:""}),catalog:r.ucCatalog||null,required:!0})]})}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Function"}),r.ucCatalog&&r.ucSchema||r.schemaRefName?t.jsxs("button",{type:"button",onClick:()=>ze(),className:"text-xs text-slate-400 hover:text-white flex items-center space-x-1",disabled:tt,children:[t.jsx(Ut,{className:`w-3 h-3 ${tt?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}):null]}),t.jsx(ae,{options:Kt,value:r.ucFunction,onChange:j=>{const Y=j.target.value,Q=nr(Y);c({...r,ucFunction:Y,functionRefName:"",name:_?r.name:Q,refName:f?r.refName:Q})},disabled:(!r.ucCatalog||!r.ucSchema)&&!r.schemaRefName||tt,required:!0}),tt&&t.jsx("p",{className:"text-xs text-slate-500",children:"Loading functions..."}),!r.ucCatalog&&!r.ucSchema&&!r.schemaRefName&&t.jsx("p",{className:"text-xs text-slate-500",children:"Select a schema first to browse functions"})]})]}),t.jsxs("div",{className:"space-y-3 pt-3 border-t border-slate-700",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h5",{className:"text-sm font-medium text-slate-300",children:"Partial Arguments"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Pre-fill function parameters with static values or variable references"})]}),t.jsxs("button",{type:"button",onClick:()=>c({...r,ucPartialArgs:[...r.ucPartialArgs,{id:`arg_${Date.now()}`,name:"",source:"manual",value:""}]}),className:"flex items-center space-x-1 text-xs text-violet-400 hover:text-violet-300 transition-colors",children:[t.jsx(Ie,{className:"w-3 h-3"}),t.jsx("span",{children:"Add Argument"})]})]}),r.ucPartialArgs.length===0?t.jsx("p",{className:"text-xs text-slate-500 italic",children:'No partial arguments configured. Click "Add Argument" to pre-fill function parameters.'}):t.jsx("div",{className:"space-y-3",children:r.ucPartialArgs.map((j,Y)=>t.jsx("div",{className:"p-3 bg-slate-900/50 rounded-lg border border-slate-600 space-y-2",children:t.jsxs("div",{className:"flex items-start justify-between gap-2",children:[t.jsxs("div",{className:"flex-1 grid grid-cols-2 gap-3",children:[t.jsx(U,{label:"Parameter Name",value:j.name,onChange:Q=>{const xe=[...r.ucPartialArgs];xe[Y]={...j,name:Q.target.value},c({...r,ucPartialArgs:xe})},placeholder:"e.g., host, client_id"}),t.jsxs("div",{className:"space-y-1.5",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Value Source"}),t.jsxs("div",{className:"inline-flex rounded-lg bg-slate-800 p-0.5 text-xs",children:[t.jsx("button",{type:"button",onClick:()=>{const Q=[...r.ucPartialArgs];Q[Y]={...j,source:"manual",value:""},c({...r,ucPartialArgs:Q})},className:`px-2 py-1 rounded font-medium transition-all ${j.source==="manual"?"bg-violet-500/20 text-violet-400":"text-slate-400 hover:text-slate-300"}`,children:"Manual"}),t.jsx("button",{type:"button",onClick:()=>{const Q=[...r.ucPartialArgs];Q[Y]={...j,source:"variable",value:""},c({...r,ucPartialArgs:Q})},className:`px-2 py-1 rounded font-medium transition-all ${j.source==="variable"?"bg-violet-500/20 text-violet-400":"text-slate-400 hover:text-slate-300"}`,children:"Variable"}),t.jsx("button",{type:"button",onClick:()=>{const Q=[...r.ucPartialArgs];Q[Y]={...j,source:"service_principal",value:""},c({...r,ucPartialArgs:Q})},className:`px-2 py-1 rounded font-medium transition-all ${j.source==="service_principal"?"bg-violet-500/20 text-violet-400":"text-slate-400 hover:text-slate-300"}`,children:"SP"})]})]}),j.source==="manual"&&t.jsx(U,{value:j.value,onChange:Q=>{const xe=[...r.ucPartialArgs];xe[Y]={...j,value:Q.target.value},c({...r,ucPartialArgs:xe})},placeholder:"Enter value..."}),j.source==="variable"&&t.jsx(ae,{value:j.value,onChange:Q=>{const xe=[...r.ucPartialArgs];xe[Y]={...j,value:Q.target.value},c({...r,ucPartialArgs:xe})},options:st}),j.source==="service_principal"&&t.jsx(ae,{value:j.value,onChange:Q=>{const xe=[...r.ucPartialArgs];xe[Y]={...j,value:Q.target.value},c({...r,ucPartialArgs:xe})},options:it})]})]}),t.jsx("button",{type:"button",onClick:()=>{const Q=r.ucPartialArgs.filter(xe=>xe.id!==j.id);c({...r,ucPartialArgs:Q})},className:"mt-6 p-1 text-slate-400 hover:text-red-400 transition-colors",children:t.jsx(Ze,{className:"w-4 h-4"})})]})},j.id))})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("button",{type:"button",onClick:()=>b(!y),className:"flex items-center space-x-2 text-sm text-slate-400 hover:text-white transition-colors w-full",children:[y?t.jsx(ya,{className:"w-4 h-4"}):t.jsx(Wt,{className:"w-4 h-4"}),t.jsx(Dn,{className:"w-4 h-4"}),t.jsx("span",{children:"Human In The Loop"}),v.enabled&&t.jsx(Se,{variant:"success",className:"ml-2",children:"Enabled"})]}),y&&t.jsxs("div",{className:"p-4 bg-slate-800/50 rounded-lg border border-slate-700 space-y-4",children:[t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx("input",{type:"checkbox",id:"hitlEnabled",checked:v.enabled,onChange:j=>S({...v,enabled:j.target.checked}),className:"mt-1 rounded border-slate-600 bg-slate-800 text-blue-500 focus:ring-blue-500"}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"hitlEnabled",className:"block text-sm font-medium text-slate-300 cursor-pointer",children:"Require Human Approval"}),t.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Pause execution and request human review before this tool runs."})]})]}),v.enabled&&t.jsxs(t.Fragment,{children:[t.jsx(U,{label:"Review Prompt",value:v.reviewPrompt,onChange:j=>S({...v,reviewPrompt:j.target.value}),placeholder:"Please review the tool call",hint:"Message shown to the reviewer"}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Allowed Decisions"}),t.jsx("p",{className:"text-xs text-slate-500 mb-3",children:"Select which decision types the reviewer can choose from"}),t.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[t.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:v.allowApprove,onChange:j=>S({...v,allowApprove:j.target.checked}),className:"rounded border-slate-600 bg-slate-800 text-green-500 focus:ring-green-500"}),t.jsx("span",{className:"text-sm text-slate-400",children:"Approve"})]}),t.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:v.allowEdit,onChange:j=>S({...v,allowEdit:j.target.checked}),className:"rounded border-slate-600 bg-slate-800 text-blue-500 focus:ring-blue-500"}),t.jsx("span",{className:"text-sm text-slate-400",children:"Edit"})]}),t.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:v.allowReject,onChange:j=>S({...v,allowReject:j.target.checked}),className:"rounded border-slate-600 bg-slate-800 text-red-500 focus:ring-red-500"}),t.jsx("span",{className:"text-sm text-slate-400",children:"Reject"})]})]}),t.jsxs("p",{className:"text-xs text-slate-500 mt-2",children:[t.jsx("strong",{children:"Approve:"})," Execute with original arguments ",t.jsx("strong",{children:" Edit:"})," Modify arguments before execution ",t.jsx("strong",{children:" Reject:"})," Skip execution"]})]})]})]})]}),r.type==="mcp"&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"MCP Server Type"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:ab.map(j=>{const Y=d.sourceType===j.value;return t.jsxs("button",{type:"button",onClick:()=>{if(g({...d,sourceType:j.value}),j.value==="sql"&&!_){const Q=Ds("sql","databricks");c(xe=>({...xe,name:Q}))}if(j.value==="sql"&&!f){const Q=Ds("sql","databricks");c(xe=>({...xe,refName:Q}))}},className:`p-3 rounded-lg border text-left transition-all ${Y?"border-purple-500 bg-purple-500/10":"border-slate-700 hover:border-slate-600 bg-slate-800/50"}`,children:[t.jsx("span",{className:`text-sm font-medium ${Y?"text-white":"text-slate-300"}`,children:j.label}),t.jsx("p",{className:"text-xs text-slate-500 mt-1",children:j.description})]},j.value)})})]}),t.jsxs("div",{className:"p-4 bg-slate-800/50 rounded-lg border border-slate-700 space-y-4",children:[d.sourceType==="url"&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"MCP Server URL"}),t.jsxs("div",{className:"flex space-x-1",children:[t.jsx("button",{type:"button",onClick:()=>g({...d,urlSource:"manual",urlVariable:""}),className:`px-2 py-1 text-xs rounded ${d.urlSource==="manual"?"bg-blue-500/30 text-blue-300":"bg-slate-700 text-slate-400"}`,children:"Manual"}),t.jsx("button",{type:"button",onClick:()=>g({...d,urlSource:"variable",url:""}),className:`px-2 py-1 text-xs rounded flex items-center space-x-1 ${d.urlSource==="variable"?"bg-purple-500/30 text-purple-300":"bg-slate-700 text-slate-400"}`,children:t.jsx("span",{children:"Variable"})})]})]}),d.urlSource==="manual"&&t.jsx(U,{placeholder:"https://your-workspace.databricks.net/api/2.0/mcp/...",value:d.url,onChange:j=>g({...d,url:j.target.value}),hint:"Full URL to the MCP server endpoint",required:!0}),d.urlSource==="variable"&&t.jsxs("div",{className:"space-y-2",children:[Object.keys(e.variables||{}).length>0?t.jsx(ae,{value:d.urlVariable,onChange:j=>g({...d,urlVariable:j.target.value}),options:[{value:"",label:"Select a variable..."},...Object.keys(e.variables||{}).map(j=>({value:j,label:j}))]}):t.jsx(U,{value:d.urlVariable,onChange:j=>g({...d,urlVariable:j.target.value}),placeholder:"mcp_server_url"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Reference a variable containing the MCP server URL"})]})]}),d.sourceType==="genie"&&t.jsxs(t.Fragment,{children:[t.jsx(os,{label:"Genie Room",resourceType:"Genie room",configuredOptions:q,configuredValue:d.genieRefName,onConfiguredChange:j=>{const Y=w[j],Q=Ds("genie",(Y==null?void 0:Y.name)||j);g({...d,genieRefName:j,genieSpaceId:"",genieName:(Y==null?void 0:Y.name)||j,genieDescription:(Y==null?void 0:Y.description)||""}),_||c(xe=>({...xe,name:Q})),f||c(xe=>({...xe,refName:Q}))},source:d.genieSource,onSourceChange:j=>{if(j==="select")g({...d,genieSource:j,genieRefName:"",genieName:"",genieDescription:""});else{const Y=d.genieRefName;if(Y&&w[Y]){const Q=w[Y];g({...d,genieSource:j,genieSpaceId:"",genieName:(Q==null?void 0:Q.name)||Y,genieDescription:(Q==null?void 0:Q.description)||""})}else g({...d,genieSource:j,genieSpaceId:""})}},hint:"Display Name and Description will auto-fill from your selection.",children:t.jsx(Kc,{value:d.genieSpaceId,onChange:j=>{const Y=ve==null?void 0:ve.find(Ge=>Ge.space_id===j),Q=(Y==null?void 0:Y.title)||"",xe=(Y==null?void 0:Y.description)||"",Ee=Ds("genie",Q||j);g({...d,genieSpaceId:j,genieRefName:"",genieName:Q,genieDescription:xe}),_||c(Ge=>({...Ge,name:Ee})),f||c(Ge=>({...Ge,refName:Ee}))},required:!0})}),t.jsx(U,{label:"Display Name",placeholder:"e.g., Retail Genie",value:d.genieName,onChange:j=>g({...d,genieName:j.target.value}),hint:"Name for this Genie Room configuration (auto-filled from selection)"}),t.jsx(U,{label:"Description (optional)",placeholder:"Query retail data using natural language",value:d.genieDescription,onChange:j=>g({...d,genieDescription:j.target.value}),hint:"Optional description (auto-filled from selection)"})]}),d.sourceType==="vector_search"&&t.jsx(os,{label:"Vector Store",resourceType:"Vector store",configuredOptions:ce,configuredValue:d.vectorStoreRefName,onConfiguredChange:j=>{var Ee;const Y=I[j],Q=((Ee=Y==null?void 0:Y.index)==null?void 0:Ee.name)||j,xe=Ds("vector_search",Q);g({...d,vectorStoreRefName:j,vectorEndpoint:"",vectorIndex:"",vectorCatalog:"",vectorSchema:""}),_||c(Ge=>({...Ge,name:xe})),f||c(Ge=>({...Ge,refName:xe}))},source:d.vectorStoreSource,onSourceChange:j=>g({...d,vectorStoreSource:j}),children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(cr,{label:"Catalog",value:d.vectorCatalog,onChange:j=>g({...d,vectorCatalog:j,vectorSchema:"",vectorStoreRefName:""}),required:!0}),t.jsx(dr,{label:"Schema",value:d.vectorSchema,onChange:j=>g({...d,vectorSchema:j,vectorStoreRefName:""}),catalog:d.vectorCatalog||null,required:!0})]}),t.jsx(ol,{label:"Vector Search Endpoint",value:d.vectorEndpoint,onChange:j=>g({...d,vectorEndpoint:j,vectorIndex:"",vectorStoreRefName:""}),required:!0}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Vector Index"}),d.vectorEndpoint&&t.jsxs("button",{type:"button",onClick:()=>ot(),className:"text-xs text-slate-400 hover:text-white flex items-center space-x-1",disabled:lt,children:[t.jsx(Ut,{className:`w-3 h-3 ${lt?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]})]}),t.jsx(ae,{options:fe,value:d.vectorIndex,onChange:j=>{const Y=j.target.value,Q=Ds("vector_search",Y);g({...d,vectorIndex:Y}),_||c(xe=>({...xe,name:Q})),f||c(xe=>({...xe,refName:Q}))},disabled:!d.vectorEndpoint||lt,required:!0})]})]})}),d.sourceType==="functions"&&t.jsx(os,{label:"Schema",resourceType:"schema",configuredOptions:H,configuredValue:d.schemaRefName,onConfiguredChange:j=>{const Y=k[j],Q=Es(Y==null?void 0:Y.schema_name)||j,xe=Ds("functions",Q);g({...d,schemaRefName:j,functionsCatalog:Es(Y==null?void 0:Y.catalog_name),functionsSchema:Es(Y==null?void 0:Y.schema_name)}),_||c(Ee=>({...Ee,name:xe})),f||c(Ee=>({...Ee,refName:xe}))},source:d.schemaSource,onSourceChange:j=>g({...d,schemaSource:j}),children:t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(cr,{label:"Catalog",value:d.functionsCatalog,onChange:j=>g({...d,functionsCatalog:j,functionsSchema:"",schemaRefName:""}),required:!0}),t.jsx(dr,{label:"Schema",value:d.functionsSchema,onChange:j=>{const Y=Ds("functions",j);g({...d,functionsSchema:j,schemaRefName:""}),_||c(Q=>({...Q,name:Y})),f||c(Q=>({...Q,refName:Y}))},catalog:d.functionsCatalog||null,required:!0})]})}),d.sourceType==="sql"&&t.jsxs("div",{className:"p-3 bg-slate-900/50 rounded-lg",children:[t.jsxs("p",{className:"text-sm text-slate-300",children:[t.jsx("strong",{children:"Databricks SQL MCP"})," - Enables serverless SQL execution without requiring a warehouse."]}),t.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"The sql: true flag will be set automatically."})]}),d.sourceType==="app"&&t.jsx(os,{label:"Databricks App",resourceType:"Databricks App",configuredOptions:W,configuredValue:d.appRefName,onConfiguredChange:j=>{var Ge;const Q=(((Ge=e.resources)==null?void 0:Ge.apps)||{})[j],xe=(Q==null?void 0:Q.name)||j,Ee=Ds("app",xe);g({...d,appRefName:j,appName:""}),_||c(De=>({...De,name:Ee})),f||c(De=>({...De,refName:Ee}))},source:d.appSource,onSourceChange:j=>g({...d,appSource:j}),hint:"The app's URL will be retrieved dynamically from the workspace at runtime.",children:t.jsx(Rm,{value:d.appName,onChange:j=>{const Y=Ds("app",j);g({...d,appName:j,appRefName:""}),_||c(Q=>({...Q,name:Y})),f||c(Q=>({...Q,refName:Y}))},required:!0})}),d.sourceType==="connection"&&t.jsx(os,{label:"UC Connection",resourceType:"connection",configuredOptions:te,configuredValue:d.connectionRefName,onConfiguredChange:j=>{const Y=L[j],Q=(Y==null?void 0:Y.name)||j,xe=Ds("connection",Q);g({...d,connectionRefName:j,connectionName:(Y==null?void 0:Y.name)||""}),_||c(Ee=>({...Ee,name:xe})),f||c(Ee=>({...Ee,refName:xe}))},source:d.connectionSource,onSourceChange:j=>g({...d,connectionSource:j}),children:t.jsx(Tg,{label:"Select Connection",value:d.connectionName,onChange:j=>{const Y=Ds("connection",j);g({...d,connectionName:j,connectionRefName:""}),_||c(Q=>({...Q,name:Y})),f||c(Q=>({...Q,refName:Y}))},required:!0})})]}),t.jsxs("div",{className:"p-4 bg-slate-800/50 rounded-lg border border-slate-700 space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h4",{className:"text-sm font-medium text-slate-300",children:"Authentication"}),t.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:d.useCredentials,onChange:j=>g({...d,useCredentials:j.target.checked}),className:"rounded border-slate-600 bg-slate-800 text-blue-500 focus:ring-blue-500"}),t.jsx("span",{className:"text-sm text-slate-400",children:"Use credentials"})]})]}),d.useCredentials&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{type:"button",onClick:()=>g({...d,credentialsMode:"service_principal"}),className:`px-3 py-1.5 text-xs rounded-lg font-medium transition-colors ${d.credentialsMode==="service_principal"?"bg-amber-500/20 text-amber-400 border border-amber-500/30":"bg-slate-800 text-slate-400 border border-slate-700 hover:border-slate-600"}`,children:"Configured Service Principal"}),t.jsx("button",{type:"button",onClick:()=>g({...d,credentialsMode:"manual"}),className:`px-3 py-1.5 text-xs rounded-lg font-medium transition-colors ${d.credentialsMode==="manual"?"bg-blue-500/20 text-blue-400 border border-blue-500/30":"bg-slate-800 text-slate-400 border border-slate-700 hover:border-slate-600"}`,children:"Manual Credentials"})]}),d.credentialsMode==="service_principal"?t.jsxs("div",{className:"space-y-2",children:[t.jsx(ae,{label:"Service Principal",options:[{value:"",label:"Select a service principal..."},...Object.keys(e.service_principals||{}).map(j=>({value:j,label:j}))],value:d.servicePrincipalRef,onChange:j=>g({...d,servicePrincipalRef:j.target.value}),hint:"Reference a pre-configured service principal"}),Object.keys(e.service_principals||{}).length===0&&t.jsx("div",{className:"p-2 bg-amber-500/10 border border-amber-500/30 rounded text-amber-400 text-xs",children:"No service principals configured. Add one in Resources  Service Principals first."})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Client ID"}),t.jsxs("div",{className:"inline-flex rounded-lg bg-slate-900/50 p-0.5",children:[t.jsx("button",{type:"button",onClick:()=>g({...d,clientIdSource:"variable"}),className:`px-3 py-1 text-xs rounded-md font-medium transition-all duration-150 ${d.clientIdSource==="variable"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Variable"}),t.jsx("button",{type:"button",onClick:()=>g({...d,clientIdSource:"manual"}),className:`px-3 py-1 text-xs rounded-md font-medium transition-all duration-150 ${d.clientIdSource==="manual"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Manual"})]})]}),d.clientIdSource==="variable"?t.jsx(ae,{options:[{value:"",label:"Select a variable..."},...me.map(j=>({value:j,label:`${j} (${Me(X[j])})`}))],value:d.clientIdVar,onChange:j=>g({...d,clientIdVar:j.target.value}),hint:me.length===0?"Define variables in the Variables section first":void 0}):t.jsx(U,{placeholder:"Enter client ID...",value:d.clientIdManual,onChange:j=>g({...d,clientIdManual:j.target.value})})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Client Secret"}),t.jsxs("div",{className:"inline-flex rounded-lg bg-slate-900/50 p-0.5",children:[t.jsx("button",{type:"button",onClick:()=>g({...d,clientSecretSource:"variable"}),className:`px-3 py-1 text-xs rounded-md font-medium transition-all duration-150 ${d.clientSecretSource==="variable"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Variable"}),t.jsx("button",{type:"button",onClick:()=>g({...d,clientSecretSource:"manual"}),className:`px-3 py-1 text-xs rounded-md font-medium transition-all duration-150 ${d.clientSecretSource==="manual"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Manual"})]})]}),d.clientSecretSource==="variable"?t.jsx(ae,{options:[{value:"",label:"Select a variable..."},...me.map(j=>({value:j,label:`${j} (${Me(X[j])})`}))],value:d.clientSecretVar,onChange:j=>g({...d,clientSecretVar:j.target.value}),hint:me.length===0?"Define variables in the Variables section first":void 0}):t.jsx(U,{type:"password",placeholder:"Enter client secret...",value:d.clientSecretManual,onChange:j=>g({...d,clientSecretManual:j.target.value})})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("label",{className:"text-sm font-medium text-slate-300",children:["Workspace Host ",t.jsx("span",{className:"text-slate-500",children:"(Optional)"})]}),t.jsxs("div",{className:"inline-flex rounded-lg bg-slate-900/50 p-0.5",children:[t.jsx("button",{type:"button",onClick:()=>g({...d,workspaceHostSource:"variable"}),className:`px-3 py-1 text-xs rounded-md font-medium transition-all duration-150 ${d.workspaceHostSource==="variable"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Variable"}),t.jsx("button",{type:"button",onClick:()=>g({...d,workspaceHostSource:"manual"}),className:`px-3 py-1 text-xs rounded-md font-medium transition-all duration-150 ${d.workspaceHostSource==="manual"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Manual"})]})]}),d.workspaceHostSource==="variable"?t.jsx(ae,{options:[{value:"",label:"Select a variable..."},...me.map(j=>({value:j,label:`${j} (${Me(X[j])})`}))],value:d.workspaceHostVar,onChange:j=>g({...d,workspaceHostVar:j.target.value}),hint:me.length===0?"Define variables in the Variables section first":void 0}):t.jsx(U,{placeholder:"https://your-workspace.cloud.databricks.com",value:d.workspaceHostManual,onChange:j=>g({...d,workspaceHostManual:j.target.value})})]})]})]})]}),t.jsxs("div",{className:"p-4 bg-slate-800/30 rounded-lg border border-slate-700/50 space-y-4",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("h4",{className:"text-sm font-medium text-slate-200",children:"Tool Filtering"}),t.jsxs("button",{type:"button",onClick:async()=>{var j,Y,Q,xe,Ee,Ge,De,Pe,Be,Ss,Cs,ns,ks;g(Oe=>({...Oe,availableToolsLoading:!0,availableToolsError:"",availableTools:[]}));try{const Oe={};switch(d.sourceType){case"url":if(d.urlSource==="variable"&&d.urlVariable)throw new Error("Cannot discover tools when using a variable for URL. Enter a direct URL to discover tools.");if(!d.url)throw new Error("Please enter a URL to discover tools.");Oe.url=d.url;break;case"connection":if(d.connectionSource==="configured"&&d.connectionRefName){const Ce=L[d.connectionRefName];Ce&&(Oe.connection={name:Ce.name})}else if(d.connectionName)Oe.connection={name:d.connectionName};else throw new Error("Please select a connection to discover tools.");break;case"genie":if(d.genieSource==="configured"&&d.genieRefName){const Ce=(Y=(j=e.resources)==null?void 0:j.genie_rooms)==null?void 0:Y[d.genieRefName];if(Ce){const Ye=typeof Ce.space_id=="string"&&Ce.space_id.startsWith("*")?(xe=(Q=e.variables)==null?void 0:Q[Ce.space_id.slice(1)])==null?void 0:xe.value:Ce.space_id;Oe.genie_room={name:Ce.name||"Genie Room",space_id:Ye||Ce.space_id}}else throw new Error("Selected Genie Room not found. Please select a configured Genie room.")}else if(d.genieSource==="select"&&d.genieSpaceId)Oe.genie_room={name:d.genieName||"Genie Room",space_id:d.genieSpaceId};else throw new Error("Please select a Genie space to discover tools.");break;case"functions":if(d.functionsCatalog&&d.functionsSchema)Oe.functions={catalog_name:d.functionsCatalog,schema_name:d.functionsSchema};else throw new Error("Please select a catalog and schema to discover functions.");break;case"sql":Oe.sql=!0;break;case"app":if(d.appSource==="configured"&&d.appRefName){const Ce=(Ge=(Ee=e.resources)==null?void 0:Ee.apps)==null?void 0:Ge[d.appRefName];if(Ce)Oe.app={name:Ce.name};else throw new Error("Selected Databricks App not found. Please select a configured app.")}else if(d.appSource==="select"&&d.appName)Oe.app={name:d.appName};else throw new Error("Please select a Databricks App to discover tools.");break;case"vector_search":if(d.vectorStoreSource==="configured"&&d.vectorStoreRefName){const Ce=(Pe=(De=e.resources)==null?void 0:De.vector_stores)==null?void 0:Pe[d.vectorStoreRefName];if(Ce){const Ye=(Be=Ce.index)==null?void 0:Be.schema;if(!(Ye!=null&&Ye.catalog_name)||!(Ye!=null&&Ye.schema_name))throw new Error("Vector store must have an index with schema (catalog/schema) configured.");Oe.vector_search={index:{schema:{catalog_name:Ye.catalog_name,schema_name:Ye.schema_name},name:Ce.index.name}}}else throw new Error("Selected Vector Store not found. Please select a configured vector store.")}else if(d.vectorStoreSource==="select"){if(!d.vectorIndex)throw new Error("Please select a vector index to discover tools.");if(!d.vectorCatalog||!d.vectorSchema)throw new Error("Please select a catalog and schema for the vector index.");Oe.vector_search={index:{schema:{catalog_name:d.vectorCatalog,schema_name:d.vectorSchema},name:d.vectorIndex}}}else throw new Error("Please select a vector store to discover tools.");break}if(d.useCredentials){if(d.credentialsMode==="service_principal"&&d.servicePrincipalRef){const Ce=(Ss=e.service_principals)==null?void 0:Ss[d.servicePrincipalRef];if(Ce){const Ye=ut=>{var G;if(typeof ut=="string"){if(ut.startsWith("*")){const ue=ut.slice(1),de=(G=e.variables)==null?void 0:G[ue];if(de&&typeof de=="object"&&"value"in de)return String(de.value);if(typeof de=="string")return de}return ut}};if(Oe.client_id=Ye(Ce.client_id),Oe.client_secret=Ye(Ce.client_secret),l){let ut=l.replace(/\/$/,"");!ut.startsWith("http://")&&!ut.startsWith("https://")&&(ut=`https://${ut}`),Oe.workspace_host=ut}}else console.warn("Service principal not found:",d.servicePrincipalRef)}else if(d.credentialsMode==="service_principal"&&!d.servicePrincipalRef){if(console.log("No service principal selected, using ambient auth"),l){let Ce=l.replace(/\/$/,"");!Ce.startsWith("http://")&&!Ce.startsWith("https://")&&(Ce=`https://${Ce}`),Oe.workspace_host=Ce}}else if(d.credentialsMode==="manual"){if(d.clientIdSource==="variable"&&d.clientIdVar){const Ce=(Cs=e.variables)==null?void 0:Cs[d.clientIdVar];Ce&&typeof Ce=="object"&&"value"in Ce&&(Oe.client_id=String(Ce.value))}else d.clientIdManual&&(Oe.client_id=d.clientIdManual);if(d.clientSecretSource==="variable"&&d.clientSecretVar){const Ce=(ns=e.variables)==null?void 0:ns[d.clientSecretVar];Ce&&typeof Ce=="object"&&"value"in Ce&&(Oe.client_secret=String(Ce.value))}else d.clientSecretManual&&(Oe.client_secret=d.clientSecretManual);if(d.workspaceHostSource==="variable"&&d.workspaceHostVar){const Ce=(ks=e.variables)==null?void 0:ks[d.workspaceHostVar];Ce&&typeof Ce=="object"&&"value"in Ce&&(Oe.workspace_host=String(Ce.value))}else d.workspaceHostManual&&(Oe.workspace_host=d.workspaceHostManual)}}const xt={"Content-Type":"application/json"};l&&(xt["X-Databricks-Host"]=l.replace(/\/$/,""));const wt=await fetch("/api/mcp/list-tools",{method:"POST",headers:xt,body:JSON.stringify(Oe)}),St=await wt.json();if(!wt.ok)throw new Error(St.error||"Failed to discover tools");St.tools&&St.tools.length>0?g(Ce=>({...Ce,availableToolsLoading:!1,availableTools:St.tools.map(Ye=>Ye.name),availableToolsError:""})):g(Ce=>({...Ce,availableToolsLoading:!1,availableTools:[],availableToolsError:"No tools found on the MCP server."}))}catch(Oe){g(xt=>({...xt,availableToolsLoading:!1,availableToolsError:Oe instanceof Error?Oe.message:"Failed to discover tools"}))}},className:"text-xs text-slate-400 hover:text-white flex items-center space-x-1",disabled:d.availableToolsLoading,children:[t.jsx(Ut,{className:`w-3 h-3 ${d.availableToolsLoading?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]})]}),t.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Control which tools are loaded from the MCP server. Supports glob patterns: * (any chars), ? (single char), [abc] (char set)"})]})}),d.availableToolsError&&t.jsx("div",{className:"p-2 bg-amber-500/10 border border-amber-500/30 rounded text-xs text-amber-400",children:d.availableToolsError}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Include Tools"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Only load tools matching these patterns. Leave empty to include all tools."}),t.jsxs("div",{className:"space-y-2",children:[d.includeTools.map((j,Y)=>t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(U,{value:j,onChange:Q=>{const xe=[...d.includeTools];xe[Y]=Q.target.value,g({...d,includeTools:xe})},placeholder:"e.g., query_*, list_tables, get_?_data",className:"flex-1"}),t.jsx(ee,{variant:"ghost",size:"sm",type:"button",onClick:()=>{const Q=d.includeTools.filter((xe,Ee)=>Ee!==Y);g({...d,includeTools:Q})},children:t.jsx(Ze,{className:"w-4 h-4 text-red-400"})})]},Y)),t.jsxs("div",{className:"flex items-center space-x-2",children:[d.availableTools.length>0?t.jsx(ae,{options:[{value:"",label:"Select Tool..."},...d.availableTools.map(j=>({value:j,label:j}))],value:"",onChange:j=>{j.target.value&&g({...d,includeTools:[...d.includeTools,j.target.value]})},className:"flex-1"}):null,t.jsxs(ee,{variant:"secondary",size:"sm",type:"button",onClick:()=>g({...d,includeTools:[...d.includeTools,""]}),children:[t.jsx(Ie,{className:"w-4 h-4 mr-1"}),"Add Pattern"]})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Exclude Tools"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Exclude tools matching these patterns. Takes precedence over include patterns."}),t.jsxs("div",{className:"space-y-2",children:[d.excludeTools.map((j,Y)=>t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(U,{value:j,onChange:Q=>{const xe=[...d.excludeTools];xe[Y]=Q.target.value,g({...d,excludeTools:xe})},placeholder:"e.g., drop_*, delete_*, execute_ddl",className:"flex-1"}),t.jsx(ee,{variant:"ghost",size:"sm",type:"button",onClick:()=>{const Q=d.excludeTools.filter((xe,Ee)=>Ee!==Y);g({...d,excludeTools:Q})},children:t.jsx(Ze,{className:"w-4 h-4 text-red-400"})})]},Y)),t.jsxs("div",{className:"flex items-center space-x-2",children:[d.availableTools.length>0?t.jsx(ae,{options:[{value:"",label:"Select Tool..."},...d.availableTools.map(j=>({value:j,label:j}))],value:"",onChange:j=>{j.target.value&&g({...d,excludeTools:[...d.excludeTools,j.target.value]})},className:"flex-1"}):null,t.jsxs(ee,{variant:"secondary",size:"sm",type:"button",onClick:()=>g({...d,excludeTools:[...d.excludeTools,""]}),children:[t.jsx(Ie,{className:"w-4 h-4 mr-1"}),"Add Pattern"]})]})]})]}),(d.includeTools.length>0||d.excludeTools.length>0)&&t.jsx("div",{className:"p-3 bg-purple-900/20 border border-purple-500/30 rounded-lg",children:t.jsxs("p",{className:"text-xs text-purple-300",children:[t.jsx("strong",{children:"Filter Summary:"})," ",d.includeTools.length>0&&t.jsxs("span",{children:["Including: ",d.includeTools.filter(j=>j).join(", ")||"none"]}),d.includeTools.length>0&&d.excludeTools.length>0&&" | ",d.excludeTools.length>0&&t.jsxs("span",{children:["Excluding: ",d.excludeTools.filter(j=>j).join(", ")||"none"]})]})})]})]}),t.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[t.jsx(ee,{variant:"secondary",type:"button",onClick:()=>{u(!1),At()},children:"Cancel"}),t.jsx(ee,{type:"submit",disabled:!r.name||r.type==="mcp"&&d.sourceType==="connection"&&!(d.connectionSource==="configured"&&d.connectionRefName||d.connectionSource==="select"&&d.connectionName),children:m?"Save Changes":"Add Tool"})]})]})})]})}async function rb(e){const s=await fetch("/api/ai/generate-guardrail-prompt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){const n=await s.json();throw new Error(n.error||"Failed to generate guardrail prompt")}return(await s.json()).prompt}const pl=[{value:"accuracy",label:"Accuracy"},{value:"completeness",label:"Completeness"},{value:"clarity",label:"Clarity"},{value:"helpfulness",label:"Helpfulness"},{value:"safety",label:"Safety"},{value:"relevance",label:"Relevance"},{value:"tone",label:"Professional Tone"},{value:"no_hallucination",label:"No Hallucination"},{value:"pii_protection",label:"PII Protection"},{value:"bias_free",label:"Bias-Free"}],fl=`You are an expert judge evaluating AI responses. Your task is to critique the AI assistant's latest response in the conversation below.

Evaluate the response based on these criteria:
1. Accuracy - Is the information correct and factual?
2. Completeness - Does it fully address the user's query?
3. Clarity - Is the explanation clear and well-structured?
4. Helpfulness - Does it provide actionable and useful information?
5. Safety - Does it avoid harmful or inappropriate content?

If the response meets ALL criteria satisfactorily, set pass to True.

If you find ANY issues with the response, do NOT set pass to True. Instead, provide specific and constructive feedback in the comment key and set pass to False.

### Inputs:
{inputs}

### Response:
{outputs}`;function ib(){var F;const{config:e,addGuardrail:s,updateGuardrail:a,removeGuardrail:n}=nt(),[i,l]=A.useState(!1),[o,u]=A.useState(null),[m,h]=A.useState({refName:"",name:"",modelKey:"",prompt:fl,numRetries:"3",failOpen:!0,maxContextLength:"8000"}),[r,c]=A.useState(!1),[d,g]=A.useState(!1),[v,S]=A.useState(""),[y,b]=A.useState(!1),[_,x]=A.useState(["accuracy","completeness","clarity","helpfulness","safety"]),[f,C]=A.useState(""),w=async(E=!1)=>{g(!0);try{const $=await rb({context:v||void 0,guardrail_name:m.name||void 0,evaluation_criteria:_.length>0?_:void 0,existing_prompt:E?m.prompt:void 0});h({...m,prompt:$}),b(!1),S("")}catch($){console.error("Failed to generate guardrail prompt:",$),alert($ instanceof Error?$.message:"Failed to generate guardrail prompt")}finally{g(!1)}},I=()=>{f&&!_.includes(f)&&(x([..._,f]),C(""))},R=e.guardrails||{},k=((F=e.resources)==null?void 0:F.llms)||{},D=()=>{h({refName:"",name:"",modelKey:"",prompt:fl,numRetries:"3",failOpen:!0,maxContextLength:"8000"}),u(null),b(!1),S(""),x(["accuracy","completeness","clarity","helpfulness","safety"]),c(!1)},{scrollToAsset:L}=zs(),V=(E,$)=>{var N;L(E),u(E),c(!0);const p=((N=Object.entries(k).find(([,P])=>P.name===$.model.name))==null?void 0:N[0])||"";h({refName:E,name:$.name,modelKey:p,prompt:$.prompt,numRetries:String($.num_retries??3),failOpen:$.fail_open!==!1,maxContextLength:String($.max_context_length??8e3)}),l(!0)},B=Object.entries(k).map(([E,$])=>({value:E,label:`${E} (${$.name})`})),T=E=>{if(E.preventDefault(),!(!m.refName.trim()||!m.name.trim())&&m.modelKey&&k[m.modelKey]){const $={name:m.name,model:k[m.modelKey],prompt:m.prompt,num_retries:parseInt(m.numRetries),fail_open:m.failOpen,max_context_length:parseInt(m.maxContextLength)},p=m.refName.trim();o?o!==p?(n(o),s(p,$)):a(p,$):s(p,$),D(),l(!1)}};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-white",children:"Guardrails"}),t.jsx("p",{className:"text-slate-400 mt-1",children:"Configure safety checks and quality controls for agent responses"})]}),t.jsxs(ee,{onClick:()=>l(!0),children:[t.jsx(Ie,{className:"w-4 h-4"}),"Add Guardrail"]})]}),Object.keys(R).length===0?t.jsxs($e,{className:"text-center py-12",children:[t.jsx(Ja,{className:"w-12 h-12 mx-auto text-slate-600 mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-slate-300 mb-2",children:"No guardrails configured"}),t.jsx("p",{className:"text-slate-500 mb-4",children:"Guardrails help ensure agent responses are safe, accurate, and helpful."}),t.jsxs(ee,{onClick:()=>l(!0),children:[t.jsx(Ie,{className:"w-4 h-4"}),"Add Your First Guardrail"]})]}):t.jsx("div",{className:"grid gap-4",children:Object.entries(R).map(([E,$])=>t.jsx($e,{variant:"interactive",className:"group cursor-pointer",onClick:()=>V(E,$),children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex items-start space-x-4",children:[t.jsx("div",{className:"w-10 h-10 rounded-lg bg-emerald-500/20 flex items-center justify-center flex-shrink-0",children:t.jsx(Ja,{className:"w-5 h-5 text-emerald-400"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-white",children:E}),E!==$.name&&t.jsxs("p",{className:"text-xs text-slate-500",children:["name: ",$.name]}),t.jsxs("p",{className:"text-sm text-slate-400",children:["Model: ",$.model.name]}),t.jsxs("p",{className:"text-xs text-slate-500 mt-2 line-clamp-2 font-mono",children:[$.prompt.substring(0,100),"..."]})]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs(Se,{variant:"success",children:["retries: ",$.num_retries??3]}),t.jsxs(Se,{variant:$.fail_open!==!1?"info":"warning",children:["fail open: ",$.fail_open!==!1?"yes":"no"]}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:p=>{p.stopPropagation(),V(E,$)},title:"Edit guardrail",children:t.jsx(Lr,{className:"w-4 h-4"})}),t.jsx(ee,{variant:"danger",size:"sm",onClick:p=>{p.stopPropagation(),Gt("Guardrail",E,()=>n(E))},title:"Delete guardrail",children:t.jsx(Ze,{className:"w-4 h-4"})})]})]})},E))}),t.jsx(ws,{isOpen:i,onClose:()=>{l(!1),D()},title:o?"Edit Guardrail":"Add Guardrail",description:o?"Modify the guardrail configuration":"Configure a safety check for agent responses",size:"lg",children:t.jsxs("form",{onSubmit:T,className:"space-y-4",children:[B.length===0&&t.jsx("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-lg p-4 text-amber-400 text-sm",children:"You need to add an LLM first before creating a guardrail."}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(U,{label:"Reference Name",placeholder:"e.g., llm_judge_guardrail",value:m.refName,onChange:E=>{const $=Ot(E.target.value);h({...m,refName:$,name:!r&&m.name===m.refName?$:m.name}),c(!0)},hint:"YAML key (spaces become underscores)",required:!0}),t.jsx(ae,{label:"Judge LLM",options:B,value:m.modelKey,onChange:E=>h({...m,modelKey:E.target.value}),placeholder:"Select an LLM...",required:!0})]}),t.jsx(U,{label:"Guardrail Name",placeholder:"e.g., llm_judge",value:m.name,onChange:E=>h({...m,name:E.target.value}),hint:"The name property inside the guardrail config (can differ from reference name)",required:!0}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Evaluation Prompt"})}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs("button",{type:"button",onClick:()=>b(!y),className:"flex items-center space-x-1.5 px-3 py-1.5 text-xs rounded-lg font-medium bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-purple-300 border border-purple-500/30 hover:from-purple-500/30 hover:to-pink-500/30 transition-all",disabled:d,children:[t.jsx(Rt,{className:"w-3.5 h-3.5"}),t.jsx("span",{children:"AI Assistant"})]}),m.prompt&&m.prompt!==fl&&t.jsxs("button",{type:"button",onClick:()=>w(!0),className:"flex items-center space-x-1.5 px-3 py-1.5 text-xs rounded-lg font-medium bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-purple-300 border border-purple-500/30 hover:from-purple-500/30 hover:to-pink-500/30 transition-all",disabled:d,children:[d?t.jsx(Nt,{className:"w-3.5 h-3.5 animate-spin"}):t.jsx(Rt,{className:"w-3.5 h-3.5"}),t.jsx("span",{children:"Improve Prompt"})]})]}),y&&t.jsxs("div",{className:"p-3 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-lg border border-purple-500/30 space-y-3",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Rt,{className:"w-4 h-4 text-purple-400"}),t.jsx("span",{className:"text-sm font-medium text-purple-300",children:"Generate Guardrail Prompt with AI"})]}),t.jsx("p",{className:"text-xs text-slate-400",children:"Describe what this guardrail should evaluate and I'll generate an optimized evaluation prompt."}),t.jsx(Jt,{value:v,onChange:E=>S(E.target.value),rows:2,placeholder:"e.g., This guardrail should check that responses don't contain harmful content and are factually accurate for a retail customer service agent..."}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-xs font-medium text-slate-400",children:"Evaluation Criteria"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Select what aspects the guardrail should evaluate"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:pl.map(E=>t.jsx("button",{type:"button",onClick:()=>{_.includes(E.value)?x(_.filter($=>$!==E.value)):x([..._,E.value])},className:`px-2 py-1 text-xs rounded-md transition-all ${_.includes(E.value)?"bg-emerald-500/30 text-emerald-300 border border-emerald-500/50":"bg-slate-800 text-slate-400 border border-slate-700 hover:border-slate-600"}`,children:E.label},E.value))}),_.filter(E=>!pl.map($=>$.value).includes(E)).length>0&&t.jsx("div",{className:"flex flex-wrap gap-2",children:_.filter(E=>!pl.map($=>$.value).includes(E)).map(E=>t.jsxs("span",{className:"px-2 py-1 text-xs rounded-md bg-blue-500/30 text-blue-300 border border-blue-500/50 flex items-center space-x-1",children:[t.jsx("span",{children:E}),t.jsx("button",{type:"button",onClick:()=>x(_.filter($=>$!==E)),className:"hover:text-red-300",children:""})]},E))}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"text",value:f,onChange:E=>C(E.target.value.replace(/[^a-z0-9_\s]/gi,"").toLowerCase()),placeholder:"Add custom criterion...",className:"flex-1 px-2 py-1 text-xs bg-slate-800 border border-slate-700 rounded-md text-slate-300 placeholder-slate-500 focus:border-purple-500 focus:outline-none",onKeyDown:E=>{E.key==="Enter"&&(E.preventDefault(),I())}}),t.jsx("button",{type:"button",onClick:I,disabled:!f,className:"px-2 py-1 text-xs bg-slate-700 text-slate-300 rounded-md hover:bg-slate-600 disabled:opacity-50",children:"Add"})]})]}),t.jsxs("div",{className:"flex justify-end space-x-2",children:[t.jsx(ee,{type:"button",variant:"secondary",size:"sm",onClick:()=>{b(!1),S("")},disabled:d,children:"Cancel"}),t.jsx(ee,{type:"button",size:"sm",onClick:()=>w(!1),disabled:d||_.length===0&&!v,className:"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600",children:d?t.jsxs(t.Fragment,{children:[t.jsx(Nt,{className:"w-4 h-4 mr-1.5 animate-spin"}),"Generating..."]}):t.jsxs(t.Fragment,{children:[t.jsx(Rt,{className:"w-4 h-4 mr-1.5"}),"Generate Prompt"]})})]})]}),t.jsx(Jt,{value:m.prompt,onChange:E=>h({...m,prompt:E.target.value}),rows:12,hint:"Use {inputs} and {outputs} placeholders for conversation context",required:!0})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(U,{label:"Number of Retries",type:"number",min:"0",max:"10",value:m.numRetries,onChange:E=>h({...m,numRetries:E.target.value}),hint:"How many times to retry if evaluation fails"}),t.jsx(U,{label:"Max Context Length",type:"number",min:"0",value:m.maxContextLength,onChange:E=>h({...m,maxContextLength:E.target.value}),hint:"Max character length for extracted tool context (default: 8000)"})]}),t.jsx("div",{className:"p-3 bg-slate-800/30 rounded-lg border border-slate-700/50",children:t.jsxs("label",{className:"flex items-center space-x-3 text-sm text-slate-300 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:m.failOpen,onChange:E=>h({...m,failOpen:E.target.checked}),className:"rounded border-slate-600 bg-slate-700 text-purple-500 focus:ring-purple-500"}),t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"Fail Open"}),t.jsx("p",{className:"text-xs text-slate-500 mt-0.5",children:"When enabled, responses pass through if the guardrail judge call fails (recommended for production)"})]})]})}),t.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[t.jsx(ee,{variant:"secondary",type:"button",onClick:()=>{l(!1),D()},children:"Cancel"}),t.jsx(ee,{type:"submit",disabled:B.length===0,children:o?"Save Changes":"Add Guardrail"})]})]})})]})}function Ua({label:e,options:s,value:a,onChange:n,placeholder:i,hint:l}){const[o,u]=A.useState(!1),m=A.useRef(null);A.useEffect(()=>{const d=g=>{m.current&&!m.current.contains(g.target)&&u(!1)};return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[]);const h=d=>{a.includes(d)?n(a.filter(g=>g!==d)):n([...a,d])},r=(d,g)=>{g.stopPropagation(),n(a.filter(v=>v!==d))},c=a.map(d=>{var g;return((g=s.find(v=>v.value===d))==null?void 0:g.label)||d});return t.jsxs("div",{className:"space-y-1.5",ref:m,children:[e&&t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:e}),t.jsxs("div",{className:"relative",children:[t.jsxs("div",{onClick:()=>u(!o),className:pt("w-full min-h-[42px] px-3 py-2 bg-slate-800/50 border rounded-lg cursor-pointer","focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500","transition-all duration-200 flex flex-wrap gap-1.5 items-center",o?"border-blue-500 ring-2 ring-blue-500/50":"border-slate-700"),children:[a.length===0?t.jsx("span",{className:"text-slate-500",children:i||"Select options..."}):c.map((d,g)=>t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-blue-500/20 text-blue-400 rounded text-sm",children:[d,t.jsx(_a,{className:"w-3 h-3 cursor-pointer hover:text-blue-300",onClick:v=>r(a[g],v)})]},a[g])),t.jsx(Wt,{className:pt("w-4 h-4 text-slate-500 ml-auto transition-transform",o&&"rotate-180")})]}),o&&t.jsx("div",{className:"absolute z-10 w-full mt-1 bg-slate-800 border border-slate-700 rounded-lg shadow-xl max-h-60 overflow-auto",children:s.length===0?t.jsx("div",{className:"px-3 py-2 text-sm text-slate-500",children:"No options available"}):s.map(d=>t.jsxs("div",{onClick:()=>h(d.value),className:pt("px-3 py-2 flex items-center justify-between cursor-pointer transition-colors",a.includes(d.value)?"bg-blue-500/20 text-blue-400":"text-slate-300 hover:bg-slate-700"),children:[t.jsx("span",{children:d.label}),a.includes(d.value)&&t.jsx(bi,{className:"w-4 h-4"})]},d.value))})]}),l&&t.jsx("p",{className:"text-xs text-slate-500",children:l})]})}async function lb(e){const s=await fetch("/api/ai/generate-middleware-prompt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){const n=await s.json();throw new Error(n.error||"Failed to generate prompt")}return(await s.json()).prompt}function ob(e){return typeof e=="object"&&e!==null&&"name"in e}function Nn(e,s){var a;if(ob(e)){const n=e,i=(a=Object.entries(s).find(([,l])=>l.name===n.name))==null?void 0:a[0];return i?{source:"configured",ref:i,inline:""}:{source:"inline",ref:"",inline:n.default_template||""}}return{source:"inline",ref:"",inline:typeof e=="string"?e:""}}function wn(e,s,a){return e==="configured"&&s?`__PROMPT_REF__${s}`:a||void 0}const cb=e=>{if(e==="custom")return"";const s=e.match(/create_(.+)$/);if(s&&s[1])return s[1];const a=e.split(".");return a[a.length-1]||"middleware"},Ha=[{value:"dao_ai.middleware.create_guardrail_middleware",label:"Guardrail Middleware",description:"LLM-based guardrail validation with retry logic",category:"Guardrails"},{value:"dao_ai.middleware.create_content_filter_middleware",label:"Content Filter",description:"Deterministic keyword-based content blocking",category:"Guardrails"},{value:"dao_ai.middleware.create_safety_guardrail_middleware",label:"Safety Guardrail",description:"Safety-focused response evaluation",category:"Guardrails"},{value:"dao_ai.middleware.create_veracity_guardrail_middleware",label:"Veracity Guardrail",description:"Groundedness check against tool/retrieval context",category:"Guardrails"},{value:"dao_ai.middleware.create_relevance_guardrail_middleware",label:"Relevance Guardrail",description:"Check if response addresses the user query",category:"Guardrails"},{value:"dao_ai.middleware.create_tone_guardrail_middleware",label:"Tone Guardrail",description:"Validate response matches a tone profile",category:"Guardrails"},{value:"dao_ai.middleware.create_conciseness_guardrail_middleware",label:"Conciseness Guardrail",description:"Length and verbosity checks with LLM evaluation",category:"Guardrails"},{value:"dao_ai.middleware.create_user_id_validation_middleware",label:"User ID Validation",description:"Ensure user_id is present in context",category:"Validation"},{value:"dao_ai.middleware.create_thread_id_validation_middleware",label:"Thread ID Validation",description:"Ensure thread_id is present in context",category:"Validation"},{value:"dao_ai.middleware.create_custom_field_validation_middleware",label:"Custom Field Validation",description:"Validate custom required fields",category:"Validation"},{value:"dao_ai.middleware.create_filter_last_human_message_middleware",label:"Filter Last Human Message",description:"Keep only the last human message",category:"Validation"},{value:"dao_ai.middleware.create_summarization_middleware",label:"Summarization",description:"Summarize chat history when limits exceeded",category:"Processing"},{value:"dao_ai.middleware.create_human_in_the_loop_middleware",label:"Human-in-the-Loop",description:"Require human approval for tool execution",category:"Human Approval"},{value:"dao_ai.middleware.create_assert_middleware",label:"Assert (DSPy)",description:"Assert constraints with retry on failure",category:"Assertions"},{value:"dao_ai.middleware.create_suggest_middleware",label:"Suggest (DSPy)",description:"Provide suggestions when constraints fail",category:"Assertions"},{value:"dao_ai.middleware.create_refine_middleware",label:"Refine (DSPy)",description:"Iteratively refine outputs to meet constraints",category:"Assertions"},{value:"dao_ai.middleware.create_tool_call_limit_middleware",label:"Tool Call Limit",description:"Limit tool calls per thread or run",category:"Limits"},{value:"dao_ai.middleware.create_model_call_limit_middleware",label:"Model Call Limit",description:"Limit LLM API calls per thread or run",category:"Limits"},{value:"dao_ai.middleware.create_tool_retry_middleware",label:"Tool Retry",description:"Retry failed tool calls with exponential backoff",category:"Retry"},{value:"dao_ai.middleware.create_model_retry_middleware",label:"Model Retry",description:"Retry failed model calls with exponential backoff",category:"Retry"},{value:"dao_ai.middleware.create_context_editing_middleware",label:"Context Editing",description:"Clear older tool outputs when token limits reached",category:"Processing"},{value:"dao_ai.middleware.create_pii_middleware",label:"PII Protection",description:"Detect and handle personally identifiable information",category:"Privacy"},{value:"dao_ai.middleware.create_tool_call_observability_middleware",label:"Tool Call Observability",description:"Log tool calls with timing and argument tracking",category:"Observability"},{value:"dao_ai.middleware.create_todo_list_middleware",label:"Todo List",description:"Agent task planning and tracking with write_todos tool",category:"Deep Agents"},{value:"dao_ai.middleware.create_deep_summarization_middleware",label:"Deep Summarization",description:"Backend-offloading summarization with arg truncation",category:"Processing"},{value:"dao_ai.middleware.create_llm_tool_selector_middleware",label:"LLM Tool Selector",description:"Intelligently select relevant tools per query",category:"Processing"},{value:"dao_ai.middleware.create_filesystem_middleware",label:"Filesystem",description:"File operations (ls, read, write, edit, glob, grep)",category:"Deep Agents"},{value:"dao_ai.middleware.create_subagent_middleware",label:"SubAgent",description:"Spawn subagents for complex multi-step tasks",category:"Deep Agents"},{value:"dao_ai.middleware.create_agents_memory_middleware",label:"Agents Memory",description:"Load AGENTS.md context files into system prompt",category:"Deep Agents"},{value:"dao_ai.middleware.create_skills_middleware",label:"Skills",description:"Discover and expose SKILL.md agent skills",category:"Deep Agents"},{value:"custom",label:"Custom Factory...",description:"Custom middleware factory function",category:"Custom"}],rd=Array.from(new Set(Ha.map(e=>e.category))),xl=e=>{if(Ha.find(i=>i.value===e))return e;const s=e.split("."),a=s[s.length-1],n=Ha.find(i=>{const l=i.value.split(".");return l[l.length-1]===a});return n?n.value:e};function ti(e,s,a="tool_0"){if(typeof e=="string"&&e.startsWith("__REF__")){const n=e.substring(7);return{id:a,isManual:!1,toolRef:n,toolName:""}}if(typeof e=="string"&&e.startsWith("*")){const n=e.substring(1);return{id:a,isManual:!1,toolRef:n,toolName:""}}if(typeof e=="string"){if(s[e])return{id:a,isManual:!1,toolRef:e,toolName:""};const n=Object.entries(s).find(([,i])=>(i==null?void 0:i.name)===e);return n?{id:a,isManual:!1,toolRef:n[0],toolName:""}:{id:a,isManual:!0,toolRef:"",toolName:e}}if(typeof e=="object"&&e!==null){const n=e.name,i=Object.entries(s).find(([,l])=>JSON.stringify(l)===JSON.stringify(e));if(i)return{id:a,isManual:!1,toolRef:i[0],toolName:""};if(n){const l=Object.entries(s).find(([,o])=>(o==null?void 0:o.name)===n);return l?{id:a,isManual:!1,toolRef:l[0],toolName:""}:{id:a,isManual:!0,toolRef:"",toolName:n}}}return{id:a,isManual:!0,toolRef:"",toolName:String(e)}}const Sn={refName:"",selectedFactory:"",customFactory:"",guardrailName:"",guardrailModel:"",guardrailPrompt:"",guardrailPromptSource:"inline",guardrailPromptRef:"",guardrailRetries:3,guardrailFailOpen:!0,guardrailMaxContextLength:8e3,bannedKeywords:[],blockMessage:"I cannot provide that response. Please rephrase your request.",safetyModel:"",safetyFailOpen:!0,customFields:[],summaryModel:"",summaryMaxTokens:2048,summaryMaxTokensBefore:20480,summaryMaxMessagesBefore:10,summaryUsesTokens:!0,hitlInterruptTools:[],hitlDescriptionPrefix:"",assertConstraint:"",assertMaxRetries:3,assertOnFailure:"error",assertFallbackMessage:"Unable to generate a valid response.",assertMiddlewareName:"",suggestConstraint:"",suggestAllowOneRetry:!1,suggestLogLevel:"warning",suggestMiddlewareName:"",refineRewardFn:"",refineThreshold:.8,refineMaxIterations:3,refineSelectBest:!0,toolCallLimitTool:"",toolCallLimitThreadLimit:null,toolCallLimitRunLimit:10,toolCallLimitExitBehavior:"continue",modelCallLimitThreadLimit:null,modelCallLimitRunLimit:50,modelCallLimitExitBehavior:"end",toolRetryMaxRetries:3,toolRetryBackoffFactor:2,toolRetryInitialDelay:1,toolRetryMaxDelay:null,toolRetryJitter:!1,toolRetryTools:[],toolRetryOnFailure:"continue",modelRetryMaxRetries:3,modelRetryBackoffFactor:2,modelRetryInitialDelay:1,modelRetryMaxDelay:null,modelRetryJitter:!1,modelRetryOnFailure:"continue",contextEditingTrigger:1e5,contextEditingKeep:3,contextEditingClearAtLeast:0,contextEditingClearToolInputs:!1,contextEditingExcludeTools:[],contextEditingPlaceholder:"[cleared]",contextEditingTokenCountMethod:"approximate",piiType:"email",piiStrategy:"redact",piiApplyToInput:!0,piiApplyToOutput:!1,piiApplyToToolResults:!1,veracityModel:"",veracityRetries:2,veracityFailOpen:!0,veracityMaxContextLength:8e3,relevanceModel:"",relevanceRetries:2,relevanceFailOpen:!0,toneModel:"",toneProfile:"professional",toneCustomGuidelines:"",toneCustomGuidelinesSource:"inline",toneCustomGuidelinesRef:"",toneRetries:2,toneFailOpen:!0,concisenessModel:"",concisenessMaxLength:3e3,concisenessMinLength:20,concisenessCheckVerbosity:!0,concisenessRetries:2,concisenessFailOpen:!0,observabilityLogLevel:"INFO",observabilityIncludeArgs:!1,observabilityTrackTiming:!0,todoSystemPrompt:"",todoSystemPromptSource:"inline",todoSystemPromptRef:"",todoToolDescription:"",deepSumModel:"",deepSumBackendType:"state",deepSumRootDir:"",deepSumVolumePath:"",deepSumTriggerType:"tokens",deepSumTriggerValue:1e5,deepSumKeepType:"messages",deepSumKeepValue:20,deepSumHistoryPathPrefix:"/conversation_history",deepSumTruncateArgsEnabled:!1,deepSumTruncateArgsTriggerType:"messages",deepSumTruncateArgsTriggerValue:50,deepSumTruncateArgsKeepType:"messages",deepSumTruncateArgsKeepValue:20,deepSumTruncateArgsMaxLength:2e3,toolSelectorModel:"",toolSelectorMaxTools:3,toolSelectorAlwaysInclude:[],filesystemBackendType:"state",filesystemRootDir:"",filesystemVolumePath:"",filesystemEvictLimit:2e4,filesystemSystemPrompt:"",filesystemSystemPromptSource:"inline",filesystemSystemPromptRef:"",filesystemCustomToolDescs:"",subagentBackendType:"state",subagentRootDir:"",subagentVolumePath:"",subagentSystemPrompt:"",subagentSystemPromptSource:"inline",subagentSystemPromptRef:"",subagentTaskDescription:"",subagentEntries:[],agentsMemorySources:[],agentsMemoryBackendType:"state",agentsMemoryRootDir:"",agentsMemoryVolumePath:"",skillsSources:[],skillsBackendType:"state",skillsRootDir:"",skillsVolumePath:"",volumeSource:"reference",volumeRef:"",volumeSubPath:"",genericArgs:{}},db={"dao_ai.middleware.create_guardrail_middleware":"guardrail","dao_ai.middleware.create_todo_list_middleware":"todo","dao_ai.middleware.create_filesystem_middleware":"filesystem","dao_ai.middleware.create_subagent_middleware":"subagent","dao_ai.middleware.create_tone_guardrail_middleware":"tone"},ub={guardrail:'e.g., "Evaluate responses for professional tone, factual accuracy, and no PII disclosure"',todo:'e.g., "Manage engineering sprint tasks with priority levels and blocking dependencies"',filesystem:'e.g., "Manage project files with read-only access to config files and write access to output directory"',subagent:'e.g., "Coordinate between a research agent and a writing agent to produce comprehensive reports"',tone:'e.g., "Maintain a warm, empathetic customer support tone while being technically accurate"'};function Cn({label:e,value:s,source:a,promptRef:n,middlewareType:i,middlewareName:l,placeholder:o,hint:u,required:m,rows:h=3,promptOptions:r,prompts:c,onValueChange:d,onSourceChange:g,onRefChange:v}){var R,k;const[S,y]=A.useState(!1),[b,_]=A.useState(!1),[x,f]=A.useState(""),C=db[i]||i,w=ub[C]||"Describe what this prompt should achieve...",I=async(D=!1)=>{y(!0);try{const L=await lb({middleware_type:C,context:x||void 0,existing_prompt:D?s:void 0,middleware_name:l||void 0});d(L),_(!1),f("")}catch(L){console.error("Failed to generate middleware prompt:",L),alert(L instanceof Error?L.message:"Failed to generate prompt")}finally{y(!1)}};return t.jsxs("div",{className:"col-span-2 space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:e}),t.jsxs("div",{className:"inline-flex rounded-lg bg-slate-900/50 p-0.5",children:[t.jsx("button",{type:"button",onClick:()=>g("inline"),className:`px-3 py-1 text-xs rounded-md font-medium transition-all duration-150 ${a==="inline"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Inline"}),t.jsx("button",{type:"button",onClick:()=>g("configured"),className:`px-3 py-1 text-xs rounded-md font-medium transition-all duration-150 ${a==="configured"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Configured"})]})]}),a==="configured"?t.jsxs("div",{className:"space-y-2",children:[t.jsx(ae,{value:n,onChange:D=>v(D.target.value),options:r,placeholder:"Select a configured prompt..."}),n&&c[n]&&t.jsxs("div",{className:"p-3 bg-slate-800/50 rounded-lg border border-slate-700",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx(Ya,{className:"w-4 h-4 text-violet-400"}),t.jsx("span",{className:"text-sm font-medium text-slate-300",children:c[n].name})]}),c[n].description&&t.jsx("p",{className:"text-xs text-slate-400 mb-2",children:c[n].description}),c[n].default_template&&t.jsxs("pre",{className:"text-xs text-slate-500 bg-slate-900/50 p-2 rounded overflow-auto max-h-32",children:[(R=c[n].default_template)==null?void 0:R.substring(0,300),(((k=c[n].default_template)==null?void 0:k.length)||0)>300?"...":""]})]})]}):t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs("button",{type:"button",onClick:()=>_(!b),className:"flex items-center space-x-1.5 px-3 py-1.5 text-xs rounded-lg font-medium bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-purple-300 border border-purple-500/30 hover:from-purple-500/30 hover:to-pink-500/30 transition-all",disabled:S,children:[t.jsx(Rt,{className:"w-3.5 h-3.5"}),t.jsx("span",{children:"AI Assistant"})]}),s&&t.jsxs("button",{type:"button",onClick:()=>I(!0),className:"flex items-center space-x-1.5 px-3 py-1.5 text-xs rounded-lg font-medium bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-purple-300 border border-purple-500/30 hover:from-purple-500/30 hover:to-pink-500/30 transition-all",disabled:S,children:[S?t.jsx(Nt,{className:"w-3.5 h-3.5 animate-spin"}):t.jsx(Rt,{className:"w-3.5 h-3.5"}),t.jsx("span",{children:"Improve Prompt"})]})]})}),b&&t.jsxs("div",{className:"p-3 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-lg border border-purple-500/30 space-y-3",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Rt,{className:"w-4 h-4 text-purple-400"}),t.jsxs("span",{className:"text-sm font-medium text-purple-300",children:["Generate ",e," with AI"]})]}),t.jsxs("p",{className:"text-xs text-slate-400",children:["Describe what this ",C," prompt should do. The AI will generate an optimized prompt based on your description."]}),t.jsx(Jt,{value:x,onChange:D=>f(D.target.value),placeholder:w,rows:3}),t.jsxs("div",{className:"flex justify-end space-x-2",children:[t.jsx(ee,{type:"button",variant:"secondary",size:"sm",onClick:()=>{_(!1),f("")},disabled:S,children:"Cancel"}),t.jsx(ee,{type:"button",size:"sm",onClick:()=>I(!1),disabled:S||!x,className:"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600",children:S?t.jsxs(t.Fragment,{children:[t.jsx(Nt,{className:"w-4 h-4 mr-1.5 animate-spin"}),"Generating..."]}):t.jsxs(t.Fragment,{children:[t.jsx(Rt,{className:"w-4 h-4 mr-1.5"}),"Generate"]})})]})]}),t.jsx(Jt,{value:s,onChange:D=>d(D.target.value),placeholder:o,rows:h,required:m,hint:u})]})]})}function mb(){var E,$;const{config:e,addMiddleware:s,removeMiddleware:a,updateMiddleware:n}=nt(),[i,l]=A.useState(!1),[o,u]=A.useState(null),[m,h]=A.useState(null),[r,c]=A.useState(Sn),d=e.middleware||{},g=((E=e.resources)==null?void 0:E.llms)||{},v=[{value:"",label:"Select LLM..."},...Object.keys(g).map(p=>({value:p,label:p}))],S=e.tools||{},y=e.prompts||{},b=[{value:"",label:"Select a configured prompt..."},...Object.entries(y).map(([p,N])=>({value:p,label:`${p}  ${N.name}`}))],_=(($=e.resources)==null?void 0:$.volumes)||{},x=Object.entries(_).map(([p,N])=>{var W,q;const P=((W=N.schema)==null?void 0:W.catalog_name)||"",M=((q=N.schema)==null?void 0:q.schema_name)||"",O=P&&M?`/Volumes/${P}/${M}/${N.name}`:N.name;return{value:p,label:`${p} (${O})`,path:O}}),f=p=>{var O,W;const N=_[p];if(!N)return"";const P=((O=N.schema)==null?void 0:O.catalog_name)||"",M=((W=N.schema)==null?void 0:W.schema_name)||"";return P&&M?`/Volumes/${P}/${M}/${N.name}`:N.name},C=p=>{const N=x.find(M=>M.path===p);if(N)return{key:N.value,subPath:""};let P=null;for(const M of x)if(p.startsWith(M.path+"/")){const O=p.slice(M.path.length+1);(!P||M.path.length>P.len)&&(P={key:M.value,subPath:O,len:M.path.length})}return P?{key:P.key,subPath:P.subPath}:{key:"",subPath:""}},w=()=>{u(null),c(Sn),l(!0)},I=p=>{if(typeof p=="string"&&p.startsWith("*"))return p.substring(1);if(typeof p=="object"&&p!==null){const P=Object.entries(g).find(([,M])=>M.name===p.name);if(P)return P[0]}return typeof p=="string"?p:""},R=(p,N,P)=>{const M={},O=p.args||{},W=xl(p.name);if(W==="dao_ai.middleware.create_guardrail_middleware"){M.guardrailName=O.name||"",M.guardrailModel=I(O.model);const q=Nn(O.prompt,P);M.guardrailPrompt=q.inline,M.guardrailPromptSource=q.source,M.guardrailPromptRef=q.ref,M.guardrailRetries=O.num_retries||3,M.guardrailFailOpen=O.fail_open!==!1,M.guardrailMaxContextLength=O.max_context_length??8e3}if(W==="dao_ai.middleware.create_content_filter_middleware"&&(M.bannedKeywords=Array.isArray(O.banned_keywords)?O.banned_keywords:[],M.blockMessage=O.block_message||Sn.blockMessage),W==="dao_ai.middleware.create_safety_guardrail_middleware"&&(M.safetyModel=I(O.safety_model),M.safetyFailOpen=O.fail_open!==!1),W==="dao_ai.middleware.create_custom_field_validation_middleware"&&(M.customFields=Array.isArray(O.fields)?O.fields.map((q,ce)=>({id:`field_${ce}`,name:q.name||"",description:q.description||"",required:q.required!==!1,exampleValue:q.example_value||""})):[]),W==="dao_ai.middleware.create_summarization_middleware"){const q=O.chat_history||{};M.summaryModel=I(q.model),M.summaryMaxTokens=q.max_tokens||2048,M.summaryUsesTokens=!!q.max_tokens_before_summary,M.summaryMaxTokensBefore=q.max_tokens_before_summary||20480,M.summaryMaxMessagesBefore=q.max_messages_before_summary||10}if(W==="dao_ai.middleware.create_human_in_the_loop_middleware"){const q=O.interrupt_on||{};M.hitlInterruptTools=Object.entries(q).map(([ce,se],H)=>({id:`tool_${H}`,toolName:ce,reviewPrompt:se.review_prompt||"",allowedDecisions:se.allowed_decisions||["approve","edit","reject"]})),M.hitlDescriptionPrefix=O.description_prefix||""}if(W==="dao_ai.middleware.create_assert_middleware"&&(M.assertConstraint=O.constraint||"",M.assertMaxRetries=O.max_retries||3,M.assertOnFailure=O.on_failure||"error",M.assertFallbackMessage=O.fallback_message||Sn.assertFallbackMessage,M.assertMiddlewareName=O.name||""),W==="dao_ai.middleware.create_suggest_middleware"&&(M.suggestConstraint=O.constraint||"",M.suggestAllowOneRetry=O.allow_one_retry||!1,M.suggestLogLevel=O.log_level||"warning",M.suggestMiddlewareName=O.name||""),W==="dao_ai.middleware.create_refine_middleware"&&(M.refineRewardFn=O.reward_fn||"",M.refineThreshold=O.threshold??.8,M.refineMaxIterations=O.max_iterations||3,M.refineSelectBest=O.select_best!==!1),W==="dao_ai.middleware.create_tool_call_limit_middleware"){if(O.tool){const q=ti(O.tool,N);M.toolCallLimitTool=q.toolRef||""}else M.toolCallLimitTool="";M.toolCallLimitThreadLimit=O.thread_limit??null,M.toolCallLimitRunLimit=O.run_limit??null,M.toolCallLimitExitBehavior=O.exit_behavior||"continue"}if(W==="dao_ai.middleware.create_model_call_limit_middleware"&&(M.modelCallLimitThreadLimit=O.thread_limit??null,M.modelCallLimitRunLimit=O.run_limit??null,M.modelCallLimitExitBehavior=O.exit_behavior||"end"),W==="dao_ai.middleware.create_tool_retry_middleware"&&(M.toolRetryMaxRetries=O.max_retries||3,M.toolRetryBackoffFactor=O.backoff_factor||2,M.toolRetryInitialDelay=O.initial_delay||1,M.toolRetryMaxDelay=O.max_delay??null,M.toolRetryJitter=O.jitter||!1,M.toolRetryOnFailure=O.on_failure||"continue",Array.isArray(O.tools)?M.toolRetryTools=O.tools.map(q=>ti(q,N).toolRef).filter(Boolean):M.toolRetryTools=[]),W==="dao_ai.middleware.create_model_retry_middleware"&&(M.modelRetryMaxRetries=O.max_retries||3,M.modelRetryBackoffFactor=O.backoff_factor||2,M.modelRetryInitialDelay=O.initial_delay||1,M.modelRetryMaxDelay=O.max_delay??null,M.modelRetryJitter=O.jitter||!1,M.modelRetryOnFailure=O.on_failure||"continue"),W==="dao_ai.middleware.create_context_editing_middleware"&&(M.contextEditingTrigger=O.trigger||1e5,M.contextEditingKeep=O.keep||3,M.contextEditingClearAtLeast=O.clear_at_least||0,M.contextEditingClearToolInputs=O.clear_tool_inputs||!1,M.contextEditingPlaceholder=O.placeholder||"[cleared]",M.contextEditingTokenCountMethod=O.token_count_method||"approximate",Array.isArray(O.exclude_tools)?M.contextEditingExcludeTools=O.exclude_tools.map(q=>ti(q,N).toolRef).filter(Boolean):M.contextEditingExcludeTools=[]),W==="dao_ai.middleware.create_pii_middleware"&&(M.piiType=O.pii_type||"email",M.piiStrategy=O.strategy||"redact",M.piiApplyToInput=O.apply_to_input!==!1,M.piiApplyToOutput=O.apply_to_output||!1,M.piiApplyToToolResults=O.apply_to_tool_results||!1),W==="dao_ai.middleware.create_veracity_guardrail_middleware"&&(M.veracityModel=I(O.model),M.veracityRetries=O.num_retries??2,M.veracityFailOpen=O.fail_open!==!1,M.veracityMaxContextLength=O.max_context_length??8e3),W==="dao_ai.middleware.create_relevance_guardrail_middleware"&&(M.relevanceModel=I(O.model),M.relevanceRetries=O.num_retries??2,M.relevanceFailOpen=O.fail_open!==!1),W==="dao_ai.middleware.create_tone_guardrail_middleware"){M.toneModel=I(O.model),M.toneProfile=O.tone||"professional";const q=Nn(O.custom_guidelines,P);M.toneCustomGuidelines=q.inline,M.toneCustomGuidelinesSource=q.source,M.toneCustomGuidelinesRef=q.ref,M.toneRetries=O.num_retries??2,M.toneFailOpen=O.fail_open!==!1}if(W==="dao_ai.middleware.create_conciseness_guardrail_middleware"&&(M.concisenessModel=I(O.model),M.concisenessMaxLength=O.max_length??3e3,M.concisenessMinLength=O.min_length??20,M.concisenessCheckVerbosity=O.check_verbosity!==!1,M.concisenessRetries=O.num_retries??2,M.concisenessFailOpen=O.fail_open!==!1),W==="dao_ai.middleware.create_tool_call_observability_middleware"&&(M.observabilityLogLevel=O.log_level||"INFO",M.observabilityIncludeArgs=O.include_args||!1,M.observabilityTrackTiming=O.track_timing!==!1),W==="dao_ai.middleware.create_todo_list_middleware"){const q=Nn(O.system_prompt,P);M.todoSystemPrompt=q.inline,M.todoSystemPromptSource=q.source,M.todoSystemPromptRef=q.ref,M.todoToolDescription=O.tool_description||""}if(W==="dao_ai.middleware.create_deep_summarization_middleware"){M.deepSumModel=I(O.model),M.deepSumBackendType=O.backend_type||"state",M.deepSumRootDir=O.root_dir||"";const q=O.volume_path||"";M.deepSumVolumePath=q;const{key:ce,subPath:se}=C(q);M.volumeSource=ce?"reference":q?"manual":"reference",M.volumeRef=ce,M.volumeSubPath=se,Array.isArray(O.trigger)&&O.trigger.length===2&&(M.deepSumTriggerType=O.trigger[0],M.deepSumTriggerValue=O.trigger[1]),Array.isArray(O.keep)&&O.keep.length===2&&(M.deepSumKeepType=O.keep[0],M.deepSumKeepValue=O.keep[1]),M.deepSumHistoryPathPrefix=O.history_path_prefix||"/conversation_history",Array.isArray(O.truncate_args_trigger)&&O.truncate_args_trigger.length===2&&(M.deepSumTruncateArgsEnabled=!0,M.deepSumTruncateArgsTriggerType=O.truncate_args_trigger[0],M.deepSumTruncateArgsTriggerValue=O.truncate_args_trigger[1]),Array.isArray(O.truncate_args_keep)&&O.truncate_args_keep.length===2&&(M.deepSumTruncateArgsKeepType=O.truncate_args_keep[0],M.deepSumTruncateArgsKeepValue=O.truncate_args_keep[1]),M.deepSumTruncateArgsMaxLength=O.truncate_args_max_length??2e3}if(W==="dao_ai.middleware.create_llm_tool_selector_middleware"&&(M.toolSelectorModel=I(O.model),M.toolSelectorMaxTools=O.max_tools??3,Array.isArray(O.always_include)?M.toolSelectorAlwaysInclude=O.always_include.map(q=>ti(q,N).toolRef).filter(Boolean):M.toolSelectorAlwaysInclude=[]),W==="dao_ai.middleware.create_filesystem_middleware"){M.filesystemBackendType=O.backend_type||"state",M.filesystemRootDir=O.root_dir||"";const q=O.volume_path||"";M.filesystemVolumePath=q;const{key:ce,subPath:se}=C(q);M.volumeSource=ce?"reference":q?"manual":"reference",M.volumeRef=ce,M.volumeSubPath=se,M.filesystemEvictLimit=O.tool_token_limit_before_evict??2e4;const H=Nn(O.system_prompt,P);M.filesystemSystemPrompt=H.inline,M.filesystemSystemPromptSource=H.source,M.filesystemSystemPromptRef=H.ref,O.custom_tool_descriptions&&typeof O.custom_tool_descriptions=="object"&&(M.filesystemCustomToolDescs=JSON.stringify(O.custom_tool_descriptions,null,2))}if(W==="dao_ai.middleware.create_subagent_middleware"){M.subagentBackendType=O.backend_type||"state",M.subagentRootDir=O.root_dir||"";const q=O.volume_path||"";M.subagentVolumePath=q;const{key:ce,subPath:se}=C(q);M.volumeSource=ce?"reference":q?"manual":"reference",M.volumeRef=ce,M.volumeSubPath=se;const H=Nn(O.system_prompt,P);M.subagentSystemPrompt=H.inline,M.subagentSystemPromptSource=H.source,M.subagentSystemPromptRef=H.ref,M.subagentTaskDescription=O.task_description||"",Array.isArray(O.subagents)?M.subagentEntries=O.subagents.map((z,te)=>{const K=Nn(z.system_prompt,P);return{id:`subagent_${te}`,name:z.name||"",description:z.description||"",systemPrompt:K.inline,systemPromptSource:K.source,systemPromptRef:K.ref,model:I(z.model)}}):M.subagentEntries=[]}if(W==="dao_ai.middleware.create_agents_memory_middleware"){M.agentsMemorySources=Array.isArray(O.sources)?O.sources:[],M.agentsMemoryBackendType=O.backend_type||"state",M.agentsMemoryRootDir=O.root_dir||"";const q=O.volume_path||"";M.agentsMemoryVolumePath=q;const{key:ce,subPath:se}=C(q);M.volumeSource=ce?"reference":q?"manual":"reference",M.volumeRef=ce,M.volumeSubPath=se}if(W==="dao_ai.middleware.create_skills_middleware"){M.skillsSources=Array.isArray(O.sources)?O.sources:[],M.skillsBackendType=O.backend_type||"state",M.skillsRootDir=O.root_dir||"";const q=O.volume_path||"";M.skillsVolumePath=q;const{key:ce,subPath:se}=C(q);M.volumeSource=ce?"reference":q?"manual":"reference",M.volumeRef=ce,M.volumeSubPath=se}return(W==="custom"||!Ha.find(q=>q.value===W))&&(M.genericArgs=O),M},k=p=>{const N=d[p];u(p);const P=xl(N.name),M=Ha.find(W=>W.value===P&&W.value!=="custom"),O=R(N,S,y);c({...Sn,...O,refName:p,selectedFactory:M?P:"custom",customFactory:M?"":N.name}),l(!0)},D=()=>{const p=r.selectedFactory;if(p==="dao_ai.middleware.create_guardrail_middleware")return{name:r.guardrailName,model:r.guardrailModel?`__REF__${r.guardrailModel}`:void 0,prompt:wn(r.guardrailPromptSource,r.guardrailPromptRef,r.guardrailPrompt),num_retries:r.guardrailRetries,fail_open:r.guardrailFailOpen,max_context_length:r.guardrailMaxContextLength};if(p==="dao_ai.middleware.create_content_filter_middleware")return{banned_keywords:r.bannedKeywords,block_message:r.blockMessage};if(p==="dao_ai.middleware.create_safety_guardrail_middleware"){const N={fail_open:r.safetyFailOpen};return r.safetyModel&&(N.safety_model=`__REF__${r.safetyModel}`),N}if(p!=="dao_ai.middleware.create_user_id_validation_middleware"&&p!=="dao_ai.middleware.create_thread_id_validation_middleware"){if(p==="dao_ai.middleware.create_custom_field_validation_middleware")return{fields:r.customFields.map(N=>({name:N.name,...N.description&&{description:N.description},required:N.required,...N.exampleValue&&{example_value:N.exampleValue}}))};if(p!=="dao_ai.middleware.create_filter_last_human_message_middleware"){if(p==="dao_ai.middleware.create_summarization_middleware"){const N={model:r.summaryModel?`__REF__${r.summaryModel}`:void 0,max_tokens:r.summaryMaxTokens};return r.summaryUsesTokens?N.max_tokens_before_summary=r.summaryMaxTokensBefore:N.max_messages_before_summary=r.summaryMaxMessagesBefore,{chat_history:N}}if(p==="dao_ai.middleware.create_human_in_the_loop_middleware"){const N={};return r.hitlInterruptTools.forEach(P=>{N[P.toolName]={...P.reviewPrompt&&{review_prompt:P.reviewPrompt},allowed_decisions:P.allowedDecisions}}),{interrupt_on:N,...r.hitlDescriptionPrefix&&{description_prefix:r.hitlDescriptionPrefix}}}if(p==="dao_ai.middleware.create_assert_middleware")return{constraint:r.assertConstraint,max_retries:r.assertMaxRetries,on_failure:r.assertOnFailure,fallback_message:r.assertFallbackMessage,...r.assertMiddlewareName&&{name:r.assertMiddlewareName}};if(p==="dao_ai.middleware.create_suggest_middleware")return{constraint:r.suggestConstraint,allow_one_retry:r.suggestAllowOneRetry,log_level:r.suggestLogLevel,...r.suggestMiddlewareName&&{name:r.suggestMiddlewareName}};if(p==="dao_ai.middleware.create_refine_middleware")return{reward_fn:r.refineRewardFn,threshold:r.refineThreshold,max_iterations:r.refineMaxIterations,select_best:r.refineSelectBest};if(p==="dao_ai.middleware.create_tool_call_limit_middleware"){const N={};return r.toolCallLimitTool&&(N.tool=`__REF__${r.toolCallLimitTool}`),r.toolCallLimitThreadLimit!==null&&(N.thread_limit=r.toolCallLimitThreadLimit),r.toolCallLimitRunLimit!==null&&(N.run_limit=r.toolCallLimitRunLimit),N.exit_behavior=r.toolCallLimitExitBehavior,Object.keys(N).length>0?N:void 0}if(p==="dao_ai.middleware.create_model_call_limit_middleware"){const N={};return r.modelCallLimitThreadLimit!==null&&(N.thread_limit=r.modelCallLimitThreadLimit),r.modelCallLimitRunLimit!==null&&(N.run_limit=r.modelCallLimitRunLimit),N.exit_behavior=r.modelCallLimitExitBehavior,Object.keys(N).length>0?N:void 0}if(p==="dao_ai.middleware.create_tool_retry_middleware"){const N={max_retries:r.toolRetryMaxRetries,backoff_factor:r.toolRetryBackoffFactor,initial_delay:r.toolRetryInitialDelay,jitter:r.toolRetryJitter,on_failure:r.toolRetryOnFailure};return r.toolRetryMaxDelay!==null&&(N.max_delay=r.toolRetryMaxDelay),r.toolRetryTools.length>0&&(N.tools=r.toolRetryTools.map(P=>`__REF__${P}`)),N}if(p==="dao_ai.middleware.create_model_retry_middleware"){const N={max_retries:r.modelRetryMaxRetries,backoff_factor:r.modelRetryBackoffFactor,initial_delay:r.modelRetryInitialDelay,jitter:r.modelRetryJitter,on_failure:r.modelRetryOnFailure};return r.modelRetryMaxDelay!==null&&(N.max_delay=r.modelRetryMaxDelay),N}if(p==="dao_ai.middleware.create_context_editing_middleware"){const N={trigger:r.contextEditingTrigger,keep:r.contextEditingKeep,clear_at_least:r.contextEditingClearAtLeast,clear_tool_inputs:r.contextEditingClearToolInputs,placeholder:r.contextEditingPlaceholder,token_count_method:r.contextEditingTokenCountMethod};return r.contextEditingExcludeTools.length>0&&(N.exclude_tools=r.contextEditingExcludeTools.map(P=>`__REF__${P}`)),N}if(p==="dao_ai.middleware.create_pii_middleware")return{pii_type:r.piiType,strategy:r.piiStrategy,apply_to_input:r.piiApplyToInput,apply_to_output:r.piiApplyToOutput,apply_to_tool_results:r.piiApplyToToolResults};if(p==="dao_ai.middleware.create_veracity_guardrail_middleware")return{...r.veracityModel&&{model:`__REF__${r.veracityModel}`},num_retries:r.veracityRetries,fail_open:r.veracityFailOpen,max_context_length:r.veracityMaxContextLength};if(p==="dao_ai.middleware.create_relevance_guardrail_middleware")return{...r.relevanceModel&&{model:`__REF__${r.relevanceModel}`},num_retries:r.relevanceRetries,fail_open:r.relevanceFailOpen};if(p==="dao_ai.middleware.create_tone_guardrail_middleware"){const N=wn(r.toneCustomGuidelinesSource,r.toneCustomGuidelinesRef,r.toneCustomGuidelines);return{...r.toneModel&&{model:`__REF__${r.toneModel}`},tone:r.toneProfile,...N&&{custom_guidelines:N},num_retries:r.toneRetries,fail_open:r.toneFailOpen}}if(p==="dao_ai.middleware.create_conciseness_guardrail_middleware")return{...r.concisenessModel&&{model:`__REF__${r.concisenessModel}`},max_length:r.concisenessMaxLength,min_length:r.concisenessMinLength,check_verbosity:r.concisenessCheckVerbosity,num_retries:r.concisenessRetries,fail_open:r.concisenessFailOpen};if(p==="dao_ai.middleware.create_tool_call_observability_middleware")return{log_level:r.observabilityLogLevel,include_args:r.observabilityIncludeArgs,track_timing:r.observabilityTrackTiming};if(p==="dao_ai.middleware.create_todo_list_middleware"){const N={},P=wn(r.todoSystemPromptSource,r.todoSystemPromptRef,r.todoSystemPrompt);return P&&(N.system_prompt=P),r.todoToolDescription&&(N.tool_description=r.todoToolDescription),Object.keys(N).length>0?N:void 0}if(p==="dao_ai.middleware.create_deep_summarization_middleware"){const N={...r.deepSumModel&&{model:`__REF__${r.deepSumModel}`},backend_type:r.deepSumBackendType,trigger:[r.deepSumTriggerType,r.deepSumTriggerValue],keep:[r.deepSumKeepType,r.deepSumKeepValue],history_path_prefix:r.deepSumHistoryPathPrefix};if(r.deepSumBackendType==="filesystem"&&r.deepSumRootDir&&(N.root_dir=r.deepSumRootDir),r.deepSumBackendType==="volume"&&r.deepSumVolumePath){const P=r.deepSumVolumePath;N.volume_path=r.volumeSource==="reference"&&r.volumeSubPath?`${P}/${r.volumeSubPath}`:P}return r.deepSumTruncateArgsEnabled&&(N.truncate_args_trigger=[r.deepSumTruncateArgsTriggerType,r.deepSumTruncateArgsTriggerValue],N.truncate_args_keep=[r.deepSumTruncateArgsKeepType,r.deepSumTruncateArgsKeepValue],N.truncate_args_max_length=r.deepSumTruncateArgsMaxLength),N}if(p==="dao_ai.middleware.create_llm_tool_selector_middleware"){const N={...r.toolSelectorModel&&{model:`__REF__${r.toolSelectorModel}`},max_tools:r.toolSelectorMaxTools};return r.toolSelectorAlwaysInclude.length>0&&(N.always_include=r.toolSelectorAlwaysInclude.map(P=>`__REF__${P}`)),N}if(p==="dao_ai.middleware.create_filesystem_middleware"){const N={backend_type:r.filesystemBackendType};if(r.filesystemBackendType==="filesystem"&&r.filesystemRootDir&&(N.root_dir=r.filesystemRootDir),r.filesystemBackendType==="volume"&&r.filesystemVolumePath){const M=r.filesystemVolumePath;N.volume_path=r.volumeSource==="reference"&&r.volumeSubPath?`${M}/${r.volumeSubPath}`:M}r.filesystemEvictLimit!==null&&(N.tool_token_limit_before_evict=r.filesystemEvictLimit);const P=wn(r.filesystemSystemPromptSource,r.filesystemSystemPromptRef,r.filesystemSystemPrompt);if(P&&(N.system_prompt=P),r.filesystemCustomToolDescs)try{N.custom_tool_descriptions=JSON.parse(r.filesystemCustomToolDescs)}catch{}return N}if(p==="dao_ai.middleware.create_subagent_middleware"){const N={backend_type:r.subagentBackendType};if(r.subagentBackendType==="filesystem"&&r.subagentRootDir&&(N.root_dir=r.subagentRootDir),r.subagentBackendType==="volume"&&r.subagentVolumePath){const M=r.subagentVolumePath;N.volume_path=r.volumeSource==="reference"&&r.volumeSubPath?`${M}/${r.volumeSubPath}`:M}const P=wn(r.subagentSystemPromptSource,r.subagentSystemPromptRef,r.subagentSystemPrompt);return P&&(N.system_prompt=P),r.subagentTaskDescription&&(N.task_description=r.subagentTaskDescription),r.subagentEntries.length>0&&(N.subagents=r.subagentEntries.map(M=>{const O=wn(M.systemPromptSource,M.systemPromptRef,M.systemPrompt);return{name:M.name,description:M.description,...O&&{system_prompt:O},...M.model&&{model:`__REF__${M.model}`}}})),N}if(p==="dao_ai.middleware.create_agents_memory_middleware"){const N={sources:r.agentsMemorySources,backend_type:r.agentsMemoryBackendType};if(r.agentsMemoryBackendType==="filesystem"&&r.agentsMemoryRootDir&&(N.root_dir=r.agentsMemoryRootDir),r.agentsMemoryBackendType==="volume"&&r.agentsMemoryVolumePath){const P=r.agentsMemoryVolumePath;N.volume_path=r.volumeSource==="reference"&&r.volumeSubPath?`${P}/${r.volumeSubPath}`:P}return N}if(p==="dao_ai.middleware.create_skills_middleware"){const N={sources:r.skillsSources,backend_type:r.skillsBackendType};if(r.skillsBackendType==="filesystem"&&r.skillsRootDir&&(N.root_dir=r.skillsRootDir),r.skillsBackendType==="volume"&&r.skillsVolumePath){const P=r.skillsVolumePath;N.volume_path=r.volumeSource==="reference"&&r.volumeSubPath?`${P}/${r.volumeSubPath}`:P}return N}return Object.keys(r.genericArgs).length>0?r.genericArgs:void 0}}},L=p=>{if(p.preventDefault(),!r.refName)return;const N=r.selectedFactory==="custom"?r.customFactory:r.selectedFactory;if(!N)return;const P=D(),M={name:N,...P&&{args:P}};o&&o!==r.refName?(a(o),s(r.refName,M)):o?n(r.refName,M):s(r.refName,M),l(!1)},V=(p,N)=>{N.stopPropagation(),h(m===p?null:p)},B=p=>Ha.find(N=>N.value===xl(p)),T=p=>[],F=Ha.find(p=>p.value===r.selectedFactory);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-white",children:"Middleware"}),t.jsx("p",{className:"text-slate-400 mt-1",children:"Configure reusable middleware to customize agent behavior"})]}),t.jsxs(ee,{onClick:w,children:[t.jsx(Ie,{className:"w-4 h-4"}),"Add Middleware"]})]}),Object.keys(d).length===0?t.jsxs($e,{className:"text-center py-12",children:[t.jsx(xs,{className:"w-12 h-12 mx-auto text-slate-600 mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-slate-300 mb-2",children:"No middleware configured"}),t.jsx("p",{className:"text-slate-500 mb-4",children:"Middleware allows you to customize agent behavior at different stages of execution."}),t.jsxs(ee,{onClick:w,children:[t.jsx(Ie,{className:"w-4 h-4"}),"Add Your First Middleware"]})]}):t.jsxs("div",{className:"space-y-6",children:[rd.map(p=>{const N=Object.entries(d).filter(([,P])=>{const M=B(P.name);return(M==null?void 0:M.category)===p});return N.length===0?null:t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[t.jsx("div",{className:"h-px flex-1 bg-gradient-to-r from-transparent via-slate-700 to-transparent"}),t.jsx("h3",{className:"text-sm font-semibold text-slate-300 uppercase tracking-wide",children:p}),t.jsx("div",{className:"h-px flex-1 bg-gradient-to-r from-transparent via-slate-700 to-transparent"})]}),t.jsx("div",{className:"space-y-2",children:N.map(([P,M])=>{const O=B(M.name),W=T(),q=m===P;return t.jsxs("div",{className:"p-3 bg-slate-800/50 rounded-lg border border-slate-700 cursor-pointer hover:bg-slate-800/70 transition-colors",onClick:()=>k(P),children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-start space-x-3 flex-1 min-w-0",children:[t.jsx(xs,{className:"w-4 h-4 text-purple-400 flex-shrink-0 mt-1"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center space-x-2 flex-wrap",children:[t.jsx("p",{className:"font-medium text-slate-200 truncate",children:P}),W.length>0&&t.jsxs(Se,{variant:"warning",children:[W.length," ref",W.length!==1?"s":""]})]}),t.jsx("p",{className:"text-xs text-slate-500 truncate",children:(O==null?void 0:O.label)||"Custom Factory"})]})]}),t.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0 ml-2",children:[M.args&&Object.keys(M.args).length>0&&t.jsx("button",{onClick:ce=>V(P,ce),className:"p-1.5 text-slate-400 hover:text-slate-300 transition-colors",title:q?"Collapse":"Expand",children:q?t.jsx(ya,{className:"w-4 h-4"}):t.jsx(Wt,{className:"w-4 h-4"})}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:ce=>{ce.stopPropagation(),k(P)},children:t.jsx(ds,{className:"w-4 h-4"})}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:ce=>{ce.stopPropagation(),Gt("Middleware",P,()=>a(P))},children:t.jsx(Ze,{className:"w-4 h-4 text-red-400"})})]})]}),q&&M.args&&Object.keys(M.args).length>0&&t.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-700",children:[t.jsx("p",{className:"text-xs font-medium text-slate-400 mb-2",children:"Parameters:"}),t.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:Object.entries(M.args).map(([ce,se])=>t.jsxs("div",{className:"flex items-start space-x-2 text-xs",children:[t.jsxs("span",{className:"text-slate-500 font-mono",children:[ce,":"]}),t.jsx("span",{className:"text-slate-300 font-mono flex-1 break-all",children:typeof se=="object"?JSON.stringify(se):String(se)})]},ce))})]})]},P)})})]},p)}),(()=>{const p=Object.entries(d).filter(([,N])=>{const P=B(N.name);return!P||!P.category});return p.length===0?null:t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[t.jsx("div",{className:"h-px flex-1 bg-gradient-to-r from-transparent via-slate-700 to-transparent"}),t.jsx("h3",{className:"text-sm font-semibold text-slate-300 uppercase tracking-wide",children:"Other"}),t.jsx("div",{className:"h-px flex-1 bg-gradient-to-r from-transparent via-slate-700 to-transparent"})]}),t.jsx("div",{className:"space-y-2",children:p.map(([N,P])=>{var ce;const M=T(),O=m===N,W=((ce=P.name.split(".").pop())==null?void 0:ce.replace(/^create_/,"").replace(/_/g," ").replace(/middleware$/i,"").trim())||"Custom Factory",q=W.charAt(0).toUpperCase()+W.slice(1);return t.jsxs("div",{className:"p-3 bg-slate-800/50 rounded-lg border border-slate-700 cursor-pointer hover:bg-slate-800/70 transition-colors",onClick:()=>k(N),children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-start space-x-3 flex-1 min-w-0",children:[t.jsx(xs,{className:"w-4 h-4 text-orange-400 flex-shrink-0 mt-1"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center space-x-2 flex-wrap",children:[t.jsx("p",{className:"font-medium text-slate-200 truncate",children:N}),t.jsx(Se,{variant:"info",children:"Custom"}),M.length>0&&t.jsxs(Se,{variant:"warning",children:[M.length," ref",M.length!==1?"s":""]})]}),t.jsx("p",{className:"text-xs text-slate-500 truncate",children:q}),t.jsx("p",{className:"text-xs text-slate-600 truncate font-mono",children:P.name})]})]}),t.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0 ml-2",children:[P.args&&Object.keys(P.args).length>0&&t.jsx("button",{onClick:se=>V(N,se),className:"p-1.5 text-slate-400 hover:text-slate-300 transition-colors",title:O?"Collapse":"Expand",children:O?t.jsx(ya,{className:"w-4 h-4"}):t.jsx(Wt,{className:"w-4 h-4"})}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:se=>{se.stopPropagation(),k(N)},children:t.jsx(ds,{className:"w-4 h-4"})}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:se=>{se.stopPropagation(),Gt("Middleware",N,()=>a(N))},children:t.jsx(Ze,{className:"w-4 h-4 text-red-400"})})]})]}),O&&P.args&&Object.keys(P.args).length>0&&t.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-700",children:[t.jsx("p",{className:"text-xs font-medium text-slate-400 mb-2",children:"Parameters:"}),t.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:Object.entries(P.args).map(([se,H])=>t.jsxs("div",{className:"flex items-start space-x-2 text-xs",children:[t.jsxs("span",{className:"text-slate-500 font-mono",children:[se,":"]}),t.jsx("span",{className:"text-slate-300 font-mono flex-1 break-all",children:typeof H=="object"?JSON.stringify(H):String(H)})]},se))})]})]},N)})})]})})()]}),t.jsx(ws,{isOpen:i,onClose:()=>l(!1),title:o?"Edit Middleware":"Add Middleware",description:"Configure middleware to customize agent execution behavior",size:"xl",children:t.jsxs("form",{onSubmit:L,className:"space-y-5",children:[t.jsx(U,{label:"Reference Name",placeholder:"e.g., my_guardrail_middleware",value:r.refName,onChange:p=>{c({...r,refName:Ot(p.target.value)})},hint:"Unique identifier for this middleware (used in YAML anchors)",required:!0}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Middleware Type"}),rd.map(p=>{const N=Ha.filter(P=>P.category===p);return t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"h-px flex-1 bg-gradient-to-r from-slate-700 to-transparent"}),t.jsx("h4",{className:"text-xs font-semibold text-slate-400 uppercase tracking-wider px-2",children:p}),t.jsx("div",{className:"h-px flex-1 bg-gradient-to-l from-slate-700 to-transparent"})]}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:N.map(P=>t.jsx("button",{type:"button",onClick:()=>{const M=o?r.refName:cb(P.value);c({...Sn,refName:M,selectedFactory:P.value})},className:`p-3 rounded-lg border text-left transition-all ${r.selectedFactory===P.value?"bg-purple-500/20 border-purple-500/50 ring-1 ring-purple-500/30":"bg-slate-800/50 border-slate-700 hover:border-slate-600"}`,children:t.jsxs("div",{className:"flex items-start justify-between gap-2",children:[t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("p",{className:"text-sm font-medium text-white truncate",children:P.label}),t.jsx("p",{className:"text-xs text-slate-400 mt-0.5 line-clamp-2",children:P.description})]}),r.selectedFactory===P.value&&t.jsx("div",{className:"w-5 h-5 rounded-full bg-purple-500 flex items-center justify-center flex-shrink-0",children:t.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})]})},P.value))})]},p)})]}),r.selectedFactory==="custom"&&t.jsx(U,{label:"Custom Factory Function",placeholder:"e.g., my_module.create_custom_middleware",value:r.customFactory,onChange:p=>c({...r,customFactory:p.target.value}),hint:"Fully qualified name of the factory function",required:!0}),F&&r.selectedFactory!=="custom"&&t.jsxs("div",{className:"space-y-4 p-4 bg-slate-800/30 rounded-lg border border-slate-700/50",children:[t.jsx("h3",{className:"text-sm font-medium text-slate-300",children:"Parameters"}),r.selectedFactory==="dao_ai.middleware.create_guardrail_middleware"&&t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(U,{label:"Guardrail Name",value:r.guardrailName,onChange:p=>c({...r,guardrailName:p.target.value}),placeholder:"e.g., tone_check",required:!0,hint:"Name identifying this guardrail"}),t.jsx(ae,{label:"Model",options:v,value:r.guardrailModel,onChange:p=>c({...r,guardrailModel:p.target.value}),required:!0,hint:"LLM to use for evaluation"}),t.jsx(Cn,{label:"Evaluation Prompt",value:r.guardrailPrompt,source:r.guardrailPromptSource,promptRef:r.guardrailPromptRef,middlewareType:r.selectedFactory,middlewareName:r.guardrailName,placeholder:"e.g., Evaluate if the response is professional and helpful.",hint:"Criteria for evaluating responses",required:!0,rows:3,promptOptions:b,prompts:y,onValueChange:p=>c({...r,guardrailPrompt:p}),onSourceChange:p=>c({...r,guardrailPromptSource:p,...p==="configured"?{guardrailPrompt:""}:{guardrailPromptRef:""}}),onRefChange:p=>c({...r,guardrailPromptRef:p})}),t.jsx(U,{label:"Max Retries",type:"number",value:r.guardrailRetries,onChange:p=>c({...r,guardrailRetries:parseInt(p.target.value)||3}),hint:"Maximum retry attempts"}),t.jsx(U,{label:"Max Context Length",type:"number",value:r.guardrailMaxContextLength,onChange:p=>c({...r,guardrailMaxContextLength:parseInt(p.target.value)||8e3}),hint:"Max character length for extracted tool context"}),t.jsxs("div",{className:"col-span-2 flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",id:"guardrailFailOpen",checked:r.guardrailFailOpen,onChange:p=>c({...r,guardrailFailOpen:p.target.checked}),className:"rounded border-slate-600 bg-slate-800 text-blue-500 focus:ring-blue-500"}),t.jsx("label",{htmlFor:"guardrailFailOpen",className:"text-sm text-slate-300",children:"Fail Open (let responses through when the judge call fails)"})]})]}),r.selectedFactory==="dao_ai.middleware.create_content_filter_middleware"&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Banned Keywords"}),t.jsxs("div",{className:"space-y-2",children:[r.bannedKeywords.map((p,N)=>t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(U,{value:p,onChange:P=>{const M=[...r.bannedKeywords];M[N]=P.target.value,c({...r,bannedKeywords:M})},placeholder:"e.g., password",className:"flex-1"}),t.jsx(ee,{type:"button",variant:"danger",size:"sm",onClick:()=>{const P=r.bannedKeywords.filter((M,O)=>O!==N);c({...r,bannedKeywords:P})},children:t.jsx(Ze,{className:"w-4 h-4"})})]},N)),t.jsxs(ee,{type:"button",variant:"secondary",size:"sm",onClick:()=>{c({...r,bannedKeywords:[...r.bannedKeywords,""]})},children:[t.jsx(Ie,{className:"w-3 h-3 mr-1"}),"Add Keyword"]})]})]}),t.jsx(U,{label:"Block Message",value:r.blockMessage,onChange:p=>c({...r,blockMessage:p.target.value}),placeholder:"Message to return when content is blocked"})]}),r.selectedFactory==="dao_ai.middleware.create_safety_guardrail_middleware"&&t.jsxs("div",{className:"space-y-4",children:[t.jsx(ae,{label:"Safety Model (Optional)",options:v,value:r.safetyModel,onChange:p=>c({...r,safetyModel:p.target.value}),hint:"LLM for safety evaluation (optional)"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",id:"safetyFailOpen",checked:r.safetyFailOpen,onChange:p=>c({...r,safetyFailOpen:p.target.checked}),className:"rounded border-slate-600 bg-slate-800 text-blue-500 focus:ring-blue-500"}),t.jsx("label",{htmlFor:"safetyFailOpen",className:"text-sm text-slate-300",children:"Fail Open (let responses through when the safety check fails)"})]})]}),(r.selectedFactory==="dao_ai.middleware.create_user_id_validation_middleware"||r.selectedFactory==="dao_ai.middleware.create_thread_id_validation_middleware"||r.selectedFactory==="dao_ai.middleware.create_filter_last_human_message_middleware")&&t.jsx("p",{className:"text-sm text-slate-400",children:"This middleware requires no parameters."}),r.selectedFactory==="dao_ai.middleware.create_custom_field_validation_middleware"&&t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Required Fields"}),r.customFields.map((p,N)=>t.jsx("div",{className:"p-3 bg-slate-900/50 rounded-lg border border-slate-700 space-y-2",children:t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsx(U,{label:"Field Name",value:p.name,onChange:P=>{const M=[...r.customFields];M[N]={...p,name:P.target.value},c({...r,customFields:M})},placeholder:"e.g., store_num",required:!0}),t.jsx(U,{label:"Description",value:p.description,onChange:P=>{const M=[...r.customFields];M[N]={...p,description:P.target.value},c({...r,customFields:M})},placeholder:"e.g., Store number"}),t.jsx(U,{label:"Example Value (Optional)",value:p.exampleValue,onChange:P=>{const M=[...r.customFields];M[N]={...p,exampleValue:P.target.value},c({...r,customFields:M})},placeholder:"e.g., 12345"}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("label",{className:"flex items-center space-x-2 text-sm text-slate-300",children:[t.jsx("input",{type:"checkbox",checked:p.required,onChange:P=>{const M=[...r.customFields];M[N]={...p,required:P.target.checked},c({...r,customFields:M})},className:"rounded border-slate-600 bg-slate-700"}),t.jsx("span",{children:"Required"})]}),t.jsx(ee,{type:"button",variant:"danger",size:"sm",onClick:()=>{const P=r.customFields.filter(M=>M.id!==p.id);c({...r,customFields:P})},children:t.jsx(Ze,{className:"w-4 h-4"})})]})]})},p.id)),t.jsxs(ee,{type:"button",variant:"secondary",size:"sm",onClick:()=>{const p={id:`field_${Date.now()}`,name:"",description:"",required:!0,exampleValue:""};c({...r,customFields:[...r.customFields,p]})},children:[t.jsx(Ie,{className:"w-3 h-3 mr-1"}),"Add Field"]})]}),r.selectedFactory==="dao_ai.middleware.create_summarization_middleware"&&t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(ae,{label:"Summary Model",options:v,value:r.summaryModel,onChange:p=>c({...r,summaryModel:p.target.value}),required:!0,hint:"LLM for chat history summarization"}),t.jsx(U,{label:"Max Summary Tokens",type:"number",value:r.summaryMaxTokens,onChange:p=>c({...r,summaryMaxTokens:parseInt(p.target.value)||2048}),hint:"Max tokens for the summary"}),t.jsxs("div",{className:"col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Trigger Threshold"}),t.jsxs("div",{className:"flex items-center space-x-4 mb-2",children:[t.jsxs("label",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"radio",checked:r.summaryUsesTokens,onChange:()=>c({...r,summaryUsesTokens:!0}),className:"text-purple-500"}),t.jsx("span",{className:"text-sm text-slate-300",children:"By Tokens"})]}),t.jsxs("label",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"radio",checked:!r.summaryUsesTokens,onChange:()=>c({...r,summaryUsesTokens:!1}),className:"text-purple-500"}),t.jsx("span",{className:"text-sm text-slate-300",children:"By Messages"})]})]}),r.summaryUsesTokens?t.jsx(U,{label:"Max Tokens Before Summary",type:"number",value:r.summaryMaxTokensBefore,onChange:p=>c({...r,summaryMaxTokensBefore:parseInt(p.target.value)||20480}),hint:"Trigger when history exceeds this token count"}):t.jsx(U,{label:"Max Messages Before Summary",type:"number",value:r.summaryMaxMessagesBefore,onChange:p=>c({...r,summaryMaxMessagesBefore:parseInt(p.target.value)||10}),hint:"Trigger when history exceeds this message count"})]})]}),r.selectedFactory==="dao_ai.middleware.create_human_in_the_loop_middleware"&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Interrupt Tools"}),r.hitlInterruptTools.map((p,N)=>t.jsxs("div",{className:"p-3 mb-2 bg-slate-900/50 rounded-lg border border-slate-700 space-y-2",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsx(U,{label:"Tool Name",value:p.toolName,onChange:P=>{const M=[...r.hitlInterruptTools];M[N]={...p,toolName:P.target.value},c({...r,hitlInterruptTools:M})},placeholder:"e.g., search_tool",required:!0}),t.jsx(U,{label:"Review Prompt (Optional)",value:p.reviewPrompt,onChange:P=>{const M=[...r.hitlInterruptTools];M[N]={...p,reviewPrompt:P.target.value},c({...r,hitlInterruptTools:M})},placeholder:"e.g., Approve search?"})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"flex items-center space-x-4",children:["approve","edit","reject"].map(P=>t.jsxs("label",{className:"flex items-center space-x-2 text-sm text-slate-300",children:[t.jsx("input",{type:"checkbox",checked:p.allowedDecisions.includes(P),onChange:M=>{const O=[...r.hitlInterruptTools],W=M.target.checked?[...p.allowedDecisions,P]:p.allowedDecisions.filter(q=>q!==P);O[N]={...p,allowedDecisions:W},c({...r,hitlInterruptTools:O})},className:"rounded border-slate-600 bg-slate-700"}),t.jsx("span",{className:"capitalize",children:P})]},P))}),t.jsx(ee,{type:"button",variant:"danger",size:"sm",onClick:()=>{const P=r.hitlInterruptTools.filter(M=>M.id!==p.id);c({...r,hitlInterruptTools:P})},children:t.jsx(Ze,{className:"w-4 h-4"})})]})]},p.id)),t.jsxs(ee,{type:"button",variant:"secondary",size:"sm",onClick:()=>{const p={id:`tool_${Date.now()}`,toolName:"",reviewPrompt:"",allowedDecisions:["approve","edit","reject"]};c({...r,hitlInterruptTools:[...r.hitlInterruptTools,p]})},children:[t.jsx(Ie,{className:"w-3 h-3 mr-1"}),"Add Tool"]})]}),t.jsx(U,{label:"Description Prefix (Optional)",value:r.hitlDescriptionPrefix,onChange:p=>c({...r,hitlDescriptionPrefix:p.target.value}),placeholder:"Tool execution pending approval",hint:"Prefix for the human review description"})]}),r.selectedFactory==="dao_ai.middleware.create_assert_middleware"&&t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx("div",{className:"col-span-2",children:t.jsx(U,{label:"Constraint",value:r.assertConstraint,onChange:p=>c({...r,assertConstraint:p.target.value}),placeholder:"e.g., my_module.MyConstraint",required:!0,hint:"Python reference to constraint (class or callable)"})}),t.jsx(U,{label:"Max Retries",type:"number",value:r.assertMaxRetries,onChange:p=>c({...r,assertMaxRetries:parseInt(p.target.value)||3})}),t.jsx(ae,{label:"On Failure",options:[{value:"error",label:"Error"},{value:"warn",label:"Warn"},{value:"ignore",label:"Ignore"}],value:r.assertOnFailure,onChange:p=>c({...r,assertOnFailure:p.target.value})}),t.jsx("div",{className:"col-span-2",children:t.jsx(U,{label:"Fallback Message",value:r.assertFallbackMessage,onChange:p=>c({...r,assertFallbackMessage:p.target.value}),placeholder:"Message on complete failure"})}),t.jsx(U,{label:"Middleware Name (Optional)",value:r.assertMiddlewareName,onChange:p=>c({...r,assertMiddlewareName:p.target.value}),placeholder:"Optional custom name"})]}),r.selectedFactory==="dao_ai.middleware.create_suggest_middleware"&&t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx("div",{className:"col-span-2",children:t.jsx(U,{label:"Constraint",value:r.suggestConstraint,onChange:p=>c({...r,suggestConstraint:p.target.value}),placeholder:"e.g., my_module.MyConstraint",required:!0,hint:"Python reference to constraint"})}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",id:"suggestAllowOneRetry",checked:r.suggestAllowOneRetry,onChange:p=>c({...r,suggestAllowOneRetry:p.target.checked}),className:"rounded border-slate-600 bg-slate-800 text-blue-500 focus:ring-blue-500"}),t.jsx("label",{htmlFor:"suggestAllowOneRetry",className:"text-sm text-slate-300",children:"Allow One Retry"})]}),t.jsx(ae,{label:"Log Level",options:[{value:"warning",label:"Warning"},{value:"info",label:"Info"},{value:"debug",label:"Debug"}],value:r.suggestLogLevel,onChange:p=>c({...r,suggestLogLevel:p.target.value}),hint:"Log level for constraint feedback"}),t.jsx(U,{label:"Middleware Name (Optional)",value:r.suggestMiddlewareName,onChange:p=>c({...r,suggestMiddlewareName:p.target.value}),placeholder:"Optional custom name"})]}),r.selectedFactory==="dao_ai.middleware.create_refine_middleware"&&t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx("div",{className:"col-span-2",children:t.jsx(U,{label:"Reward Function",value:r.refineRewardFn,onChange:p=>c({...r,refineRewardFn:p.target.value}),placeholder:"e.g., my_module.my_reward_fn",required:!0,hint:"Python reference to a reward function that scores responses (0.0 to 1.0)"})}),t.jsx(U,{label:"Threshold",type:"number",value:r.refineThreshold,onChange:p=>c({...r,refineThreshold:parseFloat(p.target.value)||.8}),placeholder:"0.8",hint:"Score threshold to stop early (0.0 - 1.0)"}),t.jsx(U,{label:"Max Iterations",type:"number",value:r.refineMaxIterations,onChange:p=>c({...r,refineMaxIterations:parseInt(p.target.value)||3}),hint:"Maximum improvement iterations"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",id:"refineSelectBest",checked:r.refineSelectBest,onChange:p=>c({...r,refineSelectBest:p.target.checked}),className:"rounded border-slate-600 bg-slate-800 text-blue-500 focus:ring-blue-500"}),t.jsx("label",{htmlFor:"refineSelectBest",className:"text-sm text-slate-300",children:"Select Best Response"})]})]}),r.selectedFactory==="dao_ai.middleware.create_tool_call_limit_middleware"&&t.jsxs("div",{className:"space-y-4",children:[t.jsx(ae,{label:"Tool to Limit",options:[{value:"",label:"All Tools (Global Limit)"},...Object.entries(S).map(([p,N])=>({value:p,label:`${p} (${N.name})`}))],value:r.toolCallLimitTool,onChange:p=>c({...r,toolCallLimitTool:p.target.value}),hint:"Select a specific tool or leave empty for global limit"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(U,{label:"Thread Limit",type:"number",value:r.toolCallLimitThreadLimit??"",onChange:p=>c({...r,toolCallLimitThreadLimit:p.target.value?parseInt(p.target.value):null}),placeholder:"No limit",hint:"Max calls per thread (requires checkpointer)"}),t.jsx(U,{label:"Run Limit",type:"number",value:r.toolCallLimitRunLimit??"",onChange:p=>c({...r,toolCallLimitRunLimit:p.target.value?parseInt(p.target.value):null}),placeholder:"No limit",hint:"Max calls per single run"})]}),t.jsx(ae,{label:"Exit Behavior",options:[{value:"continue",label:"Continue - Log and skip further calls"},{value:"error",label:"Error - Raise exception on limit"},{value:"end",label:"End - Gracefully terminate agent"}],value:r.toolCallLimitExitBehavior,onChange:p=>c({...r,toolCallLimitExitBehavior:p.target.value}),hint:"What happens when limit is reached"})]}),r.selectedFactory==="dao_ai.middleware.create_model_call_limit_middleware"&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(U,{label:"Thread Limit",type:"number",value:r.modelCallLimitThreadLimit??"",onChange:p=>c({...r,modelCallLimitThreadLimit:p.target.value?parseInt(p.target.value):null}),placeholder:"No limit",hint:"Max LLM calls per thread (requires checkpointer)"}),t.jsx(U,{label:"Run Limit",type:"number",value:r.modelCallLimitRunLimit??"",onChange:p=>c({...r,modelCallLimitRunLimit:p.target.value?parseInt(p.target.value):null}),placeholder:"No limit",hint:"Max LLM calls per single run"})]}),t.jsx(ae,{label:"Exit Behavior",options:[{value:"error",label:"Error - Raise exception on limit"},{value:"end",label:"End - Gracefully terminate agent"}],value:r.modelCallLimitExitBehavior,onChange:p=>c({...r,modelCallLimitExitBehavior:p.target.value}),hint:"What happens when limit is reached"})]}),r.selectedFactory==="dao_ai.middleware.create_tool_retry_middleware"&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsx(U,{label:"Max Retries",type:"number",value:r.toolRetryMaxRetries,onChange:p=>c({...r,toolRetryMaxRetries:parseInt(p.target.value)||3}),hint:"Maximum retry attempts"}),t.jsx(U,{label:"Backoff Factor",type:"number",step:"0.1",value:r.toolRetryBackoffFactor,onChange:p=>c({...r,toolRetryBackoffFactor:parseFloat(p.target.value)||2}),hint:"Exponential backoff multiplier"}),t.jsx(U,{label:"Initial Delay (s)",type:"number",step:"0.1",value:r.toolRetryInitialDelay,onChange:p=>c({...r,toolRetryInitialDelay:parseFloat(p.target.value)||1}),hint:"First retry delay in seconds"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(U,{label:"Max Delay (s)",type:"number",step:"0.1",value:r.toolRetryMaxDelay??"",onChange:p=>c({...r,toolRetryMaxDelay:p.target.value?parseFloat(p.target.value):null}),placeholder:"No maximum",hint:"Cap on delay between retries"}),t.jsx("div",{className:"flex items-end",children:t.jsxs("label",{className:"flex items-center space-x-2 text-sm text-slate-300 pb-2",children:[t.jsx("input",{type:"checkbox",checked:r.toolRetryJitter,onChange:p=>c({...r,toolRetryJitter:p.target.checked}),className:"rounded border-slate-600 bg-slate-700"}),t.jsx("span",{children:"Add jitter to delays"})]})})]}),t.jsx(ae,{label:"On Failure",options:[{value:"continue",label:"Continue - Proceed with null result"},{value:"error",label:"Error - Raise exception after retries"}],value:r.toolRetryOnFailure,onChange:p=>c({...r,toolRetryOnFailure:p.target.value}),hint:"What happens after all retries fail"}),t.jsx(Ua,{label:"Tools to Retry",options:Object.entries(S).map(([p,N])=>({value:p,label:`${p} (${N.name})`})),value:r.toolRetryTools,onChange:p=>c({...r,toolRetryTools:p}),placeholder:"All tools (leave empty)",hint:"Select specific tools to retry, or leave empty for all tools"})]}),r.selectedFactory==="dao_ai.middleware.create_model_retry_middleware"&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsx(U,{label:"Max Retries",type:"number",value:r.modelRetryMaxRetries,onChange:p=>c({...r,modelRetryMaxRetries:parseInt(p.target.value)||3}),hint:"Maximum retry attempts"}),t.jsx(U,{label:"Backoff Factor",type:"number",step:"0.1",value:r.modelRetryBackoffFactor,onChange:p=>c({...r,modelRetryBackoffFactor:parseFloat(p.target.value)||2}),hint:"Exponential backoff multiplier"}),t.jsx(U,{label:"Initial Delay (s)",type:"number",step:"0.1",value:r.modelRetryInitialDelay,onChange:p=>c({...r,modelRetryInitialDelay:parseFloat(p.target.value)||1}),hint:"First retry delay in seconds"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(U,{label:"Max Delay (s)",type:"number",step:"0.1",value:r.modelRetryMaxDelay??"",onChange:p=>c({...r,modelRetryMaxDelay:p.target.value?parseFloat(p.target.value):null}),placeholder:"No maximum",hint:"Cap on delay between retries"}),t.jsx("div",{className:"flex items-end",children:t.jsxs("label",{className:"flex items-center space-x-2 text-sm text-slate-300 pb-2",children:[t.jsx("input",{type:"checkbox",checked:r.modelRetryJitter,onChange:p=>c({...r,modelRetryJitter:p.target.checked}),className:"rounded border-slate-600 bg-slate-700"}),t.jsx("span",{children:"Add jitter to delays"})]})})]}),t.jsx(ae,{label:"On Failure",options:[{value:"continue",label:"Continue - Return error message"},{value:"error",label:"Error - Raise exception after retries"}],value:r.modelRetryOnFailure,onChange:p=>c({...r,modelRetryOnFailure:p.target.value}),hint:"What happens after all retries fail"})]}),r.selectedFactory==="dao_ai.middleware.create_context_editing_middleware"&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsx(U,{label:"Trigger Threshold",type:"number",value:r.contextEditingTrigger,onChange:p=>c({...r,contextEditingTrigger:parseInt(p.target.value)||1e5}),hint:"Token count that triggers clearing"}),t.jsx(U,{label:"Keep Recent",type:"number",value:r.contextEditingKeep,onChange:p=>c({...r,contextEditingKeep:parseInt(p.target.value)||3}),hint:"Number of recent tool results to keep"}),t.jsx(U,{label:"Clear At Least",type:"number",value:r.contextEditingClearAtLeast,onChange:p=>c({...r,contextEditingClearAtLeast:parseInt(p.target.value)||0}),hint:"Minimum tokens to reclaim"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(U,{label:"Placeholder Text",value:r.contextEditingPlaceholder,onChange:p=>c({...r,contextEditingPlaceholder:p.target.value}),placeholder:"[cleared]",hint:"Text to replace cleared content"}),t.jsx(ae,{label:"Token Count Method",options:[{value:"approximate",label:"Approximate (faster)"},{value:"model",label:"Model (accurate)"}],value:r.contextEditingTokenCountMethod,onChange:p=>c({...r,contextEditingTokenCountMethod:p.target.value}),hint:"How to count tokens"})]}),t.jsx("div",{className:"flex items-center",children:t.jsxs("label",{className:"flex items-center space-x-2 text-sm text-slate-300",children:[t.jsx("input",{type:"checkbox",checked:r.contextEditingClearToolInputs,onChange:p=>c({...r,contextEditingClearToolInputs:p.target.checked}),className:"rounded border-slate-600 bg-slate-700"}),t.jsx("span",{children:"Also clear tool call arguments"})]})}),t.jsx(Ua,{label:"Exclude Tools",options:Object.entries(S).map(([p,N])=>({value:p,label:`${p} (${N.name})`})),value:r.contextEditingExcludeTools,onChange:p=>c({...r,contextEditingExcludeTools:p}),placeholder:"None (clear all tool outputs)",hint:"Tool outputs that should never be cleared"})]}),r.selectedFactory==="dao_ai.middleware.create_pii_middleware"&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(ae,{label:"PII Type",options:[{value:"email",label:"Email Addresses"},{value:"phone",label:"Phone Numbers"},{value:"ssn",label:"Social Security Numbers"},{value:"credit_card",label:"Credit Card Numbers"},{value:"ip_address",label:"IP Addresses"},{value:"custom",label:"Custom (requires detector)"}],value:r.piiType,onChange:p=>c({...r,piiType:p.target.value}),required:!0,hint:"Type of PII to detect"}),t.jsx(ae,{label:"Strategy",options:[{value:"redact",label:"Redact - Replace with [REDACTED]"},{value:"mask",label:"Mask - Partial masking (e.g., ****1234)"},{value:"hash",label:"Hash - Replace with hash value"},{value:"block",label:"Block - Reject the request entirely"}],value:r.piiStrategy,onChange:p=>c({...r,piiStrategy:p.target.value}),hint:"How to handle detected PII"})]}),t.jsxs("div",{className:"p-3 bg-slate-900/50 rounded-lg border border-slate-700",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-3",children:"Apply To"}),t.jsxs("div",{className:"flex items-center space-x-6",children:[t.jsxs("label",{className:"flex items-center space-x-2 text-sm text-slate-300",children:[t.jsx("input",{type:"checkbox",checked:r.piiApplyToInput,onChange:p=>c({...r,piiApplyToInput:p.target.checked}),className:"rounded border-slate-600 bg-slate-700"}),t.jsx("span",{children:"User Input"})]}),t.jsxs("label",{className:"flex items-center space-x-2 text-sm text-slate-300",children:[t.jsx("input",{type:"checkbox",checked:r.piiApplyToOutput,onChange:p=>c({...r,piiApplyToOutput:p.target.checked}),className:"rounded border-slate-600 bg-slate-700"}),t.jsx("span",{children:"Agent Output"})]}),t.jsxs("label",{className:"flex items-center space-x-2 text-sm text-slate-300",children:[t.jsx("input",{type:"checkbox",checked:r.piiApplyToToolResults,onChange:p=>c({...r,piiApplyToToolResults:p.target.checked}),className:"rounded border-slate-600 bg-slate-700"}),t.jsx("span",{children:"Tool Results"})]})]})]}),r.piiType==="custom"&&t.jsx("p",{className:"text-xs text-amber-400 bg-amber-900/20 p-2 rounded-lg border border-amber-700/30",children:" Custom PII types require a Python detector function. Configure this through custom middleware or programmatically."})]}),r.selectedFactory==="dao_ai.middleware.create_veracity_guardrail_middleware"&&t.jsxs("div",{className:"space-y-4",children:[t.jsx("p",{className:"text-xs text-slate-400 bg-slate-900/50 p-2 rounded-lg border border-slate-700/30",children:"Checks whether the agent's response is grounded in tool/retrieval context. Uses a built-in expert prompt  no custom prompt needed. Automatically skips when no tool context is present."}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(ae,{label:"Judge Model",options:v,value:r.veracityModel,onChange:p=>c({...r,veracityModel:p.target.value}),required:!0,hint:"LLM for veracity evaluation"}),t.jsx(U,{label:"Max Retries",type:"number",value:r.veracityRetries,onChange:p=>c({...r,veracityRetries:parseInt(p.target.value)||2}),hint:"Maximum retry attempts (default: 2)"}),t.jsx(U,{label:"Max Context Length",type:"number",value:r.veracityMaxContextLength,onChange:p=>c({...r,veracityMaxContextLength:parseInt(p.target.value)||8e3}),hint:"Max chars for extracted tool context"}),t.jsx("div",{className:"flex items-end",children:t.jsxs("label",{className:"flex items-center space-x-2 text-sm text-slate-300 pb-2",children:[t.jsx("input",{type:"checkbox",checked:r.veracityFailOpen,onChange:p=>c({...r,veracityFailOpen:p.target.checked}),className:"rounded border-slate-600 bg-slate-700"}),t.jsx("span",{children:"Fail open (pass on error)"})]})})]})]}),r.selectedFactory==="dao_ai.middleware.create_relevance_guardrail_middleware"&&t.jsxs("div",{className:"space-y-4",children:[t.jsx("p",{className:"text-xs text-slate-400 bg-slate-900/50 p-2 rounded-lg border border-slate-700/30",children:"Checks whether the agent's response directly addresses the user's query. Uses a built-in expert prompt  no custom prompt needed."}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(ae,{label:"Judge Model",options:v,value:r.relevanceModel,onChange:p=>c({...r,relevanceModel:p.target.value}),required:!0,hint:"LLM for relevance evaluation"}),t.jsx(U,{label:"Max Retries",type:"number",value:r.relevanceRetries,onChange:p=>c({...r,relevanceRetries:parseInt(p.target.value)||2}),hint:"Maximum retry attempts (default: 2)"})]}),t.jsxs("label",{className:"flex items-center space-x-2 text-sm text-slate-300",children:[t.jsx("input",{type:"checkbox",checked:r.relevanceFailOpen,onChange:p=>c({...r,relevanceFailOpen:p.target.checked}),className:"rounded border-slate-600 bg-slate-700"}),t.jsx("span",{children:"Fail open (pass on error)"})]})]}),r.selectedFactory==="dao_ai.middleware.create_tone_guardrail_middleware"&&t.jsxs("div",{className:"space-y-4",children:[t.jsx("p",{className:"text-xs text-slate-400 bg-slate-900/50 p-2 rounded-lg border border-slate-700/30",children:"Validates the response matches a configurable tone profile. Select a preset or provide custom guidelines."}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(ae,{label:"Judge Model",options:v,value:r.toneModel,onChange:p=>c({...r,toneModel:p.target.value}),required:!0,hint:"LLM for tone evaluation"}),t.jsx(ae,{label:"Tone Profile",options:[{value:"professional",label:"Professional"},{value:"casual",label:"Casual"},{value:"technical",label:"Technical"},{value:"empathetic",label:"Empathetic"},{value:"concise",label:"Concise"}],value:r.toneProfile,onChange:p=>c({...r,toneProfile:p.target.value}),hint:"Preset tone profile"}),t.jsx(Cn,{label:"Custom Guidelines (Optional)",value:r.toneCustomGuidelines,source:r.toneCustomGuidelinesSource,promptRef:r.toneCustomGuidelinesRef,middlewareType:r.selectedFactory,middlewareName:r.refName,placeholder:"Custom tone guidelines override the preset profile...",hint:"Overrides the preset profile if provided",rows:3,promptOptions:b,prompts:y,onValueChange:p=>c({...r,toneCustomGuidelines:p}),onSourceChange:p=>c({...r,toneCustomGuidelinesSource:p,...p==="configured"?{toneCustomGuidelines:""}:{toneCustomGuidelinesRef:""}}),onRefChange:p=>c({...r,toneCustomGuidelinesRef:p})}),t.jsx(U,{label:"Max Retries",type:"number",value:r.toneRetries,onChange:p=>c({...r,toneRetries:parseInt(p.target.value)||2}),hint:"Maximum retry attempts (default: 2)"}),t.jsx("div",{className:"flex items-end",children:t.jsxs("label",{className:"flex items-center space-x-2 text-sm text-slate-300 pb-2",children:[t.jsx("input",{type:"checkbox",checked:r.toneFailOpen,onChange:p=>c({...r,toneFailOpen:p.target.checked}),className:"rounded border-slate-600 bg-slate-700"}),t.jsx("span",{children:"Fail open (pass on error)"})]})})]})]}),r.selectedFactory==="dao_ai.middleware.create_conciseness_guardrail_middleware"&&t.jsxs("div",{className:"space-y-4",children:[t.jsx("p",{className:"text-xs text-slate-400 bg-slate-900/50 p-2 rounded-lg border border-slate-700/30",children:"Hybrid deterministic + LLM conciseness check. Performs a fast length check first, then optionally evaluates verbosity using the judge LLM."}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(ae,{label:"Judge Model",options:v,value:r.concisenessModel,onChange:p=>c({...r,concisenessModel:p.target.value}),required:!0,hint:"LLM for verbosity evaluation"}),t.jsx(U,{label:"Max Retries",type:"number",value:r.concisenessRetries,onChange:p=>c({...r,concisenessRetries:parseInt(p.target.value)||2}),hint:"Maximum retry attempts (default: 2)"}),t.jsx(U,{label:"Max Length (chars)",type:"number",value:r.concisenessMaxLength,onChange:p=>c({...r,concisenessMaxLength:parseInt(p.target.value)||3e3}),hint:"Maximum response character length"}),t.jsx(U,{label:"Min Length (chars)",type:"number",value:r.concisenessMinLength,onChange:p=>c({...r,concisenessMinLength:parseInt(p.target.value)||20}),hint:"Minimum response character length"})]}),t.jsxs("div",{className:"flex items-center space-x-6",children:[t.jsxs("label",{className:"flex items-center space-x-2 text-sm text-slate-300",children:[t.jsx("input",{type:"checkbox",checked:r.concisenessCheckVerbosity,onChange:p=>c({...r,concisenessCheckVerbosity:p.target.checked}),className:"rounded border-slate-600 bg-slate-700"}),t.jsx("span",{children:"Check verbosity (LLM evaluation)"})]}),t.jsxs("label",{className:"flex items-center space-x-2 text-sm text-slate-300",children:[t.jsx("input",{type:"checkbox",checked:r.concisenessFailOpen,onChange:p=>c({...r,concisenessFailOpen:p.target.checked}),className:"rounded border-slate-600 bg-slate-700"}),t.jsx("span",{children:"Fail open (pass on error)"})]})]})]}),r.selectedFactory==="dao_ai.middleware.create_tool_call_observability_middleware"&&t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"grid grid-cols-2 gap-4",children:t.jsx(ae,{label:"Log Level",options:[{value:"DEBUG",label:"DEBUG"},{value:"INFO",label:"INFO"},{value:"WARNING",label:"WARNING"}],value:r.observabilityLogLevel,onChange:p=>c({...r,observabilityLogLevel:p.target.value}),hint:"Logging level for tool calls"})}),t.jsxs("div",{className:"flex items-center space-x-6",children:[t.jsxs("label",{className:"flex items-center space-x-2 text-sm text-slate-300",children:[t.jsx("input",{type:"checkbox",checked:r.observabilityIncludeArgs,onChange:p=>c({...r,observabilityIncludeArgs:p.target.checked}),className:"rounded border-slate-600 bg-slate-700"}),t.jsx("span",{children:"Include tool call arguments"})]}),t.jsxs("label",{className:"flex items-center space-x-2 text-sm text-slate-300",children:[t.jsx("input",{type:"checkbox",checked:r.observabilityTrackTiming,onChange:p=>c({...r,observabilityTrackTiming:p.target.checked}),className:"rounded border-slate-600 bg-slate-700"}),t.jsx("span",{children:"Track execution timing"})]})]})]}),r.selectedFactory==="dao_ai.middleware.create_todo_list_middleware"&&t.jsxs("div",{className:"space-y-4",children:[t.jsx("p",{className:"text-xs text-slate-400 bg-slate-900/50 p-2 rounded-lg border border-slate-700/30",children:"Provides agents with a write_todos tool for task planning and tracking. Both fields are optional."}),t.jsx(Cn,{label:"System Prompt (Optional)",value:r.todoSystemPrompt,source:r.todoSystemPromptSource,promptRef:r.todoSystemPromptRef,middlewareType:r.selectedFactory,middlewareName:r.refName,placeholder:"Custom system prompt to guide todo usage...",hint:"If empty, uses the built-in prompt",rows:3,promptOptions:b,prompts:y,onValueChange:p=>c({...r,todoSystemPrompt:p}),onSourceChange:p=>c({...r,todoSystemPromptSource:p,...p==="configured"?{todoSystemPrompt:""}:{todoSystemPromptRef:""}}),onRefChange:p=>c({...r,todoSystemPromptRef:p})}),t.jsx(U,{label:"Tool Description (Optional)",value:r.todoToolDescription,onChange:p=>c({...r,todoToolDescription:p.target.value}),placeholder:"Custom description for the write_todos tool...",hint:"If empty, uses the built-in description"})]}),r.selectedFactory==="dao_ai.middleware.create_deep_summarization_middleware"&&t.jsxs("div",{className:"space-y-4",children:[t.jsx("p",{className:"text-xs text-slate-400 bg-slate-900/50 p-2 rounded-lg border border-slate-700/30",children:"Advanced summarization with backend offloading, tool argument truncation, and fraction-based triggers."}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(ae,{label:"Summary Model",options:v,value:r.deepSumModel,onChange:p=>c({...r,deepSumModel:p.target.value}),required:!0,hint:"LLM for generating summaries"}),t.jsx(ae,{label:"Backend Type",options:[{value:"state",label:"State (ephemeral)"},{value:"filesystem",label:"Filesystem (disk)"},{value:"store",label:"Store (persistent)"},{value:"volume",label:"Volume (Databricks UC)"}],value:r.deepSumBackendType,onChange:p=>c({...r,deepSumBackendType:p.target.value}),hint:"Backend for storing offloaded history"})]}),r.deepSumBackendType==="filesystem"&&t.jsx(U,{label:"Root Directory",value:r.deepSumRootDir,onChange:p=>c({...r,deepSumRootDir:p.target.value}),placeholder:"/workspace",required:!0,hint:"Required for filesystem backend"}),r.deepSumBackendType==="volume"&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Volume Path"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{type:"button",onClick:()=>c({...r,volumeSource:"reference",deepSumVolumePath:"",volumeRef:"",volumeSubPath:""}),className:`px-2 py-1 text-xs rounded ${r.volumeSource==="reference"?"bg-blue-500/30 text-blue-300":"bg-slate-700 text-slate-400"}`,children:"Select"}),t.jsx("button",{type:"button",onClick:()=>c({...r,volumeSource:"manual",deepSumVolumePath:"",volumeRef:"",volumeSubPath:""}),className:`px-2 py-1 text-xs rounded ${r.volumeSource==="manual"?"bg-blue-500/30 text-blue-300":"bg-slate-700 text-slate-400"}`,children:"Manual"})]})]}),r.volumeSource==="reference"?t.jsxs("div",{className:"space-y-2",children:[t.jsx(ae,{value:r.volumeRef,onChange:p=>{const N=p.target.value;c({...r,volumeRef:N,deepSumVolumePath:f(N)})},options:[{value:"",label:"Select volume..."},...x.map(p=>({value:p.value,label:p.label}))]}),t.jsx("p",{className:"text-xs text-slate-500",children:x.length===0?"No volumes configured  add one in the Resources section.":`Select from ${x.length} configured volume${x.length!==1?"s":""}.`}),t.jsx(U,{value:r.volumeSubPath,onChange:p=>c({...r,volumeSubPath:p.target.value}),placeholder:"optional/sub/path"}),t.jsx("p",{className:"text-xs text-slate-500",children:'Optional path within the volume (e.g., "agents/workspace").'})]}):t.jsxs("div",{className:"space-y-2",children:[t.jsx(U,{value:r.deepSumVolumePath,onChange:p=>c({...r,deepSumVolumePath:p.target.value}),placeholder:"/Volumes/catalog/schema/volume",required:!0}),t.jsx("p",{className:"text-xs text-slate-500",children:"Enter the full UC Volumes path directly."})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Trigger Threshold"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx(ae,{options:[{value:"tokens",label:"Tokens"},{value:"messages",label:"Messages"},{value:"fraction",label:"Fraction"}],value:r.deepSumTriggerType,onChange:p=>c({...r,deepSumTriggerType:p.target.value})}),t.jsx(U,{type:"number",step:r.deepSumTriggerType==="fraction"?"0.01":"1",value:r.deepSumTriggerValue,onChange:p=>c({...r,deepSumTriggerValue:parseFloat(p.target.value)||0})})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Keep After Summary"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx(ae,{options:[{value:"messages",label:"Messages"},{value:"tokens",label:"Tokens"},{value:"fraction",label:"Fraction"}],value:r.deepSumKeepType,onChange:p=>c({...r,deepSumKeepType:p.target.value})}),t.jsx(U,{type:"number",step:r.deepSumKeepType==="fraction"?"0.01":"1",value:r.deepSumKeepValue,onChange:p=>c({...r,deepSumKeepValue:parseFloat(p.target.value)||0})})]})]})]}),t.jsx(U,{label:"History Path Prefix",value:r.deepSumHistoryPathPrefix,onChange:p=>c({...r,deepSumHistoryPathPrefix:p.target.value}),placeholder:"/conversation_history",hint:"Path prefix for stored conversation history"}),t.jsxs("div",{className:"space-y-3 p-3 bg-slate-900/30 rounded-lg border border-slate-700/30",children:[t.jsxs("label",{className:"flex items-center space-x-2 text-sm text-slate-300",children:[t.jsx("input",{type:"checkbox",checked:r.deepSumTruncateArgsEnabled,onChange:p=>c({...r,deepSumTruncateArgsEnabled:p.target.checked}),className:"rounded border-slate-600 bg-slate-700"}),t.jsx("span",{className:"font-medium",children:"Enable argument truncation"})]}),r.deepSumTruncateArgsEnabled&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.jsx(ae,{label:"Trigger Type",options:[{value:"messages",label:"Messages"},{value:"tokens",label:"Tokens"},{value:"fraction",label:"Fraction"}],value:r.deepSumTruncateArgsTriggerType,onChange:p=>c({...r,deepSumTruncateArgsTriggerType:p.target.value})}),t.jsx(U,{label:"Trigger Value",type:"number",step:r.deepSumTruncateArgsTriggerType==="fraction"?"0.01":"1",value:r.deepSumTruncateArgsTriggerValue,onChange:p=>c({...r,deepSumTruncateArgsTriggerValue:parseFloat(p.target.value)||0})}),t.jsx(U,{label:"Max Arg Length",type:"number",value:r.deepSumTruncateArgsMaxLength,onChange:p=>c({...r,deepSumTruncateArgsMaxLength:parseInt(p.target.value)||2e3}),hint:"Max chars per arg"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsx(ae,{label:"Keep Type",options:[{value:"messages",label:"Messages"},{value:"tokens",label:"Tokens"}],value:r.deepSumTruncateArgsKeepType,onChange:p=>c({...r,deepSumTruncateArgsKeepType:p.target.value}),hint:"Unit for keep threshold"}),t.jsx(U,{label:"Keep Value",type:"number",value:r.deepSumTruncateArgsKeepValue,onChange:p=>c({...r,deepSumTruncateArgsKeepValue:parseInt(p.target.value)||20}),hint:"Recent items to preserve after truncation"})]})]})]})]}),r.selectedFactory==="dao_ai.middleware.create_llm_tool_selector_middleware"&&t.jsxs("div",{className:"space-y-4",children:[t.jsx("p",{className:"text-xs text-slate-400 bg-slate-900/50 p-2 rounded-lg border border-slate-700/30",children:"Uses an LLM to select the most relevant tools per query. Ideal for agents with many tools (10+)."}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(ae,{label:"Selector Model",options:v,value:r.toolSelectorModel,onChange:p=>c({...r,toolSelectorModel:p.target.value}),required:!0,hint:"Fast model recommended (e.g., gpt-4o-mini)"}),t.jsx(U,{label:"Max Tools",type:"number",min:"1",value:r.toolSelectorMaxTools,onChange:p=>c({...r,toolSelectorMaxTools:parseInt(p.target.value)||3}),hint:"Max tools selected per query"})]}),t.jsx(Ua,{label:"Always Include Tools",options:Object.entries(S).map(([p,N])=>({value:p,label:`${p} (${N.name})`})),value:r.toolSelectorAlwaysInclude,onChange:p=>c({...r,toolSelectorAlwaysInclude:p}),placeholder:"None (all tools eligible for filtering)",hint:"Tools that should always be available regardless of LLM selection"})]}),r.selectedFactory==="dao_ai.middleware.create_filesystem_middleware"&&t.jsxs("div",{className:"space-y-4",children:[t.jsx("p",{className:"text-xs text-slate-400 bg-slate-900/50 p-2 rounded-lg border border-slate-700/30",children:"Provides agents with filesystem tools: ls, read_file, write_file, edit_file, glob, grep. Auto-evicts large tool results."}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(ae,{label:"Backend Type",options:[{value:"state",label:"State (ephemeral)"},{value:"filesystem",label:"Filesystem (disk)"},{value:"store",label:"Store (persistent)"},{value:"volume",label:"Volume (Databricks UC)"}],value:r.filesystemBackendType,onChange:p=>c({...r,filesystemBackendType:p.target.value}),hint:"Backend for file storage"}),t.jsx(U,{label:"Eviction Token Limit",type:"number",value:r.filesystemEvictLimit??"",onChange:p=>c({...r,filesystemEvictLimit:p.target.value?parseInt(p.target.value):null}),placeholder:"20000",hint:"Token limit before evicting results to filesystem"})]}),r.filesystemBackendType==="filesystem"&&t.jsx(U,{label:"Root Directory",value:r.filesystemRootDir,onChange:p=>c({...r,filesystemRootDir:p.target.value}),placeholder:"/workspace",required:!0,hint:"Required for filesystem backend"}),r.filesystemBackendType==="volume"&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Volume Path"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{type:"button",onClick:()=>c({...r,volumeSource:"reference",filesystemVolumePath:"",volumeRef:"",volumeSubPath:""}),className:`px-2 py-1 text-xs rounded ${r.volumeSource==="reference"?"bg-blue-500/30 text-blue-300":"bg-slate-700 text-slate-400"}`,children:"Select"}),t.jsx("button",{type:"button",onClick:()=>c({...r,volumeSource:"manual",filesystemVolumePath:"",volumeRef:"",volumeSubPath:""}),className:`px-2 py-1 text-xs rounded ${r.volumeSource==="manual"?"bg-blue-500/30 text-blue-300":"bg-slate-700 text-slate-400"}`,children:"Manual"})]})]}),r.volumeSource==="reference"?t.jsxs("div",{className:"space-y-2",children:[t.jsx(ae,{value:r.volumeRef,onChange:p=>{const N=p.target.value;c({...r,volumeRef:N,filesystemVolumePath:f(N)})},options:[{value:"",label:"Select volume..."},...x.map(p=>({value:p.value,label:p.label}))]}),t.jsx("p",{className:"text-xs text-slate-500",children:x.length===0?"No volumes configured  add one in the Resources section.":`Select from ${x.length} configured volume${x.length!==1?"s":""}.`}),t.jsx(U,{value:r.volumeSubPath,onChange:p=>c({...r,volumeSubPath:p.target.value}),placeholder:"optional/sub/path"}),t.jsx("p",{className:"text-xs text-slate-500",children:'Optional path within the volume (e.g., "agents/workspace").'})]}):t.jsxs("div",{className:"space-y-2",children:[t.jsx(U,{value:r.filesystemVolumePath,onChange:p=>c({...r,filesystemVolumePath:p.target.value}),placeholder:"/Volumes/catalog/schema/volume",required:!0}),t.jsx("p",{className:"text-xs text-slate-500",children:"Enter the full UC Volumes path directly."})]})]}),t.jsx(Cn,{label:"System Prompt (Optional)",value:r.filesystemSystemPrompt,source:r.filesystemSystemPromptSource,promptRef:r.filesystemSystemPromptRef,middlewareType:r.selectedFactory,middlewareName:r.refName,placeholder:"You have access to filesystem tools for reading, writing, and editing files. Use ls to explore directories, read_file to view contents, write_file to create new files, edit_file to modify existing files, glob to find files by pattern, and grep to search file contents.",hint:"Overrides the default prompt that guides the agent on how to use filesystem tools (ls, read_file, write_file, edit_file, glob, grep). Leave empty to use the built-in guidance.",rows:3,promptOptions:b,prompts:y,onValueChange:p=>c({...r,filesystemSystemPrompt:p}),onSourceChange:p=>c({...r,filesystemSystemPromptSource:p,...p==="configured"?{filesystemSystemPrompt:""}:{filesystemSystemPromptRef:""}}),onRefChange:p=>c({...r,filesystemSystemPromptRef:p})}),t.jsx(Jt,{label:"Custom Tool Descriptions (Optional)",value:r.filesystemCustomToolDescs,onChange:p=>c({...r,filesystemCustomToolDescs:p.target.value}),placeholder:`{
  "ls": "List directory contents",
  "read_file": "Read a file"
}`,rows:3,hint:"JSON object mapping tool names to custom descriptions. Leave empty to use defaults."})]}),r.selectedFactory==="dao_ai.middleware.create_subagent_middleware"&&t.jsxs("div",{className:"space-y-4",children:[t.jsx("p",{className:"text-xs text-slate-400 bg-slate-900/50 p-2 rounded-lg border border-slate-700/30",children:'Provides a "task" tool for spawning subagents to handle complex, multi-step tasks with isolated context.'}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(ae,{label:"Backend Type",options:[{value:"state",label:"State (ephemeral)"},{value:"filesystem",label:"Filesystem (disk)"},{value:"store",label:"Store (persistent)"},{value:"volume",label:"Volume (Databricks UC)"}],value:r.subagentBackendType,onChange:p=>c({...r,subagentBackendType:p.target.value}),hint:"Backend for subagent file storage"}),t.jsx("div",{})]}),r.subagentBackendType==="filesystem"&&t.jsx(U,{label:"Root Directory",value:r.subagentRootDir,onChange:p=>c({...r,subagentRootDir:p.target.value}),placeholder:"/workspace",required:!0,hint:"Required for filesystem backend"}),r.subagentBackendType==="volume"&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Volume Path"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{type:"button",onClick:()=>c({...r,volumeSource:"reference",subagentVolumePath:"",volumeRef:"",volumeSubPath:""}),className:`px-2 py-1 text-xs rounded ${r.volumeSource==="reference"?"bg-blue-500/30 text-blue-300":"bg-slate-700 text-slate-400"}`,children:"Select"}),t.jsx("button",{type:"button",onClick:()=>c({...r,volumeSource:"manual",subagentVolumePath:"",volumeRef:"",volumeSubPath:""}),className:`px-2 py-1 text-xs rounded ${r.volumeSource==="manual"?"bg-blue-500/30 text-blue-300":"bg-slate-700 text-slate-400"}`,children:"Manual"})]})]}),r.volumeSource==="reference"?t.jsxs("div",{className:"space-y-2",children:[t.jsx(ae,{value:r.volumeRef,onChange:p=>{const N=p.target.value;c({...r,volumeRef:N,subagentVolumePath:f(N)})},options:[{value:"",label:"Select volume..."},...x.map(p=>({value:p.value,label:p.label}))]}),t.jsx("p",{className:"text-xs text-slate-500",children:x.length===0?"No volumes configured  add one in the Resources section.":`Select from ${x.length} configured volume${x.length!==1?"s":""}.`}),t.jsx(U,{value:r.volumeSubPath,onChange:p=>c({...r,volumeSubPath:p.target.value}),placeholder:"optional/sub/path"}),t.jsx("p",{className:"text-xs text-slate-500",children:'Optional path within the volume (e.g., "agents/workspace").'})]}):t.jsxs("div",{className:"space-y-2",children:[t.jsx(U,{value:r.subagentVolumePath,onChange:p=>c({...r,subagentVolumePath:p.target.value}),placeholder:"/Volumes/catalog/schema/volume",required:!0}),t.jsx("p",{className:"text-xs text-slate-500",children:"Enter the full UC Volumes path directly."})]})]}),t.jsx(Cn,{label:"System Prompt (Optional)",value:r.subagentSystemPrompt,source:r.subagentSystemPromptSource,promptRef:r.subagentSystemPromptRef,middlewareType:r.selectedFactory,middlewareName:r.refName,placeholder:"Custom system prompt for guiding task tool usage...",hint:"Overrides built-in task guidance prompt",rows:2,promptOptions:b,prompts:y,onValueChange:p=>c({...r,subagentSystemPrompt:p}),onSourceChange:p=>c({...r,subagentSystemPromptSource:p,...p==="configured"?{subagentSystemPrompt:""}:{subagentSystemPromptRef:""}}),onRefChange:p=>c({...r,subagentSystemPromptRef:p})}),t.jsx(U,{label:"Task Description (Optional)",value:r.subagentTaskDescription,onChange:p=>c({...r,subagentTaskDescription:p.target.value}),placeholder:"Custom description for the task tool...",hint:"Overrides built-in task tool description"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Subagent Definitions"}),t.jsxs(ee,{type:"button",variant:"secondary",size:"sm",onClick:()=>{const p={id:`subagent_${Date.now()}`,name:"",description:"",systemPrompt:"",systemPromptSource:"inline",systemPromptRef:"",model:""};c({...r,subagentEntries:[...r.subagentEntries,p]})},children:[t.jsx(Ie,{className:"w-3 h-3 mr-1"}),"Add Subagent"]})]}),r.subagentEntries.length===0&&t.jsx("p",{className:"text-xs text-slate-500",children:"No subagents defined. A general-purpose subagent will be created automatically."}),r.subagentEntries.map((p,N)=>t.jsxs("div",{className:"p-3 bg-slate-900/50 rounded-lg border border-slate-700 space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("span",{className:"text-xs font-medium text-slate-400",children:["Subagent ",N+1]}),t.jsx(ee,{type:"button",variant:"danger",size:"sm",onClick:()=>{const P=r.subagentEntries.filter(M=>M.id!==p.id);c({...r,subagentEntries:P})},children:t.jsx(Ze,{className:"w-3 h-3"})})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsx(U,{label:"Name",value:p.name,onChange:P=>{const M=[...r.subagentEntries];M[N]={...p,name:P.target.value},c({...r,subagentEntries:M})},placeholder:"e.g., code-reviewer",required:!0}),t.jsx(ae,{label:"Model (Optional)",options:v,value:p.model,onChange:P=>{const M=[...r.subagentEntries];M[N]={...p,model:P.target.value},c({...r,subagentEntries:M})},hint:"Override model for this subagent"}),t.jsx("div",{className:"col-span-2",children:t.jsx(U,{label:"Description",value:p.description,onChange:P=>{const M=[...r.subagentEntries];M[N]={...p,description:P.target.value},c({...r,subagentEntries:M})},placeholder:"What this subagent does (used for delegation)",required:!0})}),t.jsx(Cn,{label:"System Prompt",value:p.systemPrompt,source:p.systemPromptSource,promptRef:p.systemPromptRef,middlewareType:r.selectedFactory,middlewareName:p.name||`subagent-${N+1}`,placeholder:"Instructions for the subagent...",hint:"System prompt guiding this subagent's behavior",required:!0,rows:2,promptOptions:b,prompts:y,onValueChange:P=>{const M=[...r.subagentEntries];M[N]={...p,systemPrompt:P},c({...r,subagentEntries:M})},onSourceChange:P=>{const M=[...r.subagentEntries];M[N]={...p,systemPromptSource:P,...P==="configured"?{systemPrompt:""}:{systemPromptRef:""}},c({...r,subagentEntries:M})},onRefChange:P=>{const M=[...r.subagentEntries];M[N]={...p,systemPromptRef:P},c({...r,subagentEntries:M})}})]})]},p.id))]})]}),r.selectedFactory==="dao_ai.middleware.create_agents_memory_middleware"&&t.jsxs("div",{className:"space-y-4",children:[t.jsx("p",{className:"text-xs text-slate-400 bg-slate-900/50 p-2 rounded-lg border border-slate-700/30",children:"Loads AGENTS.md context files at startup and injects content into the system prompt."}),t.jsx(ae,{label:"Backend Type",options:[{value:"state",label:"State (ephemeral)"},{value:"filesystem",label:"Filesystem (disk)"},{value:"store",label:"Store (persistent)"},{value:"volume",label:"Volume (Databricks UC)"}],value:r.agentsMemoryBackendType,onChange:p=>c({...r,agentsMemoryBackendType:p.target.value}),hint:"Backend for file storage"}),r.agentsMemoryBackendType==="filesystem"&&t.jsx(U,{label:"Root Directory",value:r.agentsMemoryRootDir,onChange:p=>c({...r,agentsMemoryRootDir:p.target.value}),placeholder:"/",required:!0,hint:"Required for filesystem backend"}),r.agentsMemoryBackendType==="volume"&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Volume Path"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{type:"button",onClick:()=>c({...r,volumeSource:"reference",agentsMemoryVolumePath:"",volumeRef:"",volumeSubPath:""}),className:`px-2 py-1 text-xs rounded ${r.volumeSource==="reference"?"bg-blue-500/30 text-blue-300":"bg-slate-700 text-slate-400"}`,children:"Select"}),t.jsx("button",{type:"button",onClick:()=>c({...r,volumeSource:"manual",agentsMemoryVolumePath:"",volumeRef:"",volumeSubPath:""}),className:`px-2 py-1 text-xs rounded ${r.volumeSource==="manual"?"bg-blue-500/30 text-blue-300":"bg-slate-700 text-slate-400"}`,children:"Manual"})]})]}),r.volumeSource==="reference"?t.jsxs("div",{className:"space-y-2",children:[t.jsx(ae,{value:r.volumeRef,onChange:p=>{const N=p.target.value;c({...r,volumeRef:N,agentsMemoryVolumePath:f(N)})},options:[{value:"",label:"Select volume..."},...x.map(p=>({value:p.value,label:p.label}))]}),t.jsx("p",{className:"text-xs text-slate-500",children:x.length===0?"No volumes configured  add one in the Resources section.":`Select from ${x.length} configured volume${x.length!==1?"s":""}.`}),t.jsx(U,{value:r.volumeSubPath,onChange:p=>c({...r,volumeSubPath:p.target.value}),placeholder:"optional/sub/path"}),t.jsx("p",{className:"text-xs text-slate-500",children:'Optional path within the volume (e.g., "agents/workspace").'})]}):t.jsxs("div",{className:"space-y-2",children:[t.jsx(U,{value:r.agentsMemoryVolumePath,onChange:p=>c({...r,agentsMemoryVolumePath:p.target.value}),placeholder:"/Volumes/catalog/schema/volume",required:!0}),t.jsx("p",{className:"text-xs text-slate-500",children:"Enter the full UC Volumes path directly."})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Source Paths"}),r.agentsMemorySources.map((p,N)=>t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(U,{value:p,onChange:P=>{const M=[...r.agentsMemorySources];M[N]=P.target.value,c({...r,agentsMemorySources:M})},placeholder:"e.g., ~/.deepagents/AGENTS.md",className:"flex-1"}),t.jsx(ee,{type:"button",variant:"danger",size:"sm",onClick:()=>{const P=r.agentsMemorySources.filter((M,O)=>O!==N);c({...r,agentsMemorySources:P})},children:t.jsx(Ze,{className:"w-4 h-4"})})]},N)),t.jsxs(ee,{type:"button",variant:"secondary",size:"sm",onClick:()=>{c({...r,agentsMemorySources:[...r.agentsMemorySources,""]})},children:[t.jsx(Ie,{className:"w-3 h-3 mr-1"}),"Add Source"]})]})]}),r.selectedFactory==="dao_ai.middleware.create_skills_middleware"&&t.jsxs("div",{className:"space-y-4",children:[t.jsx("p",{className:"text-xs text-slate-400 bg-slate-900/50 p-2 rounded-lg border border-slate-700/30",children:"Discovers SKILL.md files from configured sources and injects skill listings into the system prompt. Later sources override earlier ones."}),t.jsx(ae,{label:"Backend Type",options:[{value:"state",label:"State (ephemeral)"},{value:"filesystem",label:"Filesystem (disk)"},{value:"store",label:"Store (persistent)"},{value:"volume",label:"Volume (Databricks UC)"}],value:r.skillsBackendType,onChange:p=>c({...r,skillsBackendType:p.target.value}),hint:"Backend for file storage"}),r.skillsBackendType==="filesystem"&&t.jsx(U,{label:"Root Directory",value:r.skillsRootDir,onChange:p=>c({...r,skillsRootDir:p.target.value}),placeholder:"/",required:!0,hint:"Required for filesystem backend"}),r.skillsBackendType==="volume"&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Volume Path"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{type:"button",onClick:()=>c({...r,volumeSource:"reference",skillsVolumePath:"",volumeRef:"",volumeSubPath:""}),className:`px-2 py-1 text-xs rounded ${r.volumeSource==="reference"?"bg-blue-500/30 text-blue-300":"bg-slate-700 text-slate-400"}`,children:"Select"}),t.jsx("button",{type:"button",onClick:()=>c({...r,volumeSource:"manual",skillsVolumePath:"",volumeRef:"",volumeSubPath:""}),className:`px-2 py-1 text-xs rounded ${r.volumeSource==="manual"?"bg-blue-500/30 text-blue-300":"bg-slate-700 text-slate-400"}`,children:"Manual"})]})]}),r.volumeSource==="reference"?t.jsxs("div",{className:"space-y-2",children:[t.jsx(ae,{value:r.volumeRef,onChange:p=>{const N=p.target.value;c({...r,volumeRef:N,skillsVolumePath:f(N)})},options:[{value:"",label:"Select volume..."},...x.map(p=>({value:p.value,label:p.label}))]}),t.jsx("p",{className:"text-xs text-slate-500",children:x.length===0?"No volumes configured  add one in the Resources section.":`Select from ${x.length} configured volume${x.length!==1?"s":""}.`}),t.jsx(U,{value:r.volumeSubPath,onChange:p=>c({...r,volumeSubPath:p.target.value}),placeholder:"optional/sub/path"}),t.jsx("p",{className:"text-xs text-slate-500",children:'Optional path within the volume (e.g., "agents/workspace").'})]}):t.jsxs("div",{className:"space-y-2",children:[t.jsx(U,{value:r.skillsVolumePath,onChange:p=>c({...r,skillsVolumePath:p.target.value}),placeholder:"/Volumes/catalog/schema/volume",required:!0}),t.jsx("p",{className:"text-xs text-slate-500",children:"Enter the full UC Volumes path directly."})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Skill Source Paths"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Later sources have higher priority (last one wins for same-name skills)"}),r.skillsSources.map((p,N)=>t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(U,{value:p,onChange:P=>{const M=[...r.skillsSources];M[N]=P.target.value,c({...r,skillsSources:M})},placeholder:"e.g., /skills/base/",className:"flex-1"}),t.jsx(ee,{type:"button",variant:"danger",size:"sm",onClick:()=>{const P=r.skillsSources.filter((M,O)=>O!==N);c({...r,skillsSources:P})},children:t.jsx(Ze,{className:"w-4 h-4"})})]},N)),t.jsxs(ee,{type:"button",variant:"secondary",size:"sm",onClick:()=>{c({...r,skillsSources:[...r.skillsSources,""]})},children:[t.jsx(Ie,{className:"w-3 h-3 mr-1"}),"Add Source"]})]})]})]}),r.selectedFactory==="custom"&&t.jsxs("div",{className:"space-y-3 p-4 bg-slate-800/30 rounded-lg border border-slate-700/50",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Arguments"}),t.jsxs(ee,{type:"button",variant:"secondary",size:"sm",onClick:()=>{const p=`arg_${Object.keys(r.genericArgs).length+1}`;c({...r,genericArgs:{...r.genericArgs,[p]:""}})},children:[t.jsx(Ie,{className:"w-3 h-3 mr-1"}),"Add Argument"]})]}),Object.keys(r.genericArgs).length===0?t.jsx("p",{className:"text-xs text-slate-500",children:'No arguments. Click "Add Argument" to pass parameters to the factory function.'}):t.jsx("div",{className:"space-y-2",children:Object.entries(r.genericArgs).map(([p,N])=>t.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[t.jsx(U,{placeholder:"Key",value:p,onChange:P=>{const M=P.target.value;if(M!==p){const O={...r.genericArgs};O[M]=O[p],delete O[p],c({...r,genericArgs:O})}}}),t.jsx(U,{placeholder:"Value",value:typeof N=="string"?N:JSON.stringify(N),onChange:P=>c({...r,genericArgs:{...r.genericArgs,[p]:P.target.value}}),className:"col-span-2"}),t.jsx(ee,{type:"button",variant:"danger",size:"sm",onClick:()=>{const P={...r.genericArgs};delete P[p],c({...r,genericArgs:P})},children:t.jsx(Ze,{className:"w-4 h-4"})})]},p))})]}),t.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[t.jsx(ee,{variant:"secondary",type:"button",onClick:()=>l(!1),children:"Cancel"}),t.jsx(ee,{type:"submit",children:o?"Save Changes":"Add Middleware"})]})]})})]})}const id=[{value:"memory",label:"In-Memory"},{value:"postgres",label:"Lakebase/PostgreSQL"}];function hb(){var te;const{config:e,updateMemory:s}=nt(),a=e.memory,n=((te=e.resources)==null?void 0:te.databases)||{},{scrollToAsset:i}=zs(),[l,o]=A.useState(!1),[u,m]=A.useState(!1),h=K=>{if(!K)return"";for(const[he,J]of Object.entries(n))if(K.instance_name&&J.instance_name===K.instance_name||K.name&&J.name===K.name)return he;return""},[r,c]=A.useState("memory"),[d,g]=A.useState(!1),[v,S]=A.useState(!1),[y,b]=A.useState("memory"),[_,x]=A.useState("default_checkpointer"),[f,C]=A.useState(""),[w,I]=A.useState("memory"),[R,k]=A.useState("default_store"),[D,L]=A.useState(""),[V,B]=A.useState(1536),[T,F]=A.useState("{user_id}"),[E,$]=A.useState("databricks-gte-large-en"),p=()=>{c("memory"),g(!1),S(!1),b("memory"),x("default_checkpointer"),C(""),I("memory"),k("default_store"),L(""),B(1536),F("{user_id}"),$("databricks-gte-large-en")},N=K=>{var he;if(c(K.refName||"memory"),K.checkpointer){g(!0);const J=K.checkpointer.database?"postgres":"memory";b(J),x(K.checkpointer.name||"default_checkpointer"),C(h(K.checkpointer.database))}else g(!1),b("memory"),x("default_checkpointer"),C("");if(K.store){S(!0);const J=K.store.database?"postgres":"memory";I(J),k(K.store.name||"default_store"),L(h(K.store.database)),B(K.store.dims||1536),F(K.store.namespace||"{user_id}"),$(((he=K.store.embedding_model)==null?void 0:he.name)||"databricks-gte-large-en")}else S(!1),I("memory"),k("default_store"),L(""),B(1536),F("{user_id}"),$("databricks-gte-large-en")},[P,M]=A.useState(null);A.useEffect(()=>{const K=JSON.stringify(a);K!==P&&M(K)},[a,P]);const O=()=>{const he={refName:hn(r)||"memory"};if(d){const J={name:_};if(y==="postgres"&&f){const oe=n[f];oe&&(J.database=oe)}he.checkpointer=J}if(v){const J={name:R};if(E&&(J.embedding_model={name:E,on_behalf_of_user:!1}),J.dims=V,T&&(J.namespace=T),w==="postgres"&&D){const oe=n[D];oe&&(J.database=oe)}he.store=J}return d||v?he:void 0},W=()=>{p(),m(!1),o(!0)},q=()=>{a&&(i(a.refName||"memory"),N(a),m(!0),o(!0))},ce=()=>{a&&Gt("Memory",a.refName||"memory",()=>{s(void 0)})},se=K=>{if(K.preventDefault(),!d&&!v)return;const he=O();s(he),o(!1)},H=Object.keys(n),z=K=>{const he=[];if(K.checkpointer){const J=K.checkpointer.database?"postgres":"memory";he.push(`Checkpointer: ${J}`)}if(K.store){const J=K.store.database?"postgres":"memory";he.push(`Store: ${J}`)}return he.join("  ")||"No components configured"};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-slate-100",children:"Memory Configuration"}),t.jsx("p",{className:"text-slate-400 mt-1",children:"Configure conversation persistence and long-term memory storage"})]}),!a&&t.jsxs(ee,{onClick:W,children:[t.jsx(Ie,{className:"w-4 h-4"}),"Add Memory"]})]}),a?t.jsx($e,{variant:"interactive",className:"group cursor-pointer",onClick:q,children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-500/20 flex items-center justify-center",children:t.jsx($t,{className:"w-5 h-5 text-purple-400"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-white",children:a.refName||"memory"}),t.jsx("p",{className:"text-sm text-slate-400",children:z(a)})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[a.checkpointer&&t.jsxs(Se,{variant:a.checkpointer.database?"success":"warning",children:[t.jsx(Il,{className:"w-3 h-3 mr-1"}),"Checkpointer"]}),a.store&&t.jsxs(Se,{variant:a.store.database?"success":"warning",children:[t.jsx($t,{className:"w-3 h-3 mr-1"}),"Store"]}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:K=>{K.stopPropagation(),q()},children:t.jsx(ds,{className:"w-4 h-4"})}),t.jsx(ee,{variant:"danger",size:"sm",onClick:K=>{K.stopPropagation(),ce()},children:t.jsx(Ze,{className:"w-4 h-4"})})]})]})}):t.jsxs($e,{className:"text-center py-12",children:[t.jsx($t,{className:"w-12 h-12 mx-auto text-slate-600 mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-slate-300 mb-2",children:"No memory configured"}),t.jsx("p",{className:"text-slate-500 mb-4 max-w-md mx-auto",children:"Memory enables conversation persistence and long-term context storage for your agents."}),t.jsxs(ee,{onClick:W,children:[t.jsx(Ie,{className:"w-4 h-4"}),"Add Memory Configuration"]})]}),t.jsx(ws,{isOpen:l,onClose:()=>o(!1),title:u?"Edit Memory Configuration":"Add Memory Configuration",description:"Configure conversation persistence and long-term memory storage",size:"lg",children:t.jsxs("form",{onSubmit:se,className:"space-y-6",children:[t.jsx(U,{label:"Reference Name",value:r,onChange:K=>c(Ot(K.target.value)),placeholder:"memory",hint:`Used as the YAML anchor (e.g., &${r||"memory"}) for referencing this memory configuration`,disabled:u}),t.jsx("div",{className:"p-4 bg-blue-900/20 border border-blue-500/30 rounded-lg",children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(Ka,{className:"w-5 h-5 text-blue-400 mt-0.5 flex-shrink-0"}),t.jsxs("div",{className:"text-sm text-blue-300",children:[t.jsx("p",{className:"font-medium",children:"Memory Components"}),t.jsxs("ul",{className:"mt-2 space-y-1 text-blue-400/80",children:[t.jsxs("li",{children:[" ",t.jsx("strong",{children:"Checkpointer"}),": Saves conversation state for resumable sessions"]}),t.jsxs("li",{children:[" ",t.jsx("strong",{children:"Store"}),": Long-term semantic memory with embeddings for context"]})]}),H.length===0&&t.jsxs("p",{className:"mt-3 text-amber-400",children:[" No databases configured. Add a database in ",t.jsx("strong",{children:"Resources  Databases"})," for persistent storage."]})]})]})}),t.jsxs("div",{className:"p-5 bg-slate-800/50 border border-slate-700 rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Il,{className:"w-5 h-5 text-purple-400"}),t.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Checkpointer"})]}),t.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:d,onChange:K=>g(K.target.checked),className:"rounded border-slate-600 bg-slate-800 text-purple-500 focus:ring-purple-500"}),t.jsx("span",{className:"text-sm text-slate-300",children:"Enable"})]})]}),d&&t.jsxs("div",{className:"space-y-4",children:[t.jsx("p",{className:"text-sm text-slate-400",children:"Saves conversation state between messages for resumable sessions."}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(U,{label:"Name",value:_,onChange:K=>x(K.target.value),placeholder:"default_checkpointer"}),t.jsx(ae,{label:"Storage Type",value:y,onChange:K=>b(K.target.value),options:id})]}),y==="memory"&&t.jsx("div",{className:"p-3 bg-amber-900/20 border border-amber-500/30 rounded-lg",children:t.jsxs("p",{className:"text-sm text-amber-300",children:[t.jsx("strong",{children:"In-Memory Storage:"})," Data lost on restart. Best for development."]})}),y==="postgres"&&t.jsxs(t.Fragment,{children:[t.jsx(ae,{label:"Database",value:f,onChange:K=>C(K.target.value),options:[{value:"",label:"Select a database..."},...H.map(K=>({value:K,label:K}))],hint:H.length===0?"Add a database in Resources  Databases":void 0}),t.jsx("div",{className:"p-3 bg-emerald-900/20 border border-emerald-500/30 rounded-lg",children:t.jsxs("p",{className:"text-sm text-emerald-300",children:[t.jsx("strong",{children:"Persistent Storage:"})," Data persists across restarts. Recommended for production."]})})]})]})]}),t.jsxs("div",{className:"p-5 bg-slate-800/50 border border-slate-700 rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx($t,{className:"w-5 h-5 text-cyan-400"}),t.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Long-Term Memory Store"})]}),t.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:v,onChange:K=>S(K.target.checked),className:"rounded border-slate-600 bg-slate-800 text-cyan-500 focus:ring-cyan-500"}),t.jsx("span",{className:"text-sm text-slate-300",children:"Enable"})]})]}),v&&t.jsxs("div",{className:"space-y-4",children:[t.jsx("p",{className:"text-sm text-slate-400",children:"Semantic memory storage with embeddings for persistent context."}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(U,{label:"Name",value:R,onChange:K=>k(K.target.value),placeholder:"default_store"}),t.jsx(ae,{label:"Storage Type",value:w,onChange:K=>I(K.target.value),options:id})]}),w==="memory"&&t.jsx("div",{className:"p-3 bg-amber-900/20 border border-amber-500/30 rounded-lg",children:t.jsxs("p",{className:"text-sm text-amber-300",children:[t.jsx("strong",{children:"In-Memory Storage:"})," Data lost on restart. Best for development."]})}),w==="postgres"&&t.jsxs(t.Fragment,{children:[t.jsx(ae,{label:"Database",value:D,onChange:K=>L(K.target.value),options:[{value:"",label:"Select a database..."},...H.map(K=>({value:K,label:K}))],hint:H.length===0?"Add a database in Resources  Databases":void 0}),t.jsx("div",{className:"p-3 bg-emerald-900/20 border border-emerald-500/30 rounded-lg",children:t.jsxs("p",{className:"text-sm text-emerald-300",children:[t.jsx("strong",{children:"Persistent Storage:"})," Data persists across restarts. Recommended for production."]})})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(U,{label:"Embedding Model",value:E,onChange:K=>$(K.target.value),placeholder:"databricks-gte-large-en",hint:"Databricks serving endpoint for embeddings"}),t.jsx(U,{label:"Embedding Dimensions",type:"number",value:V,onChange:K=>B(parseInt(K.target.value)||1536),hint:"Usually 1536 for GTE-Large"})]}),t.jsx(U,{label:"Namespace Template",value:T,onChange:K=>F(K.target.value),placeholder:"{user_id}",hint:"Template for partitioning memories. Use {user_id}, {thread_id}, etc."})]})]}),!d&&!v&&t.jsx("div",{className:"p-3 bg-red-900/20 border border-red-500/30 rounded-lg",children:t.jsx("p",{className:"text-sm text-red-400",children:"Please enable at least one memory component (Checkpointer or Store)."})}),t.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-slate-700",children:[t.jsx(ee,{variant:"secondary",type:"button",onClick:()=>o(!1),children:"Cancel"}),t.jsx(ee,{type:"submit",disabled:!d&&!v,children:u?"Save Changes":"Add Memory"})]})]})})]})}function ys(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean")return String(e);if(typeof e=="object"){const s=e;if("value"in s)return String(s.value);if("env"in s&&s.default_value!==void 0)return String(s.default_value);if("env"in s)return`$${s.env}`;if("scope"in s&&"secret"in s)return`{{secrets/${s.scope}/${s.secret}}}`}return""}async function pb(e){const s=await fetch("/api/ai/generate-prompt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){const n=await s.json();throw new Error(n.error||"Failed to generate prompt")}return(await s.json()).prompt}const gl=[{value:"user_id",label:"User ID"},{value:"store_num",label:"Store Number"},{value:"session_id",label:"Session ID"},{value:"context",label:"Context"},{value:"current_date",label:"Current Date"},{value:"user_name",label:"User Name"},{value:"location",label:"Location"}],bl=`### User Information
- **User Id**: {user_id}
- **Store Number**: {store_num}

You are a helpful assistant. Your role is to provide accurate and useful information.

#### Response Guidelines
- Be clear and concise
- Provide helpful examples when appropriate
- Always prioritize user safety
`;function ld(e){return hn(e)}function fb(){const{config:e,addPrompt:s,updatePrompt:a,removePrompt:n}=nt(),[i,l]=A.useState(!1),[o,u]=A.useState(null),[m,h]=A.useState("new"),[r,c]=A.useState("reference"),[d,g]=A.useState(!1),[v,S]=A.useState("configured"),[y,b]=A.useState(""),[_,x]=A.useState(""),[f,C]=A.useState(""),[w,I]=A.useState({refName:"",name:"",description:"",default_template:bl,alias:"",version:"",schemaRef:"",catalog_name:"",schema_name:"",tags:{},existingPromptFullName:"",autoRegister:!1}),[R,k]=A.useState(""),[D,L]=A.useState(""),[V,B]=A.useState(!1),[T,F]=A.useState(!0),[E,$]=A.useState(!1),[p,N]=A.useState(null),[P,M]=A.useState(null),[O,W]=A.useState(!1),[q,ce]=A.useState(""),[se,H]=A.useState(!1),[z,te]=A.useState(["user_id","store_num"]),[K,he]=A.useState(""),J=async(re=!1)=>{W(!0);try{const fe=await pb({context:q||void 0,agent_name:w.name||void 0,agent_description:w.description||void 0,existing_prompt:re?w.default_template:void 0,template_parameters:z.length>0?z:void 0});I({...w,default_template:fe}),H(!1),ce("")}catch(fe){console.error("Failed to generate prompt:",fe),alert(fe instanceof Error?fe.message:"Failed to generate prompt")}finally{W(!1)}},oe=()=>{K&&!z.includes(K)&&(te([...z,K]),he(""))},X=e.prompts||{},Z=e.schemas||{},me=e.service_principals||{},Re=e.variables||{},{data:st}=en(),{data:it,loading:rt}=ea(w.catalog_name||null),tt=A.useMemo(()=>{const re=fe=>{if(typeof fe!="string"||!fe.startsWith("*"))return fe;const Me=fe.slice(1),we=Re[Me];return we||fe};if(v==="configured"&&y&&me[y]){const fe=me[y];return{client_id:re(fe.client_id),client_secret:re(fe.client_secret)}}return v==="manual"&&_&&f?{client_id:_,client_secret:f}:null},[v,y,me,Re,_,f]),{data:ze,loading:Le,refetch:Ke}=Mg(w.catalog_name||null,w.schema_name||null,tt),{data:Ne,loading:et}=Rg(w.existingPromptFullName||null,tt),[lt,ot]=A.useState(null),ve=A.useMemo(()=>{const re=(Ne==null?void 0:Ne.aliases)||[],fe=(Ne==null?void 0:Ne.alias_versions)||{};if(re.length===0)return[{value:"",label:"No aliases available"}];const Me=[...re].sort((we,We)=>{if(we==="champion")return-1;if(We==="champion")return 1;if(we==="latest")return-1;if(We==="latest")return 1;const He=parseInt(fe[we]||"0");return parseInt(fe[We]||"0")-He});return[{value:"",label:"Select an alias..."},...Me.map(we=>({value:we,label:we}))]},[Ne==null?void 0:Ne.aliases,Ne==null?void 0:Ne.alias_versions]),Xe=A.useMemo(()=>{const re=(Ne==null?void 0:Ne.versions)||[];if(re.length===0)return[{value:"",label:"No versions available"}];const fe=[...re].sort((Me,we)=>{const We=parseInt(Me.version)||0;return(parseInt(we.version)||0)-We});return[{value:"",label:"Select a version..."},...fe.map(Me=>({value:Me.version,label:`v${Me.version}${Me.aliases&&Me.aliases.length>0?` (${Me.aliases.join(", ")})`:""}`}))]},[Ne==null?void 0:Ne.versions]);A.useEffect(()=>{var He;if(!Ne||!w.existingPromptFullName||Ne.full_name!==w.existingPromptFullName)return;const re=Ne.aliases||[],fe=Ne.alias_versions||{},Me=Ne.versions||[];let we="",We="";re.includes("champion")?(we="champion",We=fe.champion||""):re.includes("latest")?(we="latest",We=fe.latest||""):Me.length>0&&(We=((He=[...Me].sort((Qe,dt)=>(parseInt(dt.version)||0)-(parseInt(Qe.version)||0))[0])==null?void 0:He.version)||"",we=""),(we!==w.alias||We!==w.version)&&I(bt=>({...bt,alias:we,version:We}))},[Ne,w.existingPromptFullName]),A.useEffect(()=>{if(!w.existingPromptFullName||!Ne||Ne.full_name!==w.existingPromptFullName||!w.version&&!w.alias)return;(async()=>{B(!0),ot(null);try{const fe=w.version||void 0,Me=!fe&&w.alias?w.alias:void 0,we=await Yt.getPromptTemplate(w.existingPromptFullName,fe,Me,tt);we!=null&&we.error?we.alias_not_found?ot(`Alias '${w.alias}' does not exist for this prompt. Try 'latest' or select a specific version.`):we.version_not_found?ot(`Version ${w.version} does not exist for this prompt.`):ot(we.error):we!=null&&we.template?I(We=>({...We,default_template:we.template,version:we.version||We.version||""})):ot("No template returned from server")}catch(fe){const Me=fe instanceof Error?fe.message:"Failed to load prompt template";ot(Me),console.error("[PromptsSection] Error loading prompt template:",fe)}finally{B(!1)}})()},[w.existingPromptFullName,w.version,w.alias,Ne==null?void 0:Ne.full_name]),A.useEffect(()=>{Ne&&w.existingPromptFullName&&I(re=>({...re,tags:Ne.tags||{},description:Ne.description||re.description,version:re.version||"",default_template:Ne.template||re.default_template}))},[Ne,w.existingPromptFullName]);const qe=()=>{I({refName:"",name:"",description:"",default_template:bl,alias:"",version:"",schemaRef:"",catalog_name:"",schema_name:"",tags:{},existingPromptFullName:"",autoRegister:!1}),h("new"),c("reference"),k(""),L(""),u(null),g(!1),N(null),M(null),F(!0)},ct=re=>{const fe=Z[re];fe&&I({...w,schemaRef:re,catalog_name:ys(fe.catalog_name),schema_name:ys(fe.schema_name),existingPromptFullName:"",name:"",refName:""})},At=re=>{const fe=ze==null?void 0:ze.find(Me=>Me.full_name===re);if(fe){const Me=d?w.refName:ld(fe.name);I({...w,existingPromptFullName:re,name:fe.name,refName:Me,description:fe.description||"",alias:"",version:"",tags:fe.tags||{}}),ot(null)}},{scrollToAsset:Qt}=zs(),zt=re=>{var bt;Qt(re);const fe=X[re];let Me="",we="",We="",He="direct";if(fe.schema){const Qe=ys(fe.schema.catalog_name),dt=ys(fe.schema.schema_name),Zt=Object.entries(Z).find(([,ms])=>ys(ms.catalog_name)===Qe&&ys(ms.schema_name)===dt);Zt?(Me=Zt[0],He="reference"):(we=Qe,We=dt,He="direct")}h("new"),c(He),g(!0),I({refName:re,name:fe.name,description:fe.description||"",default_template:fe.default_template||"",alias:fe.alias||"",version:((bt=fe.version)==null?void 0:bt.toString())||"",schemaRef:Me,catalog_name:we,schema_name:We,tags:fe.tags||{},existingPromptFullName:"",autoRegister:fe.auto_register??!1}),u(re),l(!0)},yt=async re=>{if(re.preventDefault(),!w.refName||!w.name)return;const fe=hn(w.name);if(!fe)return;N(null),M(null);let Me,we="",We="";r==="reference"&&w.schemaRef&&Z[w.schemaRef]?(Me=Z[w.schemaRef],we=ys(Me.catalog_name),We=ys(Me.schema_name)):w.catalog_name&&w.schema_name&&(Me={catalog_name:w.catalog_name,schema_name:w.schema_name},we=w.catalog_name,We=w.schema_name);const He=T&&m==="new"&&!o&&we&&We&&w.default_template;let bt;if(He){$(!0);try{const dt=await Yt.registerPrompt(fe,we,We,w.default_template,w.description||void 0,w.alias||void 0,Object.keys(w.tags).length>0?w.tags:void 0,tt);if(!dt.success){N(dt.error||"Failed to register prompt in registry"),$(!1);return}bt=dt.version,M(dt.message||`Registered prompt version ${dt.version}`)}catch(dt){const Zt=dt instanceof Error?dt.message:"Unknown error during registration";N(Zt),$(!1);return}$(!1)}const Qe={name:fe,schema:Me,description:w.description||void 0,default_template:w.default_template||void 0,...T&&{alias:w.alias||void 0,version:bt??(w.version?parseInt(w.version):void 0)},tags:Object.keys(w.tags).length>0?w.tags:void 0,auto_register:w.autoRegister||void 0};o?(o!==w.refName&&n(o),a(w.refName,Qe)):s(w.refName,Qe),qe(),l(!1)},_t=()=>{R&&D&&(I({...w,tags:{...w.tags,[R]:D}}),k(""),L(""))},Pt=re=>{const fe={...w.tags};delete fe[re],I({...w,tags:fe})},Kt=Object.keys(me).length>0;return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-white",children:"Prompts"}),t.jsx("p",{className:"text-slate-400 mt-1",children:"Configure reusable prompts for agents with MLflow Prompt Registry integration"})]}),t.jsxs(ee,{onClick:()=>{qe(),l(!0)},children:[t.jsx(Ie,{className:"w-4 h-4"}),"Add Prompt"]})]}),t.jsxs($e,{className:"p-4 space-y-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-white mb-1",children:"Prompt Registry Authentication"}),t.jsx("p",{className:"text-xs text-slate-400",children:"Service principal used for all prompt registry operations (browsing, fetching templates)"})]}),t.jsxs("div",{className:"inline-flex rounded-lg bg-slate-900/50 p-0.5",children:[t.jsx("button",{type:"button",onClick:()=>S("configured"),className:`px-3 py-1.5 text-xs rounded-md font-medium transition-all duration-150 ${v==="configured"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Configured"}),t.jsx("button",{type:"button",onClick:()=>S("manual"),className:`px-3 py-1.5 text-xs rounded-md font-medium transition-all duration-150 ${v==="manual"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Manual"})]}),v==="configured"&&t.jsxs("div",{className:"space-y-2",children:[t.jsxs("select",{value:y,onChange:re=>b(re.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-sm text-white focus:outline-none focus:ring-2 focus:ring-violet-500",children:[t.jsx("option",{value:"",children:"Select a service principal..."}),Object.keys(me).map(re=>t.jsx("option",{value:re,children:re},re))]}),!Kt&&t.jsx("p",{className:"text-xs text-amber-400/70",children:"No service principals configured. Add them in Resources  Service Principals."})]}),v==="manual"&&t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx("label",{className:"text-xs font-medium text-slate-400",children:"Client ID"}),t.jsx("input",{type:"text",value:_,onChange:re=>x(re.target.value),placeholder:"Enter client ID...",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-sm text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-violet-500"})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("label",{className:"text-xs font-medium text-slate-400",children:"Client Secret"}),t.jsx("input",{type:"password",value:f,onChange:re=>C(re.target.value),placeholder:"Enter client secret...",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-sm text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-violet-500"})]})]}),tt&&t.jsx("p",{className:"text-xs text-emerald-400",children:" Custom authentication configured"})]}),Object.keys(X).length===0?t.jsxs($e,{className:"text-center py-12",children:[t.jsx(Ya,{className:"w-12 h-12 mx-auto text-slate-600 mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-slate-300 mb-2",children:"No prompts configured"}),t.jsx("p",{className:"text-slate-500 mb-4 max-w-md mx-auto",children:'Prompts define agent behavior and can be version-controlled through MLflow Prompt Registry. Use aliases like "production" or "staging" for environment management.'}),t.jsxs(ee,{onClick:()=>{qe(),l(!0)},children:[t.jsx(Ie,{className:"w-4 h-4"}),"Add Your First Prompt"]})]}):t.jsx("div",{className:"grid gap-4",children:Object.entries(X).map(([re,fe])=>t.jsx($e,{variant:"interactive",className:"group cursor-pointer",onClick:()=>zt(re),children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex items-start space-x-4",children:[t.jsx("div",{className:"w-10 h-10 rounded-lg bg-violet-500/20 flex items-center justify-center flex-shrink-0",children:t.jsx(Ya,{className:"w-5 h-5 text-violet-400"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("h3",{className:"font-medium text-white",children:re}),fe.alias&&t.jsxs(Se,{variant:"info",children:[t.jsx(Or,{className:"w-3 h-3 mr-1"}),"@",fe.alias]}),fe.version&&t.jsxs(Se,{variant:"default",children:[t.jsx(Ol,{className:"w-3 h-3 mr-1"}),"v",fe.version]})]}),t.jsx("p",{className:"text-sm text-slate-400 mt-1",children:fe.schema?`${ys(fe.schema.catalog_name)}.${ys(fe.schema.schema_name)}.${fe.name}`:fe.name}),fe.description&&t.jsx("p",{className:"text-xs text-slate-500 mt-1 line-clamp-2",children:fe.description}),fe.tags&&Object.keys(fe.tags).length>0&&t.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:Object.entries(fe.tags).map(([Me,we])=>t.jsxs("span",{className:"px-2 py-0.5 bg-slate-700/50 rounded text-xs text-slate-400",children:[t.jsx(Vl,{className:"w-3 h-3 inline mr-1"}),Me,": ",we]},Me))})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",onClick:Me=>Me.stopPropagation(),children:[t.jsx(ee,{variant:"ghost",size:"sm",onClick:()=>zt(re),title:"Edit prompt",children:t.jsx(ds,{className:"w-4 h-4"})}),t.jsx(ee,{variant:"danger",size:"sm",onClick:()=>{Gt("Prompt",re,()=>n(re))},title:"Delete prompt",children:t.jsx(Ze,{className:"w-4 h-4"})})]})]})},re))}),t.jsx(ws,{isOpen:i,onClose:()=>{qe(),l(!1)},title:o?"Edit Prompt":"Add Prompt",description:"Configure a reusable prompt for agents",size:"xl",children:t.jsxs("form",{onSubmit:yt,className:"space-y-4",children:[!o&&t.jsxs("div",{className:"flex items-center justify-center space-x-4 p-3 bg-slate-800/50 rounded-lg",children:[t.jsxs("button",{type:"button",onClick:()=>{h("new"),I({...w,existingPromptFullName:""})},className:`flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors ${m==="new"?"bg-blue-500/30 text-blue-300 border border-blue-500/50":"bg-slate-700/50 text-slate-400 hover:bg-slate-700"}`,children:[t.jsx(Ie,{className:"w-4 h-4"}),t.jsx("span",{children:"New Prompt"})]}),t.jsxs("button",{type:"button",onClick:()=>{h("existing")},className:`flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors ${m==="existing"?"bg-blue-500/30 text-blue-300 border border-blue-500/50":"bg-slate-700/50 text-slate-400 hover:bg-slate-700"}`,children:[t.jsx(wu,{className:"w-4 h-4"}),t.jsx("span",{children:"Existing Prompt"})]})]}),m==="existing"&&!o&&t.jsxs("div",{className:"space-y-4 p-4 bg-slate-800/30 rounded-lg border border-slate-700",children:[t.jsx("h4",{className:"text-sm font-medium text-slate-300",children:"Select Existing Prompt from MLflow Registry"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Schema"}),t.jsx("div",{className:"flex space-x-2",children:t.jsxs("div",{className:"inline-flex rounded-lg bg-slate-900/50 p-0.5 w-full",children:[t.jsx("button",{type:"button",onClick:()=>{c("reference"),g(!1),I({...w,catalog_name:"",schema_name:"",existingPromptFullName:"",name:"",refName:""})},className:`flex-1 px-3 py-1.5 text-xs rounded-md font-medium transition-all duration-150 ${r==="reference"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Configured"}),t.jsx("button",{type:"button",onClick:()=>{c("direct"),g(!1),I({...w,schemaRef:"",existingPromptFullName:"",name:"",refName:""})},className:`flex-1 px-3 py-1.5 text-xs rounded-md font-medium transition-all duration-150 ${r==="direct"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Select"})]})}),r==="reference"?t.jsx(ae,{label:"Schema Reference",value:w.schemaRef,onChange:re=>ct(re.target.value),options:[{value:"",label:"Select a configured schema..."},...Object.entries(Z).map(([re,fe])=>({value:re,label:`${re} (${ys(fe.catalog_name)}.${ys(fe.schema_name)})`}))],hint:"Reference a schema defined in the Schemas section"}):t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(ae,{label:"Catalog",value:w.catalog_name,onChange:re=>I({...w,catalog_name:re.target.value,schema_name:"",existingPromptFullName:"",name:"",refName:""}),options:[{value:"",label:"Select catalog..."},...(st||[]).map(re=>({value:re.name,label:re.name}))]}),t.jsx(ae,{label:"Schema",value:w.schema_name,onChange:re=>I({...w,schema_name:re.target.value,existingPromptFullName:"",name:"",refName:""}),options:[{value:"",label:rt?"Loading...":"Select schema..."},...(it||[]).map(re=>({value:re.name,label:re.name}))],disabled:!w.catalog_name||rt})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Available Prompts"}),w.catalog_name&&w.schema_name||w.schemaRef?t.jsxs("button",{type:"button",onClick:()=>Ke(),className:"text-xs text-slate-400 hover:text-white flex items-center space-x-1",disabled:Le,children:[t.jsx(Ut,{className:`w-3 h-3 ${Le?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}):null]}),t.jsx(ae,{value:w.existingPromptFullName,onChange:re=>At(re.target.value),options:[{value:"",label:Le?"Loading prompts...":"Select a prompt..."},...(ze||[]).map(re=>({value:re.full_name,label:`${re.name}${re.description?` - ${re.description.substring(0,50)}${re.description.length>50?"...":""}`:""}`}))],disabled:(!w.catalog_name||!w.schema_name)&&!w.schemaRef||Le}),(w.catalog_name&&w.schema_name||w.schemaRef)&&!Le&&(!ze||ze.length===0)&&t.jsx("p",{className:"text-xs text-amber-400",children:"No prompts found in this schema. Try selecting a different schema or create a new prompt."})]}),w.existingPromptFullName&&t.jsxs("div",{className:"space-y-3 pt-3 border-t border-slate-700",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("p",{className:"text-sm font-medium text-slate-300",children:"Version & Alias"}),(et||V)&&t.jsxs("span",{className:"text-xs text-slate-400 flex items-center space-x-1",children:[t.jsx(Ut,{className:"w-3 h-3 animate-spin"}),t.jsx("span",{children:V?"Loading template...":"Loading details..."})]})]}),lt&&t.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/30 rounded-lg",children:t.jsx("p",{className:"text-xs text-red-400",children:lt})}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(ae,{label:"Alias",value:w.alias,onChange:re=>{ot(null);const fe=re.target.value,Me=Ne==null?void 0:Ne.alias_versions;let we="";fe&&Me&&Me[fe]?we=Me[fe]:fe==="latest"&&(Ne!=null&&Ne.latest_version)&&(we=Ne.latest_version),I({...w,alias:fe,version:we})},options:ve,hint:"Select an alias configured for this prompt"}),t.jsx(ae,{label:"Version",value:w.version,onChange:re=>{ot(null);const fe=re.target.value,Me=Ne==null?void 0:Ne.alias_versions;let we="";if(fe&&Me){for(const[We,He]of Object.entries(Me))if(He===fe){we=We;break}}I({...w,version:fe,alias:we})},options:Xe,hint:"Pin to a specific version number"})]}),(w.alias||w.version)&&!lt&&!V&&t.jsxs("p",{className:"text-xs text-emerald-400",children:[" Using ",w.alias&&w.version?`alias: ${w.alias} (v${w.version})`:w.alias?`alias: ${w.alias}`:`version: v${w.version}`]})]})]}),t.jsx(U,{label:"Reference Name",placeholder:"e.g., General Prompt",value:w.refName,onChange:re=>{I({...w,refName:Ot(re.target.value)}),g(!0)},hint:"Type naturally - spaces become underscores",required:!0}),t.jsxs("div",{className:"space-y-1.5",children:[t.jsx(U,{label:"Prompt Name",placeholder:"e.g., My New Prompt",value:w.name,onChange:re=>{const fe=re.target.value,Me=Ot(fe);I({...w,name:Me,refName:!o&&!d?ld(Me):w.refName})},hint:"Type naturally - spaces become underscores",required:!0,disabled:m==="existing"&&!!w.existingPromptFullName}),w.name&&w.name.endsWith("_")&&t.jsx("p",{className:"text-xs text-slate-400",children:"Continue typing to complete the name..."})]}),t.jsx(U,{label:"Description",placeholder:"e.g., General retail store assistant prompt",value:w.description,onChange:re=>I({...w,description:re.target.value}),hint:"Used as commit message when syncing to MLflow registry"}),m==="new"&&!o&&t.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-slate-800/50 rounded-lg",children:[t.jsx("input",{type:"checkbox",id:"saveToRegistry",checked:T,onChange:re=>F(re.target.checked),className:"w-4 h-4 rounded border-slate-600 bg-slate-800 text-violet-500 focus:ring-violet-500 focus:ring-offset-0"}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"saveToRegistry",className:"text-sm font-medium text-slate-300 cursor-pointer",children:"Save to Prompt Registry"}),t.jsx("p",{className:"text-xs text-slate-500",children:T?"Prompt will be registered in MLflow with versioning and the configured alias":"Only the default_template will be saved to YAML (no registry, no alias)"})]})]}),t.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-slate-800/50 rounded-lg",children:[t.jsx("input",{type:"checkbox",id:"autoRegister",checked:w.autoRegister,onChange:re=>I({...w,autoRegister:re.target.checked}),className:"w-4 h-4 rounded border-slate-600 bg-slate-800 text-violet-500 focus:ring-violet-500 focus:ring-offset-0"}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"autoRegister",className:"text-sm font-medium text-slate-300 cursor-pointer",children:"Auto Register"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Automatically register this prompt in MLflow when the application starts"})]})]}),m==="new"&&t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Schema (Optional)"}),t.jsxs("div",{className:"inline-flex rounded-lg bg-slate-900/50 p-0.5 w-full",children:[t.jsx("button",{type:"button",onClick:()=>{c("reference"),I({...w,catalog_name:"",schema_name:""})},className:`flex-1 px-3 py-1.5 text-xs rounded-md font-medium transition-all duration-150 ${r==="reference"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Configured"}),t.jsx("button",{type:"button",onClick:()=>{c("direct"),I({...w,schemaRef:""})},className:`flex-1 px-3 py-1.5 text-xs rounded-md font-medium transition-all duration-150 ${r==="direct"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Select"})]}),r==="reference"?t.jsx(ae,{label:"Schema Reference",value:w.schemaRef,onChange:re=>I({...w,schemaRef:re.target.value}),options:[{value:"",label:"Select a configured schema..."},...Object.entries(Z).map(([re,fe])=>({value:re,label:`${re} (${ys(fe.catalog_name)}.${ys(fe.schema_name)})`}))],hint:"Reference a schema defined in the Schemas section"}):t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(ae,{label:"Catalog",value:w.catalog_name,onChange:re=>I({...w,catalog_name:re.target.value,schema_name:""}),options:[{value:"",label:"Select catalog..."},...(st||[]).map(re=>({value:re.name,label:re.name}))]}),t.jsx(ae,{label:"Schema",value:w.schema_name,onChange:re=>I({...w,schema_name:re.target.value}),options:[{value:"",label:rt?"Loading schemas...":"Select schema..."},...(it||[]).map(re=>({value:re.name,label:re.name}))],disabled:!w.catalog_name||rt})]}),t.jsx("p",{className:"text-xs text-slate-500",children:"Associate prompt with a Unity Catalog schema for the full name (catalog.schema.prompt_name)"})]})]}),m==="new"&&T&&t.jsxs("div",{children:[t.jsx(U,{label:"Alias (Optional)",placeholder:"e.g., champion, production, staging",value:w.alias,onChange:re=>I({...w,alias:re.target.value}),hint:"Set an alias for this prompt version (e.g., champion, default)"}),t.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Version is auto-assigned when registering a new prompt. Use alias to reference specific versions."})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:m==="existing"?"Template":"Default Template"}),t.jsx("div",{className:"flex items-center space-x-2",children:V&&t.jsxs("span",{className:"text-xs text-slate-400 flex items-center space-x-1",children:[t.jsx(Ut,{className:"w-3 h-3 animate-spin"}),t.jsx("span",{children:"Loading template..."})]})})]}),m==="new"&&t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs("button",{type:"button",onClick:()=>H(!se),className:"flex items-center space-x-1.5 px-3 py-1.5 text-xs rounded-lg font-medium bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-purple-300 border border-purple-500/30 hover:from-purple-500/30 hover:to-pink-500/30 transition-all",disabled:O,children:[t.jsx(Rt,{className:"w-3.5 h-3.5"}),t.jsx("span",{children:"AI Assistant"})]}),w.default_template&&w.default_template!==bl&&t.jsxs("button",{type:"button",onClick:()=>J(!0),className:"flex items-center space-x-1.5 px-3 py-1.5 text-xs rounded-lg font-medium bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-purple-300 border border-purple-500/30 hover:from-purple-500/30 hover:to-pink-500/30 transition-all",disabled:O,children:[O?t.jsx(Nt,{className:"w-3.5 h-3.5 animate-spin"}):t.jsx(Rt,{className:"w-3.5 h-3.5"}),t.jsx("span",{children:"Improve Prompt"})]})]}),m==="new"&&se&&t.jsxs("div",{className:"p-3 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-lg border border-purple-500/30 space-y-3",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Rt,{className:"w-4 h-4 text-purple-400"}),t.jsx("span",{className:"text-sm font-medium text-purple-300",children:"Generate Prompt with AI"})]}),t.jsx("p",{className:"text-xs text-slate-400",children:"Describe what this prompt should do and I'll generate an optimized template for you."}),t.jsx(Jt,{value:q,onChange:re=>ce(re.target.value),rows:3,placeholder:"e.g., This prompt is for a product specialist agent that helps customers find and compare products. It should include instructions for tool usage and customer service best practices..."}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-xs font-medium text-slate-400",children:"Template Parameters"}),t.jsxs("p",{className:"text-xs text-slate-500",children:["Select variables to include in the prompt (e.g., ","{user_id}",")"]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:gl.map(re=>t.jsx("button",{type:"button",onClick:()=>{z.includes(re.value)?te(z.filter(fe=>fe!==re.value)):te([...z,re.value])},className:`px-2 py-1 text-xs rounded-md transition-all ${z.includes(re.value)?"bg-purple-500/30 text-purple-300 border border-purple-500/50":"bg-slate-800 text-slate-400 border border-slate-700 hover:border-slate-600"}`,children:re.label},re.value))}),z.filter(re=>!gl.map(fe=>fe.value).includes(re)).length>0&&t.jsx("div",{className:"flex flex-wrap gap-2",children:z.filter(re=>!gl.map(fe=>fe.value).includes(re)).map(re=>t.jsxs("span",{className:"px-2 py-1 text-xs rounded-md bg-blue-500/30 text-blue-300 border border-blue-500/50 flex items-center space-x-1",children:[t.jsx("span",{children:re}),t.jsx("button",{type:"button",onClick:()=>te(z.filter(fe=>fe!==re)),className:"hover:text-red-300",children:""})]},re))}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"text",value:K,onChange:re=>he(re.target.value.replace(/[^a-z0-9_]/gi,"_").toLowerCase()),placeholder:"Add custom parameter...",className:"flex-1 px-2 py-1 text-xs bg-slate-800 border border-slate-700 rounded-md text-slate-300 placeholder-slate-500 focus:border-purple-500 focus:outline-none",onKeyDown:re=>{re.key==="Enter"&&(re.preventDefault(),oe())}}),t.jsx("button",{type:"button",onClick:oe,disabled:!K,className:"px-2 py-1 text-xs bg-slate-700 text-slate-300 rounded-md hover:bg-slate-600 disabled:opacity-50",children:"Add"})]})]}),t.jsxs("div",{className:"flex justify-end space-x-2",children:[t.jsx(ee,{type:"button",variant:"secondary",size:"sm",onClick:()=>{H(!1),ce("")},disabled:O,children:"Cancel"}),t.jsx(ee,{type:"button",size:"sm",onClick:()=>J(!1),disabled:O||!q&&!w.name&&!w.description,className:"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600",children:O?t.jsxs(t.Fragment,{children:[t.jsx(Nt,{className:"w-4 h-4 mr-1.5 animate-spin"}),"Generating..."]}):t.jsxs(t.Fragment,{children:[t.jsx(Rt,{className:"w-4 h-4 mr-1.5"}),"Generate Prompt"]})})]})]}),t.jsx(Jt,{value:w.default_template,onChange:re=>m==="new"&&I({...w,default_template:re.target.value}),rows:10,readOnly:m==="existing",className:m==="existing"?"bg-slate-800/50 cursor-not-allowed":"",hint:m==="existing"?"Template loaded from MLflow registry (read-only).":"Fallback template if MLflow registry is unavailable. Use {variable_name} for substitutions."})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Tags"}),Object.keys(w.tags).length>0&&t.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(w.tags).map(([re,fe])=>t.jsxs("div",{className:"flex items-center space-x-1 px-2 py-1 bg-slate-700/50 rounded text-sm",children:[t.jsx(Vl,{className:"w-3 h-3 text-slate-400"}),t.jsxs("span",{className:"text-slate-300",children:[re,":"]}),t.jsx("span",{className:"text-slate-400",children:fe}),t.jsx("button",{type:"button",onClick:()=>Pt(re),className:"ml-1 text-slate-500 hover:text-red-400",children:""})]},re))}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(U,{placeholder:"Key (e.g., environment)",value:R,onChange:re=>k(re.target.value),className:"flex-1"}),t.jsx(U,{placeholder:"Value (e.g., production)",value:D,onChange:re=>L(re.target.value),className:"flex-1"}),t.jsx(ee,{type:"button",variant:"secondary",size:"sm",onClick:_t,disabled:!R||!D,children:t.jsx(Ie,{className:"w-4 h-4"})})]}),t.jsx("p",{className:"text-xs text-slate-500",children:"Metadata tags for organization and filtering in MLflow"})]}),tt&&t.jsxs("div",{className:"p-3 bg-violet-500/10 border border-violet-500/20 rounded-lg",children:[t.jsx("p",{className:"text-xs text-violet-300",children:v==="configured"?t.jsxs(t.Fragment,{children:["Using service principal: ",t.jsx("span",{className:"font-medium",children:y})]}):t.jsx(t.Fragment,{children:"Using manual credentials"})}),t.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Change this in the Prompt Registry Authentication section above."})]}),p&&t.jsxs("div",{className:"p-3 bg-red-500/10 border border-red-500/30 rounded-lg",children:[t.jsx("p",{className:"text-sm text-red-400 font-medium",children:"Registration Failed"}),t.jsx("p",{className:"text-xs text-red-300 mt-1",children:p})]}),P&&t.jsx("div",{className:"p-3 bg-emerald-500/10 border border-emerald-500/30 rounded-lg",children:t.jsxs("p",{className:"text-sm text-emerald-400",children:[" ",P]})}),m==="new"&&!o&&(w.catalog_name||w.schemaRef)&&w.name&&w.default_template&&t.jsx("div",{className:"p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg",children:t.jsxs("p",{className:"text-xs text-blue-300",children:[t.jsx("span",{className:"font-medium",children:"Registry:"})," This prompt will be registered in MLflow Prompt Registry at"," ",t.jsx("span",{className:"font-mono text-blue-200",children:w.schemaRef&&Z[w.schemaRef]?`${Z[w.schemaRef].catalog_name}.${Z[w.schemaRef].schema_name}.${w.name}`:`${w.catalog_name}.${w.schema_name}.${w.name}`})]})}),t.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[t.jsx(ee,{variant:"secondary",type:"button",onClick:()=>{qe(),l(!1)},disabled:E,children:"Cancel"}),t.jsx(ee,{type:"submit",disabled:!w.refName||!w.name||E,children:E?t.jsxs(t.Fragment,{children:[t.jsx(Nt,{className:"w-4 h-4 mr-1.5 animate-spin"}),"Registering..."]}):o?"Update Prompt":"Add Prompt"})]})]})})]})}function od(e,s,a){if(!e)return!1;const n=s.resources||{},i=["llms","genie_rooms","tables","volumes","functions","warehouses","connections","databases","vector_stores"];for(const d of i){const g=n[d]||{};if(e in g&&e!==a)return!0}const l=s.agents||{};if(e in l&&e!==a)return!0;const o=s.tools||{};if(e in o&&e!==a)return!0;const u=s.guardrails||{};if(e in u&&e!==a)return!0;const m=s.retrievers||{};if(e in m&&e!==a)return!0;const h=s.schemas||{};if(e in h&&e!==a)return!0;const r=s.prompts||{};if(e in r&&e!==a)return!0;const c=s.variables||{};return e in c&&e!==a}async function xb(e){const s=await fetch("/api/ai/generate-prompt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){const n=await s.json();throw new Error(n.error||"Failed to generate prompt")}return(await s.json()).prompt}async function gb(e){const s=await fetch("/api/ai/generate-handoff-prompt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){const n=await s.json();throw new Error(n.error||"Failed to generate handoff prompt")}return(await s.json()).prompt}const vl=[{value:"user_id",label:"User ID"},{value:"store_num",label:"Store Number"},{value:"session_id",label:"Session ID"},{value:"context",label:"Context"},{value:"current_date",label:"Current Date"},{value:"user_name",label:"User Name"},{value:"location",label:"Location"}];function bb(){var w;const{config:e,addAgent:s,removeAgent:a,updateAgent:n}=nt(),[i,l]=A.useState(!1),[o,u]=A.useState(null),m=e.agents||{},h=((w=e.resources)==null?void 0:w.llms)||{},r=e.tools||{},c=e.guardrails||{},d=e.prompts||{},g=Object.entries(h).map(([I,R])=>({value:I,label:`${I} (${R.name})`})),v=Object.entries(r).map(([I,R])=>({value:I,label:R.name})),S=Object.entries(c).map(([I,R])=>({value:I,label:R.name})),y=e.middleware||{},b=Object.entries(y).map(([I])=>({value:I,label:I})),_=Object.entries(d).map(([I,R])=>({value:I,label:`${I} (${R.name})`})),{scrollToAsset:x}=zs(),f=I=>{u(I),l(!0)},C=I=>{x(I),f(I)};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-white",children:"Agents"}),t.jsx("p",{className:"text-slate-400 mt-1",children:"Create and configure your AI agents"})]}),t.jsxs(ee,{onClick:()=>{u(null),l(!0)},children:[t.jsx(Ie,{className:"w-4 h-4"}),"Add Agent"]})]}),Object.keys(m).length===0?t.jsxs($e,{className:"text-center py-12",children:[t.jsx(ts,{className:"w-12 h-12 mx-auto text-slate-600 mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-slate-300 mb-2",children:"No agents configured"}),t.jsx("p",{className:"text-slate-500 mb-4",children:"Agents are the AI assistants that interact with users and use tools."}),t.jsxs(ee,{onClick:()=>l(!0),children:[t.jsx(Ie,{className:"w-4 h-4"}),"Add Your First Agent"]})]}):t.jsx("div",{className:"space-y-3",children:Object.entries(m).map(([I,R])=>{var k;return t.jsxs($e,{variant:"interactive",className:"group cursor-pointer",onClick:()=>C(I),children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("div",{className:"w-10 h-10 rounded-lg bg-violet-500/20 flex items-center justify-center",children:t.jsx(ts,{className:"w-5 h-5 text-violet-400"})}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-slate-200",children:I}),t.jsxs("p",{className:"text-xs text-slate-500",children:[R.name,R.description?`  ${R.description}`:""]})]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Se,{variant:"info",children:typeof R.model=="object"?R.model.name:R.model}),t.jsxs(Se,{variant:"default",children:[((k=R.tools)==null?void 0:k.length)||0," tools"]}),R.response_format&&t.jsx(Se,{variant:"success",children:"Structured Output"}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:D=>{D.stopPropagation(),f(I)},title:"Edit agent",children:t.jsx(Lr,{className:"w-4 h-4"})}),t.jsx(ee,{variant:"danger",size:"sm",onClick:D=>{D.stopPropagation(),Gt("Agent",I,()=>a(I))},title:"Delete agent",children:t.jsx(Ze,{className:"w-4 h-4"})})]})]}),R.description&&t.jsx("p",{className:"mt-2 text-sm text-slate-400 line-clamp-2",children:R.description}),R.tools&&R.tools.length>0&&t.jsxs("div",{className:"mt-3 flex flex-wrap gap-1",children:[R.tools.slice(0,5).map((D,L)=>t.jsx(Se,{variant:"warning",className:"text-xs",children:D.name},L)),R.tools.length>5&&t.jsxs(Se,{variant:"default",className:"text-xs",children:["+",R.tools.length-5," more"]})]})]},I)})}),t.jsx(vb,{isOpen:i,onClose:()=>{l(!1),u(null)},editingAgent:o?m[o]:null,editingKey:o,llmOptions:g,toolOptions:v,guardrailOptions:S,middlewareOptions:b,promptOptions:_,llms:h,tools:r,guardrails:c,middleware:y,prompts:d,onAdd:s,onUpdate:n,onRemove:a})]})}function cd(e){return e.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,"")}function vb({isOpen:e,onClose:s,editingAgent:a,editingKey:n,llmOptions:i,toolOptions:l,guardrailOptions:o,middlewareOptions:u,promptOptions:m,llms:h,tools:r,guardrails:c,middleware:d,prompts:g,onAdd:v,onUpdate:S,onRemove:y}){var K,he;const{config:b}=nt(),[_,x]=A.useState("inline"),[f,C]=A.useState(!1),[w,I]=A.useState(!1),[R,k]=A.useState(""),[D,L]=A.useState(!1),[V,B]=A.useState(["user_id","store_num"]),[T,F]=A.useState(""),[E,$]=A.useState(null),[p,N]=A.useState({refName:"",name:"",description:"",modelKey:"",promptRef:"",prompt:"You are a helpful assistant.",handoffPrompt:"",selectedTools:[],selectedGuardrails:[],selectedMiddleware:[],enableResponseFormat:!1,schemaType:"json",responseSchema:"",useTool:!0}),[P,M]=A.useState(null),[O,W]=A.useState("inline"),q=()=>{try{JSON.parse(p.responseSchema),$({valid:!0,message:"Valid JSON schema"})}catch(J){$({valid:!1,message:J instanceof Error?J.message:"Invalid JSON"})}},ce=async(J=!1)=>{C(!0);try{const oe=p.selectedTools.map(Z=>{var me;return(me=r[Z])==null?void 0:me.name}).filter(Boolean),X=await xb({context:R||void 0,agent_name:p.name||void 0,agent_description:p.description||void 0,tools:oe.length>0?oe:void 0,existing_prompt:J?p.prompt:void 0,template_parameters:V.length>0?V:void 0});N({...p,prompt:X}),L(!1),k("")}catch(oe){console.error("Failed to generate prompt:",oe),alert(oe instanceof Error?oe.message:"Failed to generate prompt")}finally{C(!1)}},se=async(J=!1)=>{I(!0);try{const oe=Object.values(b.agents||{}).map(Z=>Z.name).filter(Z=>Z!==p.name),X=await gb({agent_name:p.name||void 0,agent_description:p.description||void 0,system_prompt:p.prompt||void 0,existing_handoff:J?p.handoffPrompt:void 0,other_agents:oe.length>0?oe:void 0});N({...p,handoffPrompt:X})}catch(oe){console.error("Failed to generate handoff prompt:",oe),alert(oe instanceof Error?oe.message:"Failed to generate handoff prompt")}finally{I(!1)}},H=()=>{T&&!V.includes(T)&&(B([...V,T]),F(""))};A.useEffect(()=>{var J,oe,X,Z,me;if(e)if(a&&n){const Re=((J=Object.entries(h).find(([,Xe])=>{var qe;return Xe.name===((qe=a.model)==null?void 0:qe.name)}))==null?void 0:J[0])||"";let st="inline",it="",rt="";if(typeof a.prompt=="object"&&a.prompt!==null){const Xe=a.prompt,qe=(oe=Object.entries(g).find(([,ct])=>ct.name===Xe.name))==null?void 0:oe[0];qe&&(st="configured",it=qe)}else rt=typeof a.prompt=="string"?a.prompt:"";const tt=((X=a.tools)==null?void 0:X.map(Xe=>{var qe;return((qe=Object.entries(r).find(([,ct])=>ct.name===Xe.name))==null?void 0:qe[0])||""}).filter(Boolean))||[],ze=((Z=a.guardrails)==null?void 0:Z.map(Xe=>{var qe;return((qe=Object.entries(c).find(([,ct])=>ct.name===Xe.name))==null?void 0:qe[0])||""}).filter(Boolean))||[],Le=((me=a.middleware)==null?void 0:me.map(Xe=>{var qe;return((qe=Object.entries(d).find(([,ct])=>ct.name===Xe.name))==null?void 0:qe[0])||""}).filter(Boolean))||[];let Ke=!1,Ne="json",et="",lt=!0;a.response_format&&(Ke=!0,typeof a.response_format=="string"?(et=a.response_format,Ne=et.trim().startsWith("{")||et.trim().startsWith("[")?"json":"class"):typeof a.response_format=="object"&&(et=a.response_format.response_schema||"",Ne=et.trim().startsWith("{")||et.trim().startsWith("[")?"json":"class",lt=a.response_format.use_tool??!0));const ot={refName:n,name:a.name,description:a.description||"",modelKey:Re,promptRef:it,prompt:rt,handoffPrompt:a.handoff_prompt||"",selectedTools:tt,selectedGuardrails:ze,selectedMiddleware:Le,enableResponseFormat:Ke,schemaType:Ne,responseSchema:et,useTool:lt},ve={refName:n,name:a.name,description:a.description||"",modelKey:Re,promptRef:it,prompt:rt,handoffPrompt:a.handoff_prompt||"",selectedTools:[...tt],selectedGuardrails:[...ze],selectedMiddleware:[...Le],enableResponseFormat:Ke,schemaType:Ne,responseSchema:et,useTool:lt};x(st),N(ot),M(ve),W(st)}else{const Re={refName:"",name:"",description:"",modelKey:"",promptRef:"",prompt:"You are a helpful assistant.",handoffPrompt:"",selectedTools:[],selectedGuardrails:[],selectedMiddleware:[],enableResponseFormat:!1,schemaType:"json",responseSchema:"",useTool:!0};x("inline"),N(Re),M(null),W("inline"),L(!1),k("")}},[e,a,n,h,g,r,c]);const z=J=>{if(J.preventDefault(),!p.refName||!p.name||!p.modelKey||!h[p.modelKey])return;let oe;_==="configured"&&p.promptRef&&g[p.promptRef]?oe=g[p.promptRef]:oe=p.prompt||void 0;let X;p.enableResponseFormat&&p.responseSchema&&(X={response_schema:p.responseSchema,use_tool:p.useTool});const Z={name:p.name,description:p.description||void 0,model:h[p.modelKey],prompt:oe,handoff_prompt:p.handoffPrompt||void 0,tools:p.selectedTools.map(me=>r[me]).filter(Boolean),guardrails:p.selectedGuardrails.map(me=>c[me]).filter(Boolean),middleware:p.selectedMiddleware.map(me=>d[me]).filter(Boolean),response_format:X};n?n!==p.refName?(y(n),v(p.refName,Z)):S(p.refName,Z):v(p.refName,Z),s()},te=A.useMemo(()=>!n||!P||p.refName!==P.refName||p.name!==P.name||p.description!==P.description||p.modelKey!==P.modelKey||p.prompt!==P.prompt||p.handoffPrompt!==P.handoffPrompt||p.promptRef!==P.promptRef||_!==O||p.enableResponseFormat!==P.enableResponseFormat||p.schemaType!==P.schemaType||p.responseSchema!==P.responseSchema||p.useTool!==P.useTool||p.selectedTools.length!==P.selectedTools.length||!p.selectedTools.every((J,oe)=>J===P.selectedTools[oe])||p.selectedGuardrails.length!==P.selectedGuardrails.length||!p.selectedGuardrails.every((J,oe)=>J===P.selectedGuardrails[oe])||p.selectedMiddleware.length!==P.selectedMiddleware.length||!p.selectedMiddleware.every((J,oe)=>J===P.selectedMiddleware[oe]),[p,P,_,O,n]);return t.jsx(ws,{isOpen:e,onClose:s,title:n?"Edit Agent":"Add Agent",description:"Configure an AI agent with its model, tools, and prompts",size:"xl",children:t.jsxs("form",{onSubmit:z,className:"space-y-4",children:[i.length===0&&t.jsx("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-lg p-4 text-amber-400 text-sm",children:"You need to add an LLM first before creating an agent."}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(U,{label:"Reference Name",placeholder:"e.g., Customer Service Agent",value:p.refName,onChange:J=>N({...p,refName:Ot(J.target.value)}),hint:"Type naturally - spaces become underscores",required:!0}),t.jsx(ae,{label:"Model",options:i,value:p.modelKey,onChange:J=>N({...p,modelKey:J.target.value}),placeholder:"Select an LLM...",required:!0})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(U,{label:"Display Name",placeholder:"e.g., Customer Service Agent",value:p.name,onChange:J=>{const oe=J.target.value,X=!n&&(!p.refName||p.refName===cd(p.name));N({...p,name:oe,refName:X?cd(oe):p.refName})},hint:"Human-readable name for this agent",required:!0}),t.jsx(U,{label:"Description",placeholder:"Brief description of this agent's purpose",value:p.description,onChange:J=>N({...p,description:J.target.value})})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"System Prompt"}),t.jsxs("div",{className:"inline-flex rounded-lg bg-slate-900/50 p-0.5",children:[t.jsx("button",{type:"button",onClick:()=>{x("inline"),N({...p,promptRef:""})},className:`px-3 py-1 text-xs rounded-md font-medium transition-all duration-150 ${_==="inline"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Inline"}),t.jsx("button",{type:"button",onClick:()=>{x("configured"),N({...p,prompt:""})},className:`px-3 py-1 text-xs rounded-md font-medium transition-all duration-150 ${_==="configured"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Configured"})]})]}),_==="configured"?t.jsxs("div",{className:"space-y-2",children:[t.jsx(ae,{value:p.promptRef,onChange:J=>N({...p,promptRef:J.target.value}),options:m,placeholder:"Select a configured prompt..."}),p.promptRef&&g[p.promptRef]&&t.jsxs("div",{className:"p-3 bg-slate-800/50 rounded-lg border border-slate-700",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx(Ya,{className:"w-4 h-4 text-violet-400"}),t.jsx("span",{className:"text-sm font-medium text-slate-300",children:g[p.promptRef].name})]}),g[p.promptRef].description&&t.jsx("p",{className:"text-xs text-slate-400 mb-2",children:g[p.promptRef].description}),g[p.promptRef].default_template&&t.jsxs("pre",{className:"text-xs text-slate-500 bg-slate-900/50 p-2 rounded overflow-auto max-h-32",children:[(K=g[p.promptRef].default_template)==null?void 0:K.substring(0,300),(((he=g[p.promptRef].default_template)==null?void 0:he.length)||0)>300?"...":""]})]}),t.jsx("p",{className:"text-xs text-slate-500",children:"Reference a prompt defined in the Prompts section. The prompt will be resolved at runtime."})]}):t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs("button",{type:"button",onClick:()=>L(!D),className:"flex items-center space-x-1.5 px-3 py-1.5 text-xs rounded-lg font-medium bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-purple-300 border border-purple-500/30 hover:from-purple-500/30 hover:to-pink-500/30 transition-all",disabled:f,children:[t.jsx(Rt,{className:"w-3.5 h-3.5"}),t.jsx("span",{children:"AI Assistant"})]}),p.prompt&&p.prompt!=="You are a helpful assistant."&&t.jsxs("button",{type:"button",onClick:()=>ce(!0),className:"flex items-center space-x-1.5 px-3 py-1.5 text-xs rounded-lg font-medium bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-purple-300 border border-purple-500/30 hover:from-purple-500/30 hover:to-pink-500/30 transition-all",disabled:f,children:[f?t.jsx(Nt,{className:"w-3.5 h-3.5 animate-spin"}):t.jsx(Rt,{className:"w-3.5 h-3.5"}),t.jsx("span",{children:"Improve Prompt"})]})]})}),D&&t.jsxs("div",{className:"p-3 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-lg border border-purple-500/30 space-y-3",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Rt,{className:"w-4 h-4 text-purple-400"}),t.jsx("span",{className:"text-sm font-medium text-purple-300",children:"Generate Prompt with AI"})]}),t.jsx("p",{className:"text-xs text-slate-400",children:"Describe what this agent should do and I'll generate an optimized prompt for you."}),t.jsx(Jt,{value:R,onChange:J=>k(J.target.value),rows:3,placeholder:"e.g., This agent helps customers find products in a hardware store. It should be friendly and knowledgeable about tools and home improvement..."}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-xs font-medium text-slate-400",children:"Template Parameters"}),t.jsxs("p",{className:"text-xs text-slate-500",children:["Select variables to include in the prompt (e.g., ","{user_id}",")"]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:vl.map(J=>t.jsx("button",{type:"button",onClick:()=>{V.includes(J.value)?B(V.filter(oe=>oe!==J.value)):B([...V,J.value])},className:`px-2 py-1 text-xs rounded-md transition-all ${V.includes(J.value)?"bg-purple-500/30 text-purple-300 border border-purple-500/50":"bg-slate-800 text-slate-400 border border-slate-700 hover:border-slate-600"}`,children:J.label},J.value))}),V.filter(J=>!vl.map(oe=>oe.value).includes(J)).length>0&&t.jsx("div",{className:"flex flex-wrap gap-2",children:V.filter(J=>!vl.map(oe=>oe.value).includes(J)).map(J=>t.jsxs("span",{className:"px-2 py-1 text-xs rounded-md bg-blue-500/30 text-blue-300 border border-blue-500/50 flex items-center space-x-1",children:[t.jsx("span",{children:J}),t.jsx("button",{type:"button",onClick:()=>B(V.filter(oe=>oe!==J)),className:"hover:text-red-300",children:""})]},J))}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"text",value:T,onChange:J=>F(J.target.value.replace(/[^a-z0-9_]/gi,"_").toLowerCase()),placeholder:"Add custom parameter...",className:"flex-1 px-2 py-1 text-xs bg-slate-800 border border-slate-700 rounded-md text-slate-300 placeholder-slate-500 focus:border-purple-500 focus:outline-none",onKeyDown:J=>{J.key==="Enter"&&(J.preventDefault(),H())}}),t.jsx("button",{type:"button",onClick:H,disabled:!T,className:"px-2 py-1 text-xs bg-slate-700 text-slate-300 rounded-md hover:bg-slate-600 disabled:opacity-50",children:"Add"})]})]}),t.jsxs("div",{className:"flex justify-end space-x-2",children:[t.jsx(ee,{type:"button",variant:"secondary",size:"sm",onClick:()=>{L(!1),k("")},disabled:f,children:"Cancel"}),t.jsx(ee,{type:"button",size:"sm",onClick:()=>ce(!1),disabled:f||!R&&!p.name&&!p.description,className:"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600",children:f?t.jsxs(t.Fragment,{children:[t.jsx(Nt,{className:"w-4 h-4 mr-1.5 animate-spin"}),"Generating..."]}):t.jsxs(t.Fragment,{children:[t.jsx(Rt,{className:"w-4 h-4 mr-1.5"}),"Generate Prompt"]})})]})]}),t.jsx(Jt,{value:p.prompt,onChange:J=>N({...p,prompt:J.target.value}),rows:8,hint:"The main instructions for this agent",placeholder:"You are a helpful assistant..."})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Handoff Prompt"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs("button",{type:"button",onClick:()=>se(!1),className:"flex items-center space-x-1.5 px-3 py-1.5 text-xs rounded-lg font-medium bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-purple-300 border border-purple-500/30 hover:from-purple-500/30 hover:to-pink-500/30 transition-all",disabled:w||!p.prompt&&!p.description,title:!p.prompt&&!p.description?"Add a system prompt or description first":"Generate handoff prompt with AI",children:[w?t.jsx(Nt,{className:"w-3.5 h-3.5 animate-spin"}):t.jsx(Rt,{className:"w-3.5 h-3.5"}),t.jsx("span",{children:"AI Assistant"})]}),p.handoffPrompt&&t.jsxs("button",{type:"button",onClick:()=>se(!0),className:"flex items-center space-x-1.5 px-3 py-1.5 text-xs rounded-lg font-medium bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-purple-300 border border-purple-500/30 hover:from-purple-500/30 hover:to-pink-500/30 transition-all",disabled:w,children:[w?t.jsx(Nt,{className:"w-3.5 h-3.5 animate-spin"}):t.jsx(Rt,{className:"w-3.5 h-3.5"}),t.jsx("span",{children:"Improve Prompt"})]})]}),t.jsx(Jt,{placeholder:"Describe when this agent should be called in a multi-agent system...",value:p.handoffPrompt,onChange:J=>N({...p,handoffPrompt:J.target.value}),rows:3,hint:"Used by the supervisor to decide when to route to this agent"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(Ua,{label:"Tools",options:l,value:p.selectedTools,onChange:J=>N({...p,selectedTools:J}),placeholder:"Select tools...",hint:"Tools this agent can use"}),t.jsx(Ua,{label:"Guardrails",options:o,value:p.selectedGuardrails,onChange:J=>N({...p,selectedGuardrails:J}),placeholder:"Select guardrails...",hint:"Safety checks for this agent"})]}),t.jsx(Ua,{label:"Middleware",options:u,value:p.selectedMiddleware,onChange:J=>N({...p,selectedMiddleware:J}),placeholder:"Select middleware...",hint:"Middleware to customize agent execution behavior"}),t.jsxs("div",{className:"space-y-3 p-4 bg-slate-800/30 rounded-lg border border-slate-700/50",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Response Format"}),t.jsx(Se,{variant:"info",className:"text-xs",children:"Optional"})]}),t.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:p.enableResponseFormat,onChange:J=>{N({...p,enableResponseFormat:J.target.checked}),$(null)},className:"rounded border-slate-600 text-violet-500 focus:ring-violet-500 focus:ring-offset-slate-900"}),t.jsx("span",{className:"text-xs text-slate-400",children:"Enable"})]})]}),p.enableResponseFormat&&t.jsxs("div",{className:"space-y-3 pt-2",children:[t.jsx("p",{className:"text-xs text-slate-400",children:"Configure structured response output using JSON schema or a fully qualified class name."}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("label",{className:"text-xs font-medium text-slate-400",children:"Schema Type:"}),t.jsxs("div",{className:"inline-flex rounded-lg bg-slate-900/50 p-0.5",children:[t.jsx("button",{type:"button",onClick:()=>{N({...p,schemaType:"json"}),$(null)},className:`px-3 py-1 text-xs rounded-md font-medium transition-all duration-150 ${p.schemaType==="json"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"JSON Schema"}),t.jsx("button",{type:"button",onClick:()=>{N({...p,schemaType:"class"}),$(null)},className:`px-3 py-1 text-xs rounded-md font-medium transition-all duration-150 ${p.schemaType==="class"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Class Name"})]})]}),p.schemaType==="json"?t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-xs font-medium text-slate-400",children:"JSON Schema"}),t.jsx(ee,{type:"button",variant:"secondary",size:"sm",onClick:q,children:"Validate"})]}),t.jsx(Jt,{value:p.responseSchema,onChange:J=>{N({...p,responseSchema:J.target.value}),$(null)},rows:6,placeholder:'{"type": "object", "properties": {...}}',hint:"Enter a JSON schema to define the response structure"}),E&&t.jsx("div",{className:`p-2 rounded-lg text-xs ${E.valid?"bg-emerald-500/10 border border-emerald-500/30 text-emerald-400":"bg-red-500/10 border border-red-500/30 text-red-400"}`,children:E.message})]}):t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-xs font-medium text-slate-400",children:"Fully Qualified Class Name"}),t.jsx(U,{value:p.responseSchema,onChange:J=>N({...p,responseSchema:J.target.value}),placeholder:"myapp.models.ResponseModel",hint:"e.g., myapp.models.MyResponseModel"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-xs font-medium text-slate-400",children:"Strategy (use_tool)"}),t.jsx(ae,{value:p.useTool===null?"auto":p.useTool?"tool":"provider",onChange:J=>{const oe=J.target.value;N({...p,useTool:oe==="auto"?null:oe==="tool"})},options:[{value:"auto",label:"Auto-detect"},{value:"tool",label:"Tool Strategy (function calling)"},{value:"provider",label:"Provider Strategy (native)"}]}),t.jsx("p",{className:"text-xs text-slate-500",children:"Auto-detect lets LangChain choose the best strategy. Tool uses function calling (recommended). Provider uses native structured output."})]})]})]}),p.refName&&od(p.refName,b,n)&&t.jsxs("div",{className:"p-3 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm",children:['A resource with reference name "',p.refName,'" already exists. Please choose a unique name.']}),t.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[t.jsx(ee,{variant:"secondary",type:"button",onClick:s,children:"Cancel"}),t.jsx(ee,{type:"submit",disabled:i.length===0||!!n&&!te||od(p.refName,b,n),children:n?"Save Changes":"Add Agent"})]})]})})}function cs(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean")return String(e);if(typeof e=="object"){const s=e;if("value"in s)return String(s.value);if("env"in s&&s.default_value!==void 0)return String(s.default_value);if("env"in s)return`$${s.env}`;if("scope"in s&&"secret"in s)return`{{secrets/${s.scope}/${s.secret}}}`}return""}async function yb(e){const s=await fetch("/api/ai/generate-supervisor-prompt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){const n=await s.json();throw new Error(n.error||"Failed to generate supervisor prompt")}return(await s.json()).prompt}const jb=[{value:"TRACE",label:"TRACE"},{value:"DEBUG",label:"DEBUG"},{value:"INFO",label:"INFO"},{value:"WARNING",label:"WARNING"},{value:"ERROR",label:"ERROR"}],_b=[{value:"Small",label:"Small"},{value:"Medium",label:"Medium"},{value:"Large",label:"Large"}];function Nb(e){return e.trim().replace(/[\s-]+/g,"_").replace(/([a-z])([A-Z])/g,"$1_$2").replace(/[^a-zA-Z0-9_]/g,"").toLowerCase().replace(/_+/g,"_").replace(/^_|_$/g,"")}function wb(){var Be,Ss,Cs,ns,ks,Oe,xt,wt,St,Ce,Ye,ut;const{config:e,updateApp:s,setHasUnsavedAppChanges:a}=nt(),n=e.app,i=e.schemas||{},l=e.agents||{},o=((Be=e.resources)==null?void 0:Be.llms)||{},u=e.tools||{},m=e.memory,[h,r]=A.useState(()=>{var ne,be;let G="",ue="",de="";if((ne=n==null?void 0:n.registered_model)!=null&&ne.schema){const le=n.registered_model.schema,je=cs(le.catalog_name),_e=cs(le.schema_name),Fe=Object.entries(i).find(([,mt])=>cs(mt.catalog_name)===je&&cs(mt.schema_name)===_e);Fe?G=Fe[0]:(ue=je,de=_e)}let ie="";return n!=null&&n.service_principal&&typeof n.service_principal=="string"&&(ie=n.service_principal.startsWith("*")?n.service_principal.slice(1):n.service_principal),{name:(n==null?void 0:n.name)||"",description:(n==null?void 0:n.description)||"",logLevel:(n==null?void 0:n.log_level)||"INFO",endpointName:(n==null?void 0:n.endpoint_name)||"",modelName:((be=n==null?void 0:n.registered_model)==null?void 0:be.name)||"",modelSchema:G,directCatalog:ue,directSchema:de,workloadSize:(n==null?void 0:n.workload_size)||"Small",scaleToZero:(n==null?void 0:n.scale_to_zero)??!0,deploymentTarget:(n==null?void 0:n.deployment_target)||"model_serving",pythonVersion:(n==null?void 0:n.python_version)||"",servicePrincipalRef:ie}}),[c,d]=A.useState(()=>{var ue;const G=Object.keys(i).length>0;if((ue=n==null?void 0:n.registered_model)!=null&&ue.schema){const de=n.registered_model.schema,ie=cs(de.catalog_name),ne=cs(de.schema_name);return Object.entries(i).find(([,le])=>cs(le.catalog_name)===ie&&cs(le.schema_name)===ne)?"configured":"select"}return G?"configured":"select"}),{data:g}=en(),{data:v}=ea(h.directCatalog||null),S=g||[],y=v||[],[b,_]=A.useState(""),[x,f]=A.useState(""),[C,w]=A.useState((n==null?void 0:n.tags)||{}),[I,R]=A.useState(""),[k,D]=A.useState(""),L=[{value:"CAN_MANAGE",label:"Can Manage"},{value:"CAN_QUERY",label:"Can Query"},{value:"CAN_VIEW",label:"Can View"},{value:"CAN_REVIEW",label:"Can Review"},{value:"NO_PERMISSIONS",label:"No Permissions"}],[V,B]=A.useState(((Ss=n==null?void 0:n.permissions)==null?void 0:Ss.map(G=>({principals:G.principals||[],entitlements:G.entitlements||[]})))||[]),[T,F]=A.useState(""),[E,$]=A.useState(()=>{const G=(n==null?void 0:n.environment_vars)||{};return Object.entries(G).map(([ue,de])=>typeof de=="string"&&de.startsWith("*")?{name:ue,source:"variable",value:"",variableRef:de.slice(1)}:{name:ue,source:"manual",value:String(de),variableRef:""})}),[p,N]=A.useState(()=>n!=null&&n.agents&&Array.isArray(n.agents)&&n.agents.length>0?n.agents.map(G=>{var de;return((de=Object.entries(l).find(([,ie])=>ie.name===G.name))==null?void 0:de[0])||""}).filter(Boolean):Object.keys(l)),[P,M]=A.useState((ns=(Cs=e.app)==null?void 0:Cs.orchestration)!=null&&ns.supervisor?"supervisor":(Oe=(ks=e.app)==null?void 0:ks.orchestration)!=null&&Oe.swarm?"swarm":"none"),[O,W]=A.useState(((St=(wt=(xt=e.app)==null?void 0:xt.orchestration)==null?void 0:wt.supervisor)==null?void 0:St.prompt)||""),[q,ce]=A.useState(!1),[se,H]=A.useState(!1),[z,te]=A.useState(""),[K,he]=A.useState(()=>{var ue,de,ie,ne;const G=(ne=(ie=(de=(ue=e.app)==null?void 0:ue.orchestration)==null?void 0:de.supervisor)==null?void 0:ie.model)==null?void 0:ne.name;if(G){const be=Object.entries(o).find(([,le])=>le.name===G);return be?be[0]:""}return""}),[J,oe]=A.useState(()=>{var ue,de,ie;const G=(ie=(de=(ue=e.app)==null?void 0:ue.orchestration)==null?void 0:de.swarm)==null?void 0:ie.default_agent;return typeof G=="string"?G:G&&"name"in G?G.name:""}),[X,Z]=A.useState(()=>{var ue,de,ie;const G=(ie=(de=(ue=e.app)==null?void 0:ue.orchestration)==null?void 0:de.swarm)==null?void 0:ie.handoffs;return G?Object.entries(G).map(([ne,be])=>{if(be==null)return{agentName:ne,type:"any",targets:[]};if(Array.isArray(be)&&be.length===0)return{agentName:ne,type:"none",targets:[]};const le=be.map(je=>{var _e;return typeof je=="string"?{agent:je,isDeterministic:!1}:"agent"in je&&je.agent!==void 0?{agent:typeof je.agent=="string"?je.agent:((_e=je.agent)==null?void 0:_e.name)||"",isDeterministic:je.is_deterministic===!0}:"name"in je&&je.name!==void 0?{agent:je.name,isDeterministic:!1}:{agent:"",isDeterministic:!1}}).filter(je=>je.agent!=="");return{agentName:ne,type:"specific",targets:le}}):[]}),[me,Re]=A.useState(()=>{var ue,de,ie;const G=(ie=(de=(ue=e.app)==null?void 0:ue.orchestration)==null?void 0:de.supervisor)==null?void 0:ie.tools;return!G||!Array.isArray(G)?[]:G.map(ne=>{var je;const be=typeof ne=="string"?ne:ne==null?void 0:ne.name;return((je=Object.entries(u).find(([,_e])=>_e.name===be))==null?void 0:je[0])||""}).filter(Boolean)}),[st,it]=A.useState(()=>{var de,ie,ne;const G=(ne=(ie=(de=e.app)==null?void 0:de.orchestration)==null?void 0:ie.supervisor)==null?void 0:ne.middleware;if(!G||!Array.isArray(G))return[];const ue=e.middleware||{};return G.map(be=>{var _e;const le=typeof be=="string"?be:be==null?void 0:be.name;return le&&((_e=Object.entries(ue).find(([,Fe])=>(Fe==null?void 0:Fe.name)===le))==null?void 0:_e[0])||""}).filter(Boolean)}),[rt,tt]=A.useState(()=>{var de,ie,ne;const G=(ne=(ie=(de=e.app)==null?void 0:de.orchestration)==null?void 0:ie.swarm)==null?void 0:ne.middleware;if(!G||!Array.isArray(G))return[];const ue=e.middleware||{};return G.map(be=>{var _e;const le=typeof be=="string"?be:be==null?void 0:be.name;return le&&((_e=Object.entries(ue).find(([,Fe])=>(Fe==null?void 0:Fe.name)===le))==null?void 0:_e[0])||""}).filter(Boolean)}),[ze,Le]=A.useState(()=>{var ue,de,ie;const G=(de=(ue=e.app)==null?void 0:ue.orchestration)==null?void 0:de.memory;if(G){if(typeof G=="string"&&G.startsWith("*"))return G.slice(1);if((ie=e.memory)!=null&&ie.refName)return e.memory.refName}return""}),[Ke,Ne]=A.useState(!!(n!=null&&n.chat_history)),[et,lt]=A.useState(()=>{var ue,de;const G=(de=(ue=n==null?void 0:n.chat_history)==null?void 0:ue.model)==null?void 0:de.name;if(G){const ie=Object.entries(o).find(([,ne])=>ne.name===G);return ie?ie[0]:""}return""}),[ot,ve]=A.useState(((Ce=n==null?void 0:n.chat_history)==null?void 0:Ce.max_tokens)||2048),[Xe,qe]=A.useState(()=>{var G,ue;return(G=n==null?void 0:n.chat_history)!=null&&G.max_tokens_before_summary?!0:!((ue=n==null?void 0:n.chat_history)!=null&&ue.max_messages_before_summary)}),[ct,At]=A.useState(((Ye=n==null?void 0:n.chat_history)==null?void 0:Ye.max_tokens_before_summary)||20480),[Qt,zt]=A.useState(((ut=n==null?void 0:n.chat_history)==null?void 0:ut.max_messages_before_summary)||10),yt=A.useRef(!1),_t=(()=>{var Ht,Xt,rs,es,It,bs,Hs,Ls,Bs,$s,na,ra,Ws,Ma,Ra,Ta,Ea,Aa,Pa,Ia,Oa,La,$a,Ct,Bt,hs,vs,is,xa;if(h.name!==((n==null?void 0:n.name)||"")||h.description!==((n==null?void 0:n.description)||"")||h.logLevel!==((n==null?void 0:n.log_level)||"INFO")||h.endpointName!==((n==null?void 0:n.endpoint_name)||"")||h.modelName!==(((Ht=n==null?void 0:n.registered_model)==null?void 0:Ht.name)||"")||h.workloadSize!==((n==null?void 0:n.workload_size)||"Small")||h.scaleToZero!==((n==null?void 0:n.scale_to_zero)??!0)||h.deploymentTarget!==((n==null?void 0:n.deployment_target)||"model_serving")||h.pythonVersion!==((n==null?void 0:n.python_version)||""))return!0;let G="";if((Xt=n==null?void 0:n.registered_model)!=null&&Xt.schema){const gt=n.registered_model.schema,ls=cs(gt.catalog_name),kt=cs(gt.schema_name),Je=Object.entries(i).find(([,jt])=>cs(jt.catalog_name)===ls&&cs(jt.schema_name)===kt);G=Je?Je[0]:""}if(h.modelSchema!==G)return!0;let ue;n!=null&&n.agents&&Array.isArray(n.agents)&&n.agents.length>0?ue=n.agents.map(gt=>{var kt;return((kt=Object.entries(l).find(([,Je])=>Je.name===gt.name))==null?void 0:kt[0])||""}).filter(Boolean).sort():ue=Object.keys(l).sort();const de=[...p].sort();if(JSON.stringify(ue)!==JSON.stringify(de))return!0;let ie=(rs=n==null?void 0:n.orchestration)!=null&&rs.supervisor?"supervisor":(es=n==null?void 0:n.orchestration)!=null&&es.swarm?"swarm":"none";if((ie==="supervisor"||ie==="swarm")&&de.length<=1&&(ie="none"),P!==ie)return!0;if(P==="supervisor"){const gt=(Hs=(bs=(It=n==null?void 0:n.orchestration)==null?void 0:It.supervisor)==null?void 0:bs.model)==null?void 0:Hs.name,ls=K?(Ls=o[K])==null?void 0:Ls.name:"";if(gt!==ls||O!==((($s=(Bs=n==null?void 0:n.orchestration)==null?void 0:Bs.supervisor)==null?void 0:$s.prompt)||""))return!0;const kt=(((ra=(na=n==null?void 0:n.orchestration)==null?void 0:na.supervisor)==null?void 0:ra.tools)||[]).map(Ue=>{var Us;const ps=typeof Ue=="string"?Ue:Ue==null?void 0:Ue.name;return((Us=Object.entries(u).find(([,Vs])=>Vs.name===ps))==null?void 0:Us[0])||""}).filter(Boolean).sort(),Je=[...me].sort();if(JSON.stringify(kt)!==JSON.stringify(Je))return!0;const jt=e.middleware||{},Ms=(((Ma=(Ws=n==null?void 0:n.orchestration)==null?void 0:Ws.supervisor)==null?void 0:Ma.middleware)||[]).map(Ue=>{var Us;const ps=typeof Ue=="string"?Ue:Ue==null?void 0:Ue.name;return ps&&((Us=Object.entries(jt).find(([,Vs])=>(Vs==null?void 0:Vs.name)===ps))==null?void 0:Us[0])||""}).filter(Boolean).sort(),ht=[...st].sort();if(JSON.stringify(Ms)!==JSON.stringify(ht))return!0}else if(P==="swarm"){const gt=(Ta=(Ra=n==null?void 0:n.orchestration)==null?void 0:Ra.swarm)==null?void 0:Ta.default_agent,ls=typeof gt=="string"?gt:(gt==null?void 0:gt.name)||"";if(J!==ls)return!0;const kt=((Aa=(Ea=n==null?void 0:n.orchestration)==null?void 0:Ea.swarm)==null?void 0:Aa.handoffs)||{},Je={};if(X.forEach(Ue=>{Ue.type==="any"?Je[Ue.agentName]=null:Ue.type==="none"?Je[Ue.agentName]=[]:Je[Ue.agentName]=Ue.targets.map(ps=>ps.isDeterministic?{agent:ps.agent,is_deterministic:!0}:ps.agent)}),JSON.stringify(kt)!==JSON.stringify(Je))return!0;const jt=e.middleware||{},Ms=(((Ia=(Pa=n==null?void 0:n.orchestration)==null?void 0:Pa.swarm)==null?void 0:Ia.middleware)||[]).map(Ue=>{var Us;const ps=typeof Ue=="string"?Ue:Ue==null?void 0:Ue.name;return ps&&((Us=Object.entries(jt).find(([,Vs])=>(Vs==null?void 0:Vs.name)===ps))==null?void 0:Us[0])||""}).filter(Boolean).sort(),ht=[...rt].sort();if(JSON.stringify(Ms)!==JSON.stringify(ht))return!0}const ne=(Oa=n==null?void 0:n.orchestration)==null?void 0:Oa.memory;let be="";if(typeof ne=="string"&&ne.startsWith("*")?be=ne.slice(1):(La=e.memory)!=null&&La.refName&&ne&&(be=e.memory.refName),ze!==be)return!0;const le=(n==null?void 0:n.tags)||{};if(JSON.stringify(le)!==JSON.stringify(C))return!0;const je=(n==null?void 0:n.permissions)||[];if(JSON.stringify(je)!==JSON.stringify(V))return!0;const _e=(n==null?void 0:n.environment_vars)||{},Fe={};if(E.forEach(gt=>{gt.name&&(Fe[gt.name]=gt.source==="variable"&&gt.variableRef?`*${gt.variableRef}`:gt.value)}),JSON.stringify(_e)!==JSON.stringify(Fe))return!0;let mt="";if(n!=null&&n.service_principal&&typeof n.service_principal=="string"&&(mt=n.service_principal.startsWith("*")?n.service_principal.slice(1):n.service_principal),h.servicePrincipalRef!==mt)return!0;const Ve=!!(n!=null&&n.chat_history);if(Ke!==Ve)return!0;if(Ke){const gt=(Ct=($a=n==null?void 0:n.chat_history)==null?void 0:$a.model)==null?void 0:Ct.name,ls=et?(Bt=o[et])==null?void 0:Bt.name:"";if(gt!==ls||ot!==(((hs=n==null?void 0:n.chat_history)==null?void 0:hs.max_tokens)||2048))return!0;const kt=!!((vs=n==null?void 0:n.chat_history)!=null&&vs.max_tokens_before_summary);if(Xe!==kt)return!0;if(Xe){if(ct!==(((is=n==null?void 0:n.chat_history)==null?void 0:is.max_tokens_before_summary)||20480))return!0}else if(Qt!==(((xa=n==null?void 0:n.chat_history)==null?void 0:xa.max_messages_before_summary)||10))return!0}return!1})(),Pt=[];h.name.trim()||Pt.push("Application name is required"),h.modelName.trim()||Pt.push("Model name is required"),p.length===0&&Pt.push("At least one agent must be selected"),P==="supervisor"&&!K&&Pt.push("Supervisor orchestration requires an LLM");const Kt=Pt.length===0,re=_t&&Kt;A.useEffect(()=>{a(_t)},[_t,a]);const fe=[{value:"",label:"Select an LLM..."},...Object.entries(o).map(([G,ue])=>({value:G,label:`${G} (${ue.name})`}))],Me=Object.keys(l),we=p.filter(G=>l[G]),We=[{value:"",label:p.length===0?"Select agents for app first...":"Select an agent..."},...we.map(G=>({value:G,label:l[G].name}))],He=e.middleware||{},bt=Object.entries(He).map(([G])=>({value:G,label:G})),Qe=[{value:"any",label:"Any Agent (can hand off to all)"},{value:"specific",label:"Specific Agents (select targets)"},{value:"none",label:"No Handoffs (terminal agent)"}],dt=we.filter(G=>!X.some(ue=>ue.agentName===G));A.useEffect(()=>{var _e,Fe,mt,Ve,Ht,Xt,rs,es,It,bs,Hs,Ls,Bs,$s,na,ra,Ws,Ma,Ra,Ta,Ea,Aa,Pa,Ia,Oa,La,$a;let G="",ue="",de="",ie=Object.keys(i).length>0?"configured":"select";if((_e=n==null?void 0:n.registered_model)!=null&&_e.schema){const Ct=n.registered_model.schema,Bt=cs(Ct.catalog_name),hs=cs(Ct.schema_name),vs=Object.entries(i).find(([,is])=>cs(is.catalog_name)===Bt&&cs(is.schema_name)===hs);vs?(G=vs[0],ie="configured"):(ue=Bt,de=hs,ie="select")}let ne="";n!=null&&n.service_principal&&typeof n.service_principal=="string"&&(ne=n.service_principal.startsWith("*")?n.service_principal.slice(1):n.service_principal),r({name:(n==null?void 0:n.name)||"",description:(n==null?void 0:n.description)||"",logLevel:(n==null?void 0:n.log_level)||"INFO",endpointName:(n==null?void 0:n.endpoint_name)||"",modelName:((Fe=n==null?void 0:n.registered_model)==null?void 0:Fe.name)||"",modelSchema:G,directCatalog:ue,directSchema:de,workloadSize:(n==null?void 0:n.workload_size)||"Small",scaleToZero:(n==null?void 0:n.scale_to_zero)??!0,deploymentTarget:(n==null?void 0:n.deployment_target)||"model_serving",pythonVersion:(n==null?void 0:n.python_version)||"",servicePrincipalRef:ne}),d(ie);let be=[];if(n!=null&&n.agents&&Array.isArray(n.agents)&&n.agents.length>0?(be=n.agents.map(Ct=>{var hs;return((hs=Object.entries(l).find(([,vs])=>vs.name===Ct.name))==null?void 0:hs[0])||""}).filter(Boolean),N(be)):(be=Object.keys(l),N(be)),!yt.current){yt.current=!0;let Ct=(mt=n==null?void 0:n.orchestration)!=null&&mt.supervisor?"supervisor":(Ve=n==null?void 0:n.orchestration)!=null&&Ve.swarm?"swarm":"none";(Ct==="supervisor"||Ct==="swarm")&&be.length<=1&&(Ct="none"),M(Ct);const Bt=(rs=(Xt=(Ht=n==null?void 0:n.orchestration)==null?void 0:Ht.supervisor)==null?void 0:Xt.model)==null?void 0:rs.name;if(Bt){const kt=Object.entries(o).find(([,Je])=>Je.name===Bt);he(kt?kt[0]:"")}else he("");W(((It=(es=n==null?void 0:n.orchestration)==null?void 0:es.supervisor)==null?void 0:It.prompt)||"");const hs=(Hs=(bs=n==null?void 0:n.orchestration)==null?void 0:bs.supervisor)==null?void 0:Hs.tools;if(hs&&Array.isArray(hs)){const kt=hs.map(Je=>{var ht;const jt=typeof Je=="string"?Je:Je==null?void 0:Je.name;return((ht=Object.entries(u).find(([,Ue])=>Ue.name===jt))==null?void 0:ht[0])||""}).filter(Boolean);Re(kt)}else Re([]);const vs=(Bs=(Ls=n==null?void 0:n.orchestration)==null?void 0:Ls.supervisor)==null?void 0:Bs.middleware;if(vs&&Array.isArray(vs)){const kt=vs.map(Je=>{var ht;const jt=typeof Je=="string"?Je:Je==null?void 0:Je.name;return jt&&((ht=Object.entries(He).find(([,Ue])=>(Ue==null?void 0:Ue.name)===jt))==null?void 0:ht[0])||""}).filter(Boolean);it(kt)}else it([]);const is=(na=($s=n==null?void 0:n.orchestration)==null?void 0:$s.swarm)==null?void 0:na.default_agent;typeof is=="string"?oe(is):is&&"name"in is?oe(is.name):oe("");const xa=(Ws=(ra=n==null?void 0:n.orchestration)==null?void 0:ra.swarm)==null?void 0:Ws.handoffs;if(xa){const kt=Object.entries(xa).map(([Je,jt])=>{if(jt==null)return{agentName:Je,type:"any",targets:[]};if(Array.isArray(jt)&&jt.length===0)return{agentName:Je,type:"none",targets:[]};const Ms=jt.map(ht=>{var Ue;return typeof ht=="string"?{agent:ht,isDeterministic:!1}:"agent"in ht&&ht.agent!==void 0?{agent:typeof ht.agent=="string"?ht.agent:((Ue=ht.agent)==null?void 0:Ue.name)||"",isDeterministic:ht.is_deterministic===!0}:"name"in ht&&ht.name!==void 0?{agent:ht.name,isDeterministic:!1}:{agent:"",isDeterministic:!1}}).filter(ht=>ht.agent!=="");return{agentName:Je,type:"specific",targets:Ms}});Z(kt)}else Z([]);const gt=(Ra=(Ma=n==null?void 0:n.orchestration)==null?void 0:Ma.swarm)==null?void 0:Ra.middleware;if(gt&&Array.isArray(gt)){const kt=gt.map(Je=>{var ht;const jt=typeof Je=="string"?Je:Je==null?void 0:Je.name;return jt&&((ht=Object.entries(He).find(([,Ue])=>(Ue==null?void 0:Ue.name)===jt))==null?void 0:ht[0])||""}).filter(Boolean);tt(kt)}else tt([]);const ls=(Ta=n==null?void 0:n.orchestration)==null?void 0:Ta.memory;ls?typeof ls=="string"&&ls.startsWith("*")?Le(ls.slice(1)):(Ea=e.memory)!=null&&Ea.refName?Le(e.memory.refName):Le("memory"):Le("")}w((n==null?void 0:n.tags)||{}),B(((Aa=n==null?void 0:n.permissions)==null?void 0:Aa.map(Ct=>({principals:Ct.principals||[],entitlements:Ct.entitlements||[]})))||[]);const le=(n==null?void 0:n.environment_vars)||{};$(Object.entries(le).map(([Ct,Bt])=>typeof Bt=="string"&&Bt.startsWith("*")?{name:Ct,source:"variable",value:"",variableRef:Bt.slice(1)}:{name:Ct,source:"manual",value:String(Bt),variableRef:""})),Ne(!!(n!=null&&n.chat_history));const je=(Ia=(Pa=n==null?void 0:n.chat_history)==null?void 0:Pa.model)==null?void 0:Ia.name;if(je){const Ct=Object.entries(o).find(([,Bt])=>Bt.name===je);lt(Ct?Ct[0]:"")}else lt("");ve(((Oa=n==null?void 0:n.chat_history)==null?void 0:Oa.max_tokens)||2048),(La=n==null?void 0:n.chat_history)!=null&&La.max_tokens_before_summary?(qe(!0),At(n.chat_history.max_tokens_before_summary)):($a=n==null?void 0:n.chat_history)!=null&&$a.max_messages_before_summary?(qe(!1),zt(n.chat_history.max_messages_before_summary)):(qe(!0),At(20480),zt(10))},[n,l,o,u]),A.useEffect(()=>{p.length<=1&&P!=="none"&&M("none")},[p.length,P]);const Zt=()=>{dt.length>0&&Z([...X,{agentName:dt[0],type:"any",targets:[]}])},ms=G=>{Z(ue=>ue.filter((de,ie)=>ie!==G))},j=(G,ue)=>{Z(de=>de.map((ie,ne)=>ne===G?{...ie,...ue}:ie))},Y=(G,ue)=>{Z(de=>de.map((ie,ne)=>{if(ne!==G)return ie;const be=ie.targets.some(je=>je.agent===ue),le=ie.targets.some(je=>je.isDeterministic);return be?{...ie,targets:ie.targets.filter(je=>je.agent!==ue)}:le?{...ie,targets:[{agent:ue,isDeterministic:!0}]}:{...ie,targets:[...ie.targets,{agent:ue,isDeterministic:!1}]}}))},Q=G=>{Z(ue=>ue.map((de,ie)=>{if(ie!==G)return de;if(de.targets.some(le=>le.isDeterministic))return{...de,targets:de.targets.map(le=>({...le,isDeterministic:!1}))};const be=de.targets[0];return be?{...de,targets:[{agent:be.agent,isDeterministic:!0}]}:de}))},xe=async(G=!1)=>{ce(!0);try{const ue=Object.values(l).map(ie=>({name:ie.name,description:ie.description,handoff_prompt:ie.handoff_prompt})),de=await yb({context:z||void 0,agents:ue.length>0?ue:void 0,existing_prompt:G?O:void 0});W(de),H(!1),te("")}catch(ue){console.error("Failed to generate supervisor prompt:",ue),alert(ue instanceof Error?ue.message:"Failed to generate supervisor prompt")}finally{ce(!1)}},Ee=()=>{var be;let G;c==="configured"&&h.modelSchema?G=i[h.modelSchema]:c==="select"&&h.directCatalog&&h.directSchema&&(G={catalog_name:h.directCatalog,schema_name:h.directSchema});let ue;if(P==="supervisor"&&K&&o[K]){const le=me.map(_e=>u[_e]).filter(Boolean),je=st.map(_e=>He[_e]).filter(Boolean);ue={supervisor:{model:o[K],...le.length>0&&{tools:le},...O&&{prompt:O},...je.length>0&&{middleware:je}},...ze&&{memory:`*${ze}`}}}else if(P==="swarm"){const le={};X.forEach(_e=>{_e.type==="any"?le[_e.agentName]=null:_e.type==="none"?le[_e.agentName]=[]:le[_e.agentName]=_e.targets.map(Fe=>Fe.isDeterministic?{agent:Fe.agent,is_deterministic:!0}:Fe.agent)});const je=rt.map(_e=>He[_e]).filter(Boolean);ue={swarm:{...J&&l[J]&&{default_agent:J},...Object.keys(le).length>0&&{handoffs:le},...je.length>0&&{middleware:je}},...ze&&{memory:`*${ze}`}}}else if(P==="none"){const le=(be=e.app)==null?void 0:be.orchestration,je=p[0],_e=je&&l[je]?l[je].name:void 0;ze?le!=null&&le.supervisor?ue={supervisor:le.supervisor,memory:`*${ze}`}:le!=null&&le.swarm?ue={swarm:le.swarm,memory:`*${ze}`}:ue={swarm:_e?{default_agent:_e}:{},memory:`*${ze}`}:p.length>0&&_e&&(ue={swarm:{default_agent:_e}})}const de=p.map(le=>l[le]).filter(Boolean),ie={};E.forEach(le=>{le.name&&(le.source==="variable"&&le.variableRef?ie[le.name]=`*${le.variableRef}`:le.source==="manual"&&le.value&&(ie[le.name]=le.value))});let ne;Ke&&et&&o[et]&&(ne={model:o[et],max_tokens:ot},Xe?ne.max_tokens_before_summary=ct:ne.max_messages_before_summary=Qt),s({name:h.name,description:h.description||void 0,log_level:h.logLevel,endpoint_name:h.endpointName||void 0,service_principal:h.servicePrincipalRef?`*${h.servicePrincipalRef}`:void 0,registered_model:{name:h.modelName,...G&&{schema:G}},workload_size:h.workloadSize,scale_to_zero:h.scaleToZero,deployment_target:h.deploymentTarget,python_version:h.pythonVersion||void 0,orchestration:ue,agents:de.length>0?de:void 0,tags:Object.keys(C).length>0?C:void 0,permissions:V.length>0?V:void 0,environment_vars:Object.keys(ie).length>0?ie:void 0,chat_history:ne})},Ge=G=>{N(ue=>ue.includes(G)?ue.filter(de=>de!==G):[...ue,G])},De=()=>{N(Object.keys(l))},Pe=()=>{N([])};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-white",children:"Application"}),t.jsx("p",{className:"text-slate-400 mt-1",children:"Configure your application settings, orchestration, and deployment options"})]}),t.jsxs($e,{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[t.jsx(ca,{className:"w-5 h-5 text-slate-400"}),t.jsx("h3",{className:"font-medium text-white",children:"Application Settings"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(U,{label:"Application Name",placeholder:"e.g., my_retail_app",value:h.name,onChange:G=>{const ue=G.target.value,de=Nb(ue),ie=de?`${de}_endpoint`:"",ne=hn(ue),be={...h,name:ue};(!h.endpointName||h.endpointName===b)&&(be.endpointName=ie,_(ie)),(!h.modelName||h.modelName===x)&&(be.modelName=ne,f(ne)),r(be)},required:!0}),t.jsx(ae,{label:"Log Level",options:jb,value:h.logLevel,onChange:G=>r({...h,logLevel:G.target.value})})]}),t.jsx(U,{label:"Description",placeholder:"Brief description of your application",value:h.description,onChange:G=>r({...h,description:G.target.value})}),t.jsxs("div",{className:"space-y-1.5",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Deployment Target"}),t.jsxs("div",{className:"inline-flex rounded-lg bg-slate-900/50 p-0.5",children:[t.jsx("button",{type:"button",onClick:()=>r({...h,deploymentTarget:"model_serving"}),className:`px-4 py-1.5 text-xs rounded-md font-medium transition-all duration-150 ${h.deploymentTarget==="model_serving"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Model Serving"}),t.jsx("button",{type:"button",onClick:()=>r({...h,deploymentTarget:"apps"}),className:`px-4 py-1.5 text-xs rounded-md font-medium transition-all duration-150 ${h.deploymentTarget==="apps"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Databricks Apps"})]}),t.jsx("p",{className:"text-xs text-slate-500",children:"Choose where your agent will be deployed"})]}),h.deploymentTarget==="model_serving"&&t.jsx(U,{label:"Endpoint Name",placeholder:"e.g., my_agent_endpoint",value:h.endpointName,onChange:G=>r({...h,endpointName:G.target.value}),hint:"The name of the model serving endpoint"}),t.jsx(U,{label:"Python Version (Optional)",placeholder:"e.g., 3.11",value:h.pythonVersion,onChange:G=>r({...h,pythonVersion:G.target.value}),hint:"Python version for the deployment environment"}),t.jsx(ae,{label:"Service Principal (Optional)",value:h.servicePrincipalRef,onChange:G=>r({...h,servicePrincipalRef:G.target.value}),options:[{value:"",label:"None - Use default credentials"},...Object.keys(e.service_principals||{}).map(G=>({value:G,label:G}))],hint:"Optional service principal for application authentication"}),Object.keys(e.service_principals||{}).length===0&&h.servicePrincipalRef===""&&t.jsx("p",{className:"text-xs text-slate-500 -mt-2",children:"Configure service principals in Resources  Service Principals to use them here."})]}),t.jsxs($e,{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ts,{className:"w-5 h-5 text-slate-400"}),t.jsx("h3",{className:"font-medium text-white",children:"Application Agents"})]}),t.jsx("div",{className:"flex items-center space-x-2",children:Me.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(ee,{variant:"ghost",size:"sm",onClick:De,disabled:p.length===Me.length,children:"Select All"}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:Pe,disabled:p.length===0,children:"Clear"})]})})]}),t.jsx("p",{className:"text-sm text-slate-400",children:"Select the agents to include in this application. These agents will be available for orchestration."}),Me.length===0?t.jsx("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-lg p-3 text-amber-400 text-sm",children:"No agents configured. Add agents in the Agents section first."}):t.jsx("div",{className:"space-y-2",children:Me.map(G=>{const ue=l[G],de=p.includes(G);return t.jsxs("button",{type:"button",onClick:()=>Ge(G),className:pt("w-full flex items-center justify-between p-3 rounded-lg border transition-all text-left",de?"bg-blue-500/10 border-blue-500/50 ring-1 ring-blue-500/30":"bg-slate-800/50 border-slate-700 hover:border-slate-600"),children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:pt("w-8 h-8 rounded-lg flex items-center justify-center",de?"bg-blue-500/20":"bg-slate-700"),children:t.jsx(ts,{className:pt("w-4 h-4",de?"text-blue-400":"text-slate-400")})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-white",children:ue.name}),ue.description&&t.jsx("p",{className:"text-xs text-slate-500 line-clamp-1",children:ue.description})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[ue.tools&&ue.tools.length>0&&t.jsxs(Se,{variant:"default",className:"text-[10px]",children:[ue.tools.length," tools"]}),de?t.jsx("div",{className:"w-5 h-5 rounded-full bg-blue-500 flex items-center justify-center",children:t.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}):t.jsx("div",{className:"w-5 h-5 rounded-full border-2 border-slate-600"})]})]},G)})}),p.length>0&&t.jsxs("div",{className:"pt-3 border-t border-slate-700",children:[t.jsxs("p",{className:"text-xs text-slate-500 mb-2",children:["Selected agents (",p.length,")"]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:p.map(G=>{var ue;return t.jsxs("span",{className:"inline-flex items-center px-2 py-1 bg-blue-500/20 text-blue-300 rounded text-xs",children:[((ue=l[G])==null?void 0:ue.name)||G,t.jsx("button",{type:"button",onClick:de=>{de.stopPropagation(),Ge(G)},className:"ml-1.5 hover:text-white",children:t.jsx(_a,{className:"w-3 h-3"})})]},G)})})]})]}),t.jsxs($e,{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx(El,{className:"w-5 h-5 text-slate-400"}),t.jsx("h3",{className:"font-medium text-white",children:"Orchestration"})]}),t.jsx("p",{className:"text-sm text-slate-400 mb-4",children:"Configure how agents work together in your multi-agent system"}),t.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.jsxs("button",{type:"button",onClick:()=>M("none"),disabled:p.length>1,className:pt("p-4 rounded-lg border text-center transition-all",P==="none"?"bg-blue-500/10 border-blue-500 ring-1 ring-blue-500":"bg-slate-800/50 border-slate-700 hover:border-slate-600",p.length>1&&"opacity-50 cursor-not-allowed hover:border-slate-700"),children:[t.jsx("div",{className:"w-10 h-10 mx-auto rounded-lg bg-slate-700 flex items-center justify-center mb-2",children:t.jsx(Or,{className:"w-5 h-5 text-slate-400"})}),t.jsx("h4",{className:"text-sm font-medium text-white",children:"No Orchestration"}),t.jsx("p",{className:"text-xs text-slate-500 mt-0.5",children:"Single agent mode"})]}),t.jsxs("button",{type:"button",onClick:()=>M("supervisor"),disabled:p.length<=1,className:pt("p-4 rounded-lg border text-center transition-all",P==="supervisor"?"bg-blue-500/10 border-blue-500 ring-1 ring-blue-500":"bg-slate-800/50 border-slate-700 hover:border-slate-600",p.length<=1&&"opacity-50 cursor-not-allowed hover:border-slate-700"),children:[t.jsx("div",{className:pt("w-10 h-10 mx-auto rounded-lg flex items-center justify-center mb-2",p.length<=1?"bg-slate-700":"bg-blue-500/20"),children:t.jsx(Dl,{className:pt("w-5 h-5",p.length<=1?"text-slate-500":"text-blue-400")})}),t.jsx("h4",{className:"text-sm font-medium text-white",children:"Supervisor"}),t.jsx("p",{className:"text-xs text-slate-500 mt-0.5",children:"Central routing agent"})]}),t.jsxs("button",{type:"button",onClick:()=>M("swarm"),disabled:p.length<=1,className:pt("p-4 rounded-lg border text-center transition-all",P==="swarm"?"bg-blue-500/10 border-blue-500 ring-1 ring-blue-500":"bg-slate-800/50 border-slate-700 hover:border-slate-600",p.length<=1&&"opacity-50 cursor-not-allowed hover:border-slate-700"),children:[t.jsx("div",{className:pt("w-10 h-10 mx-auto rounded-lg flex items-center justify-center mb-2",p.length<=1?"bg-slate-700":"bg-purple-500/20"),children:t.jsx(El,{className:pt("w-5 h-5",p.length<=1?"text-slate-500":"text-purple-400")})}),t.jsx("h4",{className:"text-sm font-medium text-white",children:"Swarm"}),t.jsx("p",{className:"text-xs text-slate-500 mt-0.5",children:"Peer-to-peer handoffs"})]})]}),p.length<=1&&t.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Supervisor and Swarm orchestration require multiple agents to be selected."}),P!=="none"&&t.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-700",children:[P==="supervisor"&&t.jsxs(t.Fragment,{children:[Object.keys(o).length===0&&t.jsx("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-lg p-3 text-amber-400 text-sm",children:"Add an LLM in Resources first to configure supervisor orchestration."}),t.jsx(ae,{label:"Orchestration Model",options:fe,value:K,onChange:G=>he(G.target.value),hint:"The LLM that will route requests to appropriate agents"})]}),P==="supervisor"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Supervisor Prompt (Optional)"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[!se&&t.jsxs("button",{type:"button",onClick:()=>H(!0),className:"flex items-center space-x-1.5 px-3 py-1.5 text-xs rounded-lg font-medium bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-purple-300 border border-purple-500/30 hover:from-purple-500/30 hover:to-pink-500/30 transition-all",children:[t.jsx(Rt,{className:"w-3.5 h-3.5"}),t.jsx("span",{children:"AI Assistant"})]}),O&&!se&&t.jsxs("button",{type:"button",onClick:()=>xe(!0),className:"flex items-center space-x-1.5 px-3 py-1.5 text-xs rounded-lg font-medium bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-purple-300 border border-purple-500/30 hover:from-purple-500/30 hover:to-pink-500/30 transition-all",disabled:q,children:[q?t.jsx(Nt,{className:"w-3.5 h-3.5 animate-spin"}):t.jsx(Rt,{className:"w-3.5 h-3.5"}),t.jsx("span",{children:"Improve Prompt"})]})]}),se&&t.jsxs("div",{className:"p-3 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-lg border border-purple-500/30 space-y-3",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Rt,{className:"w-4 h-4 text-purple-400"}),t.jsx("span",{className:"text-sm font-medium text-purple-300",children:"Generate Supervisor Prompt with AI"})]}),t.jsx("p",{className:"text-xs text-slate-400",children:"The AI will use the configured agents' names, descriptions, and handoff prompts to generate a supervisor prompt that effectively routes requests."}),Object.keys(l).length>0&&t.jsxs("div",{className:"space-y-1",children:[t.jsx("p",{className:"text-xs text-slate-500",children:"Agents that will be included:"}),t.jsx("div",{className:"flex flex-wrap gap-1",children:Object.values(l).map((G,ue)=>t.jsx("span",{className:"px-2 py-0.5 bg-slate-800/50 rounded text-xs text-slate-300",children:G.name},ue))})]}),t.jsx(Jt,{label:"Additional Context (Optional)",placeholder:"Describe any specific routing logic, priorities, or special instructions for the supervisor...",value:z,onChange:G=>te(G.target.value),rows:3}),t.jsxs("div",{className:"flex justify-end space-x-2",children:[t.jsx(ee,{variant:"secondary",size:"sm",onClick:()=>{H(!1),te("")},children:"Cancel"}),t.jsx(ee,{type:"button",size:"sm",onClick:()=>xe(!1),disabled:q||Object.keys(l).length===0,className:"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600",children:q?t.jsxs(t.Fragment,{children:[t.jsx(Nt,{className:"w-4 h-4 mr-1.5 animate-spin"}),"Generating..."]}):t.jsxs(t.Fragment,{children:[t.jsx(Rt,{className:"w-4 h-4 mr-1.5"}),"Generate Prompt"]})})]})]}),t.jsx(Jt,{placeholder:"Custom instructions for the supervisor agent...",value:O,onChange:G=>W(G.target.value),rows:4,hint:"Override the default supervisor prompt"})]}),t.jsxs("div",{className:"space-y-3 pt-3 border-t border-slate-700/50",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{children:[t.jsxs("h4",{className:"text-sm font-medium text-slate-200 flex items-center gap-2",children:[t.jsx(ma,{className:"w-4 h-4 text-green-400"}),"Supervisor Tools"]}),t.jsx("p",{className:"text-xs text-slate-500",children:"Assign tools that the supervisor can use directly"})]})}),Object.keys(u).length===0?t.jsx("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-lg p-3 text-amber-400 text-sm",children:"No tools configured. Add tools in the Tools section first."}):t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(u).map(([G,ue])=>{const de=me.includes(G);return t.jsxs("button",{type:"button",onClick:()=>{Re(ie=>de?ie.filter(ne=>ne!==G):[...ie,G])},className:pt("px-3 py-1.5 rounded-lg text-sm transition-colors flex items-center gap-2",de?"bg-green-500/20 text-green-300 border border-green-500/50":"bg-slate-800 text-slate-400 border border-slate-700 hover:border-slate-600"),children:[t.jsx(ma,{className:"w-3 h-3"}),ue.name,de&&t.jsx(_a,{className:"w-3 h-3 ml-1"})]},G)})}),me.length>0&&t.jsxs("p",{className:"text-xs text-green-400",children:[" ",me.length," tool",me.length!==1?"s":""," assigned to supervisor"]})]})]}),t.jsxs("div",{className:"space-y-3 pt-3 border-t border-slate-700/50",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{children:[t.jsxs("h4",{className:"text-sm font-medium text-slate-200 flex items-center gap-2",children:[t.jsx(xs,{className:"w-4 h-4 text-purple-400"}),"Supervisor Middleware"]}),t.jsx("p",{className:"text-xs text-slate-500",children:"Assign middleware to customize supervisor execution behavior"})]})}),Object.keys(He).length===0?t.jsx("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-lg p-3 text-amber-400 text-sm",children:"No middleware configured. Add middleware in the Middleware section first."}):t.jsx(Ua,{label:"Select Middleware",options:bt,value:st,onChange:G=>it(G),placeholder:"Select middleware...",hint:"Middleware to apply to the supervisor agent"})]})]}),P==="swarm"&&t.jsxs(t.Fragment,{children:[p.length===0&&t.jsx("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-lg p-3 text-amber-400 text-sm",children:"Select agents for the application above before configuring swarm orchestration."}),t.jsx(ae,{label:"Default Agent",options:We,value:J,onChange:G=>oe(G.target.value),hint:"The agent that handles initial requests (from selected application agents)",disabled:p.length===0}),t.jsxs("div",{className:"space-y-3 pt-3 border-t border-slate-700/50",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-slate-200",children:"Agent Handoff Rules"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Define which agents can hand off to which other agents"})]}),t.jsxs(ee,{variant:"secondary",size:"sm",onClick:Zt,disabled:dt.length===0||p.length===0,children:[t.jsx(Ie,{className:"w-4 h-4 mr-1"}),"Add Rule"]})]}),p.length===0&&t.jsx("div",{className:"bg-slate-800/50 rounded-lg p-3 text-slate-400 text-sm",children:"Select agents for the application first to configure handoff rules."}),X.length===0&&p.length>0&&t.jsx("div",{className:"bg-blue-900/20 border border-blue-500/30 rounded-lg p-3",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(Ka,{className:"w-4 h-4 text-blue-400 mt-0.5 flex-shrink-0"}),t.jsxs("div",{className:"text-sm text-blue-300",children:[t.jsx("p",{className:"font-medium",children:"No handoff rules defined"}),t.jsxs("p",{className:"text-blue-400/80 mt-1 text-xs",children:["Without explicit rules, agents will use their ",t.jsx("code",{className:"bg-blue-900/50 px-1 rounded",children:"handoff_prompt"})," to determine routing."]})]})]})}),X.map((G,ue)=>{var de;return t.jsxs("div",{className:"bg-slate-800/30 rounded-lg p-3 border border-slate-700/50 space-y-2",children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1 grid grid-cols-2 gap-3",children:[t.jsx(ae,{label:"From Agent",value:G.agentName,onChange:ie=>j(ue,{agentName:ie.target.value}),options:[{value:G.agentName,label:((de=l[G.agentName])==null?void 0:de.name)||G.agentName},...dt.map(ie=>{var ne;return{value:ie,label:((ne=l[ie])==null?void 0:ne.name)||ie}})]}),t.jsx(ae,{label:"Can Hand Off To",value:G.type,onChange:ie=>j(ue,{type:ie.target.value,targets:ie.target.value==="specific"?G.targets:[]}),options:Qe})]}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:()=>ms(ue),className:"ml-2 mt-6",children:t.jsx(Ze,{className:"w-4 h-4 text-red-400"})})]}),G.type==="specific"&&(()=>{const ie=G.targets.some(ne=>ne.isDeterministic);return t.jsxs("div",{className:"pt-1 space-y-3",children:[t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[t.jsx("input",{type:"checkbox",checked:ie,onChange:ne=>{ne.stopPropagation(),Q(ue)},className:"w-3.5 h-3.5 rounded border-slate-600 bg-slate-700 text-amber-500 focus:ring-amber-500/30 focus:ring-offset-0 cursor-pointer"}),t.jsx("span",{className:pt("text-xs transition-colors",ie?"text-amber-400 font-medium":"text-slate-400 group-hover:text-slate-300"),children:"Deterministic route"})]}),ie&&t.jsx("div",{className:"bg-amber-500/10 border border-amber-500/20 rounded-lg p-2.5",children:t.jsxs("p",{className:"text-[10px] text-amber-400/80",children:["This agent will ",t.jsx("span",{className:"font-semibold",children:"always"})," route to the selected target after completing its turn. Only one target is allowed."]})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-slate-400 mb-2",children:ie?"Select the target agent:":"Select target agents:"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:we.filter(ne=>ne!==G.agentName).map(ne=>{var je;const be=G.targets.some(_e=>_e.agent===ne),le=ie&&!be&&G.targets.length>0;return t.jsx("button",{type:"button",onClick:()=>!le&&Y(ue,ne),className:pt("px-2.5 py-1 rounded-lg text-xs transition-colors",be&&ie?"bg-amber-500/30 text-amber-300 border border-amber-500/50":be?"bg-purple-500/30 text-purple-300 border border-purple-500/50":le?"bg-slate-800 text-slate-600 border border-slate-700 cursor-not-allowed":"bg-slate-700 text-slate-400 border border-slate-600 hover:border-slate-500"),disabled:le,children:((je=l[ne])==null?void 0:je.name)||ne},ne)})})]})]})})(),G.type==="any"&&t.jsx("p",{className:"text-xs text-emerald-400",children:" This agent can hand off to any other agent"}),G.type==="none"&&t.jsx("p",{className:"text-xs text-amber-400",children:" This agent cannot hand off (terminal agent)"})]},ue)})]}),t.jsxs("div",{className:"space-y-3 pt-3 border-t border-slate-700/50",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{children:[t.jsxs("h4",{className:"text-sm font-medium text-slate-200 flex items-center gap-2",children:[t.jsx(xs,{className:"w-4 h-4 text-purple-400"}),"Swarm Middleware"]}),t.jsx("p",{className:"text-xs text-slate-500",children:"Assign middleware to apply across all agents in the swarm"})]})}),Object.keys(He).length===0?t.jsx("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-lg p-3 text-amber-400 text-sm",children:"No middleware configured. Add middleware in the Middleware section first."}):t.jsx(Ua,{label:"Select Middleware",options:bt,value:rt,onChange:G=>tt(G),placeholder:"Select middleware...",hint:"Middleware to apply to the swarm orchestration"})]})]})]}),t.jsxs("div",{className:"bg-slate-800/30 rounded-lg p-3 text-xs text-slate-400 space-y-1.5",children:[t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(Se,{variant:"info",className:"text-[10px] px-1.5 py-0",children:"Supervisor"}),t.jsx("span",{children:"Central agent analyzes requests and routes to appropriate specialized agents."})]}),t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(Se,{variant:"info",className:"text-[10px] px-1.5 py-0",children:"Swarm"}),t.jsx("span",{children:"Agents hand off conversations directly to each other based on handoff rules."})]})]}),t.jsxs("div",{className:"space-y-2 pt-4 border-t border-slate-700",children:[t.jsx(ae,{label:"Memory",options:m?[{value:"",label:"No memory (stateless)"},...m.refName?[{value:m.refName,label:`*${m.refName}`}]:[{value:"memory",label:"*memory"}]]:[{value:"",label:"No memory configured"}],value:ze,onChange:G=>Le(G.target.value),hint:m?"Assign configured memory to enable conversation persistence":"Configure memory in the Memory section first",disabled:!m}),!m&&t.jsxs("p",{className:"text-xs text-amber-400",children:[" Add a memory configuration in the ",t.jsx("strong",{children:"Memory"})," section to enable conversation persistence."]}),ze&&p.length===1&&P==="none"&&t.jsx("p",{className:"text-xs text-cyan-400",children:" With a single agent and memory, swarm orchestration will be used automatically."})]})]}),t.jsxs($e,{className:"space-y-4",children:[t.jsx("h3",{className:"font-medium text-white",children:"Model Registration"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(U,{label:"Registered Model Name",placeholder:"e.g., my_agent_model",value:h.modelName,onChange:G=>r({...h,modelName:hn(G.target.value)}),required:!0}),t.jsxs("div",{className:"space-y-1.5",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Model Schema"}),t.jsxs("div",{className:"inline-flex rounded-lg bg-slate-900/50 p-0.5",children:[t.jsx("button",{type:"button",onClick:()=>d("configured"),disabled:Object.keys(i).length===0,className:`px-2 py-0.5 text-[10px] rounded-md font-medium transition-all duration-150 ${c==="configured"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300 disabled:opacity-50 disabled:cursor-not-allowed"}`,children:"Configured"}),t.jsx("button",{type:"button",onClick:()=>d("select"),className:`px-2 py-0.5 text-[10px] rounded-md font-medium transition-all duration-150 ${c==="select"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Select"})]})]}),c==="configured"?t.jsx(ae,{options:[{value:"",label:"Select a configured schema..."},...Object.keys(i).map(G=>({value:G,label:G}))],value:h.modelSchema,onChange:G=>r({...h,modelSchema:G.target.value})}):t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx(ae,{options:[{value:"",label:"Select Catalog..."},...S.map(G=>({value:G.name,label:G.name}))],value:h.directCatalog,onChange:G=>r({...h,directCatalog:G.target.value,directSchema:""})}),t.jsx(ae,{options:[{value:"",label:"Select Schema..."},...y.map(G=>({value:G.name,label:G.name}))],value:h.directSchema,onChange:G=>r({...h,directSchema:G.target.value}),disabled:!h.directCatalog})]})]})]})]}),h.deploymentTarget==="model_serving"&&t.jsxs($e,{className:"space-y-4",children:[t.jsx("h3",{className:"font-medium text-white",children:"Model Serving Options"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(ae,{label:"Workload Size",options:_b,value:h.workloadSize,onChange:G=>r({...h,workloadSize:G.target.value})}),t.jsxs("div",{className:"space-y-1.5",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Scale to Zero"}),t.jsxs("div",{className:"inline-flex rounded-lg bg-slate-900/50 p-0.5 mt-1",children:[t.jsx("button",{type:"button",onClick:()=>r({...h,scaleToZero:!0}),className:`px-4 py-1.5 text-xs rounded-md font-medium transition-all duration-150 ${h.scaleToZero?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Enabled"}),t.jsx("button",{type:"button",onClick:()=>r({...h,scaleToZero:!1}),className:`px-4 py-1.5 text-xs rounded-md font-medium transition-all duration-150 ${h.scaleToZero?"text-slate-400 border border-transparent hover:text-slate-300":"bg-violet-500/20 text-violet-400 border border-violet-500/40"}`,children:"Disabled"})]})]})]})]}),t.jsxs($e,{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ts,{className:"w-5 h-5 text-slate-400"}),t.jsx("h3",{className:"font-medium text-white",children:"Chat History Summarization"})]}),t.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:Ke,onChange:G=>Ne(G.target.checked),className:"rounded border-slate-600 text-violet-500 focus:ring-violet-500 focus:ring-offset-slate-900"}),t.jsx("span",{className:"text-xs text-slate-400",children:"Enable"})]})]}),t.jsx("p",{className:"text-sm text-slate-400",children:"Configure automatic chat history summarization to manage long conversations and reduce token usage"}),Ke&&t.jsxs("div",{className:"space-y-4 p-4 bg-slate-800/30 rounded-lg border border-slate-700/50",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(ae,{label:"Summary Model",value:et,onChange:G=>lt(G.target.value),options:[{value:"",label:"Select an LLM..."},...Object.entries(o).map(([G,ue])=>({value:G,label:ue.name||G}))],hint:"LLM for chat history summarization",required:!0}),t.jsx(U,{label:"Max Summary Tokens",type:"number",value:ot,onChange:G=>ve(parseInt(G.target.value)||2048),hint:"Max tokens for the summary",min:1})]}),Object.keys(o).length===0&&t.jsx("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-lg p-3 text-amber-400 text-sm",children:"No LLMs configured. Add an LLM in Resources section first."}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Trigger Threshold"}),t.jsxs("div",{className:"flex items-center space-x-6 mb-3",children:[t.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[t.jsx("input",{type:"radio",checked:Xe,onChange:()=>qe(!0),className:"text-purple-500 focus:ring-purple-500 focus:ring-offset-slate-900"}),t.jsx("span",{className:"text-sm text-slate-300",children:"By Tokens"})]}),t.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[t.jsx("input",{type:"radio",checked:!Xe,onChange:()=>qe(!1),className:"text-purple-500 focus:ring-purple-500 focus:ring-offset-slate-900"}),t.jsx("span",{className:"text-sm text-slate-300",children:"By Messages"})]})]}),Xe?t.jsx(U,{label:"Max Tokens Before Summary",type:"number",value:ct,onChange:G=>At(parseInt(G.target.value)||20480),hint:"Trigger when history exceeds this token count",min:1}):t.jsx(U,{label:"Max Messages Before Summary",type:"number",value:Qt,onChange:G=>zt(parseInt(G.target.value)||10),hint:"Trigger when history exceeds this message count",min:1})]}),t.jsx("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-3 text-sm text-blue-300",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(Ka,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("p",{className:"font-medium",children:"How it works:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-1 text-xs text-blue-200/80",children:[t.jsx("li",{children:"When the threshold is exceeded, older messages are summarized using the selected LLM"}),t.jsxs("li",{children:["Recent messages (up to ",t.jsx("strong",{children:ot})," tokens) are preserved for context"]}),t.jsx("li",{children:"The summary replaces older messages, reducing overall token usage"})]})]})]})})]})]}),t.jsxs($e,{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(jf,{className:"w-5 h-5 text-slate-400"}),t.jsx("h3",{className:"font-medium text-white",children:"Environment Variables"})]}),t.jsxs(ee,{variant:"secondary",size:"sm",onClick:()=>$([...E,{name:"",source:"variable",value:"",variableRef:""}]),children:[t.jsx(Ie,{className:"w-4 h-4 mr-1"}),"Add Variable"]})]}),t.jsx("p",{className:"text-sm text-slate-400",children:"Configure environment variables for your application. Values can reference configured variables or be set manually."}),E.length===0?t.jsx("div",{className:"bg-slate-800/50 rounded-lg p-3 text-slate-400 text-sm",children:"No environment variables configured. Add variables to set runtime configuration."}):t.jsx("div",{className:"space-y-3",children:E.map((G,ue)=>t.jsxs("div",{className:"p-3 bg-slate-800/30 rounded-lg border border-slate-700 space-y-3",children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1 grid grid-cols-2 gap-3",children:[t.jsx(U,{label:"Name",placeholder:"e.g., API_KEY",value:G.name,onChange:de=>{const ie=[...E];ie[ue].name=de.target.value.toUpperCase().replace(/[^A-Z0-9_]/g,"_"),$(ie)}}),t.jsxs("div",{className:"space-y-1.5",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Value"}),t.jsxs("div",{className:"inline-flex rounded-lg bg-slate-900/50 p-0.5",children:[t.jsx("button",{type:"button",onClick:()=>{const de=[...E];de[ue].source="variable",de[ue].value="",$(de)},className:`px-2 py-0.5 text-[10px] rounded-md font-medium transition-all duration-150 ${G.source==="variable"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Variable"}),t.jsx("button",{type:"button",onClick:()=>{const de=[...E];de[ue].source="manual",de[ue].variableRef="",$(de)},className:`px-2 py-0.5 text-[10px] rounded-md font-medium transition-all duration-150 ${G.source==="manual"?"bg-violet-500/20 text-violet-400 border border-violet-500/40":"text-slate-400 border border-transparent hover:text-slate-300"}`,children:"Manual"})]})]}),G.source==="variable"?t.jsx(ae,{value:G.variableRef,onChange:de=>{const ie=[...E];ie[ue].variableRef=de.target.value,$(ie)},options:[{value:"",label:"Select a variable..."},...Object.keys(e.variables||{}).map(de=>({value:de,label:de}))]}):t.jsx(U,{value:G.value,onChange:de=>{const ie=[...E];ie[ue].value=de.target.value,$(ie)},placeholder:"Enter value..."})]})]}),t.jsx("button",{type:"button",onClick:()=>$(E.filter((de,ie)=>ie!==ue)),className:"ml-3 mt-6 text-slate-400 hover:text-red-400",children:t.jsx(Ze,{className:"w-4 h-4"})})]}),G.name&&t.jsxs("div",{className:"text-xs text-slate-500",children:["YAML: ",t.jsxs("code",{className:"bg-slate-900/50 px-1 rounded text-slate-400",children:[G.name,": ",G.source==="variable"&&G.variableRef?`*${G.variableRef}`:G.value||'""']})]})]},ue))}),Object.keys(e.variables||{}).length===0&&t.jsx("p",{className:"text-xs text-slate-500",children:"Configure variables in the Variables section to reference them here."})]}),t.jsxs($e,{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Vl,{className:"w-5 h-5 text-slate-400"}),t.jsx("h3",{className:"font-medium text-white",children:"Tags"})]}),t.jsx("p",{className:"text-sm text-slate-400",children:"Add metadata tags to your application for organization and filtering"}),Object.keys(C).length>0&&t.jsx("div",{className:"space-y-2",children:Object.entries(C).map(([G,ue])=>t.jsxs("div",{className:"flex items-center justify-between p-2 bg-slate-800/50 rounded-lg border border-slate-700",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-sm font-medium text-blue-400",children:G}),t.jsx("span",{className:"text-slate-500",children:"="}),t.jsx("span",{className:"text-sm text-slate-300",children:String(ue)})]}),t.jsx("button",{type:"button",onClick:()=>{const de={...C};delete de[G],w(de)},className:"text-slate-400 hover:text-red-400",children:t.jsx(Ze,{className:"w-4 h-4"})})]},G))}),t.jsxs("div",{className:"flex items-end space-x-2",children:[t.jsx("div",{className:"flex-1",children:t.jsx(U,{label:"Key",placeholder:"e.g., environment",value:I,onChange:G=>R(G.target.value)})}),t.jsx("div",{className:"flex-1",children:t.jsx(U,{label:"Value",placeholder:"e.g., production",value:k,onChange:G=>D(G.target.value)})}),t.jsxs(ee,{variant:"secondary",onClick:()=>{I&&k&&(w({...C,[I]:k}),R(""),D(""))},disabled:!I||!k,children:[t.jsx(Ie,{className:"w-4 h-4"}),"Add"]})]})]}),t.jsxs($e,{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Dl,{className:"w-5 h-5 text-slate-400"}),t.jsx("h3",{className:"font-medium text-white",children:"Permissions"})]}),t.jsxs(ee,{variant:"secondary",size:"sm",onClick:()=>B([...V,{principals:[],entitlements:[]}]),children:[t.jsx(Ie,{className:"w-4 h-4 mr-1"}),"Add Permission"]})]}),t.jsx("p",{className:"text-sm text-slate-400",children:"Configure who can access this application and with what permissions"}),V.length===0?t.jsx("div",{className:"bg-slate-800/50 rounded-lg p-3 text-slate-400 text-sm",children:"No permissions configured. Add permissions to control access to this application."}):t.jsx("div",{className:"space-y-3",children:V.map((G,ue)=>t.jsxs("div",{className:"p-3 bg-slate-800/30 rounded-lg border border-slate-700 space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("span",{className:"text-sm font-medium text-slate-300",children:["Permission Rule ",ue+1]}),t.jsx("button",{type:"button",onClick:()=>B(V.filter((de,ie)=>ie!==ue)),className:"text-slate-400 hover:text-red-400",children:t.jsx(Ze,{className:"w-4 h-4"})})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-xs font-medium text-slate-400",children:"Principals (users, groups, service principals)"}),t.jsx("div",{className:"flex flex-wrap gap-2 min-h-[32px]",children:G.principals.map((de,ie)=>t.jsxs("span",{className:"inline-flex items-center px-2 py-1 bg-blue-500/20 text-blue-300 rounded text-xs",children:[de,t.jsx("button",{type:"button",onClick:()=>{const ne=[...V];ne[ue].principals=G.principals.filter((be,le)=>le!==ie),B(ne)},className:"ml-1.5 hover:text-white",children:t.jsx(_a,{className:"w-3 h-3"})})]},ie))}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx(U,{placeholder:"e.g., user@example.com or group_name",value:T,onChange:de=>F(de.target.value),className:"flex-1"}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:()=>{if(T){const de=[...V];de[ue].principals=[...G.principals,T],B(de),F("")}},disabled:!T,children:"Add"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-xs font-medium text-slate-400",children:"Entitlements"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:L.map(de=>t.jsx("button",{type:"button",onClick:()=>{const ie=[...V];G.entitlements.includes(de.value)?ie[ue].entitlements=G.entitlements.filter(ne=>ne!==de.value):ie[ue].entitlements=[...G.entitlements,de.value],B(ie)},className:pt("px-2.5 py-1 rounded-lg text-xs transition-colors",G.entitlements.includes(de.value)?"bg-green-500/30 text-green-300 border border-green-500/50":"bg-slate-700 text-slate-400 border border-slate-600 hover:border-slate-500"),children:de.label},de.value))})]})]},ue))})]}),t.jsxs($e,{variant:"highlight",children:[t.jsx("h3",{className:"font-medium text-white mb-3",children:"Configuration Summary"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-slate-400",children:"Application:"}),t.jsx("span",{className:"text-white ml-2",children:h.name||"Not set"})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-slate-400",children:"Agents:"}),t.jsxs(Se,{variant:p.length>0?"success":"warning",className:"ml-2",children:[p.length," selected"]})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-slate-400",children:"Orchestration:"}),t.jsx(Se,{variant:P!=="none"?"info":"default",className:"ml-2",children:P==="supervisor"?"Supervisor":P==="swarm"?"Swarm":"None"})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-slate-400",children:"Endpoint:"}),t.jsx("span",{className:"text-white ml-2",children:h.endpointName||"Not set"})]})]})]}),t.jsxs("div",{className:"flex justify-end items-center space-x-3",children:[!_t&&Kt&&t.jsx("span",{className:"text-sm text-slate-500",children:"No unsaved changes"}),!Kt&&_t&&t.jsxs("div",{className:"text-sm text-amber-400 flex items-center gap-2",children:[t.jsx("span",{children:"Missing required fields:"}),t.jsx("span",{children:Pt.join(", ")})]}),t.jsxs(ee,{onClick:Ee,size:"lg",disabled:!re,children:[t.jsx(bf,{className:"w-4 h-4"}),"Save Configuration"]})]})]})}function Sb({activeSection:e,onNavigate:s}){const a=()=>{switch(e){case"overview":return t.jsx(Nf,{onNavigate:s});case"variables":return t.jsx(ug,{});case"service_principals":return t.jsx(mg,{});case"schemas":return t.jsx(Eg,{});case"resources":return t.jsx(Lg,{});case"retrievers":return t.jsx(tb,{});case"tools":return t.jsx(nb,{});case"guardrails":return t.jsx(ib,{});case"middleware":return t.jsx(mb,{});case"memory":return t.jsx(hb,{});case"prompts":return t.jsx(fb,{});case"agents":return t.jsx(bb,{});case"app":return t.jsx(wb,{});default:return null}};return t.jsx("div",{className:"flex-1 overflow-y-auto bg-slate-900/50",children:t.jsx("div",{className:"p-6 animate-fade-in",children:a()})})}async function dd(e){try{const s=mn(e);return await Cb(s)}catch(s){return{valid:!1,errors:[],schemaError:s instanceof Error?s.message:"Validation failed"}}}async function Cb(e){try{const s=await fetch("/api/validate/schema",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({yaml_content:e})});if(!s.ok){const n=await s.json().catch(()=>({error:s.statusText}));return{valid:!1,errors:[],schemaError:n.error||`Validation request failed: ${s.status}`}}const a=await s.json();return{valid:a.valid,errors:(a.errors||[]).map(n=>({path:n.path||"/",message:n.message||"Unknown validation error",keyword:n.type||"validation"})),warnings:(a.warnings||[]).map(n=>({path:n.path||"/",message:n.message||"Unknown warning",keyword:n.type||"warning"}))}}catch(s){return{valid:!1,errors:[],schemaError:s instanceof Error?s.message:"Validation request failed"}}}async function kb(){}function Mb(e=500){const{config:s}=nt(),[a,n]=A.useState(null),[i,l]=A.useState(!1),[o,u]=A.useState(!1),m=A.useRef(null);A.useEffect(()=>{kb().then(()=>{u(!0)})},[]),A.useEffect(()=>{if(o)return m.current&&clearTimeout(m.current),m.current=setTimeout(async()=>{l(!0);try{const r=await dd(s);n(r)}catch(r){n({valid:!1,errors:[],schemaError:r instanceof Error?r.message:"Validation failed"})}finally{l(!1)}},e),()=>{m.current&&clearTimeout(m.current)}},[s,o,e]);const h=A.useCallback(async()=>{l(!0);try{const r=await dd(s);return n(r),r}catch(r){const c={valid:!1,errors:[],schemaError:r instanceof Error?r.message:"Validation failed"};return n(c),c}finally{l(!1)}},[s]);return{validationResult:a,isValidating:i,schemaReady:o,validate:h,isValid:(a==null?void 0:a.valid)??null,errors:(a==null?void 0:a.errors)??[],schemaError:a==null?void 0:a.schemaError}}function Rb(){const{config:e,setConfig:s}=nt(),[a,n]=A.useState(!1),[i,l]=A.useState(!0),[o,u]=A.useState(!0),[m,h]=A.useState(""),[r,c]=A.useState(null),[d,g]=A.useState(!1),v=A.useRef(null),S=A.useRef(null),{isValid:y,errors:b,schemaError:_,isValidating:x,schemaReady:f}=Mb(800),C=mn(e);A.useEffect(()=>{o&&(h(C),c(null),g(!1))},[C,o]),A.useEffect(()=>{m||h(C)},[C,m]);const w=A.useCallback(()=>{v.current&&S.current&&(S.current.scrollTop=v.current.scrollTop,S.current.scrollLeft=v.current.scrollLeft)},[]),{targetSection:I,targetAsset:R,scrollTimestamp:k,clearTarget:D}=zs(),L=o?C:m;A.useEffect(()=>{if(!I&&!R||!S.current)return;const W=L.split(`
`);let q=-1;if(I){const se={schemas:["schemas:"],variables:["variables:"],service_principals:["service_principals:"],resources:["resources:"],retrievers:["retrievers:"],tools:["tools:"],guardrails:["guardrails:"],memory:["memory:"],prompts:["prompts:"],agents:["agents:"],app:["app:"]}[I]||[`${I}:`];for(let H=0;H<W.length;H++){const z=W[H];for(const te of se)if(z.startsWith(te)){q=H;break}if(q>=0)break}}else if(R){const ce=new RegExp(`^\\s*${R}:\\s*&${R}`),se=new RegExp(`^\\s*${R}:`);for(let H=0;H<W.length;H++){const z=W[H];if(ce.test(z)){q=H;break}se.test(z)&&(q=H)}}if(q>=0){const se=q*24;S.current.scrollTo({top:Math.max(0,se-48),behavior:"smooth"})}D()},[I,R,k,L,D]);const V=async()=>{await navigator.clipboard.writeText(o?C:m),n(!0),setTimeout(()=>n(!1),2e3)},B=O=>{var W;h(O),g(O!==C);try{Na.load(O),c(null)}catch(q){q instanceof Na.YAMLException&&c({line:(W=q.mark)!=null&&W.line?q.mark.line+1:0,message:q.message})}},T=()=>{if(!r)try{const O=gm(m);bm(O);const W=Na.load(m);s(W),g(!1),u(!0)}catch(O){console.error("Failed to apply YAML changes:",O)}},F=()=>{h(C),c(null),g(!1)},E=()=>{if(!o&&d){if(!confirm("You have unsaved changes. Discard them?"))return;F()}u(!o)},p=(()=>{const O=new Set;return r!=null&&r.line&&O.add(r.line),O})(),N=O=>O.split(`
`).map((q,ce)=>{const se=ce+1,H=p.has(se);return t.jsx("div",{className:`text-right pr-3 select-none ${H?"bg-red-500/20 text-red-400 font-bold":"text-slate-600"}`,style:{height:"1.5rem",lineHeight:"1.5rem"},children:se},ce)}),P=O=>O.split(`
`).map((W,q)=>{const ce=q+1,se=p.has(ce);let H;if(W.trim().startsWith("#"))H=t.jsx("span",{className:"text-slate-500",children:W});else if(W.match(/^(\s*)([a-zA-Z_][a-zA-Z0-9_]*):(.*)$/)){const z=W.match(/^(\s*)([a-zA-Z_][a-zA-Z0-9_]*):(.*)$/),[,te,K,he]=z;H=t.jsxs("span",{children:[te,t.jsx("span",{className:"text-blue-400",children:K}),t.jsx("span",{className:"text-slate-400",children:":"}),t.jsx("span",{className:"text-emerald-400",children:he})]})}else W.trim().startsWith("-")?H=t.jsx("span",{className:"text-amber-400",children:W}):H=t.jsx("span",{className:"text-slate-300",children:W});return t.jsx("div",{className:`px-2 -mx-2 ${se?"bg-red-500/20 border-l-2 border-red-500":"hover:bg-slate-800/30"}`,style:{height:"1.5rem",lineHeight:"1.5rem"},children:H},q)}),M=()=>!o&&r?t.jsxs("div",{className:"flex items-center space-x-2 text-red-400",children:[t.jsx(As,{className:"w-4 h-4"}),t.jsxs("span",{className:"text-xs",children:["YAML Error (line ",r.line,")"]})]}):f?x?t.jsxs("div",{className:"flex items-center space-x-2 text-slate-400",children:[t.jsx(Nt,{className:"w-4 h-4 animate-spin"}),t.jsx("span",{className:"text-xs",children:"Validating..."})]}):_?t.jsxs("div",{className:"flex items-center space-x-2 text-amber-400",children:[t.jsx(Vn,{className:"w-4 h-4"}),t.jsx("span",{className:"text-xs",title:_,children:"Schema error"})]}):y===!0?t.jsxs("div",{className:"flex items-center space-x-2 text-emerald-400",children:[t.jsx(go,{className:"w-4 h-4"}),t.jsx("span",{className:"text-xs",children:"Valid"})]}):y===!1?t.jsxs("button",{onClick:()=>l(!i),className:"flex items-center space-x-2 text-red-400 hover:text-red-300 transition-colors",children:[t.jsx(As,{className:"w-4 h-4"}),t.jsxs("span",{className:"text-xs",children:[b.length," error",b.length!==1?"s":""]}),i?t.jsx(ya,{className:"w-3 h-3"}):t.jsx(Wt,{className:"w-3 h-3"})]}):null:t.jsxs("div",{className:"flex items-center space-x-2 text-slate-400",children:[t.jsx(Nt,{className:"w-4 h-4 animate-spin"}),t.jsx("span",{className:"text-xs",children:"Loading schema..."})]});return t.jsxs("div",{className:"h-full flex flex-col bg-slate-950",children:[t.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-800",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(bo,{className:"w-4 h-4 text-slate-400"}),t.jsxs("span",{className:"text-sm font-medium text-slate-300",children:["YAML ",o?"Preview":"Editor"]}),!o&&d&&t.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-medium bg-amber-500/20 text-amber-400 rounded",children:"Modified"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[M(),t.jsx(ee,{variant:"ghost",size:"sm",onClick:E,title:o?"Unlock to edit YAML":"Lock to prevent edits",className:o?"":"text-amber-400 hover:text-amber-300",children:o?t.jsxs(t.Fragment,{children:[t.jsx(vo,{className:"w-4 h-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Locked"})]}):t.jsxs(t.Fragment,{children:[t.jsx(yf,{className:"w-4 h-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Editing"})]})}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:V,children:a?t.jsxs(t.Fragment,{children:[t.jsx(bi,{className:"w-4 h-4 text-emerald-400"}),t.jsx("span",{className:"text-emerald-400",children:"Copied!"})]}):t.jsxs(t.Fragment,{children:[t.jsx(rf,{className:"w-4 h-4"}),"Copy"]})})]})]}),!o&&t.jsx("div",{className:"px-4 py-2 bg-amber-950/30 border-b border-amber-900/50",children:t.jsxs("div",{className:"flex items-center gap-2 text-xs text-amber-400",children:[t.jsx(fr,{className:"w-3 h-3"}),t.jsx("span",{children:"Edit mode: Changes here will update the UI configuration when applied"})]})}),!o&&r&&t.jsx("div",{className:"border-b border-slate-800 bg-red-950/30 px-4 py-2",children:t.jsxs("div",{className:"text-xs flex items-start space-x-2",children:[t.jsxs("span",{className:"text-red-400 font-mono shrink-0",children:["Line ",r.line,":"]}),t.jsx("span",{className:"text-red-300",children:r.message})]})}),y===!1&&i&&b.length>0&&!r&&t.jsx("div",{className:"border-b border-slate-800 bg-red-950/30 max-h-48 overflow-auto",children:t.jsx("div",{className:"px-4 py-2 space-y-1",children:b.map((O,W)=>t.jsxs("div",{className:"text-xs flex items-start space-x-2",children:[t.jsx("span",{className:"text-red-400 font-mono shrink-0",children:O.path||"/"}),t.jsx("span",{className:"text-red-300",children:O.message})]},W))})}),_&&t.jsxs("div",{className:"border-b border-slate-800 bg-amber-950/30 px-4 py-2",children:[t.jsxs("p",{className:"text-xs text-amber-400",children:[t.jsx("strong",{children:"Schema Error:"})," ",_]}),t.jsx("p",{className:"text-xs text-amber-500 mt-1",children:"Validation is unavailable. The YAML may still be valid."})]}),t.jsx("div",{className:"flex-1 overflow-auto",ref:S,children:t.jsxs("div",{className:"flex min-h-full",children:[t.jsx("div",{className:"w-12 bg-slate-900/50 border-r border-slate-800 font-mono text-sm flex-shrink-0 sticky left-0",style:{lineHeight:"1.5rem"},children:t.jsx("div",{className:"py-4",children:N(L)})}),t.jsx("div",{className:"flex-1 min-w-0",children:o?t.jsx("pre",{className:"code-block text-sm p-4",style:{lineHeight:"1.5rem"},children:P(L)}):t.jsx("textarea",{ref:v,value:m,onChange:O=>B(O.target.value),onScroll:w,spellCheck:!1,className:"w-full h-full p-4 bg-transparent text-slate-300 font-mono text-sm resize-none focus:outline-none",style:{lineHeight:"1.5rem",tabSize:2,minHeight:"100%"}})})]})}),t.jsx("div",{className:"px-4 py-3 border-t border-slate-800 bg-slate-900/50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("p",{className:"text-xs text-slate-500",children:[L.split(`
`).length," lines  ",o?"Auto-updates as you configure":"Editing manually"]}),!o&&d?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ee,{variant:"ghost",size:"sm",onClick:F,children:"Discard"}),t.jsxs(ee,{variant:"primary",size:"sm",onClick:T,disabled:!!r,children:[t.jsx(bi,{className:"w-4 h-4"}),"Apply Changes"]})]}):f&&!_&&t.jsx("p",{className:"text-xs text-slate-600",children:"Validated against dao-ai schema"})]})})]})}const Tb={};function Eb(e,s){let a;try{a=e()}catch{return}return{getItem:i=>{var l;const o=m=>m===null?null:JSON.parse(m,void 0),u=(l=a.getItem(i))!=null?l:null;return u instanceof Promise?u.then(o):o(u)},setItem:(i,l)=>a.setItem(i,JSON.stringify(l,void 0)),removeItem:i=>a.removeItem(i)}}const Sr=e=>s=>{try{const a=e(s);return a instanceof Promise?a:{then(n){return Sr(n)(a)},catch(n){return this}}}catch(a){return{then(n){return this},catch(n){return Sr(n)(a)}}}},Ab=(e,s)=>(a,n,i)=>{let l={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:y=>y,version:0,merge:(y,b)=>({...b,...y}),...s},o=!1;const u=new Set,m=new Set;let h;try{h=l.getStorage()}catch{}if(!h)return e((...y)=>{console.warn(`[zustand persist middleware] Unable to update item '${l.name}', the given storage is currently unavailable.`),a(...y)},n,i);const r=Sr(l.serialize),c=()=>{const y=l.partialize({...n()});let b;const _=r({state:y,version:l.version}).then(x=>h.setItem(l.name,x)).catch(x=>{b=x});if(b)throw b;return _},d=i.setState;i.setState=(y,b)=>{d(y,b),c()};const g=e((...y)=>{a(...y),c()},n,i);let v;const S=()=>{var y;if(!h)return;o=!1,u.forEach(_=>_(n()));const b=((y=l.onRehydrateStorage)==null?void 0:y.call(l,n()))||void 0;return Sr(h.getItem.bind(h))(l.name).then(_=>{if(_)return l.deserialize(_)}).then(_=>{if(_)if(typeof _.version=="number"&&_.version!==l.version){if(l.migrate)return l.migrate(_.state,_.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return _.state}).then(_=>{var x;return v=l.merge(_,(x=n())!=null?x:g),a(v,!0),c()}).then(()=>{b==null||b(v,void 0),o=!0,m.forEach(_=>_(v))}).catch(_=>{b==null||b(void 0,_)})};return i.persist={setOptions:y=>{l={...l,...y},y.getStorage&&(h=y.getStorage())},clearStorage:()=>{h==null||h.removeItem(l.name)},getOptions:()=>l,rehydrate:()=>S(),hasHydrated:()=>o,onHydrate:y=>(u.add(y),()=>{u.delete(y)}),onFinishHydration:y=>(m.add(y),()=>{m.delete(y)})},S(),v||g},Pb=(e,s)=>(a,n,i)=>{let l={storage:Eb(()=>localStorage),partialize:S=>S,version:0,merge:(S,y)=>({...y,...S}),...s},o=!1;const u=new Set,m=new Set;let h=l.storage;if(!h)return e((...S)=>{console.warn(`[zustand persist middleware] Unable to update item '${l.name}', the given storage is currently unavailable.`),a(...S)},n,i);const r=()=>{const S=l.partialize({...n()});return h.setItem(l.name,{state:S,version:l.version})},c=i.setState;i.setState=(S,y)=>{c(S,y),r()};const d=e((...S)=>{a(...S),r()},n,i);i.getInitialState=()=>d;let g;const v=()=>{var S,y;if(!h)return;o=!1,u.forEach(_=>{var x;return _((x=n())!=null?x:d)});const b=((y=l.onRehydrateStorage)==null?void 0:y.call(l,(S=n())!=null?S:d))||void 0;return Sr(h.getItem.bind(h))(l.name).then(_=>{if(_)if(typeof _.version=="number"&&_.version!==l.version){if(l.migrate)return[!0,l.migrate(_.state,_.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,_.state];return[!1,void 0]}).then(_=>{var x;const[f,C]=_;if(g=l.merge(C,(x=n())!=null?x:d),a(g,!0),f)return r()}).then(()=>{b==null||b(g,void 0),g=n(),o=!0,m.forEach(_=>_(g))}).catch(_=>{b==null||b(void 0,_)})};return i.persist={setOptions:S=>{l={...l,...S},S.storage&&(h=S.storage)},clearStorage:()=>{h==null||h.removeItem(l.name)},getOptions:()=>l,rehydrate:()=>v(),hasHydrated:()=>o,onHydrate:S=>(u.add(S),()=>{u.delete(S)}),onFinishHydration:S=>(m.add(S),()=>{m.delete(S)})},l.skipHydration||v(),g||d},Ib=(e,s)=>"getStorage"in s||"serialize"in s||"deserialize"in s?((Tb?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),Ab(e,s)):Pb(e,s),Tm=Ib,ud=()=>`conv-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,Em=Yn()(Tm(e=>({conversationId:ud(),messages:[],logs:[],addMessage:(s,a)=>{e(n=>({messages:[...n.messages,{role:s,content:a,timestamp:new Date().toISOString()}]}))},updateLastMessage:s=>{e(a=>{const n=[...a.messages];return n.length>0&&(n[n.length-1]={...n[n.length-1],content:s}),{messages:n}})},addLog:(s,a)=>{e(n=>({logs:[...n.logs,{timestamp:new Date().toISOString(),level:s,message:a}]}))},clearLogs:()=>{e({logs:[]})},startNewSession:()=>{e({conversationId:ud(),messages:[],logs:[]})},removeEmptyMessages:()=>{e(s=>({messages:s.messages.filter(a=>a.content||a.role==="user")}))}}),{name:"dao-chat-storage",partialize:e=>({conversationId:e.conversationId,messages:e.messages})}));function si({isOpen:e,onClose:s,onConfigured:a,autoDetectedHost:n,inDatabricksApp:i=!1,hasOboToken:l=!1,oauthInfo:o}){const[u,m]=A.useState(""),[h,r]=A.useState(""),[c,d]=A.useState(!1),[g,v]=A.useState(!1),[S,y]=A.useState(null),b=ln();A.useEffect(()=>{if(e){const R=ln();R?(m(R.host),r(R.token)):n&&m(n),y(null)}},[e,n]);const _=async()=>{if(h){d(!0),y(null);try{console.log("[DatabricksConfigModal] Testing manual token...");const R=await fetch("/api/auth/verify",{headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json","X-Databricks-Host":(u||n||"").replace(/\/$/,"")},credentials:"include"}),k=await R.json();if(console.log("[DatabricksConfigModal] Verify response:",k),k.authenticated&&k.user){const D=k.token_source==="manual"?"Personal Access Token":k.token_source==="obo"?"On-Behalf-Of User":k.token_source==="oauth"?"OAuth":k.token_source==="sdk"?"SDK Config":k.token_source==="env"?"Environment Variable":k.token_source;or({host:k.host||u||n||"",token:h,source:"manual"}),y({success:!0,message:`Connected as ${k.user.displayName||k.user.userName}`,tokenSource:D})}else{const D=k.error||k.message||k.help||`Connection failed (${R.status}): ${R.statusText||"Unknown error"}`;y({success:!1,message:D,requiredScopes:k.required_scopes})}}catch(R){const k=R instanceof Error?`${R.name}: ${R.message}`:"Connection failed - unknown error";y({success:!1,message:k})}finally{d(!1)}}else{d(!0),y(null);try{const k=await(await fetch("/api/auth/verify",{credentials:"include"})).json();k.authenticated&&k.user?(or({host:k.host||n||"",token:`__${(k.token_source||"AUTO").toUpperCase()}_TOKEN__`,isAutoDetected:!0,source:k.token_source}),y({success:!0,message:`Connected as ${k.user.displayName||k.user.userName}`})):y({success:!1,message:k.error||k.help||"Authentication failed",requiredScopes:k.required_scopes})}catch(R){const k=R instanceof Error?`${R.name}: ${R.message}`:"Connection failed - unknown error";y({success:!1,message:k})}finally{d(!1)}}},x=()=>{if(h)or({host:u||n||"",token:h,source:"manual"});else if(S!=null&&S.success){const R=ln();R&&or(R)}else return;a(),s()},f=async()=>{(b==null?void 0:b.source)==="oauth"&&await gg(),Nm(),m(n||""),r(""),y(null),a(),s()},C=async()=>{v(!0),y(null);try{const k=await xg(u||n||void 0);k.auth_url&&k.redirect?window.location.href=k.auth_url:k.error&&y({success:!1,message:k.message||k.error})}catch(R){y({success:!1,message:R instanceof Error?R.message:"OAuth login failed"})}finally{v(!1)}},w=R=>{switch(R){case"oauth":return"OAuth";case"obo":return"On-Behalf-Of User";case"header":return"On-Behalf-Of User Auth";case"sdk":return"Databricks SDK Config";case"env":return"Environment Variables";case"manual":return"Manual Configuration";default:return"Unknown"}},I=R=>{switch(R){case"oauth":return $l;case"obo":case"header":return Ja;case"sdk":case"env":return gr;default:return br}};return t.jsx(ws,{isOpen:e,onClose:s,title:"Databricks Connection",description:"Configure your Databricks workspace connection.",children:t.jsxs("div",{className:"space-y-4",children:[i&&l&&(b==null?void 0:b.source)==="obo"&&t.jsx("div",{className:"p-3 rounded-lg bg-blue-500/10 border border-blue-500/20",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(Ja,{className:"w-5 h-5 text-blue-400 mt-0.5 flex-shrink-0"}),t.jsxs("div",{className:"text-sm",children:[t.jsx("p",{className:"text-blue-300 font-medium",children:"On-Behalf-Of User Authentication Active"}),t.jsx("p",{className:"text-blue-400/80 mt-1",children:"API calls are authenticated using your Databricks session. No manual token required."})]})]})}),i&&!l&&!b&&t.jsx("div",{className:"p-3 rounded-lg bg-amber-500/10 border border-amber-500/20",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(Vn,{className:"w-5 h-5 text-amber-400 mt-0.5 flex-shrink-0"}),t.jsxs("div",{className:"text-sm",children:[t.jsx("p",{className:"text-amber-300 font-medium",children:"On-Behalf-Of User Auth Not Enabled"}),t.jsx("p",{className:"text-amber-400/80 mt-1",children:"This app is running in Databricks but OBO auth is not enabled. You can still configure a Personal Access Token manually."})]})]})}),(b==null?void 0:b.isAutoDetected)&&b.source!=="obo"&&t.jsx("div",{className:"p-3 rounded-lg bg-green-500/10 border border-green-500/20",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[(()=>{const R=I(b.source);return t.jsx(R,{className:"w-5 h-5 text-green-400 mt-0.5 flex-shrink-0"})})(),t.jsxs("div",{className:"text-sm",children:[t.jsxs("p",{className:"text-green-300 font-medium",children:["Connected via ",w(b.source)]}),t.jsx("p",{className:"text-green-400/80 mt-1",children:b.source==="oauth"?"Authenticated via OAuth. Your session is secure.":b.source==="sdk"?"Using Databricks SDK Config (~/.databrickscfg or environment variables).":b.source==="env"?"Using DATABRICKS_HOST and DATABRICKS_TOKEN environment variables.":"Using X-Forwarded-Access-Token from Databricks App proxy."}),b.host&&t.jsxs("p",{className:"text-green-400/60 mt-1 font-mono text-xs",children:["Host: ",b.host]})]})]})}),(o==null?void 0:o.configured)&&!b&&t.jsx("div",{className:"p-4 rounded-lg bg-gradient-to-r from-blue-600/20 to-purple-600/20 border border-blue-500/30",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx($l,{className:"w-6 h-6 text-blue-400 mt-0.5"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-blue-300 font-medium",children:"Login with Databricks"}),t.jsx("p",{className:"text-blue-400/80 text-sm mt-1",children:"Securely authenticate with OAuth to access Databricks APIs."}),o.scopes&&o.scopes.length>0&&t.jsxs("p",{className:"text-blue-400/60 text-xs mt-2",children:["Scopes: ",o.scopes.slice(0,3).join(", "),o.scopes.length>3&&` +${o.scopes.length-3} more`]})]})]}),t.jsx(ee,{type:"button",onClick:C,disabled:g||!u,className:"flex items-center space-x-2",children:g?"Redirecting...":t.jsxs(t.Fragment,{children:[t.jsx("span",{children:"Login"}),t.jsx(lf,{className:"w-4 h-4"})]})})]})}),n&&!b&&t.jsx("div",{className:"p-3 rounded-lg bg-blue-500/10 border border-blue-500/20",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(br,{className:"w-5 h-5 text-blue-400 mt-0.5 flex-shrink-0"}),t.jsxs("div",{className:"text-sm",children:[t.jsx("p",{className:"text-blue-300 font-medium",children:"Workspace Detected"}),t.jsxs("p",{className:"text-blue-400/80 mt-1",children:["Host auto-detected. Enter your Personal Access Token or set ",t.jsx("code",{className:"text-xs bg-blue-900/50 px-1 rounded",children:"DATABRICKS_TOKEN"})," env var."]})]})]})}),t.jsx(U,{label:"Workspace URL",placeholder:"https://your-workspace.cloud.databricks.com",value:u,onChange:R=>m(R.target.value),hint:n?"Auto-detected from URL (editable)":"Your Databricks workspace URL",required:!0}),t.jsx(U,{label:"Personal Access Token",type:"password",placeholder:"dapi...",value:h,onChange:R=>r(R.target.value),hint:"Or set DATABRICKS_TOKEN environment variable",required:!0}),!(b!=null&&b.isAutoDetected)&&t.jsx("div",{className:"p-3 rounded-lg bg-slate-800/50 border border-slate-700",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(Vn,{className:"w-5 h-5 text-slate-400 mt-0.5 flex-shrink-0"}),t.jsxs("div",{className:"text-sm text-slate-400",children:[t.jsx("p",{className:"font-medium text-slate-300",children:"Authentication Options"}),t.jsxs("ul",{className:"mt-2 space-y-1 list-disc list-inside text-xs",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"On-behalf-of-user auth"})," - Automatic in Databricks Apps"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Personal Access Token"})," - Enter manually below"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Environment variable"})," - Set ",t.jsx("code",{className:"bg-slate-700 px-1 rounded",children:"DATABRICKS_TOKEN"})]})]}),t.jsxs("p",{className:"mt-2 text-xs text-slate-500",children:[t.jsx("strong",{children:"Scope errors?"})," If using OBO auth, try signing out of Databricks and signing back in to re-authorize the app with updated scopes."]})]})]})}),S&&t.jsxs("div",{className:`p-3 rounded-lg text-sm ${S.success?"bg-green-500/20 text-green-400 border border-green-500/30":"bg-red-500/20 text-red-400 border border-red-500/30"}`,children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{children:S.message}),S.success&&S.tokenSource&&t.jsxs("span",{className:"text-xs bg-green-900/30 px-2 py-0.5 rounded",children:["via ",S.tokenSource]})]}),S.requiredScopes&&S.requiredScopes.length>0&&t.jsxs("div",{className:"mt-2 pt-2 border-t border-red-500/20",children:[t.jsx("p",{className:"font-medium mb-1",children:"Required scopes:"}),t.jsx("ul",{className:"list-disc list-inside text-xs space-y-0.5",children:S.requiredScopes.map(R=>t.jsx("li",{children:t.jsx("code",{className:"bg-red-900/30 px-1 rounded",children:R})},R))}),t.jsxs("p",{className:"mt-2 text-xs text-red-300/80",children:["Add these to ",t.jsx("code",{className:"bg-red-900/30 px-1 rounded",children:"user_api_scopes"})," in databricks.yml and redeploy."]})]})]}),t.jsxs("div",{className:"flex justify-between pt-4",children:[t.jsx(ee,{variant:"danger",type:"button",onClick:f,disabled:!ln(),children:"Disconnect"}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsx(ee,{variant:"secondary",type:"button",onClick:_,disabled:c||!h&&!l&&!i,children:c?"Testing...":"Test Connection"}),t.jsx(ee,{type:"button",onClick:x,disabled:!(S!=null&&S.success),children:"Save"})]})]}),t.jsx("div",{className:"pt-4 border-t border-slate-700",children:t.jsx("p",{className:"text-xs text-slate-500",children:"Credentials are stored in browser localStorage and sent only to your Databricks workspace."})})]})})}function Ob(){const[e,s]=A.useState(!1),{detecting:a,detected:n,autoDetectedHost:i,inDatabricksApp:l,hasToken:o,oauthInfo:u,redetect:m}=_g(),{data:h,loading:r,error:c,refetch:d,configured:g}=Sm(),v=A.useCallback(()=>{console.log("[ConnectionStatus] Config changed, re-detecting and refetching..."),m(),d()},[d,m]);if(A.useEffect(()=>{!a&&n&&d()},[a,n,d]),a)return t.jsxs("div",{className:"flex items-center space-x-2 text-slate-400",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-yellow-500 animate-pulse"}),t.jsx("span",{className:"text-sm",children:"Detecting..."})]});if(!g)return t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:()=>s(!0),className:"flex items-center space-x-2 text-slate-400 hover:text-white transition-colors",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-slate-500"}),t.jsx("span",{className:"text-sm",children:i?"Token required":"Not connected"}),t.jsx(ca,{className:"w-4 h-4"})]}),t.jsx(si,{isOpen:e,onClose:()=>s(!1),onConfigured:v,autoDetectedHost:i,oauthInfo:u})]});if(r)return t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:()=>s(!0),className:"flex items-center space-x-2 text-slate-400",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-yellow-500 animate-pulse"}),t.jsx("span",{className:"text-sm",children:"Connecting..."}),t.jsx(ca,{className:"w-4 h-4"})]}),t.jsx(si,{isOpen:e,onClose:()=>s(!1),onConfigured:v,autoDetectedHost:i,oauthInfo:u})]});if(c||!(h!=null&&h.connected))return console.log("[ConnectionStatus] Showing failed state - error:",c,"status:",h),t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:()=>s(!0),className:"flex items-center space-x-2 text-red-400 hover:text-red-300 transition-colors",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),t.jsxs("span",{className:"text-sm",children:["Connection failed",h!=null&&h.error?`: ${h.error}`:""]}),t.jsx(ca,{className:"w-4 h-4"})]}),t.jsx(si,{isOpen:e,onClose:()=>s(!1),onConfigured:v,autoDetectedHost:i,oauthInfo:u})]});const S=h.source==="oauth"?"OAuth":h.source==="obo"?"On-Behalf-Of User":h.source==="sdk"?"SDK Config":h.source==="env"?"Environment":"Manual",b=h.source==="oauth"?$l:h.source==="obo"?Ja:br;return t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:()=>s(!0),className:"flex items-center space-x-2 hover:bg-slate-800 px-2 py-1 rounded transition-colors",title:`Connected via ${S} authentication`,children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),h.isAutoDetected&&t.jsx(b,{className:`w-3 h-3 ${h.source==="obo"?"text-blue-400":"text-yellow-400"}`}),t.jsx("span",{className:"text-sm text-slate-300",children:t.jsx("span",{className:"text-white font-medium",children:h.display_name||h.user})}),t.jsx(ca,{className:"w-4 h-4 text-slate-500"})]}),t.jsx(si,{isOpen:e,onClose:()=>s(!1),onConfigured:v,autoDetectedHost:i,inDatabricksApp:l,hasOboToken:o,oauthInfo:u})]})}function Ft(e){if(typeof e=="string"||typeof e=="number")return""+e;let s="";if(Array.isArray(e))for(let a=0,n;a<e.length;a++)(n=Ft(e[a]))!==""&&(s+=(s&&" ")+n);else for(let a in e)e[a]&&(s+=(s&&" ")+a);return s}var Lb={value:()=>{}};function Fi(){for(var e=0,s=arguments.length,a={},n;e<s;++e){if(!(n=arguments[e]+"")||n in a||/[\s.]/.test(n))throw new Error("illegal type: "+n);a[n]=[]}return new hi(a)}function hi(e){this._=e}function $b(e,s){return e.trim().split(/^|\s+/).map(function(a){var n="",i=a.indexOf(".");if(i>=0&&(n=a.slice(i+1),a=a.slice(0,i)),a&&!s.hasOwnProperty(a))throw new Error("unknown type: "+a);return{type:a,name:n}})}hi.prototype=Fi.prototype={constructor:hi,on:function(e,s){var a=this._,n=$b(e+"",a),i,l=-1,o=n.length;if(arguments.length<2){for(;++l<o;)if((i=(e=n[l]).type)&&(i=Vb(a[i],e.name)))return i;return}if(s!=null&&typeof s!="function")throw new Error("invalid callback: "+s);for(;++l<o;)if(i=(e=n[l]).type)a[i]=md(a[i],e.name,s);else if(s==null)for(i in a)a[i]=md(a[i],e.name,null);return this},copy:function(){var e={},s=this._;for(var a in s)e[a]=s[a].slice();return new hi(e)},call:function(e,s){if((i=arguments.length-2)>0)for(var a=new Array(i),n=0,i,l;n<i;++n)a[n]=arguments[n+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(l=this._[e],n=0,i=l.length;n<i;++n)l[n].value.apply(s,a)},apply:function(e,s,a){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var n=this._[e],i=0,l=n.length;i<l;++i)n[i].value.apply(s,a)}};function Vb(e,s){for(var a=0,n=e.length,i;a<n;++a)if((i=e[a]).name===s)return i.value}function md(e,s,a){for(var n=0,i=e.length;n<i;++n)if(e[n].name===s){e[n]=Lb,e=e.slice(0,n).concat(e.slice(n+1));break}return a!=null&&e.push({name:s,value:a}),e}var Zl="http://www.w3.org/1999/xhtml";const hd={svg:"http://www.w3.org/2000/svg",xhtml:Zl,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function zi(e){var s=e+="",a=s.indexOf(":");return a>=0&&(s=e.slice(0,a))!=="xmlns"&&(e=e.slice(a+1)),hd.hasOwnProperty(s)?{space:hd[s],local:e}:e}function Db(e){return function(){var s=this.ownerDocument,a=this.namespaceURI;return a===Zl&&s.documentElement.namespaceURI===Zl?s.createElement(e):s.createElementNS(a,e)}}function Fb(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Am(e){var s=zi(e);return(s.local?Fb:Db)(s)}function zb(){}function To(e){return e==null?zb:function(){return this.querySelector(e)}}function Hb(e){typeof e!="function"&&(e=To(e));for(var s=this._groups,a=s.length,n=new Array(a),i=0;i<a;++i)for(var l=s[i],o=l.length,u=n[i]=new Array(o),m,h,r=0;r<o;++r)(m=l[r])&&(h=e.call(m,m.__data__,r,l))&&("__data__"in m&&(h.__data__=m.__data__),u[r]=h);return new Is(n,this._parents)}function Bb(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function Wb(){return[]}function Pm(e){return e==null?Wb:function(){return this.querySelectorAll(e)}}function Ub(e){return function(){return Bb(e.apply(this,arguments))}}function qb(e){typeof e=="function"?e=Ub(e):e=Pm(e);for(var s=this._groups,a=s.length,n=[],i=[],l=0;l<a;++l)for(var o=s[l],u=o.length,m,h=0;h<u;++h)(m=o[h])&&(n.push(e.call(m,m.__data__,h,o)),i.push(m));return new Is(n,i)}function Im(e){return function(){return this.matches(e)}}function Om(e){return function(s){return s.matches(e)}}var Gb=Array.prototype.find;function Yb(e){return function(){return Gb.call(this.children,e)}}function Kb(){return this.firstElementChild}function Xb(e){return this.select(e==null?Kb:Yb(typeof e=="function"?e:Om(e)))}var Jb=Array.prototype.filter;function Qb(){return Array.from(this.children)}function Zb(e){return function(){return Jb.call(this.children,e)}}function ev(e){return this.selectAll(e==null?Qb:Zb(typeof e=="function"?e:Om(e)))}function tv(e){typeof e!="function"&&(e=Im(e));for(var s=this._groups,a=s.length,n=new Array(a),i=0;i<a;++i)for(var l=s[i],o=l.length,u=n[i]=[],m,h=0;h<o;++h)(m=l[h])&&e.call(m,m.__data__,h,l)&&u.push(m);return new Is(n,this._parents)}function Lm(e){return new Array(e.length)}function sv(){return new Is(this._enter||this._groups.map(Lm),this._parents)}function Ci(e,s){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=s}Ci.prototype={constructor:Ci,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,s){return this._parent.insertBefore(e,s)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function av(e){return function(){return e}}function nv(e,s,a,n,i,l){for(var o=0,u,m=s.length,h=l.length;o<h;++o)(u=s[o])?(u.__data__=l[o],n[o]=u):a[o]=new Ci(e,l[o]);for(;o<m;++o)(u=s[o])&&(i[o]=u)}function rv(e,s,a,n,i,l,o){var u,m,h=new Map,r=s.length,c=l.length,d=new Array(r),g;for(u=0;u<r;++u)(m=s[u])&&(d[u]=g=o.call(m,m.__data__,u,s)+"",h.has(g)?i[u]=m:h.set(g,m));for(u=0;u<c;++u)g=o.call(e,l[u],u,l)+"",(m=h.get(g))?(n[u]=m,m.__data__=l[u],h.delete(g)):a[u]=new Ci(e,l[u]);for(u=0;u<r;++u)(m=s[u])&&h.get(d[u])===m&&(i[u]=m)}function iv(e){return e.__data__}function lv(e,s){if(!arguments.length)return Array.from(this,iv);var a=s?rv:nv,n=this._parents,i=this._groups;typeof e!="function"&&(e=av(e));for(var l=i.length,o=new Array(l),u=new Array(l),m=new Array(l),h=0;h<l;++h){var r=n[h],c=i[h],d=c.length,g=ov(e.call(r,r&&r.__data__,h,n)),v=g.length,S=u[h]=new Array(v),y=o[h]=new Array(v),b=m[h]=new Array(d);a(r,c,S,y,b,g,s);for(var _=0,x=0,f,C;_<v;++_)if(f=S[_]){for(_>=x&&(x=_+1);!(C=y[x])&&++x<v;);f._next=C||null}}return o=new Is(o,n),o._enter=u,o._exit=m,o}function ov(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function cv(){return new Is(this._exit||this._groups.map(Lm),this._parents)}function dv(e,s,a){var n=this.enter(),i=this,l=this.exit();return typeof e=="function"?(n=e(n),n&&(n=n.selection())):n=n.append(e+""),s!=null&&(i=s(i),i&&(i=i.selection())),a==null?l.remove():a(l),n&&i?n.merge(i).order():i}function uv(e){for(var s=e.selection?e.selection():e,a=this._groups,n=s._groups,i=a.length,l=n.length,o=Math.min(i,l),u=new Array(i),m=0;m<o;++m)for(var h=a[m],r=n[m],c=h.length,d=u[m]=new Array(c),g,v=0;v<c;++v)(g=h[v]||r[v])&&(d[v]=g);for(;m<i;++m)u[m]=a[m];return new Is(u,this._parents)}function mv(){for(var e=this._groups,s=-1,a=e.length;++s<a;)for(var n=e[s],i=n.length-1,l=n[i],o;--i>=0;)(o=n[i])&&(l&&o.compareDocumentPosition(l)^4&&l.parentNode.insertBefore(o,l),l=o);return this}function hv(e){e||(e=pv);function s(c,d){return c&&d?e(c.__data__,d.__data__):!c-!d}for(var a=this._groups,n=a.length,i=new Array(n),l=0;l<n;++l){for(var o=a[l],u=o.length,m=i[l]=new Array(u),h,r=0;r<u;++r)(h=o[r])&&(m[r]=h);m.sort(s)}return new Is(i,this._parents).order()}function pv(e,s){return e<s?-1:e>s?1:e>=s?0:NaN}function fv(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function xv(){return Array.from(this)}function gv(){for(var e=this._groups,s=0,a=e.length;s<a;++s)for(var n=e[s],i=0,l=n.length;i<l;++i){var o=n[i];if(o)return o}return null}function bv(){let e=0;for(const s of this)++e;return e}function vv(){return!this.node()}function yv(e){for(var s=this._groups,a=0,n=s.length;a<n;++a)for(var i=s[a],l=0,o=i.length,u;l<o;++l)(u=i[l])&&e.call(u,u.__data__,l,i);return this}function jv(e){return function(){this.removeAttribute(e)}}function _v(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Nv(e,s){return function(){this.setAttribute(e,s)}}function wv(e,s){return function(){this.setAttributeNS(e.space,e.local,s)}}function Sv(e,s){return function(){var a=s.apply(this,arguments);a==null?this.removeAttribute(e):this.setAttribute(e,a)}}function Cv(e,s){return function(){var a=s.apply(this,arguments);a==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,a)}}function kv(e,s){var a=zi(e);if(arguments.length<2){var n=this.node();return a.local?n.getAttributeNS(a.space,a.local):n.getAttribute(a)}return this.each((s==null?a.local?_v:jv:typeof s=="function"?a.local?Cv:Sv:a.local?wv:Nv)(a,s))}function $m(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Mv(e){return function(){this.style.removeProperty(e)}}function Rv(e,s,a){return function(){this.style.setProperty(e,s,a)}}function Tv(e,s,a){return function(){var n=s.apply(this,arguments);n==null?this.style.removeProperty(e):this.style.setProperty(e,n,a)}}function Ev(e,s,a){return arguments.length>1?this.each((s==null?Mv:typeof s=="function"?Tv:Rv)(e,s,a??"")):zn(this.node(),e)}function zn(e,s){return e.style.getPropertyValue(s)||$m(e).getComputedStyle(e,null).getPropertyValue(s)}function Av(e){return function(){delete this[e]}}function Pv(e,s){return function(){this[e]=s}}function Iv(e,s){return function(){var a=s.apply(this,arguments);a==null?delete this[e]:this[e]=a}}function Ov(e,s){return arguments.length>1?this.each((s==null?Av:typeof s=="function"?Iv:Pv)(e,s)):this.node()[e]}function Vm(e){return e.trim().split(/^|\s+/)}function Eo(e){return e.classList||new Dm(e)}function Dm(e){this._node=e,this._names=Vm(e.getAttribute("class")||"")}Dm.prototype={add:function(e){var s=this._names.indexOf(e);s<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var s=this._names.indexOf(e);s>=0&&(this._names.splice(s,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function Fm(e,s){for(var a=Eo(e),n=-1,i=s.length;++n<i;)a.add(s[n])}function zm(e,s){for(var a=Eo(e),n=-1,i=s.length;++n<i;)a.remove(s[n])}function Lv(e){return function(){Fm(this,e)}}function $v(e){return function(){zm(this,e)}}function Vv(e,s){return function(){(s.apply(this,arguments)?Fm:zm)(this,e)}}function Dv(e,s){var a=Vm(e+"");if(arguments.length<2){for(var n=Eo(this.node()),i=-1,l=a.length;++i<l;)if(!n.contains(a[i]))return!1;return!0}return this.each((typeof s=="function"?Vv:s?Lv:$v)(a,s))}function Fv(){this.textContent=""}function zv(e){return function(){this.textContent=e}}function Hv(e){return function(){var s=e.apply(this,arguments);this.textContent=s??""}}function Bv(e){return arguments.length?this.each(e==null?Fv:(typeof e=="function"?Hv:zv)(e)):this.node().textContent}function Wv(){this.innerHTML=""}function Uv(e){return function(){this.innerHTML=e}}function qv(e){return function(){var s=e.apply(this,arguments);this.innerHTML=s??""}}function Gv(e){return arguments.length?this.each(e==null?Wv:(typeof e=="function"?qv:Uv)(e)):this.node().innerHTML}function Yv(){this.nextSibling&&this.parentNode.appendChild(this)}function Kv(){return this.each(Yv)}function Xv(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Jv(){return this.each(Xv)}function Qv(e){var s=typeof e=="function"?e:Am(e);return this.select(function(){return this.appendChild(s.apply(this,arguments))})}function Zv(){return null}function ey(e,s){var a=typeof e=="function"?e:Am(e),n=s==null?Zv:typeof s=="function"?s:To(s);return this.select(function(){return this.insertBefore(a.apply(this,arguments),n.apply(this,arguments)||null)})}function ty(){var e=this.parentNode;e&&e.removeChild(this)}function sy(){return this.each(ty)}function ay(){var e=this.cloneNode(!1),s=this.parentNode;return s?s.insertBefore(e,this.nextSibling):e}function ny(){var e=this.cloneNode(!0),s=this.parentNode;return s?s.insertBefore(e,this.nextSibling):e}function ry(e){return this.select(e?ny:ay)}function iy(e){return arguments.length?this.property("__data__",e):this.node().__data__}function ly(e){return function(s){e.call(this,s,this.__data__)}}function oy(e){return e.trim().split(/^|\s+/).map(function(s){var a="",n=s.indexOf(".");return n>=0&&(a=s.slice(n+1),s=s.slice(0,n)),{type:s,name:a}})}function cy(e){return function(){var s=this.__on;if(s){for(var a=0,n=-1,i=s.length,l;a<i;++a)l=s[a],(!e.type||l.type===e.type)&&l.name===e.name?this.removeEventListener(l.type,l.listener,l.options):s[++n]=l;++n?s.length=n:delete this.__on}}}function dy(e,s,a){return function(){var n=this.__on,i,l=ly(s);if(n){for(var o=0,u=n.length;o<u;++o)if((i=n[o]).type===e.type&&i.name===e.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=l,i.options=a),i.value=s;return}}this.addEventListener(e.type,l,a),i={type:e.type,name:e.name,value:s,listener:l,options:a},n?n.push(i):this.__on=[i]}}function uy(e,s,a){var n=oy(e+""),i,l=n.length,o;if(arguments.length<2){var u=this.node().__on;if(u){for(var m=0,h=u.length,r;m<h;++m)for(i=0,r=u[m];i<l;++i)if((o=n[i]).type===r.type&&o.name===r.name)return r.value}return}for(u=s?dy:cy,i=0;i<l;++i)this.each(u(n[i],s,a));return this}function Hm(e,s,a){var n=$m(e),i=n.CustomEvent;typeof i=="function"?i=new i(s,a):(i=n.document.createEvent("Event"),a?(i.initEvent(s,a.bubbles,a.cancelable),i.detail=a.detail):i.initEvent(s,!1,!1)),e.dispatchEvent(i)}function my(e,s){return function(){return Hm(this,e,s)}}function hy(e,s){return function(){return Hm(this,e,s.apply(this,arguments))}}function py(e,s){return this.each((typeof s=="function"?hy:my)(e,s))}function*fy(){for(var e=this._groups,s=0,a=e.length;s<a;++s)for(var n=e[s],i=0,l=n.length,o;i<l;++i)(o=n[i])&&(yield o)}var Bm=[null];function Is(e,s){this._groups=e,this._parents=s}function Vr(){return new Is([[document.documentElement]],Bm)}function xy(){return this}Is.prototype=Vr.prototype={constructor:Is,select:Hb,selectAll:qb,selectChild:Xb,selectChildren:ev,filter:tv,data:lv,enter:sv,exit:cv,join:dv,merge:uv,selection:xy,order:mv,sort:hv,call:fv,nodes:xv,node:gv,size:bv,empty:vv,each:yv,attr:kv,style:Ev,property:Ov,classed:Dv,text:Bv,html:Gv,raise:Kv,lower:Jv,append:Qv,insert:ey,remove:sy,clone:ry,datum:iy,on:uy,dispatch:py,[Symbol.iterator]:fy};function Ps(e){return typeof e=="string"?new Is([[document.querySelector(e)]],[document.documentElement]):new Is([[e]],Bm)}function gy(e){let s;for(;s=e.sourceEvent;)e=s;return e}function Js(e,s){if(e=gy(e),s===void 0&&(s=e.currentTarget),s){var a=s.ownerSVGElement||s;if(a.createSVGPoint){var n=a.createSVGPoint();return n.x=e.clientX,n.y=e.clientY,n=n.matrixTransform(s.getScreenCTM().inverse()),[n.x,n.y]}if(s.getBoundingClientRect){var i=s.getBoundingClientRect();return[e.clientX-i.left-s.clientLeft,e.clientY-i.top-s.clientTop]}}return[e.pageX,e.pageY]}const by={passive:!1},Cr={capture:!0,passive:!1};function yl(e){e.stopImmediatePropagation()}function On(e){e.preventDefault(),e.stopImmediatePropagation()}function Wm(e){var s=e.document.documentElement,a=Ps(e).on("dragstart.drag",On,Cr);"onselectstart"in s?a.on("selectstart.drag",On,Cr):(s.__noselect=s.style.MozUserSelect,s.style.MozUserSelect="none")}function Um(e,s){var a=e.document.documentElement,n=Ps(e).on("dragstart.drag",null);s&&(n.on("click.drag",On,Cr),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in a?n.on("selectstart.drag",null):(a.style.MozUserSelect=a.__noselect,delete a.__noselect)}const ai=e=>()=>e;function eo(e,{sourceEvent:s,subject:a,target:n,identifier:i,active:l,x:o,y:u,dx:m,dy:h,dispatch:r}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:s,enumerable:!0,configurable:!0},subject:{value:a,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:l,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:u,enumerable:!0,configurable:!0},dx:{value:m,enumerable:!0,configurable:!0},dy:{value:h,enumerable:!0,configurable:!0},_:{value:r}})}eo.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function vy(e){return!e.ctrlKey&&!e.button}function yy(){return this.parentNode}function jy(e,s){return s??{x:e.x,y:e.y}}function _y(){return navigator.maxTouchPoints||"ontouchstart"in this}function qm(){var e=vy,s=yy,a=jy,n=_y,i={},l=Fi("start","drag","end"),o=0,u,m,h,r,c=0;function d(f){f.on("mousedown.drag",g).filter(n).on("touchstart.drag",y).on("touchmove.drag",b,by).on("touchend.drag touchcancel.drag",_).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function g(f,C){if(!(r||!e.call(this,f,C))){var w=x(this,s.call(this,f,C),f,C,"mouse");w&&(Ps(f.view).on("mousemove.drag",v,Cr).on("mouseup.drag",S,Cr),Wm(f.view),yl(f),h=!1,u=f.clientX,m=f.clientY,w("start",f))}}function v(f){if(On(f),!h){var C=f.clientX-u,w=f.clientY-m;h=C*C+w*w>c}i.mouse("drag",f)}function S(f){Ps(f.view).on("mousemove.drag mouseup.drag",null),Um(f.view,h),On(f),i.mouse("end",f)}function y(f,C){if(e.call(this,f,C)){var w=f.changedTouches,I=s.call(this,f,C),R=w.length,k,D;for(k=0;k<R;++k)(D=x(this,I,f,C,w[k].identifier,w[k]))&&(yl(f),D("start",f,w[k]))}}function b(f){var C=f.changedTouches,w=C.length,I,R;for(I=0;I<w;++I)(R=i[C[I].identifier])&&(On(f),R("drag",f,C[I]))}function _(f){var C=f.changedTouches,w=C.length,I,R;for(r&&clearTimeout(r),r=setTimeout(function(){r=null},500),I=0;I<w;++I)(R=i[C[I].identifier])&&(yl(f),R("end",f,C[I]))}function x(f,C,w,I,R,k){var D=l.copy(),L=Js(k||w,C),V,B,T;if((T=a.call(f,new eo("beforestart",{sourceEvent:w,target:d,identifier:R,active:o,x:L[0],y:L[1],dx:0,dy:0,dispatch:D}),I))!=null)return V=T.x-L[0]||0,B=T.y-L[1]||0,function F(E,$,p){var N=L,P;switch(E){case"start":i[R]=F,P=o++;break;case"end":delete i[R],--o;case"drag":L=Js(p||$,C),P=o;break}D.call(E,f,new eo(E,{sourceEvent:$,subject:T,target:d,identifier:R,active:P,x:L[0]+V,y:L[1]+B,dx:L[0]-N[0],dy:L[1]-N[1],dispatch:D}),I)}}return d.filter=function(f){return arguments.length?(e=typeof f=="function"?f:ai(!!f),d):e},d.container=function(f){return arguments.length?(s=typeof f=="function"?f:ai(f),d):s},d.subject=function(f){return arguments.length?(a=typeof f=="function"?f:ai(f),d):a},d.touchable=function(f){return arguments.length?(n=typeof f=="function"?f:ai(!!f),d):n},d.on=function(){var f=l.on.apply(l,arguments);return f===l?d:f},d.clickDistance=function(f){return arguments.length?(c=(f=+f)*f,d):Math.sqrt(c)},d}function Ao(e,s,a){e.prototype=s.prototype=a,a.constructor=e}function Gm(e,s){var a=Object.create(e.prototype);for(var n in s)a[n]=s[n];return a}function Dr(){}var kr=.7,ki=1/kr,Ln="\\s*([+-]?\\d+)\\s*",Mr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ua="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ny=/^#([0-9a-f]{3,8})$/,wy=new RegExp(`^rgb\\(${Ln},${Ln},${Ln}\\)$`),Sy=new RegExp(`^rgb\\(${ua},${ua},${ua}\\)$`),Cy=new RegExp(`^rgba\\(${Ln},${Ln},${Ln},${Mr}\\)$`),ky=new RegExp(`^rgba\\(${ua},${ua},${ua},${Mr}\\)$`),My=new RegExp(`^hsl\\(${Mr},${ua},${ua}\\)$`),Ry=new RegExp(`^hsla\\(${Mr},${ua},${ua},${Mr}\\)$`),pd={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ao(Dr,pn,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:fd,formatHex:fd,formatHex8:Ty,formatHsl:Ey,formatRgb:xd,toString:xd});function fd(){return this.rgb().formatHex()}function Ty(){return this.rgb().formatHex8()}function Ey(){return Ym(this).formatHsl()}function xd(){return this.rgb().formatRgb()}function pn(e){var s,a;return e=(e+"").trim().toLowerCase(),(s=Ny.exec(e))?(a=s[1].length,s=parseInt(s[1],16),a===6?gd(s):a===3?new Ns(s>>8&15|s>>4&240,s>>4&15|s&240,(s&15)<<4|s&15,1):a===8?ni(s>>24&255,s>>16&255,s>>8&255,(s&255)/255):a===4?ni(s>>12&15|s>>8&240,s>>8&15|s>>4&240,s>>4&15|s&240,((s&15)<<4|s&15)/255):null):(s=wy.exec(e))?new Ns(s[1],s[2],s[3],1):(s=Sy.exec(e))?new Ns(s[1]*255/100,s[2]*255/100,s[3]*255/100,1):(s=Cy.exec(e))?ni(s[1],s[2],s[3],s[4]):(s=ky.exec(e))?ni(s[1]*255/100,s[2]*255/100,s[3]*255/100,s[4]):(s=My.exec(e))?yd(s[1],s[2]/100,s[3]/100,1):(s=Ry.exec(e))?yd(s[1],s[2]/100,s[3]/100,s[4]):pd.hasOwnProperty(e)?gd(pd[e]):e==="transparent"?new Ns(NaN,NaN,NaN,0):null}function gd(e){return new Ns(e>>16&255,e>>8&255,e&255,1)}function ni(e,s,a,n){return n<=0&&(e=s=a=NaN),new Ns(e,s,a,n)}function Ay(e){return e instanceof Dr||(e=pn(e)),e?(e=e.rgb(),new Ns(e.r,e.g,e.b,e.opacity)):new Ns}function to(e,s,a,n){return arguments.length===1?Ay(e):new Ns(e,s,a,n??1)}function Ns(e,s,a,n){this.r=+e,this.g=+s,this.b=+a,this.opacity=+n}Ao(Ns,to,Gm(Dr,{brighter(e){return e=e==null?ki:Math.pow(ki,e),new Ns(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?kr:Math.pow(kr,e),new Ns(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Ns(dn(this.r),dn(this.g),dn(this.b),Mi(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:bd,formatHex:bd,formatHex8:Py,formatRgb:vd,toString:vd}));function bd(){return`#${on(this.r)}${on(this.g)}${on(this.b)}`}function Py(){return`#${on(this.r)}${on(this.g)}${on(this.b)}${on((isNaN(this.opacity)?1:this.opacity)*255)}`}function vd(){const e=Mi(this.opacity);return`${e===1?"rgb(":"rgba("}${dn(this.r)}, ${dn(this.g)}, ${dn(this.b)}${e===1?")":`, ${e})`}`}function Mi(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function dn(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function on(e){return e=dn(e),(e<16?"0":"")+e.toString(16)}function yd(e,s,a,n){return n<=0?e=s=a=NaN:a<=0||a>=1?e=s=NaN:s<=0&&(e=NaN),new Zs(e,s,a,n)}function Ym(e){if(e instanceof Zs)return new Zs(e.h,e.s,e.l,e.opacity);if(e instanceof Dr||(e=pn(e)),!e)return new Zs;if(e instanceof Zs)return e;e=e.rgb();var s=e.r/255,a=e.g/255,n=e.b/255,i=Math.min(s,a,n),l=Math.max(s,a,n),o=NaN,u=l-i,m=(l+i)/2;return u?(s===l?o=(a-n)/u+(a<n)*6:a===l?o=(n-s)/u+2:o=(s-a)/u+4,u/=m<.5?l+i:2-l-i,o*=60):u=m>0&&m<1?0:o,new Zs(o,u,m,e.opacity)}function Iy(e,s,a,n){return arguments.length===1?Ym(e):new Zs(e,s,a,n??1)}function Zs(e,s,a,n){this.h=+e,this.s=+s,this.l=+a,this.opacity=+n}Ao(Zs,Iy,Gm(Dr,{brighter(e){return e=e==null?ki:Math.pow(ki,e),new Zs(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?kr:Math.pow(kr,e),new Zs(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,s=isNaN(e)||isNaN(this.s)?0:this.s,a=this.l,n=a+(a<.5?a:1-a)*s,i=2*a-n;return new Ns(jl(e>=240?e-240:e+120,i,n),jl(e,i,n),jl(e<120?e+240:e-120,i,n),this.opacity)},clamp(){return new Zs(jd(this.h),ri(this.s),ri(this.l),Mi(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Mi(this.opacity);return`${e===1?"hsl(":"hsla("}${jd(this.h)}, ${ri(this.s)*100}%, ${ri(this.l)*100}%${e===1?")":`, ${e})`}`}}));function jd(e){return e=(e||0)%360,e<0?e+360:e}function ri(e){return Math.max(0,Math.min(1,e||0))}function jl(e,s,a){return(e<60?s+(a-s)*e/60:e<180?a:e<240?s+(a-s)*(240-e)/60:s)*255}const Po=e=>()=>e;function Oy(e,s){return function(a){return e+a*s}}function Ly(e,s,a){return e=Math.pow(e,a),s=Math.pow(s,a)-e,a=1/a,function(n){return Math.pow(e+n*s,a)}}function $y(e){return(e=+e)==1?Km:function(s,a){return a-s?Ly(s,a,e):Po(isNaN(s)?a:s)}}function Km(e,s){var a=s-e;return a?Oy(e,a):Po(isNaN(e)?s:e)}const Ri=function e(s){var a=$y(s);function n(i,l){var o=a((i=to(i)).r,(l=to(l)).r),u=a(i.g,l.g),m=a(i.b,l.b),h=Km(i.opacity,l.opacity);return function(r){return i.r=o(r),i.g=u(r),i.b=m(r),i.opacity=h(r),i+""}}return n.gamma=e,n}(1);function Vy(e,s){s||(s=[]);var a=e?Math.min(s.length,e.length):0,n=s.slice(),i;return function(l){for(i=0;i<a;++i)n[i]=e[i]*(1-l)+s[i]*l;return n}}function Dy(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Fy(e,s){var a=s?s.length:0,n=e?Math.min(a,e.length):0,i=new Array(n),l=new Array(a),o;for(o=0;o<n;++o)i[o]=hr(e[o],s[o]);for(;o<a;++o)l[o]=s[o];return function(u){for(o=0;o<n;++o)l[o]=i[o](u);return l}}function zy(e,s){var a=new Date;return e=+e,s=+s,function(n){return a.setTime(e*(1-n)+s*n),a}}function oa(e,s){return e=+e,s=+s,function(a){return e*(1-a)+s*a}}function Hy(e,s){var a={},n={},i;(e===null||typeof e!="object")&&(e={}),(s===null||typeof s!="object")&&(s={});for(i in s)i in e?a[i]=hr(e[i],s[i]):n[i]=s[i];return function(l){for(i in a)n[i]=a[i](l);return n}}var so=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,_l=new RegExp(so.source,"g");function By(e){return function(){return e}}function Wy(e){return function(s){return e(s)+""}}function Xm(e,s){var a=so.lastIndex=_l.lastIndex=0,n,i,l,o=-1,u=[],m=[];for(e=e+"",s=s+"";(n=so.exec(e))&&(i=_l.exec(s));)(l=i.index)>a&&(l=s.slice(a,l),u[o]?u[o]+=l:u[++o]=l),(n=n[0])===(i=i[0])?u[o]?u[o]+=i:u[++o]=i:(u[++o]=null,m.push({i:o,x:oa(n,i)})),a=_l.lastIndex;return a<s.length&&(l=s.slice(a),u[o]?u[o]+=l:u[++o]=l),u.length<2?m[0]?Wy(m[0].x):By(s):(s=m.length,function(h){for(var r=0,c;r<s;++r)u[(c=m[r]).i]=c.x(h);return u.join("")})}function hr(e,s){var a=typeof s,n;return s==null||a==="boolean"?Po(s):(a==="number"?oa:a==="string"?(n=pn(s))?(s=n,Ri):Xm:s instanceof pn?Ri:s instanceof Date?zy:Dy(s)?Vy:Array.isArray(s)?Fy:typeof s.valueOf!="function"&&typeof s.toString!="function"||isNaN(s)?Hy:oa)(e,s)}var _d=180/Math.PI,ao={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Jm(e,s,a,n,i,l){var o,u,m;return(o=Math.sqrt(e*e+s*s))&&(e/=o,s/=o),(m=e*a+s*n)&&(a-=e*m,n-=s*m),(u=Math.sqrt(a*a+n*n))&&(a/=u,n/=u,m/=u),e*n<s*a&&(e=-e,s=-s,m=-m,o=-o),{translateX:i,translateY:l,rotate:Math.atan2(s,e)*_d,skewX:Math.atan(m)*_d,scaleX:o,scaleY:u}}var ii;function Uy(e){const s=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return s.isIdentity?ao:Jm(s.a,s.b,s.c,s.d,s.e,s.f)}function qy(e){return e==null||(ii||(ii=document.createElementNS("http://www.w3.org/2000/svg","g")),ii.setAttribute("transform",e),!(e=ii.transform.baseVal.consolidate()))?ao:(e=e.matrix,Jm(e.a,e.b,e.c,e.d,e.e,e.f))}function Qm(e,s,a,n){function i(h){return h.length?h.pop()+" ":""}function l(h,r,c,d,g,v){if(h!==c||r!==d){var S=g.push("translate(",null,s,null,a);v.push({i:S-4,x:oa(h,c)},{i:S-2,x:oa(r,d)})}else(c||d)&&g.push("translate("+c+s+d+a)}function o(h,r,c,d){h!==r?(h-r>180?r+=360:r-h>180&&(h+=360),d.push({i:c.push(i(c)+"rotate(",null,n)-2,x:oa(h,r)})):r&&c.push(i(c)+"rotate("+r+n)}function u(h,r,c,d){h!==r?d.push({i:c.push(i(c)+"skewX(",null,n)-2,x:oa(h,r)}):r&&c.push(i(c)+"skewX("+r+n)}function m(h,r,c,d,g,v){if(h!==c||r!==d){var S=g.push(i(g)+"scale(",null,",",null,")");v.push({i:S-4,x:oa(h,c)},{i:S-2,x:oa(r,d)})}else(c!==1||d!==1)&&g.push(i(g)+"scale("+c+","+d+")")}return function(h,r){var c=[],d=[];return h=e(h),r=e(r),l(h.translateX,h.translateY,r.translateX,r.translateY,c,d),o(h.rotate,r.rotate,c,d),u(h.skewX,r.skewX,c,d),m(h.scaleX,h.scaleY,r.scaleX,r.scaleY,c,d),h=r=null,function(g){for(var v=-1,S=d.length,y;++v<S;)c[(y=d[v]).i]=y.x(g);return c.join("")}}}var Gy=Qm(Uy,"px, ","px)","deg)"),Yy=Qm(qy,", ",")",")"),Ky=1e-12;function Nd(e){return((e=Math.exp(e))+1/e)/2}function Xy(e){return((e=Math.exp(e))-1/e)/2}function Jy(e){return((e=Math.exp(2*e))-1)/(e+1)}const pi=function e(s,a,n){function i(l,o){var u=l[0],m=l[1],h=l[2],r=o[0],c=o[1],d=o[2],g=r-u,v=c-m,S=g*g+v*v,y,b;if(S<Ky)b=Math.log(d/h)/s,y=function(I){return[u+I*g,m+I*v,h*Math.exp(s*I*b)]};else{var _=Math.sqrt(S),x=(d*d-h*h+n*S)/(2*h*a*_),f=(d*d-h*h-n*S)/(2*d*a*_),C=Math.log(Math.sqrt(x*x+1)-x),w=Math.log(Math.sqrt(f*f+1)-f);b=(w-C)/s,y=function(I){var R=I*b,k=Nd(C),D=h/(a*_)*(k*Jy(s*R+C)-Xy(C));return[u+D*g,m+D*v,h*k/Nd(s*R+C)]}}return y.duration=b*1e3*s/Math.SQRT2,y}return i.rho=function(l){var o=Math.max(.001,+l),u=o*o,m=u*u;return e(o,u,m)},i}(Math.SQRT2,2,4);var Hn=0,ur=0,rr=0,Zm=1e3,Ti,mr,Ei=0,fn=0,Hi=0,Rr=typeof performance=="object"&&performance.now?performance:Date,eh=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Io(){return fn||(eh(Qy),fn=Rr.now()+Hi)}function Qy(){fn=0}function Ai(){this._call=this._time=this._next=null}Ai.prototype=th.prototype={constructor:Ai,restart:function(e,s,a){if(typeof e!="function")throw new TypeError("callback is not a function");a=(a==null?Io():+a)+(s==null?0:+s),!this._next&&mr!==this&&(mr?mr._next=this:Ti=this,mr=this),this._call=e,this._time=a,no()},stop:function(){this._call&&(this._call=null,this._time=1/0,no())}};function th(e,s,a){var n=new Ai;return n.restart(e,s,a),n}function Zy(){Io(),++Hn;for(var e=Ti,s;e;)(s=fn-e._time)>=0&&e._call.call(void 0,s),e=e._next;--Hn}function wd(){fn=(Ei=Rr.now())+Hi,Hn=ur=0;try{Zy()}finally{Hn=0,tj(),fn=0}}function ej(){var e=Rr.now(),s=e-Ei;s>Zm&&(Hi-=s,Ei=e)}function tj(){for(var e,s=Ti,a,n=1/0;s;)s._call?(n>s._time&&(n=s._time),e=s,s=s._next):(a=s._next,s._next=null,s=e?e._next=a:Ti=a);mr=e,no(n)}function no(e){if(!Hn){ur&&(ur=clearTimeout(ur));var s=e-fn;s>24?(e<1/0&&(ur=setTimeout(wd,e-Rr.now()-Hi)),rr&&(rr=clearInterval(rr))):(rr||(Ei=Rr.now(),rr=setInterval(ej,Zm)),Hn=1,eh(wd))}}function Sd(e,s,a){var n=new Ai;return s=s==null?0:+s,n.restart(i=>{n.stop(),e(i+s)},s,a),n}var sj=Fi("start","end","cancel","interrupt"),aj=[],sh=0,Cd=1,ro=2,fi=3,kd=4,io=5,xi=6;function Bi(e,s,a,n,i,l){var o=e.__transition;if(!o)e.__transition={};else if(a in o)return;nj(e,a,{name:s,index:n,group:i,on:sj,tween:aj,time:l.time,delay:l.delay,duration:l.duration,ease:l.ease,timer:null,state:sh})}function Oo(e,s){var a=aa(e,s);if(a.state>sh)throw new Error("too late; already scheduled");return a}function fa(e,s){var a=aa(e,s);if(a.state>fi)throw new Error("too late; already running");return a}function aa(e,s){var a=e.__transition;if(!a||!(a=a[s]))throw new Error("transition not found");return a}function nj(e,s,a){var n=e.__transition,i;n[s]=a,a.timer=th(l,0,a.time);function l(h){a.state=Cd,a.timer.restart(o,a.delay,a.time),a.delay<=h&&o(h-a.delay)}function o(h){var r,c,d,g;if(a.state!==Cd)return m();for(r in n)if(g=n[r],g.name===a.name){if(g.state===fi)return Sd(o);g.state===kd?(g.state=xi,g.timer.stop(),g.on.call("interrupt",e,e.__data__,g.index,g.group),delete n[r]):+r<s&&(g.state=xi,g.timer.stop(),g.on.call("cancel",e,e.__data__,g.index,g.group),delete n[r])}if(Sd(function(){a.state===fi&&(a.state=kd,a.timer.restart(u,a.delay,a.time),u(h))}),a.state=ro,a.on.call("start",e,e.__data__,a.index,a.group),a.state===ro){for(a.state=fi,i=new Array(d=a.tween.length),r=0,c=-1;r<d;++r)(g=a.tween[r].value.call(e,e.__data__,a.index,a.group))&&(i[++c]=g);i.length=c+1}}function u(h){for(var r=h<a.duration?a.ease.call(null,h/a.duration):(a.timer.restart(m),a.state=io,1),c=-1,d=i.length;++c<d;)i[c].call(e,r);a.state===io&&(a.on.call("end",e,e.__data__,a.index,a.group),m())}function m(){a.state=xi,a.timer.stop(),delete n[s];for(var h in n)return;delete e.__transition}}function gi(e,s){var a=e.__transition,n,i,l=!0,o;if(a){s=s==null?null:s+"";for(o in a){if((n=a[o]).name!==s){l=!1;continue}i=n.state>ro&&n.state<io,n.state=xi,n.timer.stop(),n.on.call(i?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete a[o]}l&&delete e.__transition}}function rj(e){return this.each(function(){gi(this,e)})}function ij(e,s){var a,n;return function(){var i=fa(this,e),l=i.tween;if(l!==a){n=a=l;for(var o=0,u=n.length;o<u;++o)if(n[o].name===s){n=n.slice(),n.splice(o,1);break}}i.tween=n}}function lj(e,s,a){var n,i;if(typeof a!="function")throw new Error;return function(){var l=fa(this,e),o=l.tween;if(o!==n){i=(n=o).slice();for(var u={name:s,value:a},m=0,h=i.length;m<h;++m)if(i[m].name===s){i[m]=u;break}m===h&&i.push(u)}l.tween=i}}function oj(e,s){var a=this._id;if(e+="",arguments.length<2){for(var n=aa(this.node(),a).tween,i=0,l=n.length,o;i<l;++i)if((o=n[i]).name===e)return o.value;return null}return this.each((s==null?ij:lj)(a,e,s))}function Lo(e,s,a){var n=e._id;return e.each(function(){var i=fa(this,n);(i.value||(i.value={}))[s]=a.apply(this,arguments)}),function(i){return aa(i,n).value[s]}}function ah(e,s){var a;return(typeof s=="number"?oa:s instanceof pn?Ri:(a=pn(s))?(s=a,Ri):Xm)(e,s)}function cj(e){return function(){this.removeAttribute(e)}}function dj(e){return function(){this.removeAttributeNS(e.space,e.local)}}function uj(e,s,a){var n,i=a+"",l;return function(){var o=this.getAttribute(e);return o===i?null:o===n?l:l=s(n=o,a)}}function mj(e,s,a){var n,i=a+"",l;return function(){var o=this.getAttributeNS(e.space,e.local);return o===i?null:o===n?l:l=s(n=o,a)}}function hj(e,s,a){var n,i,l;return function(){var o,u=a(this),m;return u==null?void this.removeAttribute(e):(o=this.getAttribute(e),m=u+"",o===m?null:o===n&&m===i?l:(i=m,l=s(n=o,u)))}}function pj(e,s,a){var n,i,l;return function(){var o,u=a(this),m;return u==null?void this.removeAttributeNS(e.space,e.local):(o=this.getAttributeNS(e.space,e.local),m=u+"",o===m?null:o===n&&m===i?l:(i=m,l=s(n=o,u)))}}function fj(e,s){var a=zi(e),n=a==="transform"?Yy:ah;return this.attrTween(e,typeof s=="function"?(a.local?pj:hj)(a,n,Lo(this,"attr."+e,s)):s==null?(a.local?dj:cj)(a):(a.local?mj:uj)(a,n,s))}function xj(e,s){return function(a){this.setAttribute(e,s.call(this,a))}}function gj(e,s){return function(a){this.setAttributeNS(e.space,e.local,s.call(this,a))}}function bj(e,s){var a,n;function i(){var l=s.apply(this,arguments);return l!==n&&(a=(n=l)&&gj(e,l)),a}return i._value=s,i}function vj(e,s){var a,n;function i(){var l=s.apply(this,arguments);return l!==n&&(a=(n=l)&&xj(e,l)),a}return i._value=s,i}function yj(e,s){var a="attr."+e;if(arguments.length<2)return(a=this.tween(a))&&a._value;if(s==null)return this.tween(a,null);if(typeof s!="function")throw new Error;var n=zi(e);return this.tween(a,(n.local?bj:vj)(n,s))}function jj(e,s){return function(){Oo(this,e).delay=+s.apply(this,arguments)}}function _j(e,s){return s=+s,function(){Oo(this,e).delay=s}}function Nj(e){var s=this._id;return arguments.length?this.each((typeof e=="function"?jj:_j)(s,e)):aa(this.node(),s).delay}function wj(e,s){return function(){fa(this,e).duration=+s.apply(this,arguments)}}function Sj(e,s){return s=+s,function(){fa(this,e).duration=s}}function Cj(e){var s=this._id;return arguments.length?this.each((typeof e=="function"?wj:Sj)(s,e)):aa(this.node(),s).duration}function kj(e,s){if(typeof s!="function")throw new Error;return function(){fa(this,e).ease=s}}function Mj(e){var s=this._id;return arguments.length?this.each(kj(s,e)):aa(this.node(),s).ease}function Rj(e,s){return function(){var a=s.apply(this,arguments);if(typeof a!="function")throw new Error;fa(this,e).ease=a}}function Tj(e){if(typeof e!="function")throw new Error;return this.each(Rj(this._id,e))}function Ej(e){typeof e!="function"&&(e=Im(e));for(var s=this._groups,a=s.length,n=new Array(a),i=0;i<a;++i)for(var l=s[i],o=l.length,u=n[i]=[],m,h=0;h<o;++h)(m=l[h])&&e.call(m,m.__data__,h,l)&&u.push(m);return new Sa(n,this._parents,this._name,this._id)}function Aj(e){if(e._id!==this._id)throw new Error;for(var s=this._groups,a=e._groups,n=s.length,i=a.length,l=Math.min(n,i),o=new Array(n),u=0;u<l;++u)for(var m=s[u],h=a[u],r=m.length,c=o[u]=new Array(r),d,g=0;g<r;++g)(d=m[g]||h[g])&&(c[g]=d);for(;u<n;++u)o[u]=s[u];return new Sa(o,this._parents,this._name,this._id)}function Pj(e){return(e+"").trim().split(/^|\s+/).every(function(s){var a=s.indexOf(".");return a>=0&&(s=s.slice(0,a)),!s||s==="start"})}function Ij(e,s,a){var n,i,l=Pj(s)?Oo:fa;return function(){var o=l(this,e),u=o.on;u!==n&&(i=(n=u).copy()).on(s,a),o.on=i}}function Oj(e,s){var a=this._id;return arguments.length<2?aa(this.node(),a).on.on(e):this.each(Ij(a,e,s))}function Lj(e){return function(){var s=this.parentNode;for(var a in this.__transition)if(+a!==e)return;s&&s.removeChild(this)}}function $j(){return this.on("end.remove",Lj(this._id))}function Vj(e){var s=this._name,a=this._id;typeof e!="function"&&(e=To(e));for(var n=this._groups,i=n.length,l=new Array(i),o=0;o<i;++o)for(var u=n[o],m=u.length,h=l[o]=new Array(m),r,c,d=0;d<m;++d)(r=u[d])&&(c=e.call(r,r.__data__,d,u))&&("__data__"in r&&(c.__data__=r.__data__),h[d]=c,Bi(h[d],s,a,d,h,aa(r,a)));return new Sa(l,this._parents,s,a)}function Dj(e){var s=this._name,a=this._id;typeof e!="function"&&(e=Pm(e));for(var n=this._groups,i=n.length,l=[],o=[],u=0;u<i;++u)for(var m=n[u],h=m.length,r,c=0;c<h;++c)if(r=m[c]){for(var d=e.call(r,r.__data__,c,m),g,v=aa(r,a),S=0,y=d.length;S<y;++S)(g=d[S])&&Bi(g,s,a,S,d,v);l.push(d),o.push(r)}return new Sa(l,o,s,a)}var Fj=Vr.prototype.constructor;function zj(){return new Fj(this._groups,this._parents)}function Hj(e,s){var a,n,i;return function(){var l=zn(this,e),o=(this.style.removeProperty(e),zn(this,e));return l===o?null:l===a&&o===n?i:i=s(a=l,n=o)}}function nh(e){return function(){this.style.removeProperty(e)}}function Bj(e,s,a){var n,i=a+"",l;return function(){var o=zn(this,e);return o===i?null:o===n?l:l=s(n=o,a)}}function Wj(e,s,a){var n,i,l;return function(){var o=zn(this,e),u=a(this),m=u+"";return u==null&&(m=u=(this.style.removeProperty(e),zn(this,e))),o===m?null:o===n&&m===i?l:(i=m,l=s(n=o,u))}}function Uj(e,s){var a,n,i,l="style."+s,o="end."+l,u;return function(){var m=fa(this,e),h=m.on,r=m.value[l]==null?u||(u=nh(s)):void 0;(h!==a||i!==r)&&(n=(a=h).copy()).on(o,i=r),m.on=n}}function qj(e,s,a){var n=(e+="")=="transform"?Gy:ah;return s==null?this.styleTween(e,Hj(e,n)).on("end.style."+e,nh(e)):typeof s=="function"?this.styleTween(e,Wj(e,n,Lo(this,"style."+e,s))).each(Uj(this._id,e)):this.styleTween(e,Bj(e,n,s),a).on("end.style."+e,null)}function Gj(e,s,a){return function(n){this.style.setProperty(e,s.call(this,n),a)}}function Yj(e,s,a){var n,i;function l(){var o=s.apply(this,arguments);return o!==i&&(n=(i=o)&&Gj(e,o,a)),n}return l._value=s,l}function Kj(e,s,a){var n="style."+(e+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(s==null)return this.tween(n,null);if(typeof s!="function")throw new Error;return this.tween(n,Yj(e,s,a??""))}function Xj(e){return function(){this.textContent=e}}function Jj(e){return function(){var s=e(this);this.textContent=s??""}}function Qj(e){return this.tween("text",typeof e=="function"?Jj(Lo(this,"text",e)):Xj(e==null?"":e+""))}function Zj(e){return function(s){this.textContent=e.call(this,s)}}function e_(e){var s,a;function n(){var i=e.apply(this,arguments);return i!==a&&(s=(a=i)&&Zj(i)),s}return n._value=e,n}function t_(e){var s="text";if(arguments.length<1)return(s=this.tween(s))&&s._value;if(e==null)return this.tween(s,null);if(typeof e!="function")throw new Error;return this.tween(s,e_(e))}function s_(){for(var e=this._name,s=this._id,a=rh(),n=this._groups,i=n.length,l=0;l<i;++l)for(var o=n[l],u=o.length,m,h=0;h<u;++h)if(m=o[h]){var r=aa(m,s);Bi(m,e,a,h,o,{time:r.time+r.delay+r.duration,delay:0,duration:r.duration,ease:r.ease})}return new Sa(n,this._parents,e,a)}function a_(){var e,s,a=this,n=a._id,i=a.size();return new Promise(function(l,o){var u={value:o},m={value:function(){--i===0&&l()}};a.each(function(){var h=fa(this,n),r=h.on;r!==e&&(s=(e=r).copy(),s._.cancel.push(u),s._.interrupt.push(u),s._.end.push(m)),h.on=s}),i===0&&l()})}var n_=0;function Sa(e,s,a,n){this._groups=e,this._parents=s,this._name=a,this._id=n}function rh(){return++n_}var ba=Vr.prototype;Sa.prototype={constructor:Sa,select:Vj,selectAll:Dj,selectChild:ba.selectChild,selectChildren:ba.selectChildren,filter:Ej,merge:Aj,selection:zj,transition:s_,call:ba.call,nodes:ba.nodes,node:ba.node,size:ba.size,empty:ba.empty,each:ba.each,on:Oj,attr:fj,attrTween:yj,style:qj,styleTween:Kj,text:Qj,textTween:t_,remove:$j,tween:oj,delay:Nj,duration:Cj,ease:Mj,easeVarying:Tj,end:a_,[Symbol.iterator]:ba[Symbol.iterator]};function r_(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var i_={time:null,delay:0,duration:250,ease:r_};function l_(e,s){for(var a;!(a=e.__transition)||!(a=a[s]);)if(!(e=e.parentNode))throw new Error(`transition ${s} not found`);return a}function o_(e){var s,a;e instanceof Sa?(s=e._id,e=e._name):(s=rh(),(a=i_).time=Io(),e=e==null?null:e+"");for(var n=this._groups,i=n.length,l=0;l<i;++l)for(var o=n[l],u=o.length,m,h=0;h<u;++h)(m=o[h])&&Bi(m,e,s,h,o,a||l_(m,s));return new Sa(n,this._parents,e,s)}Vr.prototype.interrupt=rj;Vr.prototype.transition=o_;const li=e=>()=>e;function c_(e,{sourceEvent:s,target:a,transform:n,dispatch:i}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:s,enumerable:!0,configurable:!0},target:{value:a,enumerable:!0,configurable:!0},transform:{value:n,enumerable:!0,configurable:!0},_:{value:i}})}function ja(e,s,a){this.k=e,this.x=s,this.y=a}ja.prototype={constructor:ja,scale:function(e){return e===1?this:new ja(this.k*e,this.x,this.y)},translate:function(e,s){return e===0&s===0?this:new ja(this.k,this.x+this.k*e,this.y+this.k*s)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Wi=new ja(1,0,0);ih.prototype=ja.prototype;function ih(e){for(;!e.__zoom;)if(!(e=e.parentNode))return Wi;return e.__zoom}function Nl(e){e.stopImmediatePropagation()}function ir(e){e.preventDefault(),e.stopImmediatePropagation()}function d_(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function u_(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function Md(){return this.__zoom||Wi}function m_(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function h_(){return navigator.maxTouchPoints||"ontouchstart"in this}function p_(e,s,a){var n=e.invertX(s[0][0])-a[0][0],i=e.invertX(s[1][0])-a[1][0],l=e.invertY(s[0][1])-a[0][1],o=e.invertY(s[1][1])-a[1][1];return e.translate(i>n?(n+i)/2:Math.min(0,n)||Math.max(0,i),o>l?(l+o)/2:Math.min(0,l)||Math.max(0,o))}function lh(){var e=d_,s=u_,a=p_,n=m_,i=h_,l=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],u=250,m=pi,h=Fi("start","zoom","end"),r,c,d,g=500,v=150,S=0,y=10;function b(T){T.property("__zoom",Md).on("wheel.zoom",R,{passive:!1}).on("mousedown.zoom",k).on("dblclick.zoom",D).filter(i).on("touchstart.zoom",L).on("touchmove.zoom",V).on("touchend.zoom touchcancel.zoom",B).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}b.transform=function(T,F,E,$){var p=T.selection?T.selection():T;p.property("__zoom",Md),T!==p?C(T,F,E,$):p.interrupt().each(function(){w(this,arguments).event($).start().zoom(null,typeof F=="function"?F.apply(this,arguments):F).end()})},b.scaleBy=function(T,F,E,$){b.scaleTo(T,function(){var p=this.__zoom.k,N=typeof F=="function"?F.apply(this,arguments):F;return p*N},E,$)},b.scaleTo=function(T,F,E,$){b.transform(T,function(){var p=s.apply(this,arguments),N=this.__zoom,P=E==null?f(p):typeof E=="function"?E.apply(this,arguments):E,M=N.invert(P),O=typeof F=="function"?F.apply(this,arguments):F;return a(x(_(N,O),P,M),p,o)},E,$)},b.translateBy=function(T,F,E,$){b.transform(T,function(){return a(this.__zoom.translate(typeof F=="function"?F.apply(this,arguments):F,typeof E=="function"?E.apply(this,arguments):E),s.apply(this,arguments),o)},null,$)},b.translateTo=function(T,F,E,$,p){b.transform(T,function(){var N=s.apply(this,arguments),P=this.__zoom,M=$==null?f(N):typeof $=="function"?$.apply(this,arguments):$;return a(Wi.translate(M[0],M[1]).scale(P.k).translate(typeof F=="function"?-F.apply(this,arguments):-F,typeof E=="function"?-E.apply(this,arguments):-E),N,o)},$,p)};function _(T,F){return F=Math.max(l[0],Math.min(l[1],F)),F===T.k?T:new ja(F,T.x,T.y)}function x(T,F,E){var $=F[0]-E[0]*T.k,p=F[1]-E[1]*T.k;return $===T.x&&p===T.y?T:new ja(T.k,$,p)}function f(T){return[(+T[0][0]+ +T[1][0])/2,(+T[0][1]+ +T[1][1])/2]}function C(T,F,E,$){T.on("start.zoom",function(){w(this,arguments).event($).start()}).on("interrupt.zoom end.zoom",function(){w(this,arguments).event($).end()}).tween("zoom",function(){var p=this,N=arguments,P=w(p,N).event($),M=s.apply(p,N),O=E==null?f(M):typeof E=="function"?E.apply(p,N):E,W=Math.max(M[1][0]-M[0][0],M[1][1]-M[0][1]),q=p.__zoom,ce=typeof F=="function"?F.apply(p,N):F,se=m(q.invert(O).concat(W/q.k),ce.invert(O).concat(W/ce.k));return function(H){if(H===1)H=ce;else{var z=se(H),te=W/z[2];H=new ja(te,O[0]-z[0]*te,O[1]-z[1]*te)}P.zoom(null,H)}})}function w(T,F,E){return!E&&T.__zooming||new I(T,F)}function I(T,F){this.that=T,this.args=F,this.active=0,this.sourceEvent=null,this.extent=s.apply(T,F),this.taps=0}I.prototype={event:function(T){return T&&(this.sourceEvent=T),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(T,F){return this.mouse&&T!=="mouse"&&(this.mouse[1]=F.invert(this.mouse[0])),this.touch0&&T!=="touch"&&(this.touch0[1]=F.invert(this.touch0[0])),this.touch1&&T!=="touch"&&(this.touch1[1]=F.invert(this.touch1[0])),this.that.__zoom=F,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(T){var F=Ps(this.that).datum();h.call(T,this.that,new c_(T,{sourceEvent:this.sourceEvent,target:b,transform:this.that.__zoom,dispatch:h}),F)}};function R(T,...F){if(!e.apply(this,arguments))return;var E=w(this,F).event(T),$=this.__zoom,p=Math.max(l[0],Math.min(l[1],$.k*Math.pow(2,n.apply(this,arguments)))),N=Js(T);if(E.wheel)(E.mouse[0][0]!==N[0]||E.mouse[0][1]!==N[1])&&(E.mouse[1]=$.invert(E.mouse[0]=N)),clearTimeout(E.wheel);else{if($.k===p)return;E.mouse=[N,$.invert(N)],gi(this),E.start()}ir(T),E.wheel=setTimeout(P,v),E.zoom("mouse",a(x(_($,p),E.mouse[0],E.mouse[1]),E.extent,o));function P(){E.wheel=null,E.end()}}function k(T,...F){if(d||!e.apply(this,arguments))return;var E=T.currentTarget,$=w(this,F,!0).event(T),p=Ps(T.view).on("mousemove.zoom",O,!0).on("mouseup.zoom",W,!0),N=Js(T,E),P=T.clientX,M=T.clientY;Wm(T.view),Nl(T),$.mouse=[N,this.__zoom.invert(N)],gi(this),$.start();function O(q){if(ir(q),!$.moved){var ce=q.clientX-P,se=q.clientY-M;$.moved=ce*ce+se*se>S}$.event(q).zoom("mouse",a(x($.that.__zoom,$.mouse[0]=Js(q,E),$.mouse[1]),$.extent,o))}function W(q){p.on("mousemove.zoom mouseup.zoom",null),Um(q.view,$.moved),ir(q),$.event(q).end()}}function D(T,...F){if(e.apply(this,arguments)){var E=this.__zoom,$=Js(T.changedTouches?T.changedTouches[0]:T,this),p=E.invert($),N=E.k*(T.shiftKey?.5:2),P=a(x(_(E,N),$,p),s.apply(this,F),o);ir(T),u>0?Ps(this).transition().duration(u).call(C,P,$,T):Ps(this).call(b.transform,P,$,T)}}function L(T,...F){if(e.apply(this,arguments)){var E=T.touches,$=E.length,p=w(this,F,T.changedTouches.length===$).event(T),N,P,M,O;for(Nl(T),P=0;P<$;++P)M=E[P],O=Js(M,this),O=[O,this.__zoom.invert(O),M.identifier],p.touch0?!p.touch1&&p.touch0[2]!==O[2]&&(p.touch1=O,p.taps=0):(p.touch0=O,N=!0,p.taps=1+!!r);r&&(r=clearTimeout(r)),N&&(p.taps<2&&(c=O[0],r=setTimeout(function(){r=null},g)),gi(this),p.start())}}function V(T,...F){if(this.__zooming){var E=w(this,F).event(T),$=T.changedTouches,p=$.length,N,P,M,O;for(ir(T),N=0;N<p;++N)P=$[N],M=Js(P,this),E.touch0&&E.touch0[2]===P.identifier?E.touch0[0]=M:E.touch1&&E.touch1[2]===P.identifier&&(E.touch1[0]=M);if(P=E.that.__zoom,E.touch1){var W=E.touch0[0],q=E.touch0[1],ce=E.touch1[0],se=E.touch1[1],H=(H=ce[0]-W[0])*H+(H=ce[1]-W[1])*H,z=(z=se[0]-q[0])*z+(z=se[1]-q[1])*z;P=_(P,Math.sqrt(H/z)),M=[(W[0]+ce[0])/2,(W[1]+ce[1])/2],O=[(q[0]+se[0])/2,(q[1]+se[1])/2]}else if(E.touch0)M=E.touch0[0],O=E.touch0[1];else return;E.zoom("touch",a(x(P,M,O),E.extent,o))}}function B(T,...F){if(this.__zooming){var E=w(this,F).event(T),$=T.changedTouches,p=$.length,N,P;for(Nl(T),d&&clearTimeout(d),d=setTimeout(function(){d=null},g),N=0;N<p;++N)P=$[N],E.touch0&&E.touch0[2]===P.identifier?delete E.touch0:E.touch1&&E.touch1[2]===P.identifier&&delete E.touch1;if(E.touch1&&!E.touch0&&(E.touch0=E.touch1,delete E.touch1),E.touch0)E.touch0[1]=this.__zoom.invert(E.touch0[0]);else if(E.end(),E.taps===2&&(P=Js(P,this),Math.hypot(c[0]-P[0],c[1]-P[1])<y)){var M=Ps(this).on("dblclick.zoom");M&&M.apply(this,arguments)}}}return b.wheelDelta=function(T){return arguments.length?(n=typeof T=="function"?T:li(+T),b):n},b.filter=function(T){return arguments.length?(e=typeof T=="function"?T:li(!!T),b):e},b.touchable=function(T){return arguments.length?(i=typeof T=="function"?T:li(!!T),b):i},b.extent=function(T){return arguments.length?(s=typeof T=="function"?T:li([[+T[0][0],+T[0][1]],[+T[1][0],+T[1][1]]]),b):s},b.scaleExtent=function(T){return arguments.length?(l[0]=+T[0],l[1]=+T[1],b):[l[0],l[1]]},b.translateExtent=function(T){return arguments.length?(o[0][0]=+T[0][0],o[1][0]=+T[1][0],o[0][1]=+T[0][1],o[1][1]=+T[1][1],b):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},b.constrain=function(T){return arguments.length?(a=T,b):a},b.duration=function(T){return arguments.length?(u=+T,b):u},b.interpolate=function(T){return arguments.length?(m=T,b):m},b.on=function(){var T=h.on.apply(h,arguments);return T===h?b:T},b.clickDistance=function(T){return arguments.length?(S=(T=+T)*T,b):Math.sqrt(S)},b.tapDistance=function(T){return arguments.length?(y=+T,b):y},b}const ha={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,{id:s,sourceHandle:a,targetHandle:n})=>`Couldn't create edge for ${e} handle id: "${e==="source"?a:n}", edge id: ${s}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(e="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${e}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},Tr=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],oh=["Enter"," ","Escape"],ch={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:e,x:s,y:a})=>`Moved selected node ${e}. New position, x: ${s}, y: ${a}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var Bn;(function(e){e.Strict="strict",e.Loose="loose"})(Bn||(Bn={}));var un;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(un||(un={}));var Er;(function(e){e.Partial="partial",e.Full="full"})(Er||(Er={}));const dh={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null,pointer:null};var va;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(va||(va={}));var qa;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(qa||(qa={}));var Te;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(Te||(Te={}));const Rd={[Te.Left]:Te.Right,[Te.Right]:Te.Left,[Te.Top]:Te.Bottom,[Te.Bottom]:Te.Top};function uh(e){return e===null?null:e?"valid":"invalid"}const mh=e=>"id"in e&&"source"in e&&"target"in e,f_=e=>"id"in e&&"position"in e&&!("source"in e)&&!("target"in e),$o=e=>"id"in e&&"internals"in e&&!("source"in e)&&!("target"in e),Fr=(e,s=[0,0])=>{const{width:a,height:n}=ka(e),i=e.origin??s,l=a*i[0],o=n*i[1];return{x:e.position.x-l,y:e.position.y-o}},x_=(e,s={nodeOrigin:[0,0]})=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const a=e.reduce((n,i)=>{const l=typeof i=="string";let o=!s.nodeLookup&&!l?i:void 0;s.nodeLookup&&(o=l?s.nodeLookup.get(i):$o(i)?i:s.nodeLookup.get(i.id));const u=o?Pi(o,s.nodeOrigin):{x:0,y:0,x2:0,y2:0};return Ui(n,u)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return qi(a)},zr=(e,s={})=>{let a={x:1/0,y:1/0,x2:-1/0,y2:-1/0},n=!1;return e.forEach(i=>{(s.filter===void 0||s.filter(i))&&(a=Ui(a,Pi(i)),n=!0)}),n?qi(a):{x:0,y:0,width:0,height:0}},Vo=(e,s,[a,n,i]=[0,0,1],l=!1,o=!1)=>{const u={...Br(s,[a,n,i]),width:s.width/i,height:s.height/i},m=[];for(const h of e.values()){const{measured:r,selectable:c=!0,hidden:d=!1}=h;if(o&&!c||d)continue;const g=r.width??h.width??h.initialWidth??null,v=r.height??h.height??h.initialHeight??null,S=Ar(u,Un(h)),y=(g??0)*(v??0),b=l&&S>0;(!h.internals.handleBounds||b||S>=y||h.dragging)&&m.push(h)}return m},g_=(e,s)=>{const a=new Set;return e.forEach(n=>{a.add(n.id)}),s.filter(n=>a.has(n.source)||a.has(n.target))};function b_(e,s){const a=new Map,n=s!=null&&s.nodes?new Set(s.nodes.map(i=>i.id)):null;return e.forEach(i=>{i.measured.width&&i.measured.height&&((s==null?void 0:s.includeHiddenNodes)||!i.hidden)&&(!n||n.has(i.id))&&a.set(i.id,i)}),a}async function v_({nodes:e,width:s,height:a,panZoom:n,minZoom:i,maxZoom:l},o){if(e.size===0)return Promise.resolve(!0);const u=b_(e,o),m=zr(u),h=Do(m,s,a,(o==null?void 0:o.minZoom)??i,(o==null?void 0:o.maxZoom)??l,(o==null?void 0:o.padding)??.1);return await n.setViewport(h,{duration:o==null?void 0:o.duration,ease:o==null?void 0:o.ease,interpolate:o==null?void 0:o.interpolate}),Promise.resolve(!0)}function hh({nodeId:e,nextPosition:s,nodeLookup:a,nodeOrigin:n=[0,0],nodeExtent:i,onError:l}){const o=a.get(e),u=o.parentId?a.get(o.parentId):void 0,{x:m,y:h}=u?u.internals.positionAbsolute:{x:0,y:0},r=o.origin??n;let c=o.extent||i;if(o.extent==="parent"&&!o.expandParent)if(!u)l==null||l("005",ha.error005());else{const g=u.measured.width,v=u.measured.height;g&&v&&(c=[[m,h],[m+g,h+v]])}else u&&qn(o.extent)&&(c=[[o.extent[0][0]+m,o.extent[0][1]+h],[o.extent[1][0]+m,o.extent[1][1]+h]]);const d=qn(c)?xn(s,c,o.measured):s;return(o.measured.width===void 0||o.measured.height===void 0)&&(l==null||l("015",ha.error015())),{position:{x:d.x-m+(o.measured.width??0)*r[0],y:d.y-h+(o.measured.height??0)*r[1]},positionAbsolute:d}}async function y_({nodesToRemove:e=[],edgesToRemove:s=[],nodes:a,edges:n,onBeforeDelete:i}){const l=new Set(e.map(d=>d.id)),o=[];for(const d of a){if(d.deletable===!1)continue;const g=l.has(d.id),v=!g&&d.parentId&&o.find(S=>S.id===d.parentId);(g||v)&&o.push(d)}const u=new Set(s.map(d=>d.id)),m=n.filter(d=>d.deletable!==!1),r=g_(o,m);for(const d of m)u.has(d.id)&&!r.find(v=>v.id===d.id)&&r.push(d);if(!i)return{edges:r,nodes:o};const c=await i({nodes:o,edges:r});return typeof c=="boolean"?c?{edges:r,nodes:o}:{edges:[],nodes:[]}:c}const Wn=(e,s=0,a=1)=>Math.min(Math.max(e,s),a),xn=(e={x:0,y:0},s,a)=>({x:Wn(e.x,s[0][0],s[1][0]-((a==null?void 0:a.width)??0)),y:Wn(e.y,s[0][1],s[1][1]-((a==null?void 0:a.height)??0))});function ph(e,s,a){const{width:n,height:i}=ka(a),{x:l,y:o}=a.internals.positionAbsolute;return xn(e,[[l,o],[l+n,o+i]],s)}const Td=(e,s,a)=>e<s?Wn(Math.abs(e-s),1,s)/s:e>a?-Wn(Math.abs(e-a),1,s)/s:0,fh=(e,s,a=15,n=40)=>{const i=Td(e.x,n,s.width-n)*a,l=Td(e.y,n,s.height-n)*a;return[i,l]},Ui=(e,s)=>({x:Math.min(e.x,s.x),y:Math.min(e.y,s.y),x2:Math.max(e.x2,s.x2),y2:Math.max(e.y2,s.y2)}),lo=({x:e,y:s,width:a,height:n})=>({x:e,y:s,x2:e+a,y2:s+n}),qi=({x:e,y:s,x2:a,y2:n})=>({x:e,y:s,width:a-e,height:n-s}),Un=(e,s=[0,0])=>{var i,l;const{x:a,y:n}=$o(e)?e.internals.positionAbsolute:Fr(e,s);return{x:a,y:n,width:((i=e.measured)==null?void 0:i.width)??e.width??e.initialWidth??0,height:((l=e.measured)==null?void 0:l.height)??e.height??e.initialHeight??0}},Pi=(e,s=[0,0])=>{var i,l;const{x:a,y:n}=$o(e)?e.internals.positionAbsolute:Fr(e,s);return{x:a,y:n,x2:a+(((i=e.measured)==null?void 0:i.width)??e.width??e.initialWidth??0),y2:n+(((l=e.measured)==null?void 0:l.height)??e.height??e.initialHeight??0)}},xh=(e,s)=>qi(Ui(lo(e),lo(s))),Ar=(e,s)=>{const a=Math.max(0,Math.min(e.x+e.width,s.x+s.width)-Math.max(e.x,s.x)),n=Math.max(0,Math.min(e.y+e.height,s.y+s.height)-Math.max(e.y,s.y));return Math.ceil(a*n)},Ed=e=>ta(e.width)&&ta(e.height)&&ta(e.x)&&ta(e.y),ta=e=>!isNaN(e)&&isFinite(e),j_=(e,s)=>{},Hr=(e,s=[1,1])=>({x:s[0]*Math.round(e.x/s[0]),y:s[1]*Math.round(e.y/s[1])}),Br=({x:e,y:s},[a,n,i],l=!1,o=[1,1])=>{const u={x:(e-a)/i,y:(s-n)/i};return l?Hr(u,o):u},Ii=({x:e,y:s},[a,n,i])=>({x:e*i+a,y:s*i+n});function kn(e,s){if(typeof e=="number")return Math.floor((s-s/(1+e))*.5);if(typeof e=="string"&&e.endsWith("px")){const a=parseFloat(e);if(!Number.isNaN(a))return Math.floor(a)}if(typeof e=="string"&&e.endsWith("%")){const a=parseFloat(e);if(!Number.isNaN(a))return Math.floor(s*a*.01)}return console.error(`[React Flow] The padding value "${e}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function __(e,s,a){if(typeof e=="string"||typeof e=="number"){const n=kn(e,a),i=kn(e,s);return{top:n,right:i,bottom:n,left:i,x:i*2,y:n*2}}if(typeof e=="object"){const n=kn(e.top??e.y??0,a),i=kn(e.bottom??e.y??0,a),l=kn(e.left??e.x??0,s),o=kn(e.right??e.x??0,s);return{top:n,right:o,bottom:i,left:l,x:l+o,y:n+i}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function N_(e,s,a,n,i,l){const{x:o,y:u}=Ii(e,[s,a,n]),{x:m,y:h}=Ii({x:e.x+e.width,y:e.y+e.height},[s,a,n]),r=i-m,c=l-h;return{left:Math.floor(o),top:Math.floor(u),right:Math.floor(r),bottom:Math.floor(c)}}const Do=(e,s,a,n,i,l)=>{const o=__(l,s,a),u=(s-o.x)/e.width,m=(a-o.y)/e.height,h=Math.min(u,m),r=Wn(h,n,i),c=e.x+e.width/2,d=e.y+e.height/2,g=s/2-c*r,v=a/2-d*r,S=N_(e,g,v,r,s,a),y={left:Math.min(S.left-o.left,0),top:Math.min(S.top-o.top,0),right:Math.min(S.right-o.right,0),bottom:Math.min(S.bottom-o.bottom,0)};return{x:g-y.left+y.right,y:v-y.top+y.bottom,zoom:r}},Pr=()=>{var e;return typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)==null?void 0:e.indexOf("Mac"))>=0};function qn(e){return e!=null&&e!=="parent"}function ka(e){var s,a;return{width:((s=e.measured)==null?void 0:s.width)??e.width??e.initialWidth??0,height:((a=e.measured)==null?void 0:a.height)??e.height??e.initialHeight??0}}function gh(e){var s,a;return(((s=e.measured)==null?void 0:s.width)??e.width??e.initialWidth)!==void 0&&(((a=e.measured)==null?void 0:a.height)??e.height??e.initialHeight)!==void 0}function bh(e,s={width:0,height:0},a,n,i){const l={...e},o=n.get(a);if(o){const u=o.origin||i;l.x+=o.internals.positionAbsolute.x-(s.width??0)*u[0],l.y+=o.internals.positionAbsolute.y-(s.height??0)*u[1]}return l}function Ad(e,s){if(e.size!==s.size)return!1;for(const a of e)if(!s.has(a))return!1;return!0}function w_(){let e,s;return{promise:new Promise((n,i)=>{e=n,s=i}),resolve:e,reject:s}}function S_(e){return{...ch,...e||{}}}function pr(e,{snapGrid:s=[0,0],snapToGrid:a=!1,transform:n,containerBounds:i}){const{x:l,y:o}=sa(e),u=Br({x:l-((i==null?void 0:i.left)??0),y:o-((i==null?void 0:i.top)??0)},n),{x:m,y:h}=a?Hr(u,s):u;return{xSnapped:m,ySnapped:h,...u}}const Fo=e=>({width:e.offsetWidth,height:e.offsetHeight}),vh=e=>{var s;return((s=e==null?void 0:e.getRootNode)==null?void 0:s.call(e))||(window==null?void 0:window.document)},C_=["INPUT","SELECT","TEXTAREA"];function yh(e){var n,i;const s=((i=(n=e.composedPath)==null?void 0:n.call(e))==null?void 0:i[0])||e.target;return(s==null?void 0:s.nodeType)!==1?!1:C_.includes(s.nodeName)||s.hasAttribute("contenteditable")||!!s.closest(".nokey")}const jh=e=>"clientX"in e,sa=(e,s)=>{var l,o;const a=jh(e),n=a?e.clientX:(l=e.touches)==null?void 0:l[0].clientX,i=a?e.clientY:(o=e.touches)==null?void 0:o[0].clientY;return{x:n-((s==null?void 0:s.left)??0),y:i-((s==null?void 0:s.top)??0)}},Pd=(e,s,a,n,i)=>{const l=s.querySelectorAll(`.${e}`);return!l||!l.length?null:Array.from(l).map(o=>{const u=o.getBoundingClientRect();return{id:o.getAttribute("data-handleid"),type:e,nodeId:i,position:o.getAttribute("data-handlepos"),x:(u.left-a.left)/n,y:(u.top-a.top)/n,...Fo(o)}})};function _h({sourceX:e,sourceY:s,targetX:a,targetY:n,sourceControlX:i,sourceControlY:l,targetControlX:o,targetControlY:u}){const m=e*.125+i*.375+o*.375+a*.125,h=s*.125+l*.375+u*.375+n*.125,r=Math.abs(m-e),c=Math.abs(h-s);return[m,h,r,c]}function oi(e,s){return e>=0?.5*e:s*25*Math.sqrt(-e)}function Id({pos:e,x1:s,y1:a,x2:n,y2:i,c:l}){switch(e){case Te.Left:return[s-oi(s-n,l),a];case Te.Right:return[s+oi(n-s,l),a];case Te.Top:return[s,a-oi(a-i,l)];case Te.Bottom:return[s,a+oi(i-a,l)]}}function Nh({sourceX:e,sourceY:s,sourcePosition:a=Te.Bottom,targetX:n,targetY:i,targetPosition:l=Te.Top,curvature:o=.25}){const[u,m]=Id({pos:a,x1:e,y1:s,x2:n,y2:i,c:o}),[h,r]=Id({pos:l,x1:n,y1:i,x2:e,y2:s,c:o}),[c,d,g,v]=_h({sourceX:e,sourceY:s,targetX:n,targetY:i,sourceControlX:u,sourceControlY:m,targetControlX:h,targetControlY:r});return[`M${e},${s} C${u},${m} ${h},${r} ${n},${i}`,c,d,g,v]}function wh({sourceX:e,sourceY:s,targetX:a,targetY:n}){const i=Math.abs(a-e)/2,l=a<e?a+i:a-i,o=Math.abs(n-s)/2,u=n<s?n+o:n-o;return[l,u,i,o]}function k_({sourceNode:e,targetNode:s,selected:a=!1,zIndex:n=0,elevateOnSelect:i=!1,zIndexMode:l="basic"}){if(l==="manual")return n;const o=i&&a?n+1e3:n,u=Math.max(e.parentId||i&&e.selected?e.internals.z:0,s.parentId||i&&s.selected?s.internals.z:0);return o+u}function M_({sourceNode:e,targetNode:s,width:a,height:n,transform:i}){const l=Ui(Pi(e),Pi(s));l.x===l.x2&&(l.x2+=1),l.y===l.y2&&(l.y2+=1);const o={x:-i[0]/i[2],y:-i[1]/i[2],width:a/i[2],height:n/i[2]};return Ar(o,qi(l))>0}const R_=({source:e,sourceHandle:s,target:a,targetHandle:n})=>`xy-edge__${e}${s||""}-${a}${n||""}`,T_=(e,s)=>s.some(a=>a.source===e.source&&a.target===e.target&&(a.sourceHandle===e.sourceHandle||!a.sourceHandle&&!e.sourceHandle)&&(a.targetHandle===e.targetHandle||!a.targetHandle&&!e.targetHandle)),E_=(e,s,a={})=>{if(!e.source||!e.target)return s;const n=a.getEdgeId||R_;let i;return mh(e)?i={...e}:i={...e,id:n(e)},T_(i,s)?s:(i.sourceHandle===null&&delete i.sourceHandle,i.targetHandle===null&&delete i.targetHandle,s.concat(i))};function Sh({sourceX:e,sourceY:s,targetX:a,targetY:n}){const[i,l,o,u]=wh({sourceX:e,sourceY:s,targetX:a,targetY:n});return[`M ${e},${s}L ${a},${n}`,i,l,o,u]}const Od={[Te.Left]:{x:-1,y:0},[Te.Right]:{x:1,y:0},[Te.Top]:{x:0,y:-1},[Te.Bottom]:{x:0,y:1}},A_=({source:e,sourcePosition:s=Te.Bottom,target:a})=>s===Te.Left||s===Te.Right?e.x<a.x?{x:1,y:0}:{x:-1,y:0}:e.y<a.y?{x:0,y:1}:{x:0,y:-1},Ld=(e,s)=>Math.sqrt(Math.pow(s.x-e.x,2)+Math.pow(s.y-e.y,2));function P_({source:e,sourcePosition:s=Te.Bottom,target:a,targetPosition:n=Te.Top,center:i,offset:l,stepPosition:o}){const u=Od[s],m=Od[n],h={x:e.x+u.x*l,y:e.y+u.y*l},r={x:a.x+m.x*l,y:a.y+m.y*l},c=A_({source:h,sourcePosition:s,target:r}),d=c.x!==0?"x":"y",g=c[d];let v=[],S,y;const b={x:0,y:0},_={x:0,y:0},[,,x,f]=wh({sourceX:e.x,sourceY:e.y,targetX:a.x,targetY:a.y});if(u[d]*m[d]===-1){d==="x"?(S=i.x??h.x+(r.x-h.x)*o,y=i.y??(h.y+r.y)/2):(S=i.x??(h.x+r.x)/2,y=i.y??h.y+(r.y-h.y)*o);const w=[{x:S,y:h.y},{x:S,y:r.y}],I=[{x:h.x,y},{x:r.x,y}];u[d]===g?v=d==="x"?w:I:v=d==="x"?I:w}else{const w=[{x:h.x,y:r.y}],I=[{x:r.x,y:h.y}];if(d==="x"?v=u.x===g?I:w:v=u.y===g?w:I,s===n){const V=Math.abs(e[d]-a[d]);if(V<=l){const B=Math.min(l-1,l-V);u[d]===g?b[d]=(h[d]>e[d]?-1:1)*B:_[d]=(r[d]>a[d]?-1:1)*B}}if(s!==n){const V=d==="x"?"y":"x",B=u[d]===m[V],T=h[V]>r[V],F=h[V]<r[V];(u[d]===1&&(!B&&T||B&&F)||u[d]!==1&&(!B&&F||B&&T))&&(v=d==="x"?w:I)}const R={x:h.x+b.x,y:h.y+b.y},k={x:r.x+_.x,y:r.y+_.y},D=Math.max(Math.abs(R.x-v[0].x),Math.abs(k.x-v[0].x)),L=Math.max(Math.abs(R.y-v[0].y),Math.abs(k.y-v[0].y));D>=L?(S=(R.x+k.x)/2,y=v[0].y):(S=v[0].x,y=(R.y+k.y)/2)}return[[e,{x:h.x+b.x,y:h.y+b.y},...v,{x:r.x+_.x,y:r.y+_.y},a],S,y,x,f]}function I_(e,s,a,n){const i=Math.min(Ld(e,s)/2,Ld(s,a)/2,n),{x:l,y:o}=s;if(e.x===l&&l===a.x||e.y===o&&o===a.y)return`L${l} ${o}`;if(e.y===o){const h=e.x<a.x?-1:1,r=e.y<a.y?1:-1;return`L ${l+i*h},${o}Q ${l},${o} ${l},${o+i*r}`}const u=e.x<a.x?1:-1,m=e.y<a.y?-1:1;return`L ${l},${o+i*m}Q ${l},${o} ${l+i*u},${o}`}function oo({sourceX:e,sourceY:s,sourcePosition:a=Te.Bottom,targetX:n,targetY:i,targetPosition:l=Te.Top,borderRadius:o=5,centerX:u,centerY:m,offset:h=20,stepPosition:r=.5}){const[c,d,g,v,S]=P_({source:{x:e,y:s},sourcePosition:a,target:{x:n,y:i},targetPosition:l,center:{x:u,y:m},offset:h,stepPosition:r});return[c.reduce((b,_,x)=>{let f="";return x>0&&x<c.length-1?f=I_(c[x-1],_,c[x+1],o):f=`${x===0?"M":"L"}${_.x} ${_.y}`,b+=f,b},""),d,g,v,S]}function $d(e){var s;return e&&!!(e.internals.handleBounds||(s=e.handles)!=null&&s.length)&&!!(e.measured.width||e.width||e.initialWidth)}function O_(e){var c;const{sourceNode:s,targetNode:a}=e;if(!$d(s)||!$d(a))return null;const n=s.internals.handleBounds||Vd(s.handles),i=a.internals.handleBounds||Vd(a.handles),l=Dd((n==null?void 0:n.source)??[],e.sourceHandle),o=Dd(e.connectionMode===Bn.Strict?(i==null?void 0:i.target)??[]:((i==null?void 0:i.target)??[]).concat((i==null?void 0:i.source)??[]),e.targetHandle);if(!l||!o)return(c=e.onError)==null||c.call(e,"008",ha.error008(l?"target":"source",{id:e.id,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle})),null;const u=(l==null?void 0:l.position)||Te.Bottom,m=(o==null?void 0:o.position)||Te.Top,h=gn(s,l,u),r=gn(a,o,m);return{sourceX:h.x,sourceY:h.y,targetX:r.x,targetY:r.y,sourcePosition:u,targetPosition:m}}function Vd(e){if(!e)return null;const s=[],a=[];for(const n of e)n.width=n.width??1,n.height=n.height??1,n.type==="source"?s.push(n):n.type==="target"&&a.push(n);return{source:s,target:a}}function gn(e,s,a=Te.Left,n=!1){const i=((s==null?void 0:s.x)??0)+e.internals.positionAbsolute.x,l=((s==null?void 0:s.y)??0)+e.internals.positionAbsolute.y,{width:o,height:u}=s??ka(e);if(n)return{x:i+o/2,y:l+u/2};switch((s==null?void 0:s.position)??a){case Te.Top:return{x:i+o/2,y:l};case Te.Right:return{x:i+o,y:l+u/2};case Te.Bottom:return{x:i+o/2,y:l+u};case Te.Left:return{x:i,y:l+u/2}}}function Dd(e,s){return e&&(s?e.find(a=>a.id===s):e[0])||null}function co(e,s){return e?typeof e=="string"?e:`${s?`${s}__`:""}${Object.keys(e).sort().map(n=>`${n}=${e[n]}`).join("&")}`:""}function L_(e,{id:s,defaultColor:a,defaultMarkerStart:n,defaultMarkerEnd:i}){const l=new Set;return e.reduce((o,u)=>([u.markerStart||n,u.markerEnd||i].forEach(m=>{if(m&&typeof m=="object"){const h=co(m,s);l.has(h)||(o.push({id:h,color:m.color||a,...m}),l.add(h))}}),o),[]).sort((o,u)=>o.id.localeCompare(u.id))}const Ch=1e3,$_=10,zo={nodeOrigin:[0,0],nodeExtent:Tr,elevateNodesOnSelect:!0,zIndexMode:"basic",defaults:{}},V_={...zo,checkEquality:!0};function Ho(e,s){const a={...e};for(const n in s)s[n]!==void 0&&(a[n]=s[n]);return a}function D_(e,s,a){const n=Ho(zo,a);for(const i of e.values())if(i.parentId)Wo(i,e,s,n);else{const l=Fr(i,n.nodeOrigin),o=qn(i.extent)?i.extent:n.nodeExtent,u=xn(l,o,ka(i));i.internals.positionAbsolute=u}}function F_(e,s){if(!e.handles)return e.measured?s==null?void 0:s.internals.handleBounds:void 0;const a=[],n=[];for(const i of e.handles){const l={id:i.id,width:i.width??1,height:i.height??1,nodeId:e.id,x:i.x,y:i.y,position:i.position,type:i.type};i.type==="source"?a.push(l):i.type==="target"&&n.push(l)}return{source:a,target:n}}function Bo(e){return e==="manual"}function uo(e,s,a,n={}){var h,r;const i=Ho(V_,n),l={i:0},o=new Map(s),u=i!=null&&i.elevateNodesOnSelect&&!Bo(i.zIndexMode)?Ch:0;let m=e.length>0;s.clear(),a.clear();for(const c of e){let d=o.get(c.id);if(i.checkEquality&&c===(d==null?void 0:d.internals.userNode))s.set(c.id,d);else{const g=Fr(c,i.nodeOrigin),v=qn(c.extent)?c.extent:i.nodeExtent,S=xn(g,v,ka(c));d={...i.defaults,...c,measured:{width:(h=c.measured)==null?void 0:h.width,height:(r=c.measured)==null?void 0:r.height},internals:{positionAbsolute:S,handleBounds:F_(c,d),z:kh(c,u,i.zIndexMode),userNode:c}},s.set(c.id,d)}(d.measured===void 0||d.measured.width===void 0||d.measured.height===void 0)&&!d.hidden&&(m=!1),c.parentId&&Wo(d,s,a,n,l)}return m}function z_(e,s){if(!e.parentId)return;const a=s.get(e.parentId);a?a.set(e.id,e):s.set(e.parentId,new Map([[e.id,e]]))}function Wo(e,s,a,n,i){const{elevateNodesOnSelect:l,nodeOrigin:o,nodeExtent:u,zIndexMode:m}=Ho(zo,n),h=e.parentId,r=s.get(h);if(!r){console.warn(`Parent node ${h} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}z_(e,a),i&&!r.parentId&&r.internals.rootParentIndex===void 0&&m==="auto"&&(r.internals.rootParentIndex=++i.i,r.internals.z=r.internals.z+i.i*$_),i&&r.internals.rootParentIndex!==void 0&&(i.i=r.internals.rootParentIndex);const c=l&&!Bo(m)?Ch:0,{x:d,y:g,z:v}=H_(e,r,o,u,c,m),{positionAbsolute:S}=e.internals,y=d!==S.x||g!==S.y;(y||v!==e.internals.z)&&s.set(e.id,{...e,internals:{...e.internals,positionAbsolute:y?{x:d,y:g}:S,z:v}})}function kh(e,s,a){const n=ta(e.zIndex)?e.zIndex:0;return Bo(a)?n:n+(e.selected?s:0)}function H_(e,s,a,n,i,l){const{x:o,y:u}=s.internals.positionAbsolute,m=ka(e),h=Fr(e,a),r=qn(e.extent)?xn(h,e.extent,m):h;let c=xn({x:o+r.x,y:u+r.y},n,m);e.extent==="parent"&&(c=ph(c,m,s));const d=kh(e,i,l),g=s.internals.z??0;return{x:c.x,y:c.y,z:g>=d?g+1:d}}function Uo(e,s,a,n=[0,0]){var o;const i=[],l=new Map;for(const u of e){const m=s.get(u.parentId);if(!m)continue;const h=((o=l.get(u.parentId))==null?void 0:o.expandedRect)??Un(m),r=xh(h,u.rect);l.set(u.parentId,{expandedRect:r,parent:m})}return l.size>0&&l.forEach(({expandedRect:u,parent:m},h)=>{var x;const r=m.internals.positionAbsolute,c=ka(m),d=m.origin??n,g=u.x<r.x?Math.round(Math.abs(r.x-u.x)):0,v=u.y<r.y?Math.round(Math.abs(r.y-u.y)):0,S=Math.max(c.width,Math.round(u.width)),y=Math.max(c.height,Math.round(u.height)),b=(S-c.width)*d[0],_=(y-c.height)*d[1];(g>0||v>0||b||_)&&(i.push({id:h,type:"position",position:{x:m.position.x-g+b,y:m.position.y-v+_}}),(x=a.get(h))==null||x.forEach(f=>{e.some(C=>C.id===f.id)||i.push({id:f.id,type:"position",position:{x:f.position.x+g,y:f.position.y+v}})})),(c.width<u.width||c.height<u.height||g||v)&&i.push({id:h,type:"dimensions",setAttributes:!0,dimensions:{width:S+(g?d[0]*g-b:0),height:y+(v?d[1]*v-_:0)}})}),i}function B_(e,s,a,n,i,l,o){const u=n==null?void 0:n.querySelector(".xyflow__viewport");let m=!1;if(!u)return{changes:[],updatedInternals:m};const h=[],r=window.getComputedStyle(u),{m22:c}=new window.DOMMatrixReadOnly(r.transform),d=[];for(const g of e.values()){const v=s.get(g.id);if(!v)continue;if(v.hidden){s.set(v.id,{...v,internals:{...v.internals,handleBounds:void 0}}),m=!0;continue}const S=Fo(g.nodeElement),y=v.measured.width!==S.width||v.measured.height!==S.height;if(!!(S.width&&S.height&&(y||!v.internals.handleBounds||g.force))){const _=g.nodeElement.getBoundingClientRect(),x=qn(v.extent)?v.extent:l;let{positionAbsolute:f}=v.internals;v.parentId&&v.extent==="parent"?f=ph(f,S,s.get(v.parentId)):x&&(f=xn(f,x,S));const C={...v,measured:S,internals:{...v.internals,positionAbsolute:f,handleBounds:{source:Pd("source",g.nodeElement,_,c,v.id),target:Pd("target",g.nodeElement,_,c,v.id)}}};s.set(v.id,C),v.parentId&&Wo(C,s,a,{nodeOrigin:i,zIndexMode:o}),m=!0,y&&(h.push({id:v.id,type:"dimensions",dimensions:S}),v.expandParent&&v.parentId&&d.push({id:v.id,parentId:v.parentId,rect:Un(C,i)}))}}if(d.length>0){const g=Uo(d,s,a,i);h.push(...g)}return{changes:h,updatedInternals:m}}async function W_({delta:e,panZoom:s,transform:a,translateExtent:n,width:i,height:l}){if(!s||!e.x&&!e.y)return Promise.resolve(!1);const o=await s.setViewportConstrained({x:a[0]+e.x,y:a[1]+e.y,zoom:a[2]},[[0,0],[i,l]],n),u=!!o&&(o.x!==a[0]||o.y!==a[1]||o.k!==a[2]);return Promise.resolve(u)}function Fd(e,s,a,n,i,l){let o=i;const u=n.get(o)||new Map;n.set(o,u.set(a,s)),o=`${i}-${e}`;const m=n.get(o)||new Map;if(n.set(o,m.set(a,s)),l){o=`${i}-${e}-${l}`;const h=n.get(o)||new Map;n.set(o,h.set(a,s))}}function Mh(e,s,a){e.clear(),s.clear();for(const n of a){const{source:i,target:l,sourceHandle:o=null,targetHandle:u=null}=n,m={edgeId:n.id,source:i,target:l,sourceHandle:o,targetHandle:u},h=`${i}-${o}--${l}-${u}`,r=`${l}-${u}--${i}-${o}`;Fd("source",m,r,e,i,o),Fd("target",m,h,e,l,u),s.set(n.id,n)}}function Rh(e,s){if(!e.parentId)return!1;const a=s.get(e.parentId);return a?a.selected?!0:Rh(a,s):!1}function zd(e,s,a){var i;let n=e;do{if((i=n==null?void 0:n.matches)!=null&&i.call(n,s))return!0;if(n===a)return!1;n=n==null?void 0:n.parentElement}while(n);return!1}function U_(e,s,a,n){const i=new Map;for(const[l,o]of e)if((o.selected||o.id===n)&&(!o.parentId||!Rh(o,e))&&(o.draggable||s&&typeof o.draggable>"u")){const u=e.get(l);u&&i.set(l,{id:l,position:u.position||{x:0,y:0},distance:{x:a.x-u.internals.positionAbsolute.x,y:a.y-u.internals.positionAbsolute.y},extent:u.extent,parentId:u.parentId,origin:u.origin,expandParent:u.expandParent,internals:{positionAbsolute:u.internals.positionAbsolute||{x:0,y:0}},measured:{width:u.measured.width??0,height:u.measured.height??0}})}return i}function wl({nodeId:e,dragItems:s,nodeLookup:a,dragging:n=!0}){var o,u,m;const i=[];for(const[h,r]of s){const c=(o=a.get(h))==null?void 0:o.internals.userNode;c&&i.push({...c,position:r.position,dragging:n})}if(!e)return[i[0],i];const l=(u=a.get(e))==null?void 0:u.internals.userNode;return[l?{...l,position:((m=s.get(e))==null?void 0:m.position)||l.position,dragging:n}:i[0],i]}function q_({dragItems:e,snapGrid:s,x:a,y:n}){const i=e.values().next().value;if(!i)return null;const l={x:a-i.distance.x,y:n-i.distance.y},o=Hr(l,s);return{x:o.x-l.x,y:o.y-l.y}}function G_({onNodeMouseDown:e,getStoreItems:s,onDragStart:a,onDrag:n,onDragStop:i}){let l={x:null,y:null},o=0,u=new Map,m=!1,h={x:0,y:0},r=null,c=!1,d=null,g=!1,v=!1,S=null;function y({noDragClassName:_,handleSelector:x,domNode:f,isSelectable:C,nodeId:w,nodeClickDistance:I=0}){d=Ps(f);function R({x:V,y:B}){const{nodeLookup:T,nodeExtent:F,snapGrid:E,snapToGrid:$,nodeOrigin:p,onNodeDrag:N,onSelectionDrag:P,onError:M,updateNodePositions:O}=s();l={x:V,y:B};let W=!1;const q=u.size>1,ce=q&&F?lo(zr(u)):null,se=q&&$?q_({dragItems:u,snapGrid:E,x:V,y:B}):null;for(const[H,z]of u){if(!T.has(H))continue;let te={x:V-z.distance.x,y:B-z.distance.y};$&&(te=se?{x:Math.round(te.x+se.x),y:Math.round(te.y+se.y)}:Hr(te,E));let K=null;if(q&&F&&!z.extent&&ce){const{positionAbsolute:oe}=z.internals,X=oe.x-ce.x+F[0][0],Z=oe.x+z.measured.width-ce.x2+F[1][0],me=oe.y-ce.y+F[0][1],Re=oe.y+z.measured.height-ce.y2+F[1][1];K=[[X,me],[Z,Re]]}const{position:he,positionAbsolute:J}=hh({nodeId:H,nextPosition:te,nodeLookup:T,nodeExtent:K||F,nodeOrigin:p,onError:M});W=W||z.position.x!==he.x||z.position.y!==he.y,z.position=he,z.internals.positionAbsolute=J}if(v=v||W,!!W&&(O(u,!0),S&&(n||N||!w&&P))){const[H,z]=wl({nodeId:w,dragItems:u,nodeLookup:T});n==null||n(S,u,H,z),N==null||N(S,H,z),w||P==null||P(S,z)}}async function k(){if(!r)return;const{transform:V,panBy:B,autoPanSpeed:T,autoPanOnNodeDrag:F}=s();if(!F){m=!1,cancelAnimationFrame(o);return}const[E,$]=fh(h,r,T);(E!==0||$!==0)&&(l.x=(l.x??0)-E/V[2],l.y=(l.y??0)-$/V[2],await B({x:E,y:$})&&R(l)),o=requestAnimationFrame(k)}function D(V){var q;const{nodeLookup:B,multiSelectionActive:T,nodesDraggable:F,transform:E,snapGrid:$,snapToGrid:p,selectNodesOnDrag:N,onNodeDragStart:P,onSelectionDragStart:M,unselectNodesAndEdges:O}=s();c=!0,(!N||!C)&&!T&&w&&((q=B.get(w))!=null&&q.selected||O()),C&&N&&w&&(e==null||e(w));const W=pr(V.sourceEvent,{transform:E,snapGrid:$,snapToGrid:p,containerBounds:r});if(l=W,u=U_(B,F,W,w),u.size>0&&(a||P||!w&&M)){const[ce,se]=wl({nodeId:w,dragItems:u,nodeLookup:B});a==null||a(V.sourceEvent,u,ce,se),P==null||P(V.sourceEvent,ce,se),w||M==null||M(V.sourceEvent,se)}}const L=qm().clickDistance(I).on("start",V=>{const{domNode:B,nodeDragThreshold:T,transform:F,snapGrid:E,snapToGrid:$}=s();r=(B==null?void 0:B.getBoundingClientRect())||null,g=!1,v=!1,S=V.sourceEvent,T===0&&D(V),l=pr(V.sourceEvent,{transform:F,snapGrid:E,snapToGrid:$,containerBounds:r}),h=sa(V.sourceEvent,r)}).on("drag",V=>{const{autoPanOnNodeDrag:B,transform:T,snapGrid:F,snapToGrid:E,nodeDragThreshold:$,nodeLookup:p}=s(),N=pr(V.sourceEvent,{transform:T,snapGrid:F,snapToGrid:E,containerBounds:r});if(S=V.sourceEvent,(V.sourceEvent.type==="touchmove"&&V.sourceEvent.touches.length>1||w&&!p.has(w))&&(g=!0),!g){if(!m&&B&&c&&(m=!0,k()),!c){const P=sa(V.sourceEvent,r),M=P.x-h.x,O=P.y-h.y;Math.sqrt(M*M+O*O)>$&&D(V)}(l.x!==N.xSnapped||l.y!==N.ySnapped)&&u&&c&&(h=sa(V.sourceEvent,r),R(N))}}).on("end",V=>{if(!(!c||g)&&(m=!1,c=!1,cancelAnimationFrame(o),u.size>0)){const{nodeLookup:B,updateNodePositions:T,onNodeDragStop:F,onSelectionDragStop:E}=s();if(v&&(T(u,!1),v=!1),i||F||!w&&E){const[$,p]=wl({nodeId:w,dragItems:u,nodeLookup:B,dragging:!1});i==null||i(V.sourceEvent,u,$,p),F==null||F(V.sourceEvent,$,p),w||E==null||E(V.sourceEvent,p)}}}).filter(V=>{const B=V.target;return!V.button&&(!_||!zd(B,`.${_}`,f))&&(!x||zd(B,x,f))});d.call(L)}function b(){d==null||d.on(".drag",null)}return{update:y,destroy:b}}function Y_(e,s,a){const n=[],i={x:e.x-a,y:e.y-a,width:a*2,height:a*2};for(const l of s.values())Ar(i,Un(l))>0&&n.push(l);return n}const K_=250;function X_(e,s,a,n){var u,m;let i=[],l=1/0;const o=Y_(e,a,s+K_);for(const h of o){const r=[...((u=h.internals.handleBounds)==null?void 0:u.source)??[],...((m=h.internals.handleBounds)==null?void 0:m.target)??[]];for(const c of r){if(n.nodeId===c.nodeId&&n.type===c.type&&n.id===c.id)continue;const{x:d,y:g}=gn(h,c,c.position,!0),v=Math.sqrt(Math.pow(d-e.x,2)+Math.pow(g-e.y,2));v>s||(v<l?(i=[{...c,x:d,y:g}],l=v):v===l&&i.push({...c,x:d,y:g}))}}if(!i.length)return null;if(i.length>1){const h=n.type==="source"?"target":"source";return i.find(r=>r.type===h)??i[0]}return i[0]}function Th(e,s,a,n,i,l=!1){var h,r,c;const o=n.get(e);if(!o)return null;const u=i==="strict"?(h=o.internals.handleBounds)==null?void 0:h[s]:[...((r=o.internals.handleBounds)==null?void 0:r.source)??[],...((c=o.internals.handleBounds)==null?void 0:c.target)??[]],m=(a?u==null?void 0:u.find(d=>d.id===a):u==null?void 0:u[0])??null;return m&&l?{...m,...gn(o,m,m.position,!0)}:m}function Eh(e,s){return e||(s!=null&&s.classList.contains("target")?"target":s!=null&&s.classList.contains("source")?"source":null)}function J_(e,s){let a=null;return s?a=!0:e&&!s&&(a=!1),a}const Ah=()=>!0;function Q_(e,{connectionMode:s,connectionRadius:a,handleId:n,nodeId:i,edgeUpdaterType:l,isTarget:o,domNode:u,nodeLookup:m,lib:h,autoPanOnConnect:r,flowId:c,panBy:d,cancelConnection:g,onConnectStart:v,onConnect:S,onConnectEnd:y,isValidConnection:b=Ah,onReconnectEnd:_,updateConnection:x,getTransform:f,getFromHandle:C,autoPanSpeed:w,dragThreshold:I=1,handleDomNode:R}){const k=vh(e.target);let D=0,L;const{x:V,y:B}=sa(e),T=Eh(l,R),F=u==null?void 0:u.getBoundingClientRect();let E=!1;if(!F||!T)return;const $=Th(i,T,n,m,s);if(!$)return;let p=sa(e,F),N=!1,P=null,M=!1,O=null;function W(){if(!r||!F)return;const[he,J]=fh(p,F,w);d({x:he,y:J}),D=requestAnimationFrame(W)}const q={...$,nodeId:i,type:T,position:$.position},ce=m.get(i);let H={inProgress:!0,isValid:null,from:gn(ce,q,Te.Left,!0),fromHandle:q,fromPosition:q.position,fromNode:ce,to:p,toHandle:null,toPosition:Rd[q.position],toNode:null,pointer:p};function z(){E=!0,x(H),v==null||v(e,{nodeId:i,handleId:n,handleType:T})}I===0&&z();function te(he){if(!E){const{x:Re,y:st}=sa(he),it=Re-V,rt=st-B;if(!(it*it+rt*rt>I*I))return;z()}if(!C()||!q){K(he);return}const J=f();p=sa(he,F),L=X_(Br(p,J,!1,[1,1]),a,m,q),N||(W(),N=!0);const oe=Ph(he,{handle:L,connectionMode:s,fromNodeId:i,fromHandleId:n,fromType:o?"target":"source",isValidConnection:b,doc:k,lib:h,flowId:c,nodeLookup:m});O=oe.handleDomNode,P=oe.connection,M=J_(!!L,oe.isValid);const X=m.get(i),Z=X?gn(X,q,Te.Left,!0):H.from,me={...H,from:Z,isValid:M,to:oe.toHandle&&M?Ii({x:oe.toHandle.x,y:oe.toHandle.y},J):p,toHandle:oe.toHandle,toPosition:M&&oe.toHandle?oe.toHandle.position:Rd[q.position],toNode:oe.toHandle?m.get(oe.toHandle.nodeId):null,pointer:p};x(me),H=me}function K(he){if(!("touches"in he&&he.touches.length>0)){if(E){(L||O)&&P&&M&&(S==null||S(P));const{inProgress:J,...oe}=H,X={...oe,toPosition:H.toHandle?H.toPosition:null};y==null||y(he,X),l&&(_==null||_(he,X))}g(),cancelAnimationFrame(D),N=!1,M=!1,P=null,O=null,k.removeEventListener("mousemove",te),k.removeEventListener("mouseup",K),k.removeEventListener("touchmove",te),k.removeEventListener("touchend",K)}}k.addEventListener("mousemove",te),k.addEventListener("mouseup",K),k.addEventListener("touchmove",te),k.addEventListener("touchend",K)}function Ph(e,{handle:s,connectionMode:a,fromNodeId:n,fromHandleId:i,fromType:l,doc:o,lib:u,flowId:m,isValidConnection:h=Ah,nodeLookup:r}){const c=l==="target",d=s?o.querySelector(`.${u}-flow__handle[data-id="${m}-${s==null?void 0:s.nodeId}-${s==null?void 0:s.id}-${s==null?void 0:s.type}"]`):null,{x:g,y:v}=sa(e),S=o.elementFromPoint(g,v),y=S!=null&&S.classList.contains(`${u}-flow__handle`)?S:d,b={handleDomNode:y,isValid:!1,connection:null,toHandle:null};if(y){const _=Eh(void 0,y),x=y.getAttribute("data-nodeid"),f=y.getAttribute("data-handleid"),C=y.classList.contains("connectable"),w=y.classList.contains("connectableend");if(!x||!_)return b;const I={source:c?x:n,sourceHandle:c?f:i,target:c?n:x,targetHandle:c?i:f};b.connection=I;const k=C&&w&&(a===Bn.Strict?c&&_==="source"||!c&&_==="target":x!==n||f!==i);b.isValid=k&&h(I),b.toHandle=Th(x,_,f,r,a,!0)}return b}const mo={onPointerDown:Q_,isValid:Ph};function Z_({domNode:e,panZoom:s,getTransform:a,getViewScale:n}){const i=Ps(e);function l({translateExtent:u,width:m,height:h,zoomStep:r=1,pannable:c=!0,zoomable:d=!0,inversePan:g=!1}){const v=x=>{if(x.sourceEvent.type!=="wheel"||!s)return;const f=a(),C=x.sourceEvent.ctrlKey&&Pr()?10:1,w=-x.sourceEvent.deltaY*(x.sourceEvent.deltaMode===1?.05:x.sourceEvent.deltaMode?1:.002)*r,I=f[2]*Math.pow(2,w*C);s.scaleTo(I)};let S=[0,0];const y=x=>{(x.sourceEvent.type==="mousedown"||x.sourceEvent.type==="touchstart")&&(S=[x.sourceEvent.clientX??x.sourceEvent.touches[0].clientX,x.sourceEvent.clientY??x.sourceEvent.touches[0].clientY])},b=x=>{const f=a();if(x.sourceEvent.type!=="mousemove"&&x.sourceEvent.type!=="touchmove"||!s)return;const C=[x.sourceEvent.clientX??x.sourceEvent.touches[0].clientX,x.sourceEvent.clientY??x.sourceEvent.touches[0].clientY],w=[C[0]-S[0],C[1]-S[1]];S=C;const I=n()*Math.max(f[2],Math.log(f[2]))*(g?-1:1),R={x:f[0]-w[0]*I,y:f[1]-w[1]*I},k=[[0,0],[m,h]];s.setViewportConstrained({x:R.x,y:R.y,zoom:f[2]},k,u)},_=lh().on("start",y).on("zoom",c?b:null).on("zoom.wheel",d?v:null);i.call(_,{})}function o(){i.on("zoom",null)}return{update:l,destroy:o,pointer:Js}}const Gi=e=>({x:e.x,y:e.y,zoom:e.k}),Sl=({x:e,y:s,zoom:a})=>Wi.translate(e,s).scale(a),Pn=(e,s)=>e.target.closest(`.${s}`),Ih=(e,s)=>s===2&&Array.isArray(e)&&e.includes(2),eN=e=>((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2,Cl=(e,s=0,a=eN,n=()=>{})=>{const i=typeof s=="number"&&s>0;return i||n(),i?e.transition().duration(s).ease(a).on("end",n):e},Oh=e=>{const s=e.ctrlKey&&Pr()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*s};function tN({zoomPanValues:e,noWheelClassName:s,d3Selection:a,d3Zoom:n,panOnScrollMode:i,panOnScrollSpeed:l,zoomOnPinch:o,onPanZoomStart:u,onPanZoom:m,onPanZoomEnd:h}){return r=>{if(Pn(r,s))return r.ctrlKey&&r.preventDefault(),!1;r.preventDefault(),r.stopImmediatePropagation();const c=a.property("__zoom").k||1;if(r.ctrlKey&&o){const y=Js(r),b=Oh(r),_=c*Math.pow(2,b);n.scaleTo(a,_,y,r);return}const d=r.deltaMode===1?20:1;let g=i===un.Vertical?0:r.deltaX*d,v=i===un.Horizontal?0:r.deltaY*d;!Pr()&&r.shiftKey&&i!==un.Vertical&&(g=r.deltaY*d,v=0),n.translateBy(a,-(g/c)*l,-(v/c)*l,{internal:!0});const S=Gi(a.property("__zoom"));clearTimeout(e.panScrollTimeout),e.isPanScrolling?(m==null||m(r,S),e.panScrollTimeout=setTimeout(()=>{h==null||h(r,S),e.isPanScrolling=!1},150)):(e.isPanScrolling=!0,u==null||u(r,S))}}function sN({noWheelClassName:e,preventScrolling:s,d3ZoomHandler:a}){return function(n,i){const l=n.type==="wheel",o=!s&&l&&!n.ctrlKey,u=Pn(n,e);if(n.ctrlKey&&l&&u&&n.preventDefault(),o||u)return null;n.preventDefault(),a.call(this,n,i)}}function aN({zoomPanValues:e,onDraggingChange:s,onPanZoomStart:a}){return n=>{var l,o,u;if((l=n.sourceEvent)!=null&&l.internal)return;const i=Gi(n.transform);e.mouseButton=((o=n.sourceEvent)==null?void 0:o.button)||0,e.isZoomingOrPanning=!0,e.prevViewport=i,((u=n.sourceEvent)==null?void 0:u.type)==="mousedown"&&s(!0),a&&(a==null||a(n.sourceEvent,i))}}function nN({zoomPanValues:e,panOnDrag:s,onPaneContextMenu:a,onTransformChange:n,onPanZoom:i}){return l=>{var o,u;e.usedRightMouseButton=!!(a&&Ih(s,e.mouseButton??0)),(o=l.sourceEvent)!=null&&o.sync||n([l.transform.x,l.transform.y,l.transform.k]),i&&!((u=l.sourceEvent)!=null&&u.internal)&&(i==null||i(l.sourceEvent,Gi(l.transform)))}}function rN({zoomPanValues:e,panOnDrag:s,panOnScroll:a,onDraggingChange:n,onPanZoomEnd:i,onPaneContextMenu:l}){return o=>{var u;if(!((u=o.sourceEvent)!=null&&u.internal)&&(e.isZoomingOrPanning=!1,l&&Ih(s,e.mouseButton??0)&&!e.usedRightMouseButton&&o.sourceEvent&&l(o.sourceEvent),e.usedRightMouseButton=!1,n(!1),i)){const m=Gi(o.transform);e.prevViewport=m,clearTimeout(e.timerId),e.timerId=setTimeout(()=>{i==null||i(o.sourceEvent,m)},a?150:0)}}}function iN({zoomActivationKeyPressed:e,zoomOnScroll:s,zoomOnPinch:a,panOnDrag:n,panOnScroll:i,zoomOnDoubleClick:l,userSelectionActive:o,noWheelClassName:u,noPanClassName:m,lib:h,connectionInProgress:r}){return c=>{var y;const d=e||s,g=a&&c.ctrlKey,v=c.type==="wheel";if(c.button===1&&c.type==="mousedown"&&(Pn(c,`${h}-flow__node`)||Pn(c,`${h}-flow__edge`)))return!0;if(!n&&!d&&!i&&!l&&!a||o||r&&!v||Pn(c,u)&&v||Pn(c,m)&&(!v||i&&v&&!e)||!a&&c.ctrlKey&&v)return!1;if(!a&&c.type==="touchstart"&&((y=c.touches)==null?void 0:y.length)>1)return c.preventDefault(),!1;if(!d&&!i&&!g&&v||!n&&(c.type==="mousedown"||c.type==="touchstart")||Array.isArray(n)&&!n.includes(c.button)&&c.type==="mousedown")return!1;const S=Array.isArray(n)&&n.includes(c.button)||!c.button||c.button<=1;return(!c.ctrlKey||v)&&S}}function lN({domNode:e,minZoom:s,maxZoom:a,translateExtent:n,viewport:i,onPanZoom:l,onPanZoomStart:o,onPanZoomEnd:u,onDraggingChange:m}){const h={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},r=e.getBoundingClientRect(),c=lh().scaleExtent([s,a]).translateExtent(n),d=Ps(e).call(c);_({x:i.x,y:i.y,zoom:Wn(i.zoom,s,a)},[[0,0],[r.width,r.height]],n);const g=d.on("wheel.zoom"),v=d.on("dblclick.zoom");c.wheelDelta(Oh);function S(L,V){return d?new Promise(B=>{c==null||c.interpolate((V==null?void 0:V.interpolate)==="linear"?hr:pi).transform(Cl(d,V==null?void 0:V.duration,V==null?void 0:V.ease,()=>B(!0)),L)}):Promise.resolve(!1)}function y({noWheelClassName:L,noPanClassName:V,onPaneContextMenu:B,userSelectionActive:T,panOnScroll:F,panOnDrag:E,panOnScrollMode:$,panOnScrollSpeed:p,preventScrolling:N,zoomOnPinch:P,zoomOnScroll:M,zoomOnDoubleClick:O,zoomActivationKeyPressed:W,lib:q,onTransformChange:ce,connectionInProgress:se,paneClickDistance:H,selectionOnDrag:z}){T&&!h.isZoomingOrPanning&&b();const te=F&&!W&&!T;c.clickDistance(z?1/0:!ta(H)||H<0?0:H);const K=te?tN({zoomPanValues:h,noWheelClassName:L,d3Selection:d,d3Zoom:c,panOnScrollMode:$,panOnScrollSpeed:p,zoomOnPinch:P,onPanZoomStart:o,onPanZoom:l,onPanZoomEnd:u}):sN({noWheelClassName:L,preventScrolling:N,d3ZoomHandler:g});if(d.on("wheel.zoom",K,{passive:!1}),!T){const J=aN({zoomPanValues:h,onDraggingChange:m,onPanZoomStart:o});c.on("start",J);const oe=nN({zoomPanValues:h,panOnDrag:E,onPaneContextMenu:!!B,onPanZoom:l,onTransformChange:ce});c.on("zoom",oe);const X=rN({zoomPanValues:h,panOnDrag:E,panOnScroll:F,onPaneContextMenu:B,onPanZoomEnd:u,onDraggingChange:m});c.on("end",X)}const he=iN({zoomActivationKeyPressed:W,panOnDrag:E,zoomOnScroll:M,panOnScroll:F,zoomOnDoubleClick:O,zoomOnPinch:P,userSelectionActive:T,noPanClassName:V,noWheelClassName:L,lib:q,connectionInProgress:se});c.filter(he),O?d.on("dblclick.zoom",v):d.on("dblclick.zoom",null)}function b(){c.on("zoom",null)}async function _(L,V,B){const T=Sl(L),F=c==null?void 0:c.constrain()(T,V,B);return F&&await S(F),new Promise(E=>E(F))}async function x(L,V){const B=Sl(L);return await S(B,V),new Promise(T=>T(B))}function f(L){if(d){const V=Sl(L),B=d.property("__zoom");(B.k!==L.zoom||B.x!==L.x||B.y!==L.y)&&(c==null||c.transform(d,V,null,{sync:!0}))}}function C(){const L=d?ih(d.node()):{x:0,y:0,k:1};return{x:L.x,y:L.y,zoom:L.k}}function w(L,V){return d?new Promise(B=>{c==null||c.interpolate((V==null?void 0:V.interpolate)==="linear"?hr:pi).scaleTo(Cl(d,V==null?void 0:V.duration,V==null?void 0:V.ease,()=>B(!0)),L)}):Promise.resolve(!1)}function I(L,V){return d?new Promise(B=>{c==null||c.interpolate((V==null?void 0:V.interpolate)==="linear"?hr:pi).scaleBy(Cl(d,V==null?void 0:V.duration,V==null?void 0:V.ease,()=>B(!0)),L)}):Promise.resolve(!1)}function R(L){c==null||c.scaleExtent(L)}function k(L){c==null||c.translateExtent(L)}function D(L){const V=!ta(L)||L<0?0:L;c==null||c.clickDistance(V)}return{update:y,destroy:b,setViewport:x,setViewportConstrained:_,getViewport:C,scaleTo:w,scaleBy:I,setScaleExtent:R,setTranslateExtent:k,syncViewport:f,setClickDistance:D}}var Gn;(function(e){e.Line="line",e.Handle="handle"})(Gn||(Gn={}));function oN({width:e,prevWidth:s,height:a,prevHeight:n,affectsX:i,affectsY:l}){const o=e-s,u=a-n,m=[o>0?1:o<0?-1:0,u>0?1:u<0?-1:0];return o&&i&&(m[0]=m[0]*-1),u&&l&&(m[1]=m[1]*-1),m}function Hd(e){const s=e.includes("right")||e.includes("left"),a=e.includes("bottom")||e.includes("top"),n=e.includes("left"),i=e.includes("top");return{isHorizontal:s,isVertical:a,affectsX:n,affectsY:i}}function Va(e,s){return Math.max(0,s-e)}function Da(e,s){return Math.max(0,e-s)}function ci(e,s,a){return Math.max(0,s-e,e-a)}function Bd(e,s){return e?!s:s}function cN(e,s,a,n,i,l,o,u){let{affectsX:m,affectsY:h}=s;const{isHorizontal:r,isVertical:c}=s,d=r&&c,{xSnapped:g,ySnapped:v}=a,{minWidth:S,maxWidth:y,minHeight:b,maxHeight:_}=n,{x,y:f,width:C,height:w,aspectRatio:I}=e;let R=Math.floor(r?g-e.pointerX:0),k=Math.floor(c?v-e.pointerY:0);const D=C+(m?-R:R),L=w+(h?-k:k),V=-l[0]*C,B=-l[1]*w;let T=ci(D,S,y),F=ci(L,b,_);if(o){let p=0,N=0;m&&R<0?p=Va(x+R+V,o[0][0]):!m&&R>0&&(p=Da(x+D+V,o[1][0])),h&&k<0?N=Va(f+k+B,o[0][1]):!h&&k>0&&(N=Da(f+L+B,o[1][1])),T=Math.max(T,p),F=Math.max(F,N)}if(u){let p=0,N=0;m&&R>0?p=Da(x+R,u[0][0]):!m&&R<0&&(p=Va(x+D,u[1][0])),h&&k>0?N=Da(f+k,u[0][1]):!h&&k<0&&(N=Va(f+L,u[1][1])),T=Math.max(T,p),F=Math.max(F,N)}if(i){if(r){const p=ci(D/I,b,_)*I;if(T=Math.max(T,p),o){let N=0;!m&&!h||m&&!h&&d?N=Da(f+B+D/I,o[1][1])*I:N=Va(f+B+(m?R:-R)/I,o[0][1])*I,T=Math.max(T,N)}if(u){let N=0;!m&&!h||m&&!h&&d?N=Va(f+D/I,u[1][1])*I:N=Da(f+(m?R:-R)/I,u[0][1])*I,T=Math.max(T,N)}}if(c){const p=ci(L*I,S,y)/I;if(F=Math.max(F,p),o){let N=0;!m&&!h||h&&!m&&d?N=Da(x+L*I+V,o[1][0])/I:N=Va(x+(h?k:-k)*I+V,o[0][0])/I,F=Math.max(F,N)}if(u){let N=0;!m&&!h||h&&!m&&d?N=Va(x+L*I,u[1][0])/I:N=Da(x+(h?k:-k)*I,u[0][0])/I,F=Math.max(F,N)}}}k=k+(k<0?F:-F),R=R+(R<0?T:-T),i&&(d?D>L*I?k=(Bd(m,h)?-R:R)/I:R=(Bd(m,h)?-k:k)*I:r?(k=R/I,h=m):(R=k*I,m=h));const E=m?x+R:x,$=h?f+k:f;return{width:C+(m?-R:R),height:w+(h?-k:k),x:l[0]*R*(m?-1:1)+E,y:l[1]*k*(h?-1:1)+$}}const Lh={width:0,height:0,x:0,y:0},dN={...Lh,pointerX:0,pointerY:0,aspectRatio:1};function uN(e){return[[0,0],[e.measured.width,e.measured.height]]}function mN(e,s,a){const n=s.position.x+e.position.x,i=s.position.y+e.position.y,l=e.measured.width??0,o=e.measured.height??0,u=a[0]*l,m=a[1]*o;return[[n-u,i-m],[n+l-u,i+o-m]]}function hN({domNode:e,nodeId:s,getStoreItems:a,onChange:n,onEnd:i}){const l=Ps(e);let o={controlDirection:Hd("bottom-right"),boundaries:{minWidth:0,minHeight:0,maxWidth:Number.MAX_VALUE,maxHeight:Number.MAX_VALUE},resizeDirection:void 0,keepAspectRatio:!1};function u({controlPosition:h,boundaries:r,keepAspectRatio:c,resizeDirection:d,onResizeStart:g,onResize:v,onResizeEnd:S,shouldResize:y}){let b={...Lh},_={...dN};o={boundaries:r,resizeDirection:d,keepAspectRatio:c,controlDirection:Hd(h)};let x,f=null,C=[],w,I,R,k=!1;const D=qm().on("start",L=>{const{nodeLookup:V,transform:B,snapGrid:T,snapToGrid:F,nodeOrigin:E,paneDomNode:$}=a();if(x=V.get(s),!x)return;f=($==null?void 0:$.getBoundingClientRect())??null;const{xSnapped:p,ySnapped:N}=pr(L.sourceEvent,{transform:B,snapGrid:T,snapToGrid:F,containerBounds:f});b={width:x.measured.width??0,height:x.measured.height??0,x:x.position.x??0,y:x.position.y??0},_={...b,pointerX:p,pointerY:N,aspectRatio:b.width/b.height},w=void 0,x.parentId&&(x.extent==="parent"||x.expandParent)&&(w=V.get(x.parentId),I=w&&x.extent==="parent"?uN(w):void 0),C=[],R=void 0;for(const[P,M]of V)if(M.parentId===s&&(C.push({id:P,position:{...M.position},extent:M.extent}),M.extent==="parent"||M.expandParent)){const O=mN(M,x,M.origin??E);R?R=[[Math.min(O[0][0],R[0][0]),Math.min(O[0][1],R[0][1])],[Math.max(O[1][0],R[1][0]),Math.max(O[1][1],R[1][1])]]:R=O}g==null||g(L,{...b})}).on("drag",L=>{const{transform:V,snapGrid:B,snapToGrid:T,nodeOrigin:F}=a(),E=pr(L.sourceEvent,{transform:V,snapGrid:B,snapToGrid:T,containerBounds:f}),$=[];if(!x)return;const{x:p,y:N,width:P,height:M}=b,O={},W=x.origin??F,{width:q,height:ce,x:se,y:H}=cN(_,o.controlDirection,E,o.boundaries,o.keepAspectRatio,W,I,R),z=q!==P,te=ce!==M,K=se!==p&&z,he=H!==N&&te;if(!K&&!he&&!z&&!te)return;if((K||he||W[0]===1||W[1]===1)&&(O.x=K?se:b.x,O.y=he?H:b.y,b.x=O.x,b.y=O.y,C.length>0)){const Z=se-p,me=H-N;for(const Re of C)Re.position={x:Re.position.x-Z+W[0]*(q-P),y:Re.position.y-me+W[1]*(ce-M)},$.push(Re)}if((z||te)&&(O.width=z&&(!o.resizeDirection||o.resizeDirection==="horizontal")?q:b.width,O.height=te&&(!o.resizeDirection||o.resizeDirection==="vertical")?ce:b.height,b.width=O.width,b.height=O.height),w&&x.expandParent){const Z=W[0]*(O.width??0);O.x&&O.x<Z&&(b.x=Z,_.x=_.x-(O.x-Z));const me=W[1]*(O.height??0);O.y&&O.y<me&&(b.y=me,_.y=_.y-(O.y-me))}const J=oN({width:b.width,prevWidth:P,height:b.height,prevHeight:M,affectsX:o.controlDirection.affectsX,affectsY:o.controlDirection.affectsY}),oe={...b,direction:J};(y==null?void 0:y(L,oe))!==!1&&(k=!0,v==null||v(L,oe),n(O,$))}).on("end",L=>{k&&(S==null||S(L,{...b}),i==null||i({...b}),k=!1)});l.call(D)}function m(){l.on(".drag",null)}return{update:u,destroy:m}}const{useDebugValue:pN}=xo,{useSyncExternalStoreWithSelector:fN}=ju,xN=e=>e;function $h(e,s=xN,a){const n=fN(e.subscribe,e.getState,e.getServerState||e.getInitialState,s,a);return pN(n),n}const Wd=(e,s)=>{const a=xu(e),n=(i,l=s)=>$h(a,i,l);return Object.assign(n,a),n},gN=(e,s)=>e?Wd(e,s):Wd;function Tt(e,s){if(Object.is(e,s))return!0;if(typeof e!="object"||e===null||typeof s!="object"||s===null)return!1;if(e instanceof Map&&s instanceof Map){if(e.size!==s.size)return!1;for(const[n,i]of e)if(!Object.is(i,s.get(n)))return!1;return!0}if(e instanceof Set&&s instanceof Set){if(e.size!==s.size)return!1;for(const n of e)if(!s.has(n))return!1;return!0}const a=Object.keys(e);if(a.length!==Object.keys(s).length)return!1;for(const n of a)if(!Object.prototype.hasOwnProperty.call(s,n)||!Object.is(e[n],s[n]))return!1;return!0}const Yi=A.createContext(null),bN=Yi.Provider,Vh=ha.error001();function at(e,s){const a=A.useContext(Yi);if(a===null)throw new Error(Vh);return $h(a,e,s)}function Et(){const e=A.useContext(Yi);if(e===null)throw new Error(Vh);return A.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe}),[e])}const Ud={display:"none"},vN={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},Dh="react-flow__node-desc",Fh="react-flow__edge-desc",yN="react-flow__aria-live",jN=e=>e.ariaLiveMessage,_N=e=>e.ariaLabelConfig;function NN({rfId:e}){const s=at(jN);return t.jsx("div",{id:`${yN}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:vN,children:s})}function wN({rfId:e,disableKeyboardA11y:s}){const a=at(_N);return t.jsxs(t.Fragment,{children:[t.jsx("div",{id:`${Dh}-${e}`,style:Ud,children:s?a["node.a11yDescription.default"]:a["node.a11yDescription.keyboardDisabled"]}),t.jsx("div",{id:`${Fh}-${e}`,style:Ud,children:a["edge.a11yDescription.default"]}),!s&&t.jsx(NN,{rfId:e})]})}const Ki=A.forwardRef(({position:e="top-left",children:s,className:a,style:n,...i},l)=>{const o=`${e}`.split("-");return t.jsx("div",{className:Ft(["react-flow__panel",a,...o]),style:n,ref:l,...i,children:s})});Ki.displayName="Panel";function SN({proOptions:e,position:s="bottom-right"}){return e!=null&&e.hideAttribution?null:t.jsx(Ki,{position:s,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:t.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const CN=e=>{const s=[],a=[];for(const[,n]of e.nodeLookup)n.selected&&s.push(n.internals.userNode);for(const[,n]of e.edgeLookup)n.selected&&a.push(n);return{selectedNodes:s,selectedEdges:a}},di=e=>e.id;function kN(e,s){return Tt(e.selectedNodes.map(di),s.selectedNodes.map(di))&&Tt(e.selectedEdges.map(di),s.selectedEdges.map(di))}function MN({onSelectionChange:e}){const s=Et(),{selectedNodes:a,selectedEdges:n}=at(CN,kN);return A.useEffect(()=>{const i={nodes:a,edges:n};e==null||e(i),s.getState().onSelectionChangeHandlers.forEach(l=>l(i))},[a,n,e]),null}const RN=e=>!!e.onSelectionChangeHandlers;function TN({onSelectionChange:e}){const s=at(RN);return e||s?t.jsx(MN,{onSelectionChange:e}):null}const zh=[0,0],EN={x:0,y:0,zoom:1},AN=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","connectionDragThreshold","onBeforeDelete","debug","autoPanSpeed","ariaLabelConfig","zIndexMode"],qd=[...AN,"rfId"],PN=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges}),Gd={translateExtent:Tr,nodeOrigin:zh,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1"};function IN(e){const{setNodes:s,setEdges:a,setMinZoom:n,setMaxZoom:i,setTranslateExtent:l,setNodeExtent:o,reset:u,setDefaultNodesAndEdges:m}=at(PN,Tt),h=Et();A.useEffect(()=>(m(e.defaultNodes,e.defaultEdges),()=>{r.current=Gd,u()}),[]);const r=A.useRef(Gd);return A.useEffect(()=>{for(const c of qd){const d=e[c],g=r.current[c];d!==g&&(typeof e[c]>"u"||(c==="nodes"?s(d):c==="edges"?a(d):c==="minZoom"?n(d):c==="maxZoom"?i(d):c==="translateExtent"?l(d):c==="nodeExtent"?o(d):c==="ariaLabelConfig"?h.setState({ariaLabelConfig:S_(d)}):c==="fitView"?h.setState({fitViewQueued:d}):c==="fitViewOptions"?h.setState({fitViewOptions:d}):h.setState({[c]:d})))}r.current=e},qd.map(c=>e[c])),null}function Yd(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function ON(e){var n;const[s,a]=A.useState(e==="system"?null:e);return A.useEffect(()=>{if(e!=="system"){a(e);return}const i=Yd(),l=()=>a(i!=null&&i.matches?"dark":"light");return l(),i==null||i.addEventListener("change",l),()=>{i==null||i.removeEventListener("change",l)}},[e]),s!==null?s:(n=Yd())!=null&&n.matches?"dark":"light"}const Kd=typeof document<"u"?document:null;function Ir(e=null,s={target:Kd,actInsideInputWithModifier:!0}){const[a,n]=A.useState(!1),i=A.useRef(!1),l=A.useRef(new Set([])),[o,u]=A.useMemo(()=>{if(e!==null){const h=(Array.isArray(e)?e:[e]).filter(c=>typeof c=="string").map(c=>c.replace("+",`
`).replace(`

`,`
+`).split(`
`)),r=h.reduce((c,d)=>c.concat(...d),[]);return[h,r]}return[[],[]]},[e]);return A.useEffect(()=>{const m=(s==null?void 0:s.target)??Kd,h=(s==null?void 0:s.actInsideInputWithModifier)??!0;if(e!==null){const r=g=>{var y,b;if(i.current=g.ctrlKey||g.metaKey||g.shiftKey||g.altKey,(!i.current||i.current&&!h)&&yh(g))return!1;const S=Jd(g.code,u);if(l.current.add(g[S]),Xd(o,l.current,!1)){const _=((b=(y=g.composedPath)==null?void 0:y.call(g))==null?void 0:b[0])||g.target,x=(_==null?void 0:_.nodeName)==="BUTTON"||(_==null?void 0:_.nodeName)==="A";s.preventDefault!==!1&&(i.current||!x)&&g.preventDefault(),n(!0)}},c=g=>{const v=Jd(g.code,u);Xd(o,l.current,!0)?(n(!1),l.current.clear()):l.current.delete(g[v]),g.key==="Meta"&&l.current.clear(),i.current=!1},d=()=>{l.current.clear(),n(!1)};return m==null||m.addEventListener("keydown",r),m==null||m.addEventListener("keyup",c),window.addEventListener("blur",d),window.addEventListener("contextmenu",d),()=>{m==null||m.removeEventListener("keydown",r),m==null||m.removeEventListener("keyup",c),window.removeEventListener("blur",d),window.removeEventListener("contextmenu",d)}}},[e,n]),a}function Xd(e,s,a){return e.filter(n=>a||n.length===s.size).some(n=>n.every(i=>s.has(i)))}function Jd(e,s){return s.includes(e)?"code":"key"}const LN=()=>{const e=Et();return A.useMemo(()=>({zoomIn:s=>{const{panZoom:a}=e.getState();return a?a.scaleBy(1.2,{duration:s==null?void 0:s.duration}):Promise.resolve(!1)},zoomOut:s=>{const{panZoom:a}=e.getState();return a?a.scaleBy(1/1.2,{duration:s==null?void 0:s.duration}):Promise.resolve(!1)},zoomTo:(s,a)=>{const{panZoom:n}=e.getState();return n?n.scaleTo(s,{duration:a==null?void 0:a.duration}):Promise.resolve(!1)},getZoom:()=>e.getState().transform[2],setViewport:async(s,a)=>{const{transform:[n,i,l],panZoom:o}=e.getState();return o?(await o.setViewport({x:s.x??n,y:s.y??i,zoom:s.zoom??l},a),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[s,a,n]=e.getState().transform;return{x:s,y:a,zoom:n}},setCenter:async(s,a,n)=>e.getState().setCenter(s,a,n),fitBounds:async(s,a)=>{const{width:n,height:i,minZoom:l,maxZoom:o,panZoom:u}=e.getState(),m=Do(s,n,i,l,o,(a==null?void 0:a.padding)??.1);return u?(await u.setViewport(m,{duration:a==null?void 0:a.duration,ease:a==null?void 0:a.ease,interpolate:a==null?void 0:a.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(s,a={})=>{const{transform:n,snapGrid:i,snapToGrid:l,domNode:o}=e.getState();if(!o)return s;const{x:u,y:m}=o.getBoundingClientRect(),h={x:s.x-u,y:s.y-m},r=a.snapGrid??i,c=a.snapToGrid??l;return Br(h,n,c,r)},flowToScreenPosition:s=>{const{transform:a,domNode:n}=e.getState();if(!n)return s;const{x:i,y:l}=n.getBoundingClientRect(),o=Ii(s,a);return{x:o.x+i,y:o.y+l}}}),[])};function Hh(e,s){const a=[],n=new Map,i=[];for(const l of e)if(l.type==="add"){i.push(l);continue}else if(l.type==="remove"||l.type==="replace")n.set(l.id,[l]);else{const o=n.get(l.id);o?o.push(l):n.set(l.id,[l])}for(const l of s){const o=n.get(l.id);if(!o){a.push(l);continue}if(o[0].type==="remove")continue;if(o[0].type==="replace"){a.push({...o[0].item});continue}const u={...l};for(const m of o)$N(m,u);a.push(u)}return i.length&&i.forEach(l=>{l.index!==void 0?a.splice(l.index,0,{...l.item}):a.push({...l.item})}),a}function $N(e,s){switch(e.type){case"select":{s.selected=e.selected;break}case"position":{typeof e.position<"u"&&(s.position=e.position),typeof e.dragging<"u"&&(s.dragging=e.dragging);break}case"dimensions":{typeof e.dimensions<"u"&&(s.measured={...e.dimensions},e.setAttributes&&((e.setAttributes===!0||e.setAttributes==="width")&&(s.width=e.dimensions.width),(e.setAttributes===!0||e.setAttributes==="height")&&(s.height=e.dimensions.height))),typeof e.resizing=="boolean"&&(s.resizing=e.resizing);break}}}function Bh(e,s){return Hh(e,s)}function Wh(e,s){return Hh(e,s)}function rn(e,s){return{id:e,type:"select",selected:s}}function In(e,s=new Set,a=!1){const n=[];for(const[i,l]of e){const o=s.has(i);!(l.selected===void 0&&!o)&&l.selected!==o&&(a&&(l.selected=o),n.push(rn(l.id,o)))}return n}function Qd({items:e=[],lookup:s}){var i;const a=[],n=new Map(e.map(l=>[l.id,l]));for(const[l,o]of e.entries()){const u=s.get(o.id),m=((i=u==null?void 0:u.internals)==null?void 0:i.userNode)??u;m!==void 0&&m!==o&&a.push({id:o.id,item:o,type:"replace"}),m===void 0&&a.push({item:o,type:"add",index:l})}for(const[l]of s)n.get(l)===void 0&&a.push({id:l,type:"remove"});return a}function Zd(e){return{id:e.id,type:"remove"}}const eu=e=>f_(e),VN=e=>mh(e);function Uh(e){return A.forwardRef(e)}const DN=typeof window<"u"?A.useLayoutEffect:A.useEffect;function tu(e){const[s,a]=A.useState(BigInt(0)),[n]=A.useState(()=>FN(()=>a(i=>i+BigInt(1))));return DN(()=>{const i=n.get();i.length&&(e(i),n.reset())},[s]),n}function FN(e){let s=[];return{get:()=>s,reset:()=>{s=[]},push:a=>{s.push(a),e()}}}const qh=A.createContext(null);function zN({children:e}){const s=Et(),a=A.useCallback(u=>{const{nodes:m=[],setNodes:h,hasDefaultNodes:r,onNodesChange:c,nodeLookup:d,fitViewQueued:g,onNodesChangeMiddlewareMap:v}=s.getState();let S=m;for(const b of u)S=typeof b=="function"?b(S):b;let y=Qd({items:S,lookup:d});for(const b of v.values())y=b(y);r&&h(S),y.length>0?c==null||c(y):g&&window.requestAnimationFrame(()=>{const{fitViewQueued:b,nodes:_,setNodes:x}=s.getState();b&&x(_)})},[]),n=tu(a),i=A.useCallback(u=>{const{edges:m=[],setEdges:h,hasDefaultEdges:r,onEdgesChange:c,edgeLookup:d}=s.getState();let g=m;for(const v of u)g=typeof v=="function"?v(g):v;r?h(g):c&&c(Qd({items:g,lookup:d}))},[]),l=tu(i),o=A.useMemo(()=>({nodeQueue:n,edgeQueue:l}),[]);return t.jsx(qh.Provider,{value:o,children:e})}function HN(){const e=A.useContext(qh);if(!e)throw new Error("useBatchContext must be used within a BatchProvider");return e}const BN=e=>!!e.panZoom;function qo(){const e=LN(),s=Et(),a=HN(),n=at(BN),i=A.useMemo(()=>{const l=c=>s.getState().nodeLookup.get(c),o=c=>{a.nodeQueue.push(c)},u=c=>{a.edgeQueue.push(c)},m=c=>{var b,_;const{nodeLookup:d,nodeOrigin:g}=s.getState(),v=eu(c)?c:d.get(c.id),S=v.parentId?bh(v.position,v.measured,v.parentId,d,g):v.position,y={...v,position:S,width:((b=v.measured)==null?void 0:b.width)??v.width,height:((_=v.measured)==null?void 0:_.height)??v.height};return Un(y)},h=(c,d,g={replace:!1})=>{o(v=>v.map(S=>{if(S.id===c){const y=typeof d=="function"?d(S):d;return g.replace&&eu(y)?y:{...S,...y}}return S}))},r=(c,d,g={replace:!1})=>{u(v=>v.map(S=>{if(S.id===c){const y=typeof d=="function"?d(S):d;return g.replace&&VN(y)?y:{...S,...y}}return S}))};return{getNodes:()=>s.getState().nodes.map(c=>({...c})),getNode:c=>{var d;return(d=l(c))==null?void 0:d.internals.userNode},getInternalNode:l,getEdges:()=>{const{edges:c=[]}=s.getState();return c.map(d=>({...d}))},getEdge:c=>s.getState().edgeLookup.get(c),setNodes:o,setEdges:u,addNodes:c=>{const d=Array.isArray(c)?c:[c];a.nodeQueue.push(g=>[...g,...d])},addEdges:c=>{const d=Array.isArray(c)?c:[c];a.edgeQueue.push(g=>[...g,...d])},toObject:()=>{const{nodes:c=[],edges:d=[],transform:g}=s.getState(),[v,S,y]=g;return{nodes:c.map(b=>({...b})),edges:d.map(b=>({...b})),viewport:{x:v,y:S,zoom:y}}},deleteElements:async({nodes:c=[],edges:d=[]})=>{const{nodes:g,edges:v,onNodesDelete:S,onEdgesDelete:y,triggerNodeChanges:b,triggerEdgeChanges:_,onDelete:x,onBeforeDelete:f}=s.getState(),{nodes:C,edges:w}=await y_({nodesToRemove:c,edgesToRemove:d,nodes:g,edges:v,onBeforeDelete:f}),I=w.length>0,R=C.length>0;if(I){const k=w.map(Zd);y==null||y(w),_(k)}if(R){const k=C.map(Zd);S==null||S(C),b(k)}return(R||I)&&(x==null||x({nodes:C,edges:w})),{deletedNodes:C,deletedEdges:w}},getIntersectingNodes:(c,d=!0,g)=>{const v=Ed(c),S=v?c:m(c),y=g!==void 0;return S?(g||s.getState().nodes).filter(b=>{const _=s.getState().nodeLookup.get(b.id);if(_&&!v&&(b.id===c.id||!_.internals.positionAbsolute))return!1;const x=Un(y?b:_),f=Ar(x,S);return d&&f>0||f>=x.width*x.height||f>=S.width*S.height}):[]},isNodeIntersecting:(c,d,g=!0)=>{const S=Ed(c)?c:m(c);if(!S)return!1;const y=Ar(S,d);return g&&y>0||y>=d.width*d.height||y>=S.width*S.height},updateNode:h,updateNodeData:(c,d,g={replace:!1})=>{h(c,v=>{const S=typeof d=="function"?d(v):d;return g.replace?{...v,data:S}:{...v,data:{...v.data,...S}}},g)},updateEdge:r,updateEdgeData:(c,d,g={replace:!1})=>{r(c,v=>{const S=typeof d=="function"?d(v):d;return g.replace?{...v,data:S}:{...v,data:{...v.data,...S}}},g)},getNodesBounds:c=>{const{nodeLookup:d,nodeOrigin:g}=s.getState();return x_(c,{nodeLookup:d,nodeOrigin:g})},getHandleConnections:({type:c,id:d,nodeId:g})=>{var v;return Array.from(((v=s.getState().connectionLookup.get(`${g}-${c}${d?`-${d}`:""}`))==null?void 0:v.values())??[])},getNodeConnections:({type:c,handleId:d,nodeId:g})=>{var v;return Array.from(((v=s.getState().connectionLookup.get(`${g}${c?d?`-${c}-${d}`:`-${c}`:""}`))==null?void 0:v.values())??[])},fitView:async c=>{const d=s.getState().fitViewResolver??w_();return s.setState({fitViewQueued:!0,fitViewOptions:c,fitViewResolver:d}),a.nodeQueue.push(g=>[...g]),d.promise}}},[]);return A.useMemo(()=>({...i,...e,viewportInitialized:n}),[n])}const su=e=>e.selected,WN=typeof window<"u"?window:void 0;function UN({deleteKeyCode:e,multiSelectionKeyCode:s}){const a=Et(),{deleteElements:n}=qo(),i=Ir(e,{actInsideInputWithModifier:!1}),l=Ir(s,{target:WN});A.useEffect(()=>{if(i){const{edges:o,nodes:u}=a.getState();n({nodes:u.filter(su),edges:o.filter(su)}),a.setState({nodesSelectionActive:!1})}},[i]),A.useEffect(()=>{a.setState({multiSelectionActive:l})},[l])}function qN(e){const s=Et();A.useEffect(()=>{const a=()=>{var i,l,o,u;if(!e.current||!(((l=(i=e.current).checkVisibility)==null?void 0:l.call(i))??!0))return!1;const n=Fo(e.current);(n.height===0||n.width===0)&&((u=(o=s.getState()).onError)==null||u.call(o,"004",ha.error004())),s.setState({width:n.width||500,height:n.height||500})};if(e.current){a(),window.addEventListener("resize",a);const n=new ResizeObserver(()=>a());return n.observe(e.current),()=>{window.removeEventListener("resize",a),n&&e.current&&n.unobserve(e.current)}}},[])}const Xi={position:"absolute",width:"100%",height:"100%",top:0,left:0},GN=e=>({userSelectionActive:e.userSelectionActive,lib:e.lib,connectionInProgress:e.connection.inProgress});function YN({onPaneContextMenu:e,zoomOnScroll:s=!0,zoomOnPinch:a=!0,panOnScroll:n=!1,panOnScrollSpeed:i=.5,panOnScrollMode:l=un.Free,zoomOnDoubleClick:o=!0,panOnDrag:u=!0,defaultViewport:m,translateExtent:h,minZoom:r,maxZoom:c,zoomActivationKeyCode:d,preventScrolling:g=!0,children:v,noWheelClassName:S,noPanClassName:y,onViewportChange:b,isControlledViewport:_,paneClickDistance:x,selectionOnDrag:f}){const C=Et(),w=A.useRef(null),{userSelectionActive:I,lib:R,connectionInProgress:k}=at(GN,Tt),D=Ir(d),L=A.useRef();qN(w);const V=A.useCallback(B=>{b==null||b({x:B[0],y:B[1],zoom:B[2]}),_||C.setState({transform:B})},[b,_]);return A.useEffect(()=>{if(w.current){L.current=lN({domNode:w.current,minZoom:r,maxZoom:c,translateExtent:h,viewport:m,onDraggingChange:E=>C.setState({paneDragging:E}),onPanZoomStart:(E,$)=>{const{onViewportChangeStart:p,onMoveStart:N}=C.getState();N==null||N(E,$),p==null||p($)},onPanZoom:(E,$)=>{const{onViewportChange:p,onMove:N}=C.getState();N==null||N(E,$),p==null||p($)},onPanZoomEnd:(E,$)=>{const{onViewportChangeEnd:p,onMoveEnd:N}=C.getState();N==null||N(E,$),p==null||p($)}});const{x:B,y:T,zoom:F}=L.current.getViewport();return C.setState({panZoom:L.current,transform:[B,T,F],domNode:w.current.closest(".react-flow")}),()=>{var E;(E=L.current)==null||E.destroy()}}},[]),A.useEffect(()=>{var B;(B=L.current)==null||B.update({onPaneContextMenu:e,zoomOnScroll:s,zoomOnPinch:a,panOnScroll:n,panOnScrollSpeed:i,panOnScrollMode:l,zoomOnDoubleClick:o,panOnDrag:u,zoomActivationKeyPressed:D,preventScrolling:g,noPanClassName:y,userSelectionActive:I,noWheelClassName:S,lib:R,onTransformChange:V,connectionInProgress:k,selectionOnDrag:f,paneClickDistance:x})},[e,s,a,n,i,l,o,u,D,g,y,I,S,R,V,k,f,x]),t.jsx("div",{className:"react-flow__renderer",ref:w,style:Xi,children:v})}const KN=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function XN(){const{userSelectionActive:e,userSelectionRect:s}=at(KN,Tt);return e&&s?t.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:s.width,height:s.height,transform:`translate(${s.x}px, ${s.y}px)`}}):null}const kl=(e,s)=>a=>{a.target===s.current&&(e==null||e(a))},JN=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,connectionInProgress:e.connection.inProgress,dragging:e.paneDragging});function QN({isSelecting:e,selectionKeyPressed:s,selectionMode:a=Er.Full,panOnDrag:n,paneClickDistance:i,selectionOnDrag:l,onSelectionStart:o,onSelectionEnd:u,onPaneClick:m,onPaneContextMenu:h,onPaneScroll:r,onPaneMouseEnter:c,onPaneMouseMove:d,onPaneMouseLeave:g,children:v}){const S=Et(),{userSelectionActive:y,elementsSelectable:b,dragging:_,connectionInProgress:x}=at(JN,Tt),f=b&&(e||y),C=A.useRef(null),w=A.useRef(),I=A.useRef(new Set),R=A.useRef(new Set),k=A.useRef(!1),D=p=>{if(k.current||x){k.current=!1;return}m==null||m(p),S.getState().resetSelectedElements(),S.setState({nodesSelectionActive:!1})},L=p=>{if(Array.isArray(n)&&(n!=null&&n.includes(2))){p.preventDefault();return}h==null||h(p)},V=r?p=>r(p):void 0,B=p=>{k.current&&(p.stopPropagation(),k.current=!1)},T=p=>{var ce,se;const{domNode:N}=S.getState();if(w.current=N==null?void 0:N.getBoundingClientRect(),!w.current)return;const P=p.target===C.current;if(!P&&!!p.target.closest(".nokey")||!e||!(l&&P||s)||p.button!==0||!p.isPrimary)return;(se=(ce=p.target)==null?void 0:ce.setPointerCapture)==null||se.call(ce,p.pointerId),k.current=!1;const{x:W,y:q}=sa(p.nativeEvent,w.current);S.setState({userSelectionRect:{width:0,height:0,startX:W,startY:q,x:W,y:q}}),P||(p.stopPropagation(),p.preventDefault())},F=p=>{const{userSelectionRect:N,transform:P,nodeLookup:M,edgeLookup:O,connectionLookup:W,triggerNodeChanges:q,triggerEdgeChanges:ce,defaultEdgeOptions:se,resetSelectedElements:H}=S.getState();if(!w.current||!N)return;const{x:z,y:te}=sa(p.nativeEvent,w.current),{startX:K,startY:he}=N;if(!k.current){const me=s?0:i;if(Math.hypot(z-K,te-he)<=me)return;H(),o==null||o(p)}k.current=!0;const J={startX:K,startY:he,x:z<K?z:K,y:te<he?te:he,width:Math.abs(z-K),height:Math.abs(te-he)},oe=I.current,X=R.current;I.current=new Set(Vo(M,J,P,a===Er.Partial,!0).map(me=>me.id)),R.current=new Set;const Z=(se==null?void 0:se.selectable)??!0;for(const me of I.current){const Re=W.get(me);if(Re)for(const{edgeId:st}of Re.values()){const it=O.get(st);it&&(it.selectable??Z)&&R.current.add(st)}}if(!Ad(oe,I.current)){const me=In(M,I.current,!0);q(me)}if(!Ad(X,R.current)){const me=In(O,R.current);ce(me)}S.setState({userSelectionRect:J,userSelectionActive:!0,nodesSelectionActive:!1})},E=p=>{var N,P;p.button===0&&((P=(N=p.target)==null?void 0:N.releasePointerCapture)==null||P.call(N,p.pointerId),!y&&p.target===C.current&&S.getState().userSelectionRect&&(D==null||D(p)),S.setState({userSelectionActive:!1,userSelectionRect:null}),k.current&&(u==null||u(p),S.setState({nodesSelectionActive:I.current.size>0})))},$=n===!0||Array.isArray(n)&&n.includes(0);return t.jsxs("div",{className:Ft(["react-flow__pane",{draggable:$,dragging:_,selection:e}]),onClick:f?void 0:kl(D,C),onContextMenu:kl(L,C),onWheel:kl(V,C),onPointerEnter:f?void 0:c,onPointerMove:f?F:d,onPointerUp:f?E:void 0,onPointerDownCapture:f?T:void 0,onClickCapture:f?B:void 0,onPointerLeave:g,ref:C,style:Xi,children:[v,t.jsx(XN,{})]})}function ho({id:e,store:s,unselect:a=!1,nodeRef:n}){const{addSelectedNodes:i,unselectNodesAndEdges:l,multiSelectionActive:o,nodeLookup:u,onError:m}=s.getState(),h=u.get(e);if(!h){m==null||m("012",ha.error012(e));return}s.setState({nodesSelectionActive:!1}),h.selected?(a||h.selected&&o)&&(l({nodes:[h],edges:[]}),requestAnimationFrame(()=>{var r;return(r=n==null?void 0:n.current)==null?void 0:r.blur()})):i([e])}function Gh({nodeRef:e,disabled:s=!1,noDragClassName:a,handleSelector:n,nodeId:i,isSelectable:l,nodeClickDistance:o}){const u=Et(),[m,h]=A.useState(!1),r=A.useRef();return A.useEffect(()=>{r.current=G_({getStoreItems:()=>u.getState(),onNodeMouseDown:c=>{ho({id:c,store:u,nodeRef:e})},onDragStart:()=>{h(!0)},onDragStop:()=>{h(!1)}})},[]),A.useEffect(()=>{var c,d;if(s)(c=r.current)==null||c.destroy();else if(e.current)return(d=r.current)==null||d.update({noDragClassName:a,handleSelector:n,domNode:e.current,isSelectable:l,nodeId:i,nodeClickDistance:o}),()=>{var g;(g=r.current)==null||g.destroy()}},[a,n,s,l,e,i]),m}const ZN=e=>s=>s.selected&&(s.draggable||e&&typeof s.draggable>"u");function Yh(){const e=Et();return A.useCallback(a=>{const{nodeExtent:n,snapToGrid:i,snapGrid:l,nodesDraggable:o,onError:u,updateNodePositions:m,nodeLookup:h,nodeOrigin:r}=e.getState(),c=new Map,d=ZN(o),g=i?l[0]:5,v=i?l[1]:5,S=a.direction.x*g*a.factor,y=a.direction.y*v*a.factor;for(const[,b]of h){if(!d(b))continue;let _={x:b.internals.positionAbsolute.x+S,y:b.internals.positionAbsolute.y+y};i&&(_=Hr(_,l));const{position:x,positionAbsolute:f}=hh({nodeId:b.id,nextPosition:_,nodeLookup:h,nodeExtent:n,nodeOrigin:r,onError:u});b.position=x,b.internals.positionAbsolute=f,c.set(b.id,b)}m(c)},[])}const Go=A.createContext(null),ew=Go.Provider;Go.Consumer;const Kh=()=>A.useContext(Go),tw=e=>({connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName,rfId:e.rfId}),sw=(e,s,a)=>n=>{const{connectionClickStartHandle:i,connectionMode:l,connection:o}=n,{fromHandle:u,toHandle:m,isValid:h}=o,r=(m==null?void 0:m.nodeId)===e&&(m==null?void 0:m.id)===s&&(m==null?void 0:m.type)===a;return{connectingFrom:(u==null?void 0:u.nodeId)===e&&(u==null?void 0:u.id)===s&&(u==null?void 0:u.type)===a,connectingTo:r,clickConnecting:(i==null?void 0:i.nodeId)===e&&(i==null?void 0:i.id)===s&&(i==null?void 0:i.type)===a,isPossibleEndHandle:l===Bn.Strict?(u==null?void 0:u.type)!==a:e!==(u==null?void 0:u.nodeId)||s!==(u==null?void 0:u.id),connectionInProcess:!!u,clickConnectionInProcess:!!i,valid:r&&h}};function aw({type:e="source",position:s=Te.Top,isValidConnection:a,isConnectable:n=!0,isConnectableStart:i=!0,isConnectableEnd:l=!0,id:o,onConnect:u,children:m,className:h,onMouseDown:r,onTouchStart:c,...d},g){var F,E;const v=o||null,S=e==="target",y=Et(),b=Kh(),{connectOnClick:_,noPanClassName:x,rfId:f}=at(tw,Tt),{connectingFrom:C,connectingTo:w,clickConnecting:I,isPossibleEndHandle:R,connectionInProcess:k,clickConnectionInProcess:D,valid:L}=at(sw(b,v,e),Tt);b||(E=(F=y.getState()).onError)==null||E.call(F,"010",ha.error010());const V=$=>{const{defaultEdgeOptions:p,onConnect:N,hasDefaultEdges:P}=y.getState(),M={...p,...$};if(P){const{edges:O,setEdges:W}=y.getState();W(E_(M,O))}N==null||N(M),u==null||u(M)},B=$=>{if(!b)return;const p=jh($.nativeEvent);if(i&&(p&&$.button===0||!p)){const N=y.getState();mo.onPointerDown($.nativeEvent,{handleDomNode:$.currentTarget,autoPanOnConnect:N.autoPanOnConnect,connectionMode:N.connectionMode,connectionRadius:N.connectionRadius,domNode:N.domNode,nodeLookup:N.nodeLookup,lib:N.lib,isTarget:S,handleId:v,nodeId:b,flowId:N.rfId,panBy:N.panBy,cancelConnection:N.cancelConnection,onConnectStart:N.onConnectStart,onConnectEnd:N.onConnectEnd,updateConnection:N.updateConnection,onConnect:V,isValidConnection:a||N.isValidConnection,getTransform:()=>y.getState().transform,getFromHandle:()=>y.getState().connection.fromHandle,autoPanSpeed:N.autoPanSpeed,dragThreshold:N.connectionDragThreshold})}p?r==null||r($):c==null||c($)},T=$=>{const{onClickConnectStart:p,onClickConnectEnd:N,connectionClickStartHandle:P,connectionMode:M,isValidConnection:O,lib:W,rfId:q,nodeLookup:ce,connection:se}=y.getState();if(!b||!P&&!i)return;if(!P){p==null||p($.nativeEvent,{nodeId:b,handleId:v,handleType:e}),y.setState({connectionClickStartHandle:{nodeId:b,type:e,id:v}});return}const H=vh($.target),z=a||O,{connection:te,isValid:K}=mo.isValid($.nativeEvent,{handle:{nodeId:b,id:v,type:e},connectionMode:M,fromNodeId:P.nodeId,fromHandleId:P.id||null,fromType:P.type,isValidConnection:z,flowId:q,doc:H,lib:W,nodeLookup:ce});K&&te&&V(te);const he=structuredClone(se);delete he.inProgress,he.toPosition=he.toHandle?he.toHandle.position:null,N==null||N($,he),y.setState({connectionClickStartHandle:null})};return t.jsx("div",{"data-handleid":v,"data-nodeid":b,"data-handlepos":s,"data-id":`${f}-${b}-${v}-${e}`,className:Ft(["react-flow__handle",`react-flow__handle-${s}`,"nodrag",x,h,{source:!S,target:S,connectable:n,connectablestart:i,connectableend:l,clickconnecting:I,connectingfrom:C,connectingto:w,valid:L,connectionindicator:n&&(!k||R)&&(k||D?l:i)}]),onMouseDown:B,onTouchStart:B,onClick:_?T:void 0,ref:g,...d,children:m})}const Za=A.memo(Uh(aw));function nw({data:e,isConnectable:s,sourcePosition:a=Te.Bottom}){return t.jsxs(t.Fragment,{children:[e==null?void 0:e.label,t.jsx(Za,{type:"source",position:a,isConnectable:s})]})}function rw({data:e,isConnectable:s,targetPosition:a=Te.Top,sourcePosition:n=Te.Bottom}){return t.jsxs(t.Fragment,{children:[t.jsx(Za,{type:"target",position:a,isConnectable:s}),e==null?void 0:e.label,t.jsx(Za,{type:"source",position:n,isConnectable:s})]})}function iw(){return null}function lw({data:e,isConnectable:s,targetPosition:a=Te.Top}){return t.jsxs(t.Fragment,{children:[t.jsx(Za,{type:"target",position:a,isConnectable:s}),e==null?void 0:e.label]})}const Oi={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},au={input:nw,default:rw,output:lw,group:iw};function ow(e){var s,a,n,i;return e.internals.handleBounds===void 0?{width:e.width??e.initialWidth??((s=e.style)==null?void 0:s.width),height:e.height??e.initialHeight??((a=e.style)==null?void 0:a.height)}:{width:e.width??((n=e.style)==null?void 0:n.width),height:e.height??((i=e.style)==null?void 0:i.height)}}const cw=e=>{const{width:s,height:a,x:n,y:i}=zr(e.nodeLookup,{filter:l=>!!l.selected});return{width:ta(s)?s:null,height:ta(a)?a:null,userSelectionActive:e.userSelectionActive,transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]}) translate(${n}px,${i}px)`}};function dw({onSelectionContextMenu:e,noPanClassName:s,disableKeyboardA11y:a}){const n=Et(),{width:i,height:l,transformString:o,userSelectionActive:u}=at(cw,Tt),m=Yh(),h=A.useRef(null);if(A.useEffect(()=>{var d;a||(d=h.current)==null||d.focus({preventScroll:!0})},[a]),Gh({nodeRef:h}),u||!i||!l)return null;const r=e?d=>{const g=n.getState().nodes.filter(v=>v.selected);e(d,g)}:void 0,c=d=>{Object.prototype.hasOwnProperty.call(Oi,d.key)&&(d.preventDefault(),m({direction:Oi[d.key],factor:d.shiftKey?4:1}))};return t.jsx("div",{className:Ft(["react-flow__nodesselection","react-flow__container",s]),style:{transform:o},children:t.jsx("div",{ref:h,className:"react-flow__nodesselection-rect",onContextMenu:r,tabIndex:a?void 0:-1,onKeyDown:a?void 0:c,style:{width:i,height:l}})})}const nu=typeof window<"u"?window:void 0,uw=e=>({nodesSelectionActive:e.nodesSelectionActive,userSelectionActive:e.userSelectionActive});function Xh({children:e,onPaneClick:s,onPaneMouseEnter:a,onPaneMouseMove:n,onPaneMouseLeave:i,onPaneContextMenu:l,onPaneScroll:o,paneClickDistance:u,deleteKeyCode:m,selectionKeyCode:h,selectionOnDrag:r,selectionMode:c,onSelectionStart:d,onSelectionEnd:g,multiSelectionKeyCode:v,panActivationKeyCode:S,zoomActivationKeyCode:y,elementsSelectable:b,zoomOnScroll:_,zoomOnPinch:x,panOnScroll:f,panOnScrollSpeed:C,panOnScrollMode:w,zoomOnDoubleClick:I,panOnDrag:R,defaultViewport:k,translateExtent:D,minZoom:L,maxZoom:V,preventScrolling:B,onSelectionContextMenu:T,noWheelClassName:F,noPanClassName:E,disableKeyboardA11y:$,onViewportChange:p,isControlledViewport:N}){const{nodesSelectionActive:P,userSelectionActive:M}=at(uw,Tt),O=Ir(h,{target:nu}),W=Ir(S,{target:nu}),q=W||R,ce=W||f,se=r&&q!==!0,H=O||M||se;return UN({deleteKeyCode:m,multiSelectionKeyCode:v}),t.jsx(YN,{onPaneContextMenu:l,elementsSelectable:b,zoomOnScroll:_,zoomOnPinch:x,panOnScroll:ce,panOnScrollSpeed:C,panOnScrollMode:w,zoomOnDoubleClick:I,panOnDrag:!O&&q,defaultViewport:k,translateExtent:D,minZoom:L,maxZoom:V,zoomActivationKeyCode:y,preventScrolling:B,noWheelClassName:F,noPanClassName:E,onViewportChange:p,isControlledViewport:N,paneClickDistance:u,selectionOnDrag:se,children:t.jsxs(QN,{onSelectionStart:d,onSelectionEnd:g,onPaneClick:s,onPaneMouseEnter:a,onPaneMouseMove:n,onPaneMouseLeave:i,onPaneContextMenu:l,onPaneScroll:o,panOnDrag:q,isSelecting:!!H,selectionMode:c,selectionKeyPressed:O,paneClickDistance:u,selectionOnDrag:se,children:[e,P&&t.jsx(dw,{onSelectionContextMenu:T,noPanClassName:E,disableKeyboardA11y:$})]})})}Xh.displayName="FlowRenderer";const mw=A.memo(Xh),hw=e=>s=>e?Vo(s.nodeLookup,{x:0,y:0,width:s.width,height:s.height},s.transform,!0).map(a=>a.id):Array.from(s.nodeLookup.keys());function pw(e){return at(A.useCallback(hw(e),[e]),Tt)}const fw=e=>e.updateNodeInternals;function xw(){const e=at(fw),[s]=A.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(a=>{const n=new Map;a.forEach(i=>{const l=i.target.getAttribute("data-id");n.set(l,{id:l,nodeElement:i.target,force:!0})}),e(n)}));return A.useEffect(()=>()=>{s==null||s.disconnect()},[s]),s}function gw({node:e,nodeType:s,hasDimensions:a,resizeObserver:n}){const i=Et(),l=A.useRef(null),o=A.useRef(null),u=A.useRef(e.sourcePosition),m=A.useRef(e.targetPosition),h=A.useRef(s),r=a&&!!e.internals.handleBounds;return A.useEffect(()=>{l.current&&!e.hidden&&(!r||o.current!==l.current)&&(o.current&&(n==null||n.unobserve(o.current)),n==null||n.observe(l.current),o.current=l.current)},[r,e.hidden]),A.useEffect(()=>()=>{o.current&&(n==null||n.unobserve(o.current),o.current=null)},[]),A.useEffect(()=>{if(l.current){const c=h.current!==s,d=u.current!==e.sourcePosition,g=m.current!==e.targetPosition;(c||d||g)&&(h.current=s,u.current=e.sourcePosition,m.current=e.targetPosition,i.getState().updateNodeInternals(new Map([[e.id,{id:e.id,nodeElement:l.current,force:!0}]])))}},[e.id,s,e.sourcePosition,e.targetPosition]),l}function bw({id:e,onClick:s,onMouseEnter:a,onMouseMove:n,onMouseLeave:i,onContextMenu:l,onDoubleClick:o,nodesDraggable:u,elementsSelectable:m,nodesConnectable:h,nodesFocusable:r,resizeObserver:c,noDragClassName:d,noPanClassName:g,disableKeyboardA11y:v,rfId:S,nodeTypes:y,nodeClickDistance:b,onError:_}){const{node:x,internals:f,isParent:C}=at(z=>{const te=z.nodeLookup.get(e),K=z.parentLookup.has(e);return{node:te,internals:te.internals,isParent:K}},Tt);let w=x.type||"default",I=(y==null?void 0:y[w])||au[w];I===void 0&&(_==null||_("003",ha.error003(w)),w="default",I=(y==null?void 0:y.default)||au.default);const R=!!(x.draggable||u&&typeof x.draggable>"u"),k=!!(x.selectable||m&&typeof x.selectable>"u"),D=!!(x.connectable||h&&typeof x.connectable>"u"),L=!!(x.focusable||r&&typeof x.focusable>"u"),V=Et(),B=gh(x),T=gw({node:x,nodeType:w,hasDimensions:B,resizeObserver:c}),F=Gh({nodeRef:T,disabled:x.hidden||!R,noDragClassName:d,handleSelector:x.dragHandle,nodeId:e,isSelectable:k,nodeClickDistance:b}),E=Yh();if(x.hidden)return null;const $=ka(x),p=ow(x),N=k||R||s||a||n||i,P=a?z=>a(z,{...f.userNode}):void 0,M=n?z=>n(z,{...f.userNode}):void 0,O=i?z=>i(z,{...f.userNode}):void 0,W=l?z=>l(z,{...f.userNode}):void 0,q=o?z=>o(z,{...f.userNode}):void 0,ce=z=>{const{selectNodesOnDrag:te,nodeDragThreshold:K}=V.getState();k&&(!te||!R||K>0)&&ho({id:e,store:V,nodeRef:T}),s&&s(z,{...f.userNode})},se=z=>{if(!(yh(z.nativeEvent)||v)){if(oh.includes(z.key)&&k){const te=z.key==="Escape";ho({id:e,store:V,unselect:te,nodeRef:T})}else if(R&&x.selected&&Object.prototype.hasOwnProperty.call(Oi,z.key)){z.preventDefault();const{ariaLabelConfig:te}=V.getState();V.setState({ariaLiveMessage:te["node.a11yDescription.ariaLiveMessage"]({direction:z.key.replace("Arrow","").toLowerCase(),x:~~f.positionAbsolute.x,y:~~f.positionAbsolute.y})}),E({direction:Oi[z.key],factor:z.shiftKey?4:1})}}},H=()=>{var X;if(v||!((X=T.current)!=null&&X.matches(":focus-visible")))return;const{transform:z,width:te,height:K,autoPanOnNodeFocus:he,setCenter:J}=V.getState();if(!he)return;Vo(new Map([[e,x]]),{x:0,y:0,width:te,height:K},z,!0).length>0||J(x.position.x+$.width/2,x.position.y+$.height/2,{zoom:z[2]})};return t.jsx("div",{className:Ft(["react-flow__node",`react-flow__node-${w}`,{[g]:R},x.className,{selected:x.selected,selectable:k,parent:C,draggable:R,dragging:F}]),ref:T,style:{zIndex:f.z,transform:`translate(${f.positionAbsolute.x}px,${f.positionAbsolute.y}px)`,pointerEvents:N?"all":"none",visibility:B?"visible":"hidden",...x.style,...p},"data-id":e,"data-testid":`rf__node-${e}`,onMouseEnter:P,onMouseMove:M,onMouseLeave:O,onContextMenu:W,onClick:ce,onDoubleClick:q,onKeyDown:L?se:void 0,tabIndex:L?0:void 0,onFocus:L?H:void 0,role:x.ariaRole??(L?"group":void 0),"aria-roledescription":"node","aria-describedby":v?void 0:`${Dh}-${S}`,"aria-label":x.ariaLabel,...x.domAttributes,children:t.jsx(ew,{value:e,children:t.jsx(I,{id:e,data:x.data,type:w,positionAbsoluteX:f.positionAbsolute.x,positionAbsoluteY:f.positionAbsolute.y,selected:x.selected??!1,selectable:k,draggable:R,deletable:x.deletable??!0,isConnectable:D,sourcePosition:x.sourcePosition,targetPosition:x.targetPosition,dragging:F,dragHandle:x.dragHandle,zIndex:f.z,parentId:x.parentId,...$})})})}var vw=A.memo(bw);const yw=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,onError:e.onError});function Jh(e){const{nodesDraggable:s,nodesConnectable:a,nodesFocusable:n,elementsSelectable:i,onError:l}=at(yw,Tt),o=pw(e.onlyRenderVisibleElements),u=xw();return t.jsx("div",{className:"react-flow__nodes",style:Xi,children:o.map(m=>t.jsx(vw,{id:m,nodeTypes:e.nodeTypes,nodeExtent:e.nodeExtent,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,resizeObserver:u,nodesDraggable:s,nodesConnectable:a,nodesFocusable:n,elementsSelectable:i,nodeClickDistance:e.nodeClickDistance,onError:l},m))})}Jh.displayName="NodeRenderer";const jw=A.memo(Jh);function _w(e){return at(A.useCallback(a=>{if(!e)return a.edges.map(i=>i.id);const n=[];if(a.width&&a.height)for(const i of a.edges){const l=a.nodeLookup.get(i.source),o=a.nodeLookup.get(i.target);l&&o&&M_({sourceNode:l,targetNode:o,width:a.width,height:a.height,transform:a.transform})&&n.push(i.id)}return n},[e]),Tt)}const Nw=({color:e="none",strokeWidth:s=1})=>{const a={strokeWidth:s,...e&&{stroke:e}};return t.jsx("polyline",{className:"arrow",style:a,strokeLinecap:"round",fill:"none",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4"})},ww=({color:e="none",strokeWidth:s=1})=>{const a={strokeWidth:s,...e&&{stroke:e,fill:e}};return t.jsx("polyline",{className:"arrowclosed",style:a,strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})},ru={[qa.Arrow]:Nw,[qa.ArrowClosed]:ww};function Sw(e){const s=Et();return A.useMemo(()=>{var i,l;return Object.prototype.hasOwnProperty.call(ru,e)?ru[e]:((l=(i=s.getState()).onError)==null||l.call(i,"009",ha.error009(e)),null)},[e])}const Cw=({id:e,type:s,color:a,width:n=12.5,height:i=12.5,markerUnits:l="strokeWidth",strokeWidth:o,orient:u="auto-start-reverse"})=>{const m=Sw(s);return m?t.jsx("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${n}`,markerHeight:`${i}`,viewBox:"-10 -10 20 20",markerUnits:l,orient:u,refX:"0",refY:"0",children:t.jsx(m,{color:a,strokeWidth:o})}):null},Qh=({defaultColor:e,rfId:s})=>{const a=at(l=>l.edges),n=at(l=>l.defaultEdgeOptions),i=A.useMemo(()=>L_(a,{id:s,defaultColor:e,defaultMarkerStart:n==null?void 0:n.markerStart,defaultMarkerEnd:n==null?void 0:n.markerEnd}),[a,n,s,e]);return i.length?t.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:t.jsx("defs",{children:i.map(l=>t.jsx(Cw,{id:l.id,type:l.type,color:l.color,width:l.width,height:l.height,markerUnits:l.markerUnits,strokeWidth:l.strokeWidth,orient:l.orient},l.id))})}):null};Qh.displayName="MarkerDefinitions";var kw=A.memo(Qh);function Zh({x:e,y:s,label:a,labelStyle:n,labelShowBg:i=!0,labelBgStyle:l,labelBgPadding:o=[2,4],labelBgBorderRadius:u=2,children:m,className:h,...r}){const[c,d]=A.useState({x:1,y:0,width:0,height:0}),g=Ft(["react-flow__edge-textwrapper",h]),v=A.useRef(null);return A.useEffect(()=>{if(v.current){const S=v.current.getBBox();d({x:S.x,y:S.y,width:S.width,height:S.height})}},[a]),a?t.jsxs("g",{transform:`translate(${e-c.width/2} ${s-c.height/2})`,className:g,visibility:c.width?"visible":"hidden",...r,children:[i&&t.jsx("rect",{width:c.width+2*o[0],x:-o[0],y:-o[1],height:c.height+2*o[1],className:"react-flow__edge-textbg",style:l,rx:u,ry:u}),t.jsx("text",{className:"react-flow__edge-text",y:c.height/2,dy:"0.3em",ref:v,style:n,children:a}),m]}):null}Zh.displayName="EdgeText";const Mw=A.memo(Zh);function Ji({path:e,labelX:s,labelY:a,label:n,labelStyle:i,labelShowBg:l,labelBgStyle:o,labelBgPadding:u,labelBgBorderRadius:m,interactionWidth:h=20,...r}){return t.jsxs(t.Fragment,{children:[t.jsx("path",{...r,d:e,fill:"none",className:Ft(["react-flow__edge-path",r.className])}),h?t.jsx("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:h,className:"react-flow__edge-interaction"}):null,n&&ta(s)&&ta(a)?t.jsx(Mw,{x:s,y:a,label:n,labelStyle:i,labelShowBg:l,labelBgStyle:o,labelBgPadding:u,labelBgBorderRadius:m}):null]})}function iu({pos:e,x1:s,y1:a,x2:n,y2:i}){return e===Te.Left||e===Te.Right?[.5*(s+n),a]:[s,.5*(a+i)]}function ep({sourceX:e,sourceY:s,sourcePosition:a=Te.Bottom,targetX:n,targetY:i,targetPosition:l=Te.Top}){const[o,u]=iu({pos:a,x1:e,y1:s,x2:n,y2:i}),[m,h]=iu({pos:l,x1:n,y1:i,x2:e,y2:s}),[r,c,d,g]=_h({sourceX:e,sourceY:s,targetX:n,targetY:i,sourceControlX:o,sourceControlY:u,targetControlX:m,targetControlY:h});return[`M${e},${s} C${o},${u} ${m},${h} ${n},${i}`,r,c,d,g]}function tp(e){return A.memo(({id:s,sourceX:a,sourceY:n,targetX:i,targetY:l,sourcePosition:o,targetPosition:u,label:m,labelStyle:h,labelShowBg:r,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:g,style:v,markerEnd:S,markerStart:y,interactionWidth:b})=>{const[_,x,f]=ep({sourceX:a,sourceY:n,sourcePosition:o,targetX:i,targetY:l,targetPosition:u}),C=e.isInternal?void 0:s;return t.jsx(Ji,{id:C,path:_,labelX:x,labelY:f,label:m,labelStyle:h,labelShowBg:r,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:g,style:v,markerEnd:S,markerStart:y,interactionWidth:b})})}const Rw=tp({isInternal:!1}),sp=tp({isInternal:!0});Rw.displayName="SimpleBezierEdge";sp.displayName="SimpleBezierEdgeInternal";function ap(e){return A.memo(({id:s,sourceX:a,sourceY:n,targetX:i,targetY:l,label:o,labelStyle:u,labelShowBg:m,labelBgStyle:h,labelBgPadding:r,labelBgBorderRadius:c,style:d,sourcePosition:g=Te.Bottom,targetPosition:v=Te.Top,markerEnd:S,markerStart:y,pathOptions:b,interactionWidth:_})=>{const[x,f,C]=oo({sourceX:a,sourceY:n,sourcePosition:g,targetX:i,targetY:l,targetPosition:v,borderRadius:b==null?void 0:b.borderRadius,offset:b==null?void 0:b.offset,stepPosition:b==null?void 0:b.stepPosition}),w=e.isInternal?void 0:s;return t.jsx(Ji,{id:w,path:x,labelX:f,labelY:C,label:o,labelStyle:u,labelShowBg:m,labelBgStyle:h,labelBgPadding:r,labelBgBorderRadius:c,style:d,markerEnd:S,markerStart:y,interactionWidth:_})})}const np=ap({isInternal:!1}),rp=ap({isInternal:!0});np.displayName="SmoothStepEdge";rp.displayName="SmoothStepEdgeInternal";function ip(e){return A.memo(({id:s,...a})=>{var i;const n=e.isInternal?void 0:s;return t.jsx(np,{...a,id:n,pathOptions:A.useMemo(()=>{var l;return{borderRadius:0,offset:(l=a.pathOptions)==null?void 0:l.offset}},[(i=a.pathOptions)==null?void 0:i.offset])})})}const Tw=ip({isInternal:!1}),lp=ip({isInternal:!0});Tw.displayName="StepEdge";lp.displayName="StepEdgeInternal";function op(e){return A.memo(({id:s,sourceX:a,sourceY:n,targetX:i,targetY:l,label:o,labelStyle:u,labelShowBg:m,labelBgStyle:h,labelBgPadding:r,labelBgBorderRadius:c,style:d,markerEnd:g,markerStart:v,interactionWidth:S})=>{const[y,b,_]=Sh({sourceX:a,sourceY:n,targetX:i,targetY:l}),x=e.isInternal?void 0:s;return t.jsx(Ji,{id:x,path:y,labelX:b,labelY:_,label:o,labelStyle:u,labelShowBg:m,labelBgStyle:h,labelBgPadding:r,labelBgBorderRadius:c,style:d,markerEnd:g,markerStart:v,interactionWidth:S})})}const Ew=op({isInternal:!1}),cp=op({isInternal:!0});Ew.displayName="StraightEdge";cp.displayName="StraightEdgeInternal";function dp(e){return A.memo(({id:s,sourceX:a,sourceY:n,targetX:i,targetY:l,sourcePosition:o=Te.Bottom,targetPosition:u=Te.Top,label:m,labelStyle:h,labelShowBg:r,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:g,style:v,markerEnd:S,markerStart:y,pathOptions:b,interactionWidth:_})=>{const[x,f,C]=Nh({sourceX:a,sourceY:n,sourcePosition:o,targetX:i,targetY:l,targetPosition:u,curvature:b==null?void 0:b.curvature}),w=e.isInternal?void 0:s;return t.jsx(Ji,{id:w,path:x,labelX:f,labelY:C,label:m,labelStyle:h,labelShowBg:r,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:g,style:v,markerEnd:S,markerStart:y,interactionWidth:_})})}const Aw=dp({isInternal:!1}),up=dp({isInternal:!0});Aw.displayName="BezierEdge";up.displayName="BezierEdgeInternal";const lu={default:up,straight:cp,step:lp,smoothstep:rp,simplebezier:sp},ou={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},Pw=(e,s,a)=>a===Te.Left?e-s:a===Te.Right?e+s:e,Iw=(e,s,a)=>a===Te.Top?e-s:a===Te.Bottom?e+s:e,cu="react-flow__edgeupdater";function du({position:e,centerX:s,centerY:a,radius:n=10,onMouseDown:i,onMouseEnter:l,onMouseOut:o,type:u}){return t.jsx("circle",{onMouseDown:i,onMouseEnter:l,onMouseOut:o,className:Ft([cu,`${cu}-${u}`]),cx:Pw(s,n,e),cy:Iw(a,n,e),r:n,stroke:"transparent",fill:"transparent"})}function Ow({isReconnectable:e,reconnectRadius:s,edge:a,sourceX:n,sourceY:i,targetX:l,targetY:o,sourcePosition:u,targetPosition:m,onReconnect:h,onReconnectStart:r,onReconnectEnd:c,setReconnecting:d,setUpdateHover:g}){const v=Et(),S=(f,C)=>{if(f.button!==0)return;const{autoPanOnConnect:w,domNode:I,isValidConnection:R,connectionMode:k,connectionRadius:D,lib:L,onConnectStart:V,onConnectEnd:B,cancelConnection:T,nodeLookup:F,rfId:E,panBy:$,updateConnection:p}=v.getState(),N=C.type==="target",P=(W,q)=>{d(!1),c==null||c(W,a,C.type,q)},M=W=>h==null?void 0:h(a,W),O=(W,q)=>{d(!0),r==null||r(f,a,C.type),V==null||V(W,q)};mo.onPointerDown(f.nativeEvent,{autoPanOnConnect:w,connectionMode:k,connectionRadius:D,domNode:I,handleId:C.id,nodeId:C.nodeId,nodeLookup:F,isTarget:N,edgeUpdaterType:C.type,lib:L,flowId:E,cancelConnection:T,panBy:$,isValidConnection:R,onConnect:M,onConnectStart:O,onConnectEnd:B,onReconnectEnd:P,updateConnection:p,getTransform:()=>v.getState().transform,getFromHandle:()=>v.getState().connection.fromHandle,dragThreshold:v.getState().connectionDragThreshold,handleDomNode:f.currentTarget})},y=f=>S(f,{nodeId:a.target,id:a.targetHandle??null,type:"target"}),b=f=>S(f,{nodeId:a.source,id:a.sourceHandle??null,type:"source"}),_=()=>g(!0),x=()=>g(!1);return t.jsxs(t.Fragment,{children:[(e===!0||e==="source")&&t.jsx(du,{position:u,centerX:n,centerY:i,radius:s,onMouseDown:y,onMouseEnter:_,onMouseOut:x,type:"source"}),(e===!0||e==="target")&&t.jsx(du,{position:m,centerX:l,centerY:o,radius:s,onMouseDown:b,onMouseEnter:_,onMouseOut:x,type:"target"})]})}function Lw({id:e,edgesFocusable:s,edgesReconnectable:a,elementsSelectable:n,onClick:i,onDoubleClick:l,onContextMenu:o,onMouseEnter:u,onMouseMove:m,onMouseLeave:h,reconnectRadius:r,onReconnect:c,onReconnectStart:d,onReconnectEnd:g,rfId:v,edgeTypes:S,noPanClassName:y,onError:b,disableKeyboardA11y:_}){let x=at(J=>J.edgeLookup.get(e));const f=at(J=>J.defaultEdgeOptions);x=f?{...f,...x}:x;let C=x.type||"default",w=(S==null?void 0:S[C])||lu[C];w===void 0&&(b==null||b("011",ha.error011(C)),C="default",w=(S==null?void 0:S.default)||lu.default);const I=!!(x.focusable||s&&typeof x.focusable>"u"),R=typeof c<"u"&&(x.reconnectable||a&&typeof x.reconnectable>"u"),k=!!(x.selectable||n&&typeof x.selectable>"u"),D=A.useRef(null),[L,V]=A.useState(!1),[B,T]=A.useState(!1),F=Et(),{zIndex:E,sourceX:$,sourceY:p,targetX:N,targetY:P,sourcePosition:M,targetPosition:O}=at(A.useCallback(J=>{const oe=J.nodeLookup.get(x.source),X=J.nodeLookup.get(x.target);if(!oe||!X)return{zIndex:x.zIndex,...ou};const Z=O_({id:e,sourceNode:oe,targetNode:X,sourceHandle:x.sourceHandle||null,targetHandle:x.targetHandle||null,connectionMode:J.connectionMode,onError:b});return{zIndex:k_({selected:x.selected,zIndex:x.zIndex,sourceNode:oe,targetNode:X,elevateOnSelect:J.elevateEdgesOnSelect,zIndexMode:J.zIndexMode}),...Z||ou}},[x.source,x.target,x.sourceHandle,x.targetHandle,x.selected,x.zIndex]),Tt),W=A.useMemo(()=>x.markerStart?`url('#${co(x.markerStart,v)}')`:void 0,[x.markerStart,v]),q=A.useMemo(()=>x.markerEnd?`url('#${co(x.markerEnd,v)}')`:void 0,[x.markerEnd,v]);if(x.hidden||$===null||p===null||N===null||P===null)return null;const ce=J=>{var me;const{addSelectedEdges:oe,unselectNodesAndEdges:X,multiSelectionActive:Z}=F.getState();k&&(F.setState({nodesSelectionActive:!1}),x.selected&&Z?(X({nodes:[],edges:[x]}),(me=D.current)==null||me.blur()):oe([e])),i&&i(J,x)},se=l?J=>{l(J,{...x})}:void 0,H=o?J=>{o(J,{...x})}:void 0,z=u?J=>{u(J,{...x})}:void 0,te=m?J=>{m(J,{...x})}:void 0,K=h?J=>{h(J,{...x})}:void 0,he=J=>{var oe;if(!_&&oh.includes(J.key)&&k){const{unselectNodesAndEdges:X,addSelectedEdges:Z}=F.getState();J.key==="Escape"?((oe=D.current)==null||oe.blur(),X({edges:[x]})):Z([e])}};return t.jsx("svg",{style:{zIndex:E},children:t.jsxs("g",{className:Ft(["react-flow__edge",`react-flow__edge-${C}`,x.className,y,{selected:x.selected,animated:x.animated,inactive:!k&&!i,updating:L,selectable:k}]),onClick:ce,onDoubleClick:se,onContextMenu:H,onMouseEnter:z,onMouseMove:te,onMouseLeave:K,onKeyDown:I?he:void 0,tabIndex:I?0:void 0,role:x.ariaRole??(I?"group":"img"),"aria-roledescription":"edge","data-id":e,"data-testid":`rf__edge-${e}`,"aria-label":x.ariaLabel===null?void 0:x.ariaLabel||`Edge from ${x.source} to ${x.target}`,"aria-describedby":I?`${Fh}-${v}`:void 0,ref:D,...x.domAttributes,children:[!B&&t.jsx(w,{id:e,source:x.source,target:x.target,type:x.type,selected:x.selected,animated:x.animated,selectable:k,deletable:x.deletable??!0,label:x.label,labelStyle:x.labelStyle,labelShowBg:x.labelShowBg,labelBgStyle:x.labelBgStyle,labelBgPadding:x.labelBgPadding,labelBgBorderRadius:x.labelBgBorderRadius,sourceX:$,sourceY:p,targetX:N,targetY:P,sourcePosition:M,targetPosition:O,data:x.data,style:x.style,sourceHandleId:x.sourceHandle,targetHandleId:x.targetHandle,markerStart:W,markerEnd:q,pathOptions:"pathOptions"in x?x.pathOptions:void 0,interactionWidth:x.interactionWidth}),R&&t.jsx(Ow,{edge:x,isReconnectable:R,reconnectRadius:r,onReconnect:c,onReconnectStart:d,onReconnectEnd:g,sourceX:$,sourceY:p,targetX:N,targetY:P,sourcePosition:M,targetPosition:O,setUpdateHover:V,setReconnecting:T})]})})}var $w=A.memo(Lw);const Vw=e=>({edgesFocusable:e.edgesFocusable,edgesReconnectable:e.edgesReconnectable,elementsSelectable:e.elementsSelectable,connectionMode:e.connectionMode,onError:e.onError});function mp({defaultMarkerColor:e,onlyRenderVisibleElements:s,rfId:a,edgeTypes:n,noPanClassName:i,onReconnect:l,onEdgeContextMenu:o,onEdgeMouseEnter:u,onEdgeMouseMove:m,onEdgeMouseLeave:h,onEdgeClick:r,reconnectRadius:c,onEdgeDoubleClick:d,onReconnectStart:g,onReconnectEnd:v,disableKeyboardA11y:S}){const{edgesFocusable:y,edgesReconnectable:b,elementsSelectable:_,onError:x}=at(Vw,Tt),f=_w(s);return t.jsxs("div",{className:"react-flow__edges",children:[t.jsx(kw,{defaultColor:e,rfId:a}),f.map(C=>t.jsx($w,{id:C,edgesFocusable:y,edgesReconnectable:b,elementsSelectable:_,noPanClassName:i,onReconnect:l,onContextMenu:o,onMouseEnter:u,onMouseMove:m,onMouseLeave:h,onClick:r,reconnectRadius:c,onDoubleClick:d,onReconnectStart:g,onReconnectEnd:v,rfId:a,onError:x,edgeTypes:n,disableKeyboardA11y:S},C))]})}mp.displayName="EdgeRenderer";const Dw=A.memo(mp),Fw=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function zw({children:e}){const s=at(Fw);return t.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:s},children:e})}function Hw(e){const s=qo(),a=A.useRef(!1);A.useEffect(()=>{!a.current&&s.viewportInitialized&&e&&(setTimeout(()=>e(s),1),a.current=!0)},[e,s.viewportInitialized])}const Bw=e=>{var s;return(s=e.panZoom)==null?void 0:s.syncViewport};function Ww(e){const s=at(Bw),a=Et();return A.useEffect(()=>{e&&(s==null||s(e),a.setState({transform:[e.x,e.y,e.zoom]}))},[e,s]),null}function Uw(e){return e.connection.inProgress?{...e.connection,to:Br(e.connection.to,e.transform)}:{...e.connection}}function qw(e){return Uw}function Gw(e){const s=qw();return at(s,Tt)}const Yw=e=>({nodesConnectable:e.nodesConnectable,isValid:e.connection.isValid,inProgress:e.connection.inProgress,width:e.width,height:e.height});function Kw({containerStyle:e,style:s,type:a,component:n}){const{nodesConnectable:i,width:l,height:o,isValid:u,inProgress:m}=at(Yw,Tt);return!(l&&i&&m)?null:t.jsx("svg",{style:e,width:l,height:o,className:"react-flow__connectionline react-flow__container",children:t.jsx("g",{className:Ft(["react-flow__connection",uh(u)]),children:t.jsx(hp,{style:s,type:a,CustomComponent:n,isValid:u})})})}const hp=({style:e,type:s=va.Bezier,CustomComponent:a,isValid:n})=>{const{inProgress:i,from:l,fromNode:o,fromHandle:u,fromPosition:m,to:h,toNode:r,toHandle:c,toPosition:d,pointer:g}=Gw();if(!i)return;if(a)return t.jsx(a,{connectionLineType:s,connectionLineStyle:e,fromNode:o,fromHandle:u,fromX:l.x,fromY:l.y,toX:h.x,toY:h.y,fromPosition:m,toPosition:d,connectionStatus:uh(n),toNode:r,toHandle:c,pointer:g});let v="";const S={sourceX:l.x,sourceY:l.y,sourcePosition:m,targetX:h.x,targetY:h.y,targetPosition:d};switch(s){case va.Bezier:[v]=Nh(S);break;case va.SimpleBezier:[v]=ep(S);break;case va.Step:[v]=oo({...S,borderRadius:0});break;case va.SmoothStep:[v]=oo(S);break;default:[v]=Sh(S)}return t.jsx("path",{d:v,fill:"none",className:"react-flow__connection-path",style:e})};hp.displayName="ConnectionLine";const Xw={};function uu(e=Xw){A.useRef(e),Et(),A.useEffect(()=>{},[e])}function Jw(){Et(),A.useRef(!1),A.useEffect(()=>{},[])}function pp({nodeTypes:e,edgeTypes:s,onInit:a,onNodeClick:n,onEdgeClick:i,onNodeDoubleClick:l,onEdgeDoubleClick:o,onNodeMouseEnter:u,onNodeMouseMove:m,onNodeMouseLeave:h,onNodeContextMenu:r,onSelectionContextMenu:c,onSelectionStart:d,onSelectionEnd:g,connectionLineType:v,connectionLineStyle:S,connectionLineComponent:y,connectionLineContainerStyle:b,selectionKeyCode:_,selectionOnDrag:x,selectionMode:f,multiSelectionKeyCode:C,panActivationKeyCode:w,zoomActivationKeyCode:I,deleteKeyCode:R,onlyRenderVisibleElements:k,elementsSelectable:D,defaultViewport:L,translateExtent:V,minZoom:B,maxZoom:T,preventScrolling:F,defaultMarkerColor:E,zoomOnScroll:$,zoomOnPinch:p,panOnScroll:N,panOnScrollSpeed:P,panOnScrollMode:M,zoomOnDoubleClick:O,panOnDrag:W,onPaneClick:q,onPaneMouseEnter:ce,onPaneMouseMove:se,onPaneMouseLeave:H,onPaneScroll:z,onPaneContextMenu:te,paneClickDistance:K,nodeClickDistance:he,onEdgeContextMenu:J,onEdgeMouseEnter:oe,onEdgeMouseMove:X,onEdgeMouseLeave:Z,reconnectRadius:me,onReconnect:Re,onReconnectStart:st,onReconnectEnd:it,noDragClassName:rt,noWheelClassName:tt,noPanClassName:ze,disableKeyboardA11y:Le,nodeExtent:Ke,rfId:Ne,viewport:et,onViewportChange:lt}){return uu(e),uu(s),Jw(),Hw(a),Ww(et),t.jsx(mw,{onPaneClick:q,onPaneMouseEnter:ce,onPaneMouseMove:se,onPaneMouseLeave:H,onPaneContextMenu:te,onPaneScroll:z,paneClickDistance:K,deleteKeyCode:R,selectionKeyCode:_,selectionOnDrag:x,selectionMode:f,onSelectionStart:d,onSelectionEnd:g,multiSelectionKeyCode:C,panActivationKeyCode:w,zoomActivationKeyCode:I,elementsSelectable:D,zoomOnScroll:$,zoomOnPinch:p,zoomOnDoubleClick:O,panOnScroll:N,panOnScrollSpeed:P,panOnScrollMode:M,panOnDrag:W,defaultViewport:L,translateExtent:V,minZoom:B,maxZoom:T,onSelectionContextMenu:c,preventScrolling:F,noDragClassName:rt,noWheelClassName:tt,noPanClassName:ze,disableKeyboardA11y:Le,onViewportChange:lt,isControlledViewport:!!et,children:t.jsxs(zw,{children:[t.jsx(Dw,{edgeTypes:s,onEdgeClick:i,onEdgeDoubleClick:o,onReconnect:Re,onReconnectStart:st,onReconnectEnd:it,onlyRenderVisibleElements:k,onEdgeContextMenu:J,onEdgeMouseEnter:oe,onEdgeMouseMove:X,onEdgeMouseLeave:Z,reconnectRadius:me,defaultMarkerColor:E,noPanClassName:ze,disableKeyboardA11y:Le,rfId:Ne}),t.jsx(Kw,{style:S,type:v,component:y,containerStyle:b}),t.jsx("div",{className:"react-flow__edgelabel-renderer"}),t.jsx(jw,{nodeTypes:e,onNodeClick:n,onNodeDoubleClick:l,onNodeMouseEnter:u,onNodeMouseMove:m,onNodeMouseLeave:h,onNodeContextMenu:r,nodeClickDistance:he,onlyRenderVisibleElements:k,noPanClassName:ze,noDragClassName:rt,disableKeyboardA11y:Le,nodeExtent:Ke,rfId:Ne}),t.jsx("div",{className:"react-flow__viewport-portal"})]})})}pp.displayName="GraphView";const Qw=A.memo(pp),mu=({nodes:e,edges:s,defaultNodes:a,defaultEdges:n,width:i,height:l,fitView:o,fitViewOptions:u,minZoom:m=.5,maxZoom:h=2,nodeOrigin:r,nodeExtent:c,zIndexMode:d="basic"}={})=>{const g=new Map,v=new Map,S=new Map,y=new Map,b=n??s??[],_=a??e??[],x=r??[0,0],f=c??Tr;Mh(S,y,b);const C=uo(_,g,v,{nodeOrigin:x,nodeExtent:f,zIndexMode:d});let w=[0,0,1];if(o&&i&&l){const I=zr(g,{filter:L=>!!((L.width||L.initialWidth)&&(L.height||L.initialHeight))}),{x:R,y:k,zoom:D}=Do(I,i,l,m,h,(u==null?void 0:u.padding)??.1);w=[R,k,D]}return{rfId:"1",width:i??0,height:l??0,transform:w,nodes:_,nodesInitialized:C,nodeLookup:g,parentLookup:v,edges:b,edgeLookup:y,connectionLookup:S,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:a!==void 0,hasDefaultEdges:n!==void 0,panZoom:null,minZoom:m,maxZoom:h,translateExtent:Tr,nodeExtent:f,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:Bn.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:x,nodeDragThreshold:1,connectionDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!0,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:o??!1,fitViewOptions:u,fitViewResolver:null,connection:{...dh},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanOnNodeFocus:!0,autoPanSpeed:15,connectionRadius:20,onError:j_,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1,ariaLabelConfig:ch,zIndexMode:d,onNodesChangeMiddlewareMap:new Map,onEdgesChangeMiddlewareMap:new Map}},Zw=({nodes:e,edges:s,defaultNodes:a,defaultEdges:n,width:i,height:l,fitView:o,fitViewOptions:u,minZoom:m,maxZoom:h,nodeOrigin:r,nodeExtent:c,zIndexMode:d})=>gN((g,v)=>{async function S(){const{nodeLookup:y,panZoom:b,fitViewOptions:_,fitViewResolver:x,width:f,height:C,minZoom:w,maxZoom:I}=v();b&&(await v_({nodes:y,width:f,height:C,panZoom:b,minZoom:w,maxZoom:I},_),x==null||x.resolve(!0),g({fitViewResolver:null}))}return{...mu({nodes:e,edges:s,width:i,height:l,fitView:o,fitViewOptions:u,minZoom:m,maxZoom:h,nodeOrigin:r,nodeExtent:c,defaultNodes:a,defaultEdges:n,zIndexMode:d}),setNodes:y=>{const{nodeLookup:b,parentLookup:_,nodeOrigin:x,elevateNodesOnSelect:f,fitViewQueued:C,zIndexMode:w}=v(),I=uo(y,b,_,{nodeOrigin:x,nodeExtent:c,elevateNodesOnSelect:f,checkEquality:!0,zIndexMode:w});C&&I?(S(),g({nodes:y,nodesInitialized:I,fitViewQueued:!1,fitViewOptions:void 0})):g({nodes:y,nodesInitialized:I})},setEdges:y=>{const{connectionLookup:b,edgeLookup:_}=v();Mh(b,_,y),g({edges:y})},setDefaultNodesAndEdges:(y,b)=>{if(y){const{setNodes:_}=v();_(y),g({hasDefaultNodes:!0})}if(b){const{setEdges:_}=v();_(b),g({hasDefaultEdges:!0})}},updateNodeInternals:y=>{const{triggerNodeChanges:b,nodeLookup:_,parentLookup:x,domNode:f,nodeOrigin:C,nodeExtent:w,debug:I,fitViewQueued:R,zIndexMode:k}=v(),{changes:D,updatedInternals:L}=B_(y,_,x,f,C,w,k);L&&(D_(_,x,{nodeOrigin:C,nodeExtent:w,zIndexMode:k}),R?(S(),g({fitViewQueued:!1,fitViewOptions:void 0})):g({}),(D==null?void 0:D.length)>0&&(I&&console.log("React Flow: trigger node changes",D),b==null||b(D)))},updateNodePositions:(y,b=!1)=>{const _=[];let x=[];const{nodeLookup:f,triggerNodeChanges:C,connection:w,updateConnection:I,onNodesChangeMiddlewareMap:R}=v();for(const[k,D]of y){const L=f.get(k),V=!!(L!=null&&L.expandParent&&(L!=null&&L.parentId)&&(D!=null&&D.position)),B={id:k,type:"position",position:V?{x:Math.max(0,D.position.x),y:Math.max(0,D.position.y)}:D.position,dragging:b};if(L&&w.inProgress&&w.fromNode.id===L.id){const T=gn(L,w.fromHandle,Te.Left,!0);I({...w,from:T})}V&&L.parentId&&_.push({id:k,parentId:L.parentId,rect:{...D.internals.positionAbsolute,width:D.measured.width??0,height:D.measured.height??0}}),x.push(B)}if(_.length>0){const{parentLookup:k,nodeOrigin:D}=v(),L=Uo(_,f,k,D);x.push(...L)}for(const k of R.values())x=k(x);C(x)},triggerNodeChanges:y=>{const{onNodesChange:b,setNodes:_,nodes:x,hasDefaultNodes:f,debug:C}=v();if(y!=null&&y.length){if(f){const w=Bh(y,x);_(w)}C&&console.log("React Flow: trigger node changes",y),b==null||b(y)}},triggerEdgeChanges:y=>{const{onEdgesChange:b,setEdges:_,edges:x,hasDefaultEdges:f,debug:C}=v();if(y!=null&&y.length){if(f){const w=Wh(y,x);_(w)}C&&console.log("React Flow: trigger edge changes",y),b==null||b(y)}},addSelectedNodes:y=>{const{multiSelectionActive:b,edgeLookup:_,nodeLookup:x,triggerNodeChanges:f,triggerEdgeChanges:C}=v();if(b){const w=y.map(I=>rn(I,!0));f(w);return}f(In(x,new Set([...y]),!0)),C(In(_))},addSelectedEdges:y=>{const{multiSelectionActive:b,edgeLookup:_,nodeLookup:x,triggerNodeChanges:f,triggerEdgeChanges:C}=v();if(b){const w=y.map(I=>rn(I,!0));C(w);return}C(In(_,new Set([...y]))),f(In(x,new Set,!0))},unselectNodesAndEdges:({nodes:y,edges:b}={})=>{const{edges:_,nodes:x,nodeLookup:f,triggerNodeChanges:C,triggerEdgeChanges:w}=v(),I=y||x,R=b||_,k=I.map(L=>{const V=f.get(L.id);return V&&(V.selected=!1),rn(L.id,!1)}),D=R.map(L=>rn(L.id,!1));C(k),w(D)},setMinZoom:y=>{const{panZoom:b,maxZoom:_}=v();b==null||b.setScaleExtent([y,_]),g({minZoom:y})},setMaxZoom:y=>{const{panZoom:b,minZoom:_}=v();b==null||b.setScaleExtent([_,y]),g({maxZoom:y})},setTranslateExtent:y=>{var b;(b=v().panZoom)==null||b.setTranslateExtent(y),g({translateExtent:y})},resetSelectedElements:()=>{const{edges:y,nodes:b,triggerNodeChanges:_,triggerEdgeChanges:x,elementsSelectable:f}=v();if(!f)return;const C=b.reduce((I,R)=>R.selected?[...I,rn(R.id,!1)]:I,[]),w=y.reduce((I,R)=>R.selected?[...I,rn(R.id,!1)]:I,[]);_(C),x(w)},setNodeExtent:y=>{const{nodes:b,nodeLookup:_,parentLookup:x,nodeOrigin:f,elevateNodesOnSelect:C,nodeExtent:w,zIndexMode:I}=v();y[0][0]===w[0][0]&&y[0][1]===w[0][1]&&y[1][0]===w[1][0]&&y[1][1]===w[1][1]||(uo(b,_,x,{nodeOrigin:f,nodeExtent:y,elevateNodesOnSelect:C,checkEquality:!1,zIndexMode:I}),g({nodeExtent:y}))},panBy:y=>{const{transform:b,width:_,height:x,panZoom:f,translateExtent:C}=v();return W_({delta:y,panZoom:f,transform:b,translateExtent:C,width:_,height:x})},setCenter:async(y,b,_)=>{const{width:x,height:f,maxZoom:C,panZoom:w}=v();if(!w)return Promise.resolve(!1);const I=typeof(_==null?void 0:_.zoom)<"u"?_.zoom:C;return await w.setViewport({x:x/2-y*I,y:f/2-b*I,zoom:I},{duration:_==null?void 0:_.duration,ease:_==null?void 0:_.ease,interpolate:_==null?void 0:_.interpolate}),Promise.resolve(!0)},cancelConnection:()=>{g({connection:{...dh}})},updateConnection:y=>{g({connection:y})},reset:()=>g({...mu()})}},Object.is);function eS({initialNodes:e,initialEdges:s,defaultNodes:a,defaultEdges:n,initialWidth:i,initialHeight:l,initialMinZoom:o,initialMaxZoom:u,initialFitViewOptions:m,fitView:h,nodeOrigin:r,nodeExtent:c,zIndexMode:d,children:g}){const[v]=A.useState(()=>Zw({nodes:e,edges:s,defaultNodes:a,defaultEdges:n,width:i,height:l,fitView:h,minZoom:o,maxZoom:u,fitViewOptions:m,nodeOrigin:r,nodeExtent:c,zIndexMode:d}));return t.jsx(bN,{value:v,children:t.jsx(zN,{children:g})})}function tS({children:e,nodes:s,edges:a,defaultNodes:n,defaultEdges:i,width:l,height:o,fitView:u,fitViewOptions:m,minZoom:h,maxZoom:r,nodeOrigin:c,nodeExtent:d,zIndexMode:g}){return A.useContext(Yi)?t.jsx(t.Fragment,{children:e}):t.jsx(eS,{initialNodes:s,initialEdges:a,defaultNodes:n,defaultEdges:i,initialWidth:l,initialHeight:o,fitView:u,initialFitViewOptions:m,initialMinZoom:h,initialMaxZoom:r,nodeOrigin:c,nodeExtent:d,zIndexMode:g,children:e})}const sS={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function aS({nodes:e,edges:s,defaultNodes:a,defaultEdges:n,className:i,nodeTypes:l,edgeTypes:o,onNodeClick:u,onEdgeClick:m,onInit:h,onMove:r,onMoveStart:c,onMoveEnd:d,onConnect:g,onConnectStart:v,onConnectEnd:S,onClickConnectStart:y,onClickConnectEnd:b,onNodeMouseEnter:_,onNodeMouseMove:x,onNodeMouseLeave:f,onNodeContextMenu:C,onNodeDoubleClick:w,onNodeDragStart:I,onNodeDrag:R,onNodeDragStop:k,onNodesDelete:D,onEdgesDelete:L,onDelete:V,onSelectionChange:B,onSelectionDragStart:T,onSelectionDrag:F,onSelectionDragStop:E,onSelectionContextMenu:$,onSelectionStart:p,onSelectionEnd:N,onBeforeDelete:P,connectionMode:M,connectionLineType:O=va.Bezier,connectionLineStyle:W,connectionLineComponent:q,connectionLineContainerStyle:ce,deleteKeyCode:se="Backspace",selectionKeyCode:H="Shift",selectionOnDrag:z=!1,selectionMode:te=Er.Full,panActivationKeyCode:K="Space",multiSelectionKeyCode:he=Pr()?"Meta":"Control",zoomActivationKeyCode:J=Pr()?"Meta":"Control",snapToGrid:oe,snapGrid:X,onlyRenderVisibleElements:Z=!1,selectNodesOnDrag:me,nodesDraggable:Re,autoPanOnNodeFocus:st,nodesConnectable:it,nodesFocusable:rt,nodeOrigin:tt=zh,edgesFocusable:ze,edgesReconnectable:Le,elementsSelectable:Ke=!0,defaultViewport:Ne=EN,minZoom:et=.5,maxZoom:lt=2,translateExtent:ot=Tr,preventScrolling:ve=!0,nodeExtent:Xe,defaultMarkerColor:qe="#b1b1b7",zoomOnScroll:ct=!0,zoomOnPinch:At=!0,panOnScroll:Qt=!1,panOnScrollSpeed:zt=.5,panOnScrollMode:yt=un.Free,zoomOnDoubleClick:_t=!0,panOnDrag:Pt=!0,onPaneClick:Kt,onPaneMouseEnter:re,onPaneMouseMove:fe,onPaneMouseLeave:Me,onPaneScroll:we,onPaneContextMenu:We,paneClickDistance:He=1,nodeClickDistance:bt=0,children:Qe,onReconnect:dt,onReconnectStart:Zt,onReconnectEnd:ms,onEdgeContextMenu:j,onEdgeDoubleClick:Y,onEdgeMouseEnter:Q,onEdgeMouseMove:xe,onEdgeMouseLeave:Ee,reconnectRadius:Ge=10,onNodesChange:De,onEdgesChange:Pe,noDragClassName:Be="nodrag",noWheelClassName:Ss="nowheel",noPanClassName:Cs="nopan",fitView:ns,fitViewOptions:ks,connectOnClick:Oe,attributionPosition:xt,proOptions:wt,defaultEdgeOptions:St,elevateNodesOnSelect:Ce=!0,elevateEdgesOnSelect:Ye=!1,disableKeyboardA11y:ut=!1,autoPanOnConnect:G,autoPanOnNodeDrag:ue,autoPanSpeed:de,connectionRadius:ie,isValidConnection:ne,onError:be,style:le,id:je,nodeDragThreshold:_e,connectionDragThreshold:Fe,viewport:mt,onViewportChange:Ve,width:Ht,height:Xt,colorMode:rs="light",debug:es,onScroll:It,ariaLabelConfig:bs,zIndexMode:Hs="basic",...Ls},Bs){const $s=je||"1",na=ON(rs),ra=A.useCallback(Ws=>{Ws.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),It==null||It(Ws)},[It]);return t.jsx("div",{"data-testid":"rf__wrapper",...Ls,onScroll:ra,style:{...le,...sS},ref:Bs,className:Ft(["react-flow",i,na]),id:je,role:"application",children:t.jsxs(tS,{nodes:e,edges:s,width:Ht,height:Xt,fitView:ns,fitViewOptions:ks,minZoom:et,maxZoom:lt,nodeOrigin:tt,nodeExtent:Xe,zIndexMode:Hs,children:[t.jsx(Qw,{onInit:h,onNodeClick:u,onEdgeClick:m,onNodeMouseEnter:_,onNodeMouseMove:x,onNodeMouseLeave:f,onNodeContextMenu:C,onNodeDoubleClick:w,nodeTypes:l,edgeTypes:o,connectionLineType:O,connectionLineStyle:W,connectionLineComponent:q,connectionLineContainerStyle:ce,selectionKeyCode:H,selectionOnDrag:z,selectionMode:te,deleteKeyCode:se,multiSelectionKeyCode:he,panActivationKeyCode:K,zoomActivationKeyCode:J,onlyRenderVisibleElements:Z,defaultViewport:Ne,translateExtent:ot,minZoom:et,maxZoom:lt,preventScrolling:ve,zoomOnScroll:ct,zoomOnPinch:At,zoomOnDoubleClick:_t,panOnScroll:Qt,panOnScrollSpeed:zt,panOnScrollMode:yt,panOnDrag:Pt,onPaneClick:Kt,onPaneMouseEnter:re,onPaneMouseMove:fe,onPaneMouseLeave:Me,onPaneScroll:we,onPaneContextMenu:We,paneClickDistance:He,nodeClickDistance:bt,onSelectionContextMenu:$,onSelectionStart:p,onSelectionEnd:N,onReconnect:dt,onReconnectStart:Zt,onReconnectEnd:ms,onEdgeContextMenu:j,onEdgeDoubleClick:Y,onEdgeMouseEnter:Q,onEdgeMouseMove:xe,onEdgeMouseLeave:Ee,reconnectRadius:Ge,defaultMarkerColor:qe,noDragClassName:Be,noWheelClassName:Ss,noPanClassName:Cs,rfId:$s,disableKeyboardA11y:ut,nodeExtent:Xe,viewport:mt,onViewportChange:Ve}),t.jsx(IN,{nodes:e,edges:s,defaultNodes:a,defaultEdges:n,onConnect:g,onConnectStart:v,onConnectEnd:S,onClickConnectStart:y,onClickConnectEnd:b,nodesDraggable:Re,autoPanOnNodeFocus:st,nodesConnectable:it,nodesFocusable:rt,edgesFocusable:ze,edgesReconnectable:Le,elementsSelectable:Ke,elevateNodesOnSelect:Ce,elevateEdgesOnSelect:Ye,minZoom:et,maxZoom:lt,nodeExtent:Xe,onNodesChange:De,onEdgesChange:Pe,snapToGrid:oe,snapGrid:X,connectionMode:M,translateExtent:ot,connectOnClick:Oe,defaultEdgeOptions:St,fitView:ns,fitViewOptions:ks,onNodesDelete:D,onEdgesDelete:L,onDelete:V,onNodeDragStart:I,onNodeDrag:R,onNodeDragStop:k,onSelectionDrag:F,onSelectionDragStart:T,onSelectionDragStop:E,onMove:r,onMoveStart:c,onMoveEnd:d,noPanClassName:Cs,nodeOrigin:tt,rfId:$s,autoPanOnConnect:G,autoPanOnNodeDrag:ue,autoPanSpeed:de,onError:be,connectionRadius:ie,isValidConnection:ne,selectNodesOnDrag:me,nodeDragThreshold:_e,connectionDragThreshold:Fe,onBeforeDelete:P,debug:es,ariaLabelConfig:bs,zIndexMode:Hs}),t.jsx(TN,{onSelectionChange:B}),Qe,t.jsx(SN,{proOptions:wt,position:xt}),t.jsx(wN,{rfId:$s,disableKeyboardA11y:ut})]})})}var nS=Uh(aS);function rS(e){const[s,a]=A.useState(e),n=A.useCallback(i=>a(l=>Bh(i,l)),[]);return[s,a,n]}function iS(e){const[s,a]=A.useState(e),n=A.useCallback(i=>a(l=>Wh(i,l)),[]);return[s,a,n]}function lS({dimensions:e,lineWidth:s,variant:a,className:n}){return t.jsx("path",{strokeWidth:s,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`,className:Ft(["react-flow__background-pattern",a,n])})}function oS({radius:e,className:s}){return t.jsx("circle",{cx:e,cy:e,r:e,className:Ft(["react-flow__background-pattern","dots",s])})}var Ga;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(Ga||(Ga={}));const cS={[Ga.Dots]:1,[Ga.Lines]:1,[Ga.Cross]:6},dS=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function fp({id:e,variant:s=Ga.Dots,gap:a=20,size:n,lineWidth:i=1,offset:l=0,color:o,bgColor:u,style:m,className:h,patternClassName:r}){const c=A.useRef(null),{transform:d,patternId:g}=at(dS,Tt),v=n||cS[s],S=s===Ga.Dots,y=s===Ga.Cross,b=Array.isArray(a)?a:[a,a],_=[b[0]*d[2]||1,b[1]*d[2]||1],x=v*d[2],f=Array.isArray(l)?l:[l,l],C=y?[x,x]:_,w=[f[0]*d[2]||1+C[0]/2,f[1]*d[2]||1+C[1]/2],I=`${g}${e||""}`;return t.jsxs("svg",{className:Ft(["react-flow__background",h]),style:{...m,...Xi,"--xy-background-color-props":u,"--xy-background-pattern-color-props":o},ref:c,"data-testid":"rf__background",children:[t.jsx("pattern",{id:I,x:d[0]%_[0],y:d[1]%_[1],width:_[0],height:_[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${w[0]},-${w[1]})`,children:S?t.jsx(oS,{radius:x/2,className:r}):t.jsx(lS,{dimensions:C,lineWidth:i,variant:s,className:r})}),t.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${I})`})]})}fp.displayName="Background";const uS=A.memo(fp);function mS(){return t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:t.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function hS(){return t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:t.jsx("path",{d:"M0 0h32v4.2H0z"})})}function pS(){return t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:t.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function fS(){return t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:t.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function xS(){return t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:t.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function ui({children:e,className:s,...a}){return t.jsx("button",{type:"button",className:Ft(["react-flow__controls-button",s]),...a,children:e})}const gS=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom,ariaLabelConfig:e.ariaLabelConfig});function xp({style:e,showZoom:s=!0,showFitView:a=!0,showInteractive:n=!0,fitViewOptions:i,onZoomIn:l,onZoomOut:o,onFitView:u,onInteractiveChange:m,className:h,children:r,position:c="bottom-left",orientation:d="vertical","aria-label":g}){const v=Et(),{isInteractive:S,minZoomReached:y,maxZoomReached:b,ariaLabelConfig:_}=at(gS,Tt),{zoomIn:x,zoomOut:f,fitView:C}=qo(),w=()=>{x(),l==null||l()},I=()=>{f(),o==null||o()},R=()=>{C(i),u==null||u()},k=()=>{v.setState({nodesDraggable:!S,nodesConnectable:!S,elementsSelectable:!S}),m==null||m(!S)},D=d==="horizontal"?"horizontal":"vertical";return t.jsxs(Ki,{className:Ft(["react-flow__controls",D,h]),position:c,style:e,"data-testid":"rf__controls","aria-label":g??_["controls.ariaLabel"],children:[s&&t.jsxs(t.Fragment,{children:[t.jsx(ui,{onClick:w,className:"react-flow__controls-zoomin",title:_["controls.zoomIn.ariaLabel"],"aria-label":_["controls.zoomIn.ariaLabel"],disabled:b,children:t.jsx(mS,{})}),t.jsx(ui,{onClick:I,className:"react-flow__controls-zoomout",title:_["controls.zoomOut.ariaLabel"],"aria-label":_["controls.zoomOut.ariaLabel"],disabled:y,children:t.jsx(hS,{})})]}),a&&t.jsx(ui,{className:"react-flow__controls-fitview",onClick:R,title:_["controls.fitView.ariaLabel"],"aria-label":_["controls.fitView.ariaLabel"],children:t.jsx(pS,{})}),n&&t.jsx(ui,{className:"react-flow__controls-interactive",onClick:k,title:_["controls.interactive.ariaLabel"],"aria-label":_["controls.interactive.ariaLabel"],children:S?t.jsx(xS,{}):t.jsx(fS,{})}),r]})}xp.displayName="Controls";const bS=A.memo(xp);function vS({id:e,x:s,y:a,width:n,height:i,style:l,color:o,strokeColor:u,strokeWidth:m,className:h,borderRadius:r,shapeRendering:c,selected:d,onClick:g}){const{background:v,backgroundColor:S}=l||{},y=o||v||S;return t.jsx("rect",{className:Ft(["react-flow__minimap-node",{selected:d},h]),x:s,y:a,rx:r,ry:r,width:n,height:i,style:{fill:y,stroke:u,strokeWidth:m},shapeRendering:c,onClick:g?b=>g(b,e):void 0})}const yS=A.memo(vS),jS=e=>e.nodes.map(s=>s.id),Ml=e=>e instanceof Function?e:()=>e;function _S({nodeStrokeColor:e,nodeColor:s,nodeClassName:a="",nodeBorderRadius:n=5,nodeStrokeWidth:i,nodeComponent:l=yS,onClick:o}){const u=at(jS,Tt),m=Ml(s),h=Ml(e),r=Ml(a),c=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return t.jsx(t.Fragment,{children:u.map(d=>t.jsx(wS,{id:d,nodeColorFunc:m,nodeStrokeColorFunc:h,nodeClassNameFunc:r,nodeBorderRadius:n,nodeStrokeWidth:i,NodeComponent:l,onClick:o,shapeRendering:c},d))})}function NS({id:e,nodeColorFunc:s,nodeStrokeColorFunc:a,nodeClassNameFunc:n,nodeBorderRadius:i,nodeStrokeWidth:l,shapeRendering:o,NodeComponent:u,onClick:m}){const{node:h,x:r,y:c,width:d,height:g}=at(v=>{const{internals:S}=v.nodeLookup.get(e),y=S.userNode,{x:b,y:_}=S.positionAbsolute,{width:x,height:f}=ka(y);return{node:y,x:b,y:_,width:x,height:f}},Tt);return!h||h.hidden||!gh(h)?null:t.jsx(u,{x:r,y:c,width:d,height:g,style:h.style,selected:!!h.selected,className:n(h),color:s(h),borderRadius:i,strokeColor:a(h),strokeWidth:l,shapeRendering:o,onClick:m,id:h.id})}const wS=A.memo(NS);var SS=A.memo(_S);const CS=200,kS=150,MS=e=>!e.hidden,RS=e=>{const s={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:s,boundingRect:e.nodeLookup.size>0?xh(zr(e.nodeLookup,{filter:MS}),s):s,rfId:e.rfId,panZoom:e.panZoom,translateExtent:e.translateExtent,flowWidth:e.width,flowHeight:e.height,ariaLabelConfig:e.ariaLabelConfig}},TS="react-flow__minimap-desc";function gp({style:e,className:s,nodeStrokeColor:a,nodeColor:n,nodeClassName:i="",nodeBorderRadius:l=5,nodeStrokeWidth:o,nodeComponent:u,bgColor:m,maskColor:h,maskStrokeColor:r,maskStrokeWidth:c,position:d="bottom-right",onClick:g,onNodeClick:v,pannable:S=!1,zoomable:y=!1,ariaLabel:b,inversePan:_,zoomStep:x=1,offsetScale:f=5}){const C=Et(),w=A.useRef(null),{boundingRect:I,viewBB:R,rfId:k,panZoom:D,translateExtent:L,flowWidth:V,flowHeight:B,ariaLabelConfig:T}=at(RS,Tt),F=(e==null?void 0:e.width)??CS,E=(e==null?void 0:e.height)??kS,$=I.width/F,p=I.height/E,N=Math.max($,p),P=N*F,M=N*E,O=f*N,W=I.x-(P-I.width)/2-O,q=I.y-(M-I.height)/2-O,ce=P+O*2,se=M+O*2,H=`${TS}-${k}`,z=A.useRef(0),te=A.useRef();z.current=N,A.useEffect(()=>{if(w.current&&D)return te.current=Z_({domNode:w.current,panZoom:D,getTransform:()=>C.getState().transform,getViewScale:()=>z.current}),()=>{var oe;(oe=te.current)==null||oe.destroy()}},[D]),A.useEffect(()=>{var oe;(oe=te.current)==null||oe.update({translateExtent:L,width:V,height:B,inversePan:_,pannable:S,zoomStep:x,zoomable:y})},[S,y,_,x,L,V,B]);const K=g?oe=>{var me;const[X,Z]=((me=te.current)==null?void 0:me.pointer(oe))||[0,0];g(oe,{x:X,y:Z})}:void 0,he=v?A.useCallback((oe,X)=>{const Z=C.getState().nodeLookup.get(X).internals.userNode;v(oe,Z)},[]):void 0,J=b??T["minimap.ariaLabel"];return t.jsx(Ki,{position:d,style:{...e,"--xy-minimap-background-color-props":typeof m=="string"?m:void 0,"--xy-minimap-mask-background-color-props":typeof h=="string"?h:void 0,"--xy-minimap-mask-stroke-color-props":typeof r=="string"?r:void 0,"--xy-minimap-mask-stroke-width-props":typeof c=="number"?c*N:void 0,"--xy-minimap-node-background-color-props":typeof n=="string"?n:void 0,"--xy-minimap-node-stroke-color-props":typeof a=="string"?a:void 0,"--xy-minimap-node-stroke-width-props":typeof o=="number"?o:void 0},className:Ft(["react-flow__minimap",s]),"data-testid":"rf__minimap",children:t.jsxs("svg",{width:F,height:E,viewBox:`${W} ${q} ${ce} ${se}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":H,ref:w,onClick:K,children:[J&&t.jsx("title",{id:H,children:J}),t.jsx(SS,{onClick:he,nodeColor:n,nodeStrokeColor:a,nodeBorderRadius:l,nodeClassName:i,nodeStrokeWidth:o,nodeComponent:u}),t.jsx("path",{className:"react-flow__minimap-mask",d:`M${W-O},${q-O}h${ce+O*2}v${se+O*2}h${-ce-O*2}z
        M${R.x},${R.y}h${R.width}v${R.height}h${-R.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}gp.displayName="MiniMap";const ES=A.memo(gp),AS=e=>s=>e?`${Math.max(1/s.transform[2],1)}`:void 0,PS={[Gn.Line]:"right",[Gn.Handle]:"bottom-right"};function IS({nodeId:e,position:s,variant:a=Gn.Handle,className:n,style:i=void 0,children:l,color:o,minWidth:u=10,minHeight:m=10,maxWidth:h=Number.MAX_VALUE,maxHeight:r=Number.MAX_VALUE,keepAspectRatio:c=!1,resizeDirection:d,autoScale:g=!0,shouldResize:v,onResizeStart:S,onResize:y,onResizeEnd:b}){const _=Kh(),x=typeof e=="string"?e:_,f=Et(),C=A.useRef(null),w=a===Gn.Handle,I=at(A.useCallback(AS(w&&g),[w,g]),Tt),R=A.useRef(null),k=s??PS[a];A.useEffect(()=>{if(!(!C.current||!x))return R.current||(R.current=hN({domNode:C.current,nodeId:x,getStoreItems:()=>{const{nodeLookup:L,transform:V,snapGrid:B,snapToGrid:T,nodeOrigin:F,domNode:E}=f.getState();return{nodeLookup:L,transform:V,snapGrid:B,snapToGrid:T,nodeOrigin:F,paneDomNode:E}},onChange:(L,V)=>{const{triggerNodeChanges:B,nodeLookup:T,parentLookup:F,nodeOrigin:E}=f.getState(),$=[],p={x:L.x,y:L.y},N=T.get(x);if(N&&N.expandParent&&N.parentId){const P=N.origin??E,M=L.width??N.measured.width??0,O=L.height??N.measured.height??0,W={id:N.id,parentId:N.parentId,rect:{width:M,height:O,...bh({x:L.x??N.position.x,y:L.y??N.position.y},{width:M,height:O},N.parentId,T,P)}},q=Uo([W],T,F,E);$.push(...q),p.x=L.x?Math.max(P[0]*M,L.x):void 0,p.y=L.y?Math.max(P[1]*O,L.y):void 0}if(p.x!==void 0&&p.y!==void 0){const P={id:x,type:"position",position:{...p}};$.push(P)}if(L.width!==void 0&&L.height!==void 0){const M={id:x,type:"dimensions",resizing:!0,setAttributes:d?d==="horizontal"?"width":"height":!0,dimensions:{width:L.width,height:L.height}};$.push(M)}for(const P of V){const M={...P,type:"position"};$.push(M)}B($)},onEnd:({width:L,height:V})=>{const B={id:x,type:"dimensions",resizing:!1,dimensions:{width:L,height:V}};f.getState().triggerNodeChanges([B])}})),R.current.update({controlPosition:k,boundaries:{minWidth:u,minHeight:m,maxWidth:h,maxHeight:r},keepAspectRatio:c,resizeDirection:d,onResizeStart:S,onResize:y,onResizeEnd:b,shouldResize:v}),()=>{var L;(L=R.current)==null||L.destroy()}},[k,u,m,h,r,c,S,y,b,v]);const D=k.split("-");return t.jsx("div",{className:Ft(["react-flow__resize-control","nodrag",...D,a,n]),ref:C,style:{...i,scale:I,...o&&{[w?"backgroundColor":"borderColor"]:o}},children:l})}A.memo(IS);function OS({data:e}){return t.jsxs("div",{className:`px-4 py-3 rounded-xl border-2 shadow-lg min-w-[200px] ${e.isDefault?"border-amber-500 bg-amber-950/80":"border-blue-500 bg-slate-800/90"}`,children:[t.jsx(Za,{type:"target",position:Te.Top,className:"!bg-blue-500 !w-3 !h-3"}),t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("div",{className:`p-1.5 rounded-lg ${e.isDefault?"bg-amber-500/20":"bg-blue-500/20"}`,children:t.jsx(ts,{className:`w-4 h-4 ${e.isDefault?"text-amber-400":"text-blue-400"}`})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-semibold text-slate-100",children:e.name}),e.isDefault&&t.jsx("div",{className:"text-[10px] text-amber-400 font-medium",children:"Default Agent"})]})]}),e.description&&t.jsx("p",{className:"text-xs text-slate-400 mb-2 line-clamp-2",children:e.description}),t.jsxs("div",{className:"space-y-1.5 text-xs",children:[t.jsxs("div",{className:"flex items-center gap-2 text-slate-300",children:[t.jsx(xr,{className:"w-3 h-3 text-purple-400"}),t.jsx("span",{className:"truncate",children:e.modelName})]}),e.toolCount>0&&t.jsxs("div",{className:"flex items-center gap-2 text-slate-300",children:[t.jsx(ma,{className:"w-3 h-3 text-green-400"}),t.jsxs("span",{children:[e.toolCount," tool",e.toolCount!==1?"s":""]})]}),e.guardrailCount>0&&t.jsxs("div",{className:"flex items-center gap-2 text-slate-300",children:[t.jsx(Ja,{className:"w-3 h-3 text-red-400"}),t.jsxs("span",{children:[e.guardrailCount," guardrail",e.guardrailCount!==1?"s":""]})]}),e.handoffTargets&&e.handoffTargets.length>0&&t.jsxs("div",{className:"flex items-center gap-2 text-slate-300",children:[t.jsx(Or,{className:"w-3 h-3 text-cyan-400"}),t.jsxs("span",{children:[" ",e.handoffTargets.join(", ")]})]}),e.deterministicTargets&&e.deterministicTargets.length>0&&t.jsxs("div",{className:"flex items-center gap-2 text-amber-400",children:[t.jsx(El,{className:"w-3 h-3 text-amber-400"}),t.jsxs("span",{children:[" ",e.deterministicTargets.join(", ")]})]})]}),t.jsx(Za,{type:"source",position:Te.Bottom,className:"!bg-blue-500 !w-3 !h-3"})]})}function LS({data:e}){return t.jsxs("div",{className:"px-4 py-3 rounded-xl border-2 border-purple-500 bg-purple-950/80 shadow-lg min-w-[180px]",children:[t.jsx(Za,{type:"target",position:Te.Top,className:"!bg-purple-500 !w-3 !h-3"}),t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("div",{className:"p-1.5 rounded-lg bg-purple-500/20",children:t.jsx(Dl,{className:"w-4 h-4 text-purple-400"})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-semibold text-slate-100",children:"Supervisor"}),t.jsx("div",{className:"text-[10px] text-purple-400 font-medium",children:"Orchestrator"})]})]}),t.jsxs("div",{className:"space-y-1.5 text-xs",children:[t.jsxs("div",{className:"flex items-center gap-2 text-slate-300",children:[t.jsx(xr,{className:"w-3 h-3 text-purple-400"}),t.jsx("span",{className:"truncate",children:e.modelName})]}),e.toolCount>0&&t.jsxs("div",{className:"flex items-center gap-2 text-slate-300",children:[t.jsx(ma,{className:"w-3 h-3 text-green-400"}),t.jsxs("span",{children:[e.toolCount," tool",e.toolCount!==1?"s":""]})]})]}),t.jsx(Za,{type:"source",position:Te.Bottom,className:"!bg-purple-500 !w-3 !h-3"})]})}const $S={agent:OS,supervisor:LS};function VS({config:e}){var m,h,r,c;const{nodes:s,edges:a}=A.useMemo(()=>DS(e),[e]),[n,,i]=rS(s),[l,,o]=iS(a),u=(h=(m=e.app)==null?void 0:m.orchestration)!=null&&h.supervisor?"supervisor":(c=(r=e.app)==null?void 0:r.orchestration)!=null&&c.swarm?"swarm":"none";return t.jsxs("div",{className:"w-full h-full bg-slate-900 rounded-lg overflow-hidden",children:[t.jsx("div",{className:"px-4 py-3 border-b border-slate-700 bg-slate-800/50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Or,{className:"w-5 h-5 text-blue-400"}),t.jsx("h3",{className:"text-sm font-medium text-slate-200",children:"Agent Graph"})]}),t.jsxs("div",{className:"flex items-center gap-4",children:[u==="swarm"&&t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("div",{className:"w-6 h-0.5 bg-cyan-400 rounded"}),t.jsx("span",{className:"text-[10px] text-slate-400",children:"Agentic"})]}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("div",{className:"w-6 h-0.5 bg-amber-500 rounded",style:{borderTop:"2px dashed #f59e0b",height:0}}),t.jsx("span",{className:"text-[10px] text-slate-400",children:"Deterministic"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-xs text-slate-400",children:"Orchestration:"}),t.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${u==="supervisor"?"bg-purple-500/20 text-purple-300":u==="swarm"?"bg-blue-500/20 text-blue-300":"bg-slate-700 text-slate-400"}`,children:u==="supervisor"?"Supervisor":u==="swarm"?"Swarm":"Not Configured"})]})]})]})}),t.jsx("div",{className:"h-[calc(100%-52px)]",children:s.length===0?t.jsx("div",{className:"flex items-center justify-center h-full text-slate-500",children:t.jsxs("div",{className:"text-center",children:[t.jsx(ts,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),t.jsx("p",{className:"text-sm",children:"No agents configured"}),t.jsx("p",{className:"text-xs mt-1",children:"Add agents to visualize the graph"})]})}):t.jsxs(nS,{nodes:n,edges:l,onNodesChange:i,onEdgesChange:o,nodeTypes:$S,connectionLineType:va.SmoothStep,fitView:!0,fitViewOptions:{padding:.3},minZoom:.3,maxZoom:2,defaultEdgeOptions:{type:"smoothstep",animated:!0,style:{stroke:"#64748b",strokeWidth:2},markerEnd:{type:qa.ArrowClosed,color:"#64748b"}},children:[t.jsx(uS,{color:"#334155",gap:20,size:1}),t.jsx(bS,{className:"!bg-slate-800 !border-slate-700 !rounded-lg [&>button]:!bg-slate-700 [&>button]:!border-slate-600 [&>button]:!text-slate-300 [&>button:hover]:!bg-slate-600"}),t.jsx(ES,{nodeColor:d=>{var g;return d.type==="supervisor"?"#a855f7":(g=d.data)!=null&&g.isDefault?"#f59e0b":"#3b82f6"},maskColor:"rgba(15, 23, 42, 0.8)",className:"!bg-slate-800 !border-slate-700 !rounded-lg"})]})})]})}function DS(e){var S,y,b,_,x;const s=[],a=[],n=e.agents||{},i=((S=e.app)==null?void 0:S.agents)||[],l=i.length>0?Object.keys(n).filter(f=>{const C=n[f];return i.some(w=>{const I=typeof w=="string"?w:w==null?void 0:w.name;return C.name===I})}):Object.keys(n),o=Object.fromEntries(l.map(f=>[f,n[f]]));if(l.length===0)return{nodes:s,edges:a};const u=l.map(f=>o[f].name),m=(y=e.app)==null?void 0:y.orchestration,h=240,r=180,c=100,d=120,g=h+c,v=r+d;if(m!=null&&m.supervisor){const f=m.supervisor,C=l.length,w=Math.min(3,C),k=Math.min(w,C)*g/2;s.push({id:"supervisor",type:"supervisor",position:{x:k-90,y:40},data:{modelName:((b=f.model)==null?void 0:b.name)||"Unknown",toolCount:((_=f.tools)==null?void 0:_.length)||0}}),l.forEach((D,L)=>{var p,N,P;const V=o[D],B=Math.floor(L/w),T=L%w,E=Math.min(w,C-B*w)*g,$=k-E/2;s.push({id:D,type:"agent",position:{x:$+T*g,y:40+v+B*v},data:{name:V.name,description:V.description,modelName:((p=V.model)==null?void 0:p.name)||"Unknown",toolCount:((N=V.tools)==null?void 0:N.length)||0,guardrailCount:((P=V.guardrails)==null?void 0:P.length)||0}}),a.push({id:`supervisor-${D}`,source:"supervisor",target:D,animated:!0,style:{stroke:"#a855f7",strokeWidth:2},markerEnd:{type:qa.ArrowClosed,color:"#a855f7"}})})}else if(m!=null&&m.swarm){const f=m.swarm,C=typeof f.default_agent=="string"?f.default_agent:(x=f.default_agent)==null?void 0:x.name,w=f.handoffs||{},I=D=>{if(!Object.prototype.hasOwnProperty.call(w,D))return u.filter(B=>B!==D).map(B=>({name:B,isDeterministic:!1}));const V=w[D];return V==null?u.filter(B=>B!==D).map(B=>({name:B,isDeterministic:!1})):Array.isArray(V)&&V.length===0?[]:Array.isArray(V)?V.map(B=>{var T;if(typeof B=="string")return{name:B,isDeterministic:!1};if(B&&typeof B=="object"&&"agent"in B){const F=B;return{name:typeof F.agent=="string"?F.agent:((T=F.agent)==null?void 0:T.name)||"",isDeterministic:F.is_deterministic===!0}}return B&&typeof B=="object"&&"name"in B?{name:B.name||"",isDeterministic:!1}:{name:"",isDeterministic:!1}}).filter(B=>B.name&&B.name!==D&&u.includes(B.name)):[]},R=l.length,k=(D,L)=>{var p,N,P,M;const V=I(D.name),B=Object.prototype.hasOwnProperty.call(w,D.name),T=!B||w[D.name]===null||w[D.name]===void 0,F=B&&Array.isArray(w[D.name])&&((p=w[D.name])==null?void 0:p.length)===0,E=V.filter(O=>!O.isDeterministic).map(O=>O.name),$=V.filter(O=>O.isDeterministic).map(O=>O.name);return{name:D.name,description:D.description,modelName:((N=D.model)==null?void 0:N.name)||"Unknown",toolCount:((P=D.tools)==null?void 0:P.length)||0,guardrailCount:((M=D.guardrails)==null?void 0:M.length)||0,isDefault:L,handoffTargets:T?["(all agents)"]:F?["(none)"]:E.length>0?E:void 0,deterministicTargets:$.length>0?$:void 0}};if(R===2){const D=g*1.5,L=50;l.forEach((V,B)=>{const T=o[V],F=T.name===C;s.push({id:V,type:"agent",position:{x:L+B*D,y:100},data:k(T,F)})})}else if(R===3){const V=50+v,B=g*.7,T=o[l[0]];s.push({id:l[0],type:"agent",position:{x:300-h/2,y:50},data:k(T,T.name===C)});const F=o[l[1]];s.push({id:l[1],type:"agent",position:{x:300-h/2-B,y:V},data:k(F,F.name===C)});const E=o[l[2]];s.push({id:l[2],type:"agent",position:{x:300-h/2+B,y:V},data:k(E,E.name===C)})}else if(R<=6){const D=280+R*30,L=D+h/2+50,V=D+r/2+50,B=2*Math.PI/R,T=-Math.PI/2;l.forEach((F,E)=>{const $=o[F],p=T+E*B,N=L+D*Math.cos(p)-h/2,P=V+D*Math.sin(p)-r/2,M=$.name===C;s.push({id:F,type:"agent",position:{x:N,y:P},data:k($,M)})})}else{const V=Math.min(3,R)*g/2;l.forEach((B,T)=>{const F=o[B],E=T%3,$=Math.floor(T/3),N=Math.min(3,R-$*3)*g,P=V-N/2,M=F.name===C;s.push({id:B,type:"agent",position:{x:P+E*g,y:50+$*v},data:k(F,M)})})}l.forEach(D=>{const L=o[D];I(L.name).forEach((B,T)=>{const F=l.find(E=>o[E].name===B.name);!F||D===F||(B.isDeterministic?a.push({id:`${D}-${F}-${T}`,source:D,target:F,animated:!1,label:"deterministic",labelStyle:{fill:"#f59e0b",fontSize:10,fontWeight:600},labelBgStyle:{fill:"#1e293b",fillOpacity:.9},labelBgPadding:[4,2],labelBgBorderRadius:4,style:{stroke:"#f59e0b",strokeWidth:3,strokeDasharray:"8 4"},markerEnd:{type:qa.ArrowClosed,color:"#f59e0b"}}):a.push({id:`${D}-${F}-${T}`,source:D,target:F,animated:!0,style:{stroke:"#22d3ee",strokeWidth:2},markerEnd:{type:qa.ArrowClosed,color:"#22d3ee"}}))})})}else{const f=l.length,C=Math.min(3,f),I=Math.min(C,f)*g/2;l.forEach((R,k)=>{var E,$,p;const D=o[R],L=Math.floor(k/C),V=k%C,T=Math.min(C,f-L*C)*g,F=I-T/2;s.push({id:R,type:"agent",position:{x:F+V*g,y:50+L*v},data:{name:D.name,description:D.description,modelName:((E=D.model)==null?void 0:E.name)||"Unknown",toolCount:(($=D.tools)==null?void 0:$.length)||0,guardrailCount:((p=D.guardrails)==null?void 0:p.length)||0,isDefault:k===0}})})}return{nodes:s,edges:a}}const FS=Yn((e,s)=>({deploymentId:null,deploymentStatus:null,isDeploying:!1,isCancelling:!1,selectedOption:"quick",error:null,startDeployment:a=>{console.log("[DeploymentStore] startDeployment called:",a);const n={id:"pending",status:"starting",type:a,started_at:new Date().toISOString(),steps:[{name:"validate",status:"running"},{name:"create_agent",status:"pending"},{name:"deploy_agent",status:"pending"}],current_step:0};return e({isDeploying:!0,isCancelling:!1,selectedOption:a,deploymentStatus:n,deploymentId:null,error:null}),console.log("[DeploymentStore] startDeployment complete, waiting for deployment ID"),n},setDeploymentId:a=>{console.log("[DeploymentStore] setDeploymentId:",a),e({deploymentId:a})},setDeploymentStatus:a=>{var o;const n=s();if(console.log("[DeploymentStore] setDeploymentStatus called:",{incomingStatus:a.status,incomingId:a.id,currentIsCancelling:n.isCancelling,currentIsDeploying:n.isDeploying,currentDeploymentId:n.deploymentId,currentStatus:(o=n.deploymentStatus)==null?void 0:o.status}),!n.deploymentId){console.log("[DeploymentStore] Ignoring status update - no current deployment");return}if(a.id!==n.deploymentId){console.log("[DeploymentStore] Ignoring stale status update for old deployment:",a.id);return}const i=a.status==="completed"||a.status==="failed"||a.status==="cancelled",l=a.status==="starting"||a.status==="creating_agent"||a.status==="deploying";if(n.isCancelling&&l){console.log("[DeploymentStore] Keeping cancelling status, backend still active"),e({deploymentStatus:{...a,status:"cancelling"},isDeploying:!0});return}if(i){console.log("[DeploymentStore] Deployment ended, resetting flags"),e({deploymentStatus:a,isDeploying:!1,isCancelling:!1});return}if(l){console.log("[DeploymentStore] Active deployment, setting isDeploying: true"),e({deploymentStatus:a,isDeploying:!0});return}console.log("[DeploymentStore] Unknown status, just updating deploymentStatus"),e({deploymentStatus:a})},setError:a=>{e({error:a,isDeploying:!1})},completeDeployment:()=>{e({isDeploying:!1})},failDeployment:(a,n)=>{e(i=>({isDeploying:!1,error:a,deploymentStatus:i.deploymentStatus?{...i.deploymentStatus,status:"failed",error:a,error_trace:n,steps:i.deploymentStatus.steps.map((l,o)=>o===i.deploymentStatus.current_step?{...l,status:"failed",error:a}:l)}:null}))},setCancelling:()=>{var n;const a=s();console.log("[DeploymentStore] setCancelling called:",{deploymentId:a.deploymentId,currentStatus:(n=a.deploymentStatus)==null?void 0:n.status}),e(i=>({isCancelling:!0,deploymentStatus:i.deploymentStatus?{...i.deploymentStatus,status:"cancelling"}:null}))},cancelDeployment:()=>{var n;const a=s();console.log("[DeploymentStore] cancelDeployment called:",{deploymentId:a.deploymentId,currentStatus:(n=a.deploymentStatus)==null?void 0:n.status}),e(i=>({isDeploying:!1,isCancelling:!1,deploymentStatus:i.deploymentStatus?{...i.deploymentStatus,status:"cancelled",completed_at:new Date().toISOString(),steps:i.deploymentStatus.steps.map((l,o)=>o===i.deploymentStatus.current_step?{...l,status:"failed",error:"Cancelled by user"}:l)}:null}))},reset:()=>{var i,l,o,u;const a=s();console.log("[DeploymentStore] reset called:",{isDeploying:a.isDeploying,isCancelling:a.isCancelling,deploymentId:a.deploymentId,status:(i=a.deploymentStatus)==null?void 0:i.status});const n=((l=a.deploymentStatus)==null?void 0:l.status)==="completed"||((o=a.deploymentStatus)==null?void 0:o.status)==="failed"||((u=a.deploymentStatus)==null?void 0:u.status)==="cancelled";if(a.isDeploying&&!n){console.log("[DeploymentStore] reset blocked - still actively deploying");return}console.log("[DeploymentStore] reset proceeding"),e({deploymentId:null,deploymentStatus:null,isDeploying:!1,isCancelling:!1,error:null})},canStartNewDeployment:()=>{const a=s();return a.isDeploying||a.isCancelling?!1:a.deploymentStatus?a.deploymentStatus.status==="completed"||a.deploymentStatus.status==="failed"||a.deploymentStatus.status==="cancelled":!0}})),po=Yn()(Tm((e,s)=>({credentialType:"manual_pat",manualClientId:"",manualClientSecret:"",manualPat:"",setCredentialType:a=>e({credentialType:a}),setManualClientId:a=>e({manualClientId:a}),setManualClientSecret:a=>e({manualClientSecret:a}),setManualPat:a=>e({manualPat:a}),getCredentials:()=>{const a=s(),n={type:a.credentialType};return a.credentialType==="manual_sp"?(n.client_id=a.manualClientId,n.client_secret=a.manualClientSecret):a.credentialType==="manual_pat"&&(n.pat=a.manualPat),n},hasCredentials:()=>{const a=s();return a.credentialType==="obo"||a.credentialType==="app"?!0:a.credentialType==="manual_sp"?!!(a.manualClientId&&a.manualClientSecret):a.credentialType==="manual_pat"?!!a.manualPat:!1}}),{name:"credential-storage"}));function Li(e){if(!e||typeof e!="object")return e;if(Array.isArray(e))return e.map(Li);const s={};for(const[a,n]of Object.entries(e))a!=="refName"&&(s[a]=Li(n));return s}const zS={validate:t.jsx(ca,{className:"w-4 h-4"}),create_agent:t.jsx(ts,{className:"w-4 h-4"}),deploy_agent:t.jsx(gr,{className:"w-4 h-4"})};function HS({onClose:e}){var ce;const{config:s}=nt(),n=(((ce=s.app)==null?void 0:ce.deployment_target)||"model_serving")==="model_serving",i={validate:"Validate Configuration",create_agent:"Create Agent Model",deploy_agent:n?"Deploy to Model Serving":"Deploy to Databricks Apps"},{deploymentId:l,deploymentStatus:o,isDeploying:u,isCancelling:m,startDeployment:h,setDeploymentId:r,setDeploymentStatus:c,failDeployment:d,setCancelling:g,reset:v,canStartNewDeployment:S}=FS(),[y,b]=A.useState(null),[_,x]=A.useState(!1),[f,C]=A.useState(null),[w,I]=A.useState(!1),R=A.useRef(null),k=A.useRef(!0);A.useEffect(()=>(k.current=!0,()=>{k.current=!1}),[]),A.useEffect(()=>{console.log("[DeploymentPanel] Component mounted with state:",{isDeploying:u,isCancelling:m,deploymentId:l,deploymentStatus:o==null?void 0:o.status}),m&&l&&(R.current=l)},[]);const{credentialType:D,manualClientId:L,manualClientSecret:V,manualPat:B,setCredentialType:T,setManualClientId:F,setManualClientSecret:E,setManualPat:$}=po(),[p,N]=A.useState({hasAppCredentials:!1,hasOboToken:!1});A.useEffect(()=>{(async()=>{try{const H=await fetch("/api/auth/context");if(H.ok){const z=await H.json();N({hasAppCredentials:z.has_service_principal||!1,hasOboToken:z.has_obo_token||!1}),T("manual_pat")}}catch(H){console.error("Failed to check credentials:",H)}})()},[]);const P=A.useCallback(async()=>{x(!0),C(null);try{const se=mn(s),H=Na.load(se),z=Li(H),te=await fetch("/api/deploy/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({config:z})}),K=te.headers.get("content-type"),he=K&&K.includes("application/json");if(!te.ok)if(he){const oe=await te.json();throw new Error(oe.error||"Validation failed")}else throw console.error("Server returned non-JSON response:",te.status,te.statusText),new Error(`Server error: ${te.status} ${te.statusText}. The server may be experiencing issues.`);if(!he)throw new Error("Server returned unexpected response format");const J=await te.json();b(J)}catch(se){console.error("Validation error:",se),C(se instanceof Error?se.message:"Failed to validate configuration")}finally{x(!1)}},[s]);A.useEffect(()=>{P()},[P]),A.useEffect(()=>{if(!l){console.log("[DeploymentPanel] Polling not started - no deploymentId");return}console.log("[DeploymentPanel] Starting polling for deployment:",l);const se=async()=>{console.log("[DeploymentPanel] Polling status for:",l);try{const z=await fetch(`/api/deploy/status/${l}`);if(!z.ok){console.log("[DeploymentPanel] Poll failed - not OK:",z.status);return}const te=await z.json();console.log("[DeploymentPanel] Got status from backend:",te.status,"id:",te.id),c(te)}catch(z){console.error("Failed to poll deployment status:",z)}};se();const H=setInterval(se,2e3);return()=>{console.log("[DeploymentPanel] Cleaning up polling for:",l),clearInterval(H)}},[l,c]);const M=async()=>{var se;if(console.log("[DeploymentPanel] handleCancel called:",{deploymentId:l,isCancelling:m}),!l||m){console.log("[DeploymentPanel] handleCancel early return - no deploymentId or already cancelling");return}R.current=l,console.log("[DeploymentPanel] Setting cancelling state..."),g();try{console.log("[DeploymentPanel] Sending cancel request to backend...");const H=await fetch(`/api/deploy/cancel/${l}`,{method:"POST"});console.log("[DeploymentPanel] Cancel request response:",H.status);const z=await H.json().catch(()=>({}));if(H.ok)if(console.log("[DeploymentPanel] Cancel succeeded, status:",(se=z.status)==null?void 0:se.status),z.status)c(z.status);else{const te=await fetch(`/api/deploy/status/${l}`);if(te.ok){const K=await te.json();console.log("[DeploymentPanel] Got updated status after cancel:",K.status),c(K)}}else{console.error("[DeploymentPanel] Cancel failed:",H.status,z);const te=await fetch(`/api/deploy/status/${l}`);if(te.ok){const K=await te.json();console.log("[DeploymentPanel] Got status after cancel failure:",K.status),c(K)}}}catch(H){console.error("Failed to send cancel request:",H);try{const z=await fetch(`/api/deploy/status/${l}`);if(z.ok){const te=await z.json();c(te)}}catch{}}},O=async()=>{var H;if(console.log("[DeploymentPanel] handleDeploy called"),!(y!=null&&y.valid)){console.log("[DeploymentPanel] handleDeploy - validation not valid");return}if(!S()){console.log("[DeploymentPanel] handleDeploy - cannot start new deployment"),C("A deployment is already in progress. Please wait for it to complete.");return}if(D==="manual_sp"&&(!L||!V)){C("Please enter both Client ID and Client Secret");return}if(D==="manual_pat"&&!B){C("Please enter a Personal Access Token");return}C(null),h("quick");const se={type:D};D==="manual_sp"?(se.client_id=L,se.client_secret=V):D==="manual_pat"&&(se.pat=B);try{const z="/api/deploy/quick",te=mn(s),K=Na.load(te),he=Li(K),J=await fetch(z,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({config:he,credentials:se,target:((H=s.app)==null?void 0:H.deployment_target)||"model_serving",skip_model_creation:w})}),oe=J.headers.get("content-type"),X=oe&&oe.includes("application/json");if(!J.ok)if(X){const me=await J.json();throw new Error(me.error||"Deployment failed to start")}else throw console.error("Server returned non-JSON response:",J.status,J.statusText),new Error(`Server error: ${J.status} ${J.statusText}. Check server logs for details.`);if(!X)throw new Error("Server returned unexpected response format");const Z=await J.json();r(Z.deployment_id)}catch(z){const te=z instanceof Error?z.message:"Failed to start deployment";C(te),d(te)}},W=se=>{switch(se){case"completed":return t.jsx(Xs,{className:"w-5 h-5 text-green-400"});case"failed":return t.jsx(As,{className:"w-5 h-5 text-red-400"});case"running":return t.jsx(Nt,{className:"w-5 h-5 text-blue-400 animate-spin"});case"skipped":return t.jsx("span",{className:"text-xs text-slate-400 uppercase tracking-wide",children:"Skipped"});default:return t.jsx(Rn,{className:"w-5 h-5 text-slate-500"})}},q=()=>{if(!o)return null;switch(o.status){case"completed":return t.jsx(Se,{variant:"success",children:"Completed"});case"failed":return t.jsx(Se,{variant:"danger",children:"Failed"});case"cancelled":return t.jsx(Se,{variant:"warning",children:"Cancelled"});case"cancelling":return t.jsx(Se,{variant:"warning",children:"Cancelling..."});case"creating_agent":return t.jsx(Se,{variant:"info",children:"Creating Agent..."});case"deploying":return t.jsx(Se,{variant:"info",children:"Deploying..."});default:return t.jsx(Se,{variant:"warning",children:"Starting..."})}};return t.jsx("div",{className:"space-y-6",children:_?t.jsxs("div",{className:"flex items-center justify-center py-8",children:[t.jsx(Ut,{className:"w-6 h-6 text-blue-400 animate-spin mr-2"}),t.jsx("span",{className:"text-slate-300",children:"Validating configuration..."})]}):y?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:`p-4 rounded-lg border ${y.valid?"bg-green-950/30 border-green-800":"bg-red-950/30 border-red-800"}`,children:[t.jsxs("div",{className:"flex items-center gap-3",children:[y.valid?t.jsx(Xs,{className:"w-6 h-6 text-green-400"}):t.jsx(As,{className:"w-6 h-6 text-red-400"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-slate-100",children:y.valid?"Configuration Valid":"Configuration Invalid"}),t.jsxs("p",{className:"text-xs text-slate-400 mt-0.5",children:[y.app_name&&`App: ${y.app_name}`,y.agent_count!==void 0&&`  ${y.agent_count} agent(s)`,`  Target: ${n?"Model Serving":"Databricks Apps"}`]})]})]}),y.errors.length>0&&t.jsx("div",{className:"mt-3 space-y-1",children:y.errors.map((se,H)=>t.jsxs("div",{className:"flex items-start gap-2 text-xs text-red-400",children:[t.jsx(As,{className:"w-3 h-3 mt-0.5 flex-shrink-0"}),t.jsx("span",{children:se})]},H))}),y.warnings.length>0&&t.jsx("div",{className:"mt-3 space-y-1",children:y.warnings.map((se,H)=>t.jsxs("div",{className:"flex items-start gap-2 text-xs text-amber-400",children:[t.jsx(fr,{className:"w-3 h-3 mt-0.5 flex-shrink-0"}),t.jsx("span",{children:se})]},H))})]}),y.requirements.length>0&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("h4",{className:"text-xs font-medium text-slate-400 uppercase tracking-wide",children:"Resource Requirements"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:y.requirements.map((se,H)=>t.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-slate-800/50 rounded-lg border border-slate-700",children:[se.type==="vector_search"&&t.jsx(Ba,{className:"w-3 h-3 text-purple-400"}),se.type==="database"&&t.jsx($t,{className:"w-3 h-3 text-blue-400"}),se.type==="genie"&&t.jsx(ts,{className:"w-3 h-3 text-cyan-400"}),se.type==="functions"&&t.jsx(ca,{className:"w-3 h-3 text-green-400"}),t.jsx("span",{className:"text-xs text-slate-300",children:se.description}),t.jsx(Se,{variant:"default",className:"text-[10px]",children:se.count})]},H))})]}),y.valid&&!o&&t.jsxs("div",{className:"space-y-3",children:[t.jsx("h4",{className:"text-xs font-medium text-slate-400 uppercase tracking-wide",children:"Deployment Credentials"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsxs("button",{onClick:()=>T("manual_pat"),className:`p-3 rounded-lg border text-left transition-all ${D==="manual_pat"?"bg-cyan-950/40 border-cyan-500 ring-1 ring-cyan-500/50":"bg-slate-800/30 border-slate-700 hover:border-slate-600"}`,children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Mt,{className:"w-4 h-4 text-cyan-400"}),t.jsx("span",{className:`text-sm font-medium ${D==="manual_pat"?"text-slate-100":"text-slate-300"}`,children:"Manual PAT"}),D==="manual_pat"&&t.jsx(Xs,{className:"w-3 h-3 text-cyan-400 ml-auto"})]}),t.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Enter personal access token"})]}),t.jsxs("button",{onClick:()=>T("manual_sp"),className:`p-3 rounded-lg border text-left transition-all ${D==="manual_sp"?"bg-amber-950/40 border-amber-500 ring-1 ring-amber-500/50":"bg-slate-800/30 border-slate-700 hover:border-slate-600"}`,children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Ja,{className:"w-4 h-4 text-amber-400"}),t.jsx("span",{className:`text-sm font-medium ${D==="manual_sp"?"text-slate-100":"text-slate-300"}`,children:"Manual SP"}),D==="manual_sp"&&t.jsx(Xs,{className:"w-3 h-3 text-amber-400 ml-auto"})]}),t.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Enter client ID & secret"})]}),t.jsxs("button",{onClick:()=>T("obo"),disabled:!p.hasOboToken,className:`p-3 rounded-lg border text-left transition-all ${D==="obo"?"bg-purple-950/40 border-purple-500 ring-1 ring-purple-500/50":p.hasOboToken?"bg-slate-800/30 border-slate-700 hover:border-slate-600":"bg-slate-800/20 border-slate-800 opacity-50 cursor-not-allowed"}`,children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Os,{className:"w-4 h-4 text-purple-400"}),t.jsx("span",{className:`text-sm font-medium ${D==="obo"?"text-slate-100":"text-slate-300"}`,children:"User Token (OBO)"}),D==="obo"&&t.jsx(Xs,{className:"w-3 h-3 text-purple-400 ml-auto"})]}),t.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Use your logged-in credentials"})]}),t.jsxs("button",{onClick:()=>T("app"),disabled:!p.hasAppCredentials,className:`p-3 rounded-lg border text-left transition-all ${D==="app"?"bg-green-950/40 border-green-500 ring-1 ring-green-500/50":p.hasAppCredentials?"bg-slate-800/30 border-slate-700 hover:border-slate-600":"bg-slate-800/20 border-slate-800 opacity-50 cursor-not-allowed"}`,children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ef,{className:"w-4 h-4 text-green-400"}),t.jsx("span",{className:`text-sm font-medium ${D==="app"?"text-slate-100":"text-slate-300"}`,children:"App Service Principal"}),D==="app"&&t.jsx(Xs,{className:"w-3 h-3 text-green-400 ml-auto"})]}),t.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Use application credentials"})]})]}),D==="manual_sp"&&t.jsxs("div",{className:"space-y-2 p-3 bg-slate-800/30 rounded-lg border border-slate-700",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Client ID"}),t.jsx("input",{type:"text",value:L,onChange:se=>F(se.target.value),placeholder:"Enter service principal client ID",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-sm text-slate-100 placeholder-slate-500 focus:outline-none focus:border-amber-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Client Secret"}),t.jsx("input",{type:"password",value:V,onChange:se=>E(se.target.value),placeholder:"Enter service principal client secret",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-sm text-slate-100 placeholder-slate-500 focus:outline-none focus:border-amber-500"})]})]}),D==="manual_pat"&&t.jsxs("div",{className:"p-3 bg-slate-800/30 rounded-lg border border-slate-700",children:[t.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Personal Access Token"}),t.jsx("input",{type:"password",value:B,onChange:se=>$(se.target.value),placeholder:"Enter Databricks personal access token",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-sm text-slate-100 placeholder-slate-500 focus:outline-none focus:border-cyan-500"})]})]}),y.valid&&y.deployment_options&&!o&&t.jsxs("div",{className:"space-y-3",children:[t.jsx("h4",{className:"text-xs font-medium text-slate-400 uppercase tracking-wide",children:"Deployment Options"}),t.jsxs("div",{className:"p-4 rounded-xl border bg-blue-950/40 border-blue-500 ring-1 ring-blue-500/50",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("div",{className:"p-1.5 rounded-lg bg-blue-500/20",children:t.jsx(br,{className:"w-4 h-4 text-blue-400"})}),t.jsx("span",{className:"font-medium text-slate-100",children:"Quick Deploy"}),t.jsx(Xs,{className:"w-4 h-4 text-blue-400 ml-auto"})]}),t.jsx("p",{className:"text-xs text-slate-400 mb-3",children:y.deployment_options.quick.description}),t.jsx("div",{className:"flex flex-wrap gap-1",children:y.deployment_options.quick.provisions.map((se,H)=>t.jsx("span",{className:"px-2 py-0.5 text-[10px] bg-slate-700/50 rounded text-slate-300",children:se},H))})]}),!n&&t.jsxs("label",{className:"flex items-start gap-3 p-3 rounded-lg border border-slate-700 bg-slate-800/30 cursor-pointer hover:bg-slate-800/50 transition-colors",children:[t.jsx("input",{type:"checkbox",checked:w,onChange:se=>I(se.target.checked),className:"mt-0.5 w-4 h-4 rounded border-slate-600 bg-slate-700 text-violet-500 focus:ring-violet-500 focus:ring-offset-0"}),t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium text-slate-200",children:"Skip model creation"}),t.jsx("p",{className:"text-xs text-slate-400 mt-0.5",children:"Deploy without logging model to MLflow. Faster deployment but no model versioning or tracking."})]})]})]}),o&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h4",{className:"text-xs font-medium text-slate-400 uppercase tracking-wide",children:"Deployment Progress"}),u&&!m&&o.status!=="cancelled"&&t.jsx("span",{className:"text-[10px] text-blue-400 bg-blue-500/20 px-2 py-0.5 rounded",children:"Running in background"})]}),q()]}),t.jsx("div",{className:"space-y-2",children:o.steps.map(se=>{const H=o.status==="cancelled"||o.status==="cancelling",z=se.status==="running"&&H?"failed":se.status,te=se.status==="running"&&H?"Cancelled by user":se.error;return t.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg border ${z==="running"?"bg-blue-950/30 border-blue-800":z==="completed"?"bg-green-950/20 border-green-900":z==="failed"?"bg-red-950/20 border-red-900":z==="skipped"?"bg-slate-800/20 border-slate-700 opacity-60":"bg-slate-800/30 border-slate-700"}`,children:[t.jsx("div",{className:`p-1.5 rounded-lg ${z==="running"?"bg-blue-500/20":z==="completed"?"bg-green-500/20":z==="failed"?"bg-red-500/20":z==="skipped"?"bg-slate-600/30":"bg-slate-700"}`,children:zS[se.name]||t.jsx(ca,{className:"w-4 h-4"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-sm text-slate-200",children:i[se.name]||se.name}),te&&t.jsx("p",{className:"text-xs text-red-400 mt-1",children:te})]}),W(z)]},se.name)})}),o.status==="completed"&&o.result&&t.jsxs("div",{className:"p-4 bg-green-950/30 border border-green-800 rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(Xs,{className:"w-5 h-5 text-green-400"}),t.jsx("span",{className:"font-medium text-green-300",children:"Deployment Successful!"})]}),t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-slate-400",children:n?"Endpoint:":"App Name:"}),t.jsx("code",{className:"px-2 py-0.5 bg-slate-800 rounded text-green-300",children:o.result.endpoint_name})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-slate-400",children:"Model:"}),t.jsx("code",{className:"px-2 py-0.5 bg-slate-800 rounded text-slate-300 text-xs",children:o.result.model_name})]})]})]}),o.status==="failed"&&o.error&&t.jsxs("div",{className:"p-4 bg-red-950/30 border border-red-800 rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(As,{className:"w-5 h-5 text-red-400"}),t.jsx("span",{className:"font-medium text-red-300",children:"Deployment Failed"})]}),t.jsx("p",{className:"text-sm text-red-400",children:o.error}),o.error_trace&&t.jsxs("details",{className:"mt-2",children:[t.jsx("summary",{className:"text-xs text-slate-500 cursor-pointer hover:text-slate-400",children:"Show details"}),t.jsx("pre",{className:"mt-2 p-2 bg-slate-900 rounded text-xs text-slate-400 overflow-x-auto max-h-40",children:o.error_trace})]})]}),o.status==="cancelled"&&t.jsxs("div",{className:"p-4 bg-amber-950/30 border border-amber-800 rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(fr,{className:"w-5 h-5 text-amber-400"}),t.jsx("span",{className:"font-medium text-amber-300",children:"Deployment Cancelled"})]}),t.jsx("p",{className:"text-sm text-slate-400 mt-2",children:"The deployment was cancelled by the user."})]})]}),f&&t.jsx("div",{className:"p-4 bg-red-950/30 border border-red-800 rounded-lg",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(As,{className:"w-5 h-5 text-red-400"}),t.jsx("span",{className:"text-red-300",children:f})]})}),t.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-slate-700",children:[t.jsx("div",{className:"flex items-center gap-3",children:!u&&!m&&t.jsxs(ee,{variant:"secondary",onClick:P,disabled:_,className:"min-w-[120px]",children:[t.jsx(Ut,{className:`w-4 h-4 ${_?"animate-spin":""}`}),"Revalidate"]})}),t.jsxs("div",{className:"flex items-center gap-3",children:[(u||m)&&t.jsx(ee,{variant:"secondary",onClick:M,disabled:m,className:"min-w-[120px]",children:m?t.jsxs(t.Fragment,{children:[t.jsx(Nt,{className:"w-4 h-4 animate-spin"}),"Cancelling..."]}):t.jsxs(t.Fragment,{children:[t.jsx(As,{className:"w-4 h-4"}),"Cancel"]})}),e&&t.jsx(ee,{variant:"secondary",onClick:()=>{v(),e()},className:"min-w-[120px]",children:"Close"}),t.jsx(ee,{variant:"primary",onClick:async()=>{console.log("[DeploymentPanel] Primary button clicked:",{status:o==null?void 0:o.status,isDeploying:u,isCancelling:m,deploymentId:l}),(o==null?void 0:o.status)==="completed"?(console.log("[DeploymentPanel] Closing dialog (completed)"),v(),e==null||e()):(o==null?void 0:o.status)==="failed"||(o==null?void 0:o.status)==="cancelled"?(console.log("[DeploymentPanel] Resetting deployment state"),R.current=null,v()):(console.log("[DeploymentPanel] Starting new deployment"),O())},disabled:!y.valid||u||m,className:"min-w-[120px]",children:u&&!m?t.jsxs(t.Fragment,{children:[t.jsx(Nt,{className:"w-4 h-4 animate-spin"}),"Deploying..."]}):(o==null?void 0:o.status)==="completed"?t.jsxs(t.Fragment,{children:[t.jsx(Xs,{className:"w-4 h-4"}),"Done"]}):(o==null?void 0:o.status)==="failed"||(o==null?void 0:o.status)==="cancelled"?t.jsxs(t.Fragment,{children:[t.jsx(Ut,{className:"w-4 h-4"}),"Try Again"]}):t.jsxs(t.Fragment,{children:[t.jsx(Cu,{className:"w-4 h-4"}),"Deploy"]})})]})]})]}):f?t.jsxs("div",{className:"p-4 bg-red-950/30 border border-red-800 rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(As,{className:"w-5 h-5 text-red-400"}),t.jsx("span",{className:"text-red-300",children:f})]}),t.jsxs(ee,{variant:"ghost",onClick:P,className:"mt-3",children:[t.jsx(Ut,{className:"w-4 h-4"}),"Retry"]})]}):null})}function fo(e){if(!e||typeof e!="object")return e;if(Array.isArray(e))return e.map(fo);const s={};for(const[a,n]of Object.entries(e))a!=="refName"&&(s[a]=fo(n));return s}function BS({onClose:e}){var Ke,Ne,et,lt,ot;const{config:s}=nt(),{conversationId:a,messages:n,logs:i,addMessage:l,updateLastMessage:o,addLog:u,clearLogs:m,startNewSession:h,removeEmptyMessages:r}=Em(),{credentialType:c,manualClientId:d,manualClientSecret:g,manualPat:v,setCredentialType:S,setManualClientId:y,setManualClientSecret:b,setManualPat:_,hasCredentials:x}=po(),[f,C]=A.useState(""),[w,I]=A.useState(!1),[R,k]=A.useState(null),[D,L]=A.useState(null),[V,B]=A.useState(!1),[T,F]=A.useState(!1),[E,$]=A.useState(!1),[p,N]=A.useState(""),[P,M]=A.useState(null),[O,W]=A.useState(!1),[q,ce]=A.useState(null),[se,H]=A.useState(!1),z=A.useRef(null),te=A.useRef(null),K=A.useRef(null),he=A.useCallback(()=>{var ve;(ve=z.current)==null||ve.scrollIntoView({behavior:"smooth"})},[]);A.useEffect(()=>{he()},[n,he]),A.useEffect(()=>{var ve;V&&((ve=te.current)==null||ve.scrollIntoView({behavior:"smooth"}))},[i,V]),A.useEffect(()=>{var ve;(ve=K.current)==null||ve.focus()},[]);const J=Object.keys(s.agents||{}).length>0,oe=!!((Ne=(Ke=s.app)==null?void 0:Ke.orchestration)!=null&&Ne.supervisor||(lt=(et=s.app)==null?void 0:et.orchestration)!=null&&lt.swarm),X=J&&oe,Z=async()=>{var Xe,qe;if(!f.trim()||w||!X)return;const ve=f.trim();C(""),I(!0),k(null),L(null),l("user",ve),u("info",`Sending message: "${ve.substring(0,50)}${ve.length>50?"...":""}"`),l("assistant","");try{const ct=[...n,{role:"user",content:ve}].map(we=>({role:we.role,content:we.content}));u("debug",`Preparing request with ${ct.length} messages`),u("info","Creating agent from configuration...");const At=mn(s),Qt=Na.load(At),zt=fo(Qt),yt=po.getState().getCredentials();u("debug",`Using ${yt.type} authentication`);let _t={};if(p.trim())try{_t=JSON.parse(p),M(null),u("debug",`Custom inputs provided: ${Object.keys(_t).join(", ")}`)}catch{throw M("Invalid JSON format"),new Error("Invalid custom_inputs JSON")}ce(null);const Pt=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({config:zt,messages:ct,credentials:yt,context:{thread_id:a,user_id:"builder-user"},custom_inputs:Object.keys(_t).length>0?_t:void 0})});if(!Pt.ok){const we=await Pt.json();throw new Error(we.error||"Chat request failed")}const Kt=(Xe=Pt.body)==null?void 0:Xe.getReader(),re=new TextDecoder;let fe="",Me="";if(Kt)for(;;){const{done:we,value:We}=await Kt.read();if(we)break;Me+=re.decode(We,{stream:!0});const He=Me.split(`
`);Me=He.pop()||"";for(const bt of He)if(bt.startsWith("data: "))try{const Qe=JSON.parse(bt.slice(6));switch(Qe.type){case"log":u(Qe.level,Qe.message);break;case"delta":fe+=Qe.content,o(fe);break;case"custom_outputs":ce(Qe.data),H(!0),!O&&Qe.data&&Object.keys(Qe.data).length>0&&(N(JSON.stringify(Qe.data,null,2)),u("info","Auto-populated custom_inputs from custom_outputs"));break;case"done":u("info",`Completed: ${Qe.response.length} characters`),o(Qe.response||fe);break;case"error":u("error",Qe.error),k(Qe.error),Qe.trace&&L(Qe.trace),r();break}}catch{console.warn("Failed to parse SSE message:",bt)}}}catch(ct){const At=ct instanceof Error?ct.message:"Failed to get response";k(At),u("error",At),r()}finally{I(!1),(qe=K.current)==null||qe.focus()}},me=ve=>{ve.key==="Enter"&&!ve.shiftKey&&(ve.preventDefault(),Z())},Re=()=>{h(),k(null),L(null),N(""),W(!1),ce(null)},st=ve=>new Date(ve).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),it=ve=>new Date(ve).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}),rt=ve=>{switch(ve){case"error":return t.jsx(As,{className:"w-3 h-3 text-red-400"});case"warning":return t.jsx(Vn,{className:"w-3 h-3 text-amber-400"});case"debug":return t.jsx(tl,{className:"w-3 h-3 text-slate-500"});default:return t.jsx(Ka,{className:"w-3 h-3 text-blue-400"})}},tt=ve=>{switch(ve){case"error":return"text-red-400";case"warning":return"text-amber-400";case"debug":return"text-slate-500";default:return"text-slate-300"}},ze=n.filter(ve=>ve.content||ve.role==="user"),Le=n.length>0&&n[n.length-1].role==="assistant"&&!n[n.length-1].content;return t.jsxs("div",{className:"flex flex-col h-[70vh]",children:[t.jsxs("div",{className:"flex items-center justify-between pb-4 border-b border-slate-700",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 rounded-lg bg-gradient-to-br from-cyan-500/20 to-blue-500/20",children:t.jsx(Xa,{className:"w-5 h-5 text-cyan-400"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-slate-100",children:"Local Agent Chat"}),t.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[t.jsxs("span",{children:["Testing ",((ot=s.app)==null?void 0:ot.name)||"your agent"," locally"]}),t.jsx("span",{className:"text-slate-600",children:""}),t.jsxs("div",{className:"flex items-center gap-1",title:`Conversation ID: ${a}`,children:[t.jsx(Ol,{className:"w-3 h-3"}),t.jsx("span",{className:"font-mono",children:a.slice(-8)})]})]})]})]}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs(ee,{variant:"ghost",size:"sm",onClick:Re,title:"Start a new conversation",children:[t.jsx(Ie,{className:"w-4 h-4"}),"New Session"]})})]}),t.jsxs("div",{className:"border-b border-slate-700",children:[t.jsxs("button",{onClick:()=>F(!T),className:"w-full flex items-center justify-between p-2 text-xs hover:bg-slate-800/50 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Mt,{className:"w-3.5 h-3.5 text-slate-400"}),t.jsx("span",{className:"text-slate-400",children:"Authentication:"}),t.jsxs("span",{className:"text-slate-300",children:[c==="obo"&&"On-Behalf-Of Token",c==="manual_sp"&&"Service Principal",c==="manual_pat"&&"Personal Access Token"]}),!x()&&c!=="obo"&&t.jsx("span",{className:"text-amber-400 text-xs",children:"(not configured)"})]}),T?t.jsx(ya,{className:"w-4 h-4 text-slate-400"}):t.jsx(Wt,{className:"w-4 h-4 text-slate-400"})]}),T&&t.jsxs("div",{className:"p-3 bg-slate-800/30 space-y-3",children:[t.jsx("div",{className:"flex gap-2",children:["obo","manual_sp","manual_pat"].map(ve=>t.jsxs("button",{onClick:()=>S(ve),className:`px-3 py-1.5 text-xs rounded-md transition-colors ${c===ve?"bg-cyan-500/20 text-cyan-300 border border-cyan-500/50":"bg-slate-700/50 text-slate-400 border border-slate-600 hover:bg-slate-700"}`,children:[ve==="obo"&&"OBO Token",ve==="manual_sp"&&"Service Principal",ve==="manual_pat"&&"PAT"]},ve))}),c==="obo"&&t.jsx("p",{className:"text-xs text-slate-500",children:"Uses the On-Behalf-Of token from Databricks Apps. This may have limited scopes."}),c==="manual_sp"&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("input",{type:"text",placeholder:"Client ID",value:d,onChange:ve=>y(ve.target.value),className:"w-full px-3 py-1.5 text-sm bg-slate-900 border border-slate-600 rounded-md text-slate-100 placeholder-slate-500 focus:outline-none focus:ring-1 focus:ring-cyan-500"}),t.jsx("input",{type:"password",placeholder:"Client Secret",value:g,onChange:ve=>b(ve.target.value),className:"w-full px-3 py-1.5 text-sm bg-slate-900 border border-slate-600 rounded-md text-slate-100 placeholder-slate-500 focus:outline-none focus:ring-1 focus:ring-cyan-500"})]}),c==="manual_pat"&&t.jsx("input",{type:"password",placeholder:"Personal Access Token",value:v,onChange:ve=>_(ve.target.value),className:"w-full px-3 py-1.5 text-sm bg-slate-900 border border-slate-600 rounded-md text-slate-100 placeholder-slate-500 focus:outline-none focus:ring-1 focus:ring-cyan-500"})]})]}),t.jsxs("div",{className:"border-b border-slate-700",children:[t.jsxs("button",{onClick:()=>$(!E),className:"w-full flex items-center justify-between p-2 text-xs hover:bg-slate-800/50 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Ol,{className:"w-3.5 h-3.5 text-slate-400"}),t.jsx("span",{className:"text-slate-400",children:"Custom Inputs:"}),t.jsx("span",{className:"text-slate-300",children:p.trim()?"Configured":"None"}),P&&t.jsxs("span",{className:"text-red-400 text-xs",children:["(",P,")"]})]}),E?t.jsx(ya,{className:"w-4 h-4 text-slate-400"}):t.jsx(Wt,{className:"w-4 h-4 text-slate-400"})]}),E&&t.jsxs("div",{className:"p-3 bg-slate-800/30 space-y-2",children:[t.jsxs("p",{className:"text-xs text-slate-500",children:["Optional JSON object to pass as custom_inputs to the agent. Example: ",'{"genie_conversation_ids": {"my_room": "abc123"}}']}),t.jsx("textarea",{value:p,onChange:ve=>{N(ve.target.value),M(null),W(!0)},placeholder:'{"key": "value"}',rows:3,className:`w-full px-3 py-2 text-sm bg-slate-900 border rounded-md text-slate-100 placeholder-slate-500 focus:outline-none focus:ring-1 font-mono ${P?"border-red-500 focus:ring-red-500":"border-slate-600 focus:ring-cyan-500"}`}),!O&&p&&t.jsx("p",{className:"text-xs text-cyan-400 mt-1",children:" Auto-populated from previous response"})]})]}),!X&&t.jsx("div",{className:"flex-1 flex items-center justify-center",children:t.jsxs("div",{className:"text-center p-6 max-w-md",children:[t.jsx(fr,{className:"w-12 h-12 text-amber-400 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-slate-100 mb-2",children:"Configuration Required"}),t.jsx("p",{className:"text-sm text-slate-400 mb-4",children:"To chat with your agent locally, you need to:"}),t.jsxs("ul",{className:"text-sm text-slate-400 text-left space-y-2",children:[!J&&t.jsxs("li",{className:"flex items-center gap-2",children:[t.jsx(As,{className:"w-4 h-4 text-red-400 flex-shrink-0"}),"Add at least one agent"]}),!oe&&t.jsxs("li",{className:"flex items-center gap-2",children:[t.jsx(As,{className:"w-4 h-4 text-red-400 flex-shrink-0"}),"Configure orchestration (Supervisor or Swarm)"]})]})]})}),X&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:`flex-1 overflow-y-auto py-4 space-y-4 min-h-0 ${V?"max-h-[30vh]":""}`,children:[ze.length===0?t.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[t.jsx(ts,{className:"w-16 h-16 text-slate-600 mb-4"}),t.jsx("h4",{className:"text-lg font-medium text-slate-300 mb-2",children:"Start a Conversation"}),t.jsx("p",{className:"text-sm text-slate-500 max-w-sm",children:"Test your agent configuration locally. Messages are processed using the dao-ai library without deploying to an endpoint."}),t.jsx("p",{className:"text-xs text-slate-600 mt-4",children:"Your chat history will be preserved when you close this panel."})]}):ze.map((ve,Xe)=>t.jsxs("div",{className:`flex gap-3 ${ve.role==="user"?"flex-row-reverse":""}`,children:[t.jsx("div",{className:`flex-shrink-0 w-8 h-8 rounded-lg flex items-center justify-center ${ve.role==="user"?"bg-blue-500/20":"bg-gradient-to-br from-cyan-500/20 to-purple-500/20"}`,children:ve.role==="user"?t.jsx(Os,{className:"w-4 h-4 text-blue-400"}):t.jsx(ts,{className:"w-4 h-4 text-cyan-400"})}),t.jsxs("div",{className:`flex flex-col max-w-[80%] ${ve.role==="user"?"items-end":"items-start"}`,children:[t.jsx("div",{className:`px-4 py-3 rounded-2xl ${ve.role==="user"?"bg-blue-600 text-white rounded-br-md":"bg-slate-800 text-slate-100 rounded-bl-md border border-slate-700"}`,children:t.jsx("p",{className:"text-sm whitespace-pre-wrap",children:ve.content})}),t.jsx("span",{className:"text-[10px] text-slate-500 mt-1 px-1",children:st(ve.timestamp)})]})]},`${ve.timestamp}-${Xe}`)),w&&Le&&t.jsxs("div",{className:"flex gap-3",children:[t.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-lg bg-gradient-to-br from-cyan-500/20 to-purple-500/20 flex items-center justify-center",children:t.jsx(ts,{className:"w-4 h-4 text-cyan-400"})}),t.jsx("div",{className:"bg-slate-800 border border-slate-700 rounded-2xl rounded-bl-md px-4 py-3",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Nt,{className:"w-4 h-4 text-cyan-400 animate-spin"}),t.jsx("span",{className:"text-sm text-slate-400",children:"Generating response..."})]})})]}),t.jsx("div",{ref:z})]}),R&&t.jsxs("div",{className:"px-4 py-3 bg-red-950/30 border border-red-800 rounded-lg mb-4",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx(As,{className:"w-4 h-4 text-red-400"}),t.jsx("span",{className:"text-sm text-red-300",children:R})]}),D&&t.jsxs("details",{className:"mt-2",children:[t.jsx("summary",{className:"text-xs text-slate-500 cursor-pointer hover:text-slate-400",children:"Show details"}),t.jsx("pre",{className:"mt-2 p-2 bg-slate-900 rounded text-xs text-slate-400 overflow-x-auto max-h-32",children:D})]})]}),t.jsxs("div",{className:"pt-4 border-t border-slate-700",children:[t.jsxs("div",{className:"flex gap-3",children:[t.jsx("div",{className:"flex-1 relative",children:t.jsx("textarea",{ref:K,value:f,onChange:ve=>C(ve.target.value),onKeyDown:me,placeholder:"Type your message...",disabled:w,rows:1,className:"w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-sm text-slate-100 placeholder-slate-500 focus:outline-none focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500/50 resize-none disabled:opacity-50",style:{minHeight:"48px",maxHeight:"120px"}})}),t.jsx(ee,{variant:"primary",onClick:Z,disabled:!f.trim()||w,className:"self-end bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500",children:w?t.jsx(Nt,{className:"w-4 h-4 animate-spin"}):t.jsx(vf,{className:"w-4 h-4"})})]}),t.jsx("p",{className:"text-[10px] text-slate-600 mt-2 text-center",children:"Press Enter to send  Shift+Enter for new line"})]}),q&&Object.keys(q).length>0&&t.jsxs("div",{className:"mt-4 border border-emerald-500/30 rounded-lg overflow-hidden",children:[t.jsxs("button",{onClick:()=>H(!se),className:"w-full flex items-center justify-between px-4 py-2 bg-emerald-900/20 hover:bg-emerald-900/30 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Ka,{className:"w-4 h-4 text-emerald-400"}),t.jsx("span",{className:"text-sm font-medium text-emerald-300",children:"Custom Outputs"}),t.jsxs("span",{className:"px-1.5 py-0.5 text-[10px] font-medium bg-emerald-500/20 text-emerald-400 rounded",children:[Object.keys(q).length," ",Object.keys(q).length===1?"key":"keys"]})]}),se?t.jsx(Wt,{className:"w-4 h-4 text-emerald-400"}):t.jsx(ya,{className:"w-4 h-4 text-emerald-400"})]}),se&&t.jsx("div",{className:"p-3 bg-emerald-900/10 max-h-40 overflow-y-auto",children:t.jsx("pre",{className:"text-xs text-emerald-300 font-mono whitespace-pre-wrap",children:JSON.stringify(q,null,2)})})]}),t.jsxs("div",{className:"mt-4 border border-slate-700 rounded-lg overflow-hidden",children:[t.jsxs("button",{onClick:()=>B(!V),className:"w-full flex items-center justify-between px-4 py-2 bg-slate-800/50 hover:bg-slate-800 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(tl,{className:"w-4 h-4 text-slate-400"}),t.jsx("span",{className:"text-sm font-medium text-slate-300",children:"Application Logs"}),i.length>0&&t.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-medium bg-slate-700 text-slate-400 rounded",children:i.length})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[i.length>0&&t.jsx("button",{onClick:ve=>{ve.stopPropagation(),m()},className:"text-xs text-slate-500 hover:text-slate-300 px-2 py-1",children:"Clear"}),V?t.jsx(Wt,{className:"w-4 h-4 text-slate-400"}):t.jsx(ya,{className:"w-4 h-4 text-slate-400"})]})]}),V&&t.jsx("div",{className:"bg-slate-900/50 max-h-40 overflow-y-auto",children:i.length===0?t.jsxs("div",{className:"px-4 py-6 text-center",children:[t.jsx(tl,{className:"w-8 h-8 text-slate-700 mx-auto mb-2"}),t.jsx("p",{className:"text-xs text-slate-600",children:"No logs yet. Send a message to see activity."})]}):t.jsxs("div",{className:"divide-y divide-slate-800",children:[i.map((ve,Xe)=>t.jsxs("div",{className:"px-4 py-2 flex items-start gap-2 hover:bg-slate-800/30",children:[t.jsx("span",{className:"text-[10px] text-slate-600 font-mono whitespace-nowrap pt-0.5",children:it(ve.timestamp)}),t.jsx("div",{className:"pt-0.5",children:rt(ve.level)}),t.jsx("span",{className:`text-xs font-mono flex-1 ${tt(ve.level)}`,children:ve.message})]},Xe)),t.jsx("div",{ref:te})]})})]})]}),e&&t.jsx("div",{className:"pt-4 mt-4 border-t border-slate-700 flex justify-end",children:t.jsx(ee,{variant:"secondary",onClick:e,children:"Close"})})]})}const hu={repo:"natefleming/dao-ai",branch:"main",path:"config"};function WS({isOpen:e,onClose:s,onImportFile:a,onLocalUpload:n}){const[i,l]=A.useState("choose"),[o,u]=A.useState(hu),[m,h]=A.useState(hu.path),[r,c]=A.useState([]),[d,g]=A.useState(!1),[v,S]=A.useState(!1),[y,b]=A.useState(null),[_,x]=A.useState(null);A.useEffect(()=>{(async()=>{S(!0);try{const V=await fetch("/api/github-config");if(V.ok){const B=await V.json();u(B),h(B.path)}}catch(V){console.warn("Failed to fetch GitHub config, using defaults:",V)}finally{S(!1)}})()},[]),A.useEffect(()=>{if(i!=="github"||v)return;(async()=>{g(!0),b(null);try{const V=`https://api.github.com/repos/${o.repo}/contents/${m}?ref=${o.branch}`,B=await fetch(V);if(!B.ok)throw B.status===404?new Error("Path not found in repository"):B.status===403?new Error("API rate limit exceeded. Please try again later."):new Error(`GitHub API error: ${B.status}`);const T=await B.json(),F=(Array.isArray(T)?T:[T]).filter(E=>E.type==="dir"||E.name.endsWith(".yaml")||E.name.endsWith(".yml")).sort((E,$)=>E.type!==$.type?E.type==="dir"?-1:1:E.name.localeCompare($.name));c(F)}catch(V){b(V instanceof Error?V.message:"Failed to fetch repository contents"),c([])}finally{g(!1)}})()},[m,o.repo,o.branch,i,v]);const f=async L=>{if(L.type==="dir")h(L.path);else if(L.download_url){x(L.name);try{const V=await fetch(L.download_url);if(!V.ok)throw new Error("Failed to download file");const B=await V.text();a(B,L.name),s()}catch(V){b(V instanceof Error?V.message:"Failed to download file")}finally{x(null)}}},C=()=>{const L=m.split("/");L.length>1&&(L.pop(),h(L.join("/")))},w=()=>{n(),s()},I=()=>{l("choose"),h(o.path),b(null)};A.useEffect(()=>{e&&(l("choose"),h(o.path),b(null))},[e,o.path]);const R=m.split("/"),k=o.path.split("/"),D=R.length>k.length;return t.jsx(ws,{isOpen:e,onClose:s,title:"Import Configuration",size:"lg",children:i==="choose"?t.jsxs("div",{className:"space-y-4",children:[t.jsx("p",{className:"text-sm text-slate-400",children:"Choose how you want to import a configuration file:"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("button",{onClick:w,className:"flex flex-col items-center gap-3 p-6 rounded-lg border border-slate-700 bg-slate-800/50 hover:bg-slate-800 hover:border-slate-600 transition-colors",children:[t.jsx("div",{className:"p-3 rounded-full bg-blue-500/20",children:t.jsx(ku,{className:"w-6 h-6 text-blue-400"})}),t.jsxs("div",{className:"text-center",children:[t.jsx("h3",{className:"text-sm font-medium text-slate-100",children:"Upload File"}),t.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Import a YAML file from your computer"})]})]}),t.jsxs("button",{onClick:()=>l("github"),className:"flex flex-col items-center gap-3 p-6 rounded-lg border border-slate-700 bg-slate-800/50 hover:bg-slate-800 hover:border-slate-600 transition-colors",children:[t.jsx("div",{className:"p-3 rounded-full bg-purple-500/20",children:t.jsx(Mc,{className:"w-6 h-6 text-purple-400"})}),t.jsxs("div",{className:"text-center",children:[t.jsx("h3",{className:"text-sm font-medium text-slate-100",children:"Browse GitHub"}),t.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Load a template from the dao-ai repository"})]})]})]})]}):t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(ee,{variant:"ghost",size:"sm",onClick:I,children:t.jsx(kc,{className:"w-4 h-4"})}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-400",children:[t.jsx(Mc,{className:"w-4 h-4"}),t.jsx("span",{children:o.repo}),t.jsx(Fa,{className:"w-3 h-3"}),t.jsx("span",{className:"text-slate-300",children:m})]})]}),D&&t.jsxs("button",{onClick:C,className:"flex items-center gap-2 text-sm text-cyan-400 hover:text-cyan-300 transition-colors",children:[t.jsx(kc,{className:"w-4 h-4"}),"Back to parent directory"]}),y&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm",children:[t.jsx(Vn,{className:"w-4 h-4 flex-shrink-0"}),y]}),d&&t.jsxs("div",{className:"flex items-center justify-center py-8",children:[t.jsx(Nt,{className:"w-6 h-6 text-cyan-400 animate-spin"}),t.jsx("span",{className:"ml-2 text-slate-400",children:"Loading..."})]}),!d&&r.length>0&&t.jsx("div",{className:"max-h-80 overflow-y-auto space-y-1 border border-slate-700 rounded-lg p-2",children:r.map(L=>t.jsxs("button",{onClick:()=>f(L),disabled:_!==null,className:`w-full flex items-center gap-3 px-3 py-2 rounded-md text-left transition-colors ${_===L.name?"bg-cyan-500/20 text-cyan-300":"hover:bg-slate-800 text-slate-300"}`,children:[_===L.name?t.jsx(Nt,{className:"w-4 h-4 animate-spin text-cyan-400"}):L.type==="dir"?t.jsx(uf,{className:"w-4 h-4 text-amber-400"}):t.jsx(Ya,{className:"w-4 h-4 text-blue-400"}),t.jsx("span",{className:"text-sm",children:L.name}),L.type==="dir"&&t.jsx(Fa,{className:"w-4 h-4 text-slate-500 ml-auto"})]},L.path))}),!d&&!y&&r.length===0&&t.jsx("div",{className:"text-center py-8 text-slate-500",children:"No YAML files found in this directory"})]})})}function US({showPreview:e,onTogglePreview:s}){var T,F,E,$,p,N,P,M;const{config:a,setConfig:n,reset:i,daoAiVersion:l,hasUnsavedAppChanges:o}=nt(),{startNewSession:u}=Em(),m=A.useRef(null),[h,r]=A.useState(!1),[c,d]=A.useState(!1),[g,v]=A.useState(!1),[S,y]=A.useState(!1),b=Object.keys(a.agents||{}).length>0,_=!!((T=a.app)!=null&&T.name),x=!!((E=(F=a.app)==null?void 0:F.orchestration)!=null&&E.supervisor||(p=($=a.app)==null?void 0:$.orchestration)!=null&&p.swarm),f=b&&_&&x,C=f&&!o,w=f&&!o,I=f,R=()=>{var W;const O=((W=a.app)==null?void 0:W.name)||"model_config";rg(a,`${O}.yaml`)},k=(O,W)=>{try{const q=gm(O);bm(q),console.log(`[Import from ${W}] Extracted YAML references:`,q);const ce=Na.load(O);if(ce.memory&&q.anchorPaths){const se=q.anchors.find(H=>H.path==="memory");se&&(ce.memory.refName=se.name,console.log("[Import] Set memory refName to:",se.name))}Ul(),n(ce),u(),console.log(`[Import from ${W}] Started new chat session for imported config`)}catch(q){console.error("Failed to parse YAML:",q),alert("Failed to parse YAML file. Please check the format.")}},D=O=>{var ce;const W=(ce=O.target.files)==null?void 0:ce[0];if(!W)return;const q=new FileReader;q.onload=se=>{var z;const H=(z=se.target)==null?void 0:z.result;k(H,`file: ${W.name}`)},q.readAsText(W),m.current&&(m.current.value="")},L=(O,W)=>{k(O,`GitHub: ${W}`)},V=()=>{var O;(O=m.current)==null||O.click()},B=()=>{confirm("Are you sure you want to reset all configuration? This cannot be undone.")&&(B0(),Ul(),i(),u())};return t.jsxs("header",{className:"h-16 bg-slate-900 border-b border-slate-800 px-6 flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center shadow-lg shadow-blue-500/20",children:t.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("h1",{className:"text-lg font-bold text-white",children:"DAO AI Builder"}),l&&t.jsxs("span",{className:"px-1.5 py-0.5 text-[10px] font-medium bg-slate-700 text-slate-400 rounded",children:["v",l]})]}),t.jsx("p",{className:"text-xs text-slate-500",children:"Agent Configuration Studio"})]})]}),((N=a.app)==null?void 0:N.name)&&t.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-cyan-500/10 to-blue-500/10 border border-cyan-500/30 rounded-lg",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-cyan-400 animate-pulse"}),t.jsx("span",{className:"text-sm font-medium text-cyan-300",children:a.app.name})]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Ob,{}),t.jsx("div",{className:"w-px h-6 bg-slate-700"}),t.jsx("input",{ref:m,type:"file",accept:".yaml,.yml",onChange:D,className:"hidden"}),t.jsxs(ee,{variant:"ghost",size:"sm",onClick:()=>y(!0),children:[t.jsx(ku,{className:"w-4 h-4"}),"Import"]}),t.jsxs(ee,{variant:"ghost",size:"sm",onClick:B,children:[t.jsx(xf,{className:"w-4 h-4"}),"Reset"]}),t.jsx("div",{className:"w-px h-6 bg-slate-700"}),t.jsxs(ee,{variant:"secondary",size:"sm",onClick:s,children:[e?t.jsx(of,{className:"w-4 h-4"}):t.jsx(cf,{className:"w-4 h-4"}),e?"Hide":"Show"," Preview"]}),t.jsxs(ee,{variant:"primary",size:"sm",onClick:R,children:[t.jsx(wu,{className:"w-4 h-4"}),"Export YAML"]}),t.jsx("div",{className:"w-px h-6 bg-slate-700"}),t.jsxs(ee,{variant:"secondary",size:"sm",onClick:()=>r(!0),disabled:!I,title:I?"Visualize agent graph":"Save Application Configuration first",children:[t.jsx(Or,{className:"w-4 h-4"}),"Visualize"]}),t.jsxs(ee,{variant:"secondary",size:"sm",onClick:()=>v(!0),disabled:!w,title:w?"Test agent locally":"Save Application Configuration first",className:"bg-gradient-to-r from-cyan-600/80 to-blue-600/80 hover:from-cyan-500 hover:to-blue-500 text-white border-0",children:[t.jsx(Xa,{className:"w-4 h-4"}),"Chat"]}),t.jsxs(ee,{variant:"primary",size:"sm",onClick:()=>d(!0),disabled:!C,title:C?"Deploy to Databricks":"Save Application Configuration first",className:"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500",children:[t.jsx(Cu,{className:"w-4 h-4"}),"Deploy"]})]}),t.jsx(ws,{isOpen:h,onClose:()=>r(!1),title:"Application Visualization",description:"Interactive graph showing agent relationships and orchestration flow",size:"full",children:t.jsx("div",{className:"h-[70vh]",children:t.jsx(VS,{config:a})})}),t.jsx(ws,{isOpen:c,onClose:()=>d(!1),title:((P=a.app)==null?void 0:P.deployment_target)==="apps"?"Deploy to Databricks Apps":"Deploy to Model Serving",description:((M=a.app)==null?void 0:M.deployment_target)==="apps"?"Deploy your agent as a Databricks App":"Deploy your agent to Databricks Model Serving",size:"lg",children:t.jsx(HS,{onClose:()=>d(!1)})}),t.jsx(ws,{isOpen:g,onClose:()=>v(!1),title:"Chat with Agent",description:"Test your agent configuration locally without deploying",size:"lg",children:t.jsx(BS,{onClose:()=>v(!1)})}),t.jsx(WS,{isOpen:S,onClose:()=>y(!1),onImportFile:L,onLocalUpload:V})]})}const qS={error:Vn,warning:fr,success:go,info:Ka},GS={error:"bg-red-500/10 border-red-500/30 text-red-400",warning:"bg-amber-500/10 border-amber-500/30 text-amber-400",success:"bg-emerald-500/10 border-emerald-500/30 text-emerald-400",info:"bg-blue-500/10 border-blue-500/30 text-blue-400"};function YS(){const{notifications:e,removeNotification:s}=_m();return e.length===0?null:t.jsx("div",{className:"fixed bottom-4 right-4 z-50 flex flex-col gap-2 max-w-md",children:e.map(a=>{const n=qS[a.type],i=GS[a.type];return t.jsx("div",{className:`${i} border rounded-lg p-4 shadow-lg backdrop-blur-sm animate-in slide-in-from-right duration-300`,children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(n,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"font-medium",children:a.message}),a.details&&t.jsx("p",{className:"text-sm opacity-80 mt-1 whitespace-pre-wrap",children:a.details})]}),t.jsx("button",{onClick:()=>s(a.id),className:"flex-shrink-0 p-1 hover:opacity-70 transition-opacity",children:t.jsx(_a,{className:"w-4 h-4"})})]})},a.id)})})}function KS({onResize:e,onResizeEnd:s}){const[a,n]=A.useState(!1),[i,l]=A.useState(0),o=A.useCallback(h=>{h.preventDefault(),n(!0),l(h.clientX)},[]),u=A.useCallback(h=>{if(!a)return;const r=h.clientX-i;l(h.clientX),e(r)},[a,i,e]),m=A.useCallback(()=>{a&&(n(!1),s==null||s())},[a,s]);return A.useEffect(()=>(a&&(document.addEventListener("mousemove",u),document.addEventListener("mouseup",m),document.body.style.cursor="col-resize",document.body.style.userSelect="none"),()=>{document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",m),document.body.style.cursor="",document.body.style.userSelect=""}),[a,u,m]),t.jsx("div",{onMouseDown:o,className:`
        w-2 flex-shrink-0 cursor-col-resize
        flex items-center justify-center
        transition-colors duration-150
        ${a?"bg-blue-500/30":"bg-slate-800 hover:bg-slate-700"}
      `,children:t.jsx("div",{className:`
        flex flex-col gap-0.5 py-2 rounded
        ${a?"opacity-100":"opacity-40 hover:opacity-100"}
        transition-opacity duration-150
      `,children:t.jsx(mf,{className:"w-3 h-3 text-slate-400"})})})}const XS=300,JS=800,QS=500;function ZS(){const[e,s]=A.useState("overview"),[a,n]=A.useState(!0),[i,l]=A.useState(QS),{config:o}=nt(),u=A.useCallback(m=>{l(h=>{const r=h-m;return Math.min(JS,Math.max(XS,r))})},[]);return t.jsxs("div",{className:"h-screen flex flex-col bg-slate-900",children:[t.jsx(US,{showPreview:a,onTogglePreview:()=>n(!a)}),t.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[t.jsx(_f,{activeSection:e,onSectionChange:s,config:o}),t.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[t.jsx("div",{className:"flex-1 flex flex-col min-h-0 min-w-0",children:t.jsx(Sb,{activeSection:e,onNavigate:s})}),a&&t.jsx(KS,{onResize:u}),a&&t.jsx("div",{className:"overflow-hidden flex-shrink-0",style:{width:i},children:t.jsx(Rb,{})})]})]}),t.jsx(YS,{})]})}Rl.createRoot(document.getElementById("root")).render(t.jsx(xo.StrictMode,{children:t.jsx(ZS,{})})); // gitleaks:allow
//# sourceMappingURL=index-CYw1oYNh.js.map // gitleaks:allow
